const t=new WeakMap,e=e=>"function"==typeof e&&t.has(e),r=void 0!==window.customElements&&void 0!==window.customElements.polyfillWrapFlushCallback,n=function(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;for(;e!==r;){const r=e.nextSibling;t.insertBefore(e,n),e=r}},o=function(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;for(;e!==r;){const r=e.nextSibling;t.removeChild(e),e=r}},a={},i={},s=`{{lit-${String(Math.random()).slice(2)}}}`,u=`\x3c!--${s}--\x3e`,l=new RegExp(`${s}|${u}`),c="$lit$";class p{constructor(t,e){this.parts=[],this.element=e;const r=[],n=[],o=document.createTreeWalker(e.content,133,null,!1);let a=0,i=-1,u=0;const{strings:p,values:{length:h}}=t;for(;u<h;){const t=o.nextNode();if(null!==t){if(i++,1===t.nodeType){if(t.hasAttributes()){const e=t.attributes,{length:r}=e;let n=0;for(let t=0;t<r;t++)d(e[t].name,c)&&n++;for(;n-- >0;){const e=p[u],r=m.exec(e)[2],n=r.toLowerCase()+c,o=t.getAttribute(n);t.removeAttribute(n);const a=o.split(l);this.parts.push({type:"attribute",index:i,name:r,strings:a}),u+=a.length-1}}"TEMPLATE"===t.tagName&&(n.push(t),o.currentNode=t.content)}else if(3===t.nodeType){const e=t.data;if(e.indexOf(s)>=0){const n=t.parentNode,o=e.split(l),a=o.length-1;for(let e=0;e<a;e++){let r,a=o[e];if(""===a)r=f();else{const t=m.exec(a);null!==t&&d(t[2],c)&&(a=a.slice(0,t.index)+t[1]+t[2].slice(0,-c.length)+t[3]),r=document.createTextNode(a)}n.insertBefore(r,t),this.parts.push({type:"node",index:++i})}""===o[a]?(n.insertBefore(f(),t),r.push(t)):t.data=o[a],u+=a}}else if(8===t.nodeType)if(t.data===s){const e=t.parentNode;null!==t.previousSibling&&i!==a||(i++,e.insertBefore(f(),t)),a=i,this.parts.push({type:"node",index:i}),null===t.nextSibling?t.data="":(r.push(t),i--),u++}else{let e=-1;for(;-1!==(e=t.data.indexOf(s,e+1));)this.parts.push({type:"node",index:-1}),u++}}else o.currentNode=n.pop()}for(const t of r)t.parentNode.removeChild(t)}}const d=(t,e)=>{const r=t.length-e.length;return r>=0&&t.slice(r)===e},h=t=>-1!==t.index,f=()=>document.createComment(""),m=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F "'>=/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/;class g{constructor(t,e,r){this.__parts=[],this.template=t,this.processor=e,this.options=r}update(t){let e=0;for(const r of this.__parts)void 0!==r&&r.setValue(t[e]),e++;for(const t of this.__parts)void 0!==t&&t.commit()}_clone(){const t=r?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),e=[],n=this.template.parts,o=document.createTreeWalker(t,133,null,!1);let a,i=0,s=0,u=o.nextNode();for(;i<n.length;)if(a=n[i],h(a)){for(;s<a.index;)s++,"TEMPLATE"===u.nodeName&&(e.push(u),o.currentNode=u.content),null===(u=o.nextNode())&&(o.currentNode=e.pop(),u=o.nextNode());if("node"===a.type){const t=this.processor.handleTextExpression(this.options);t.insertAfterNode(u.previousSibling),this.__parts.push(t)}else this.__parts.push(...this.processor.handleAttributeExpressions(u,a.name,a.strings,this.options));i++}else this.__parts.push(void 0),i++;return r&&(document.adoptNode(t),customElements.upgrade(t)),t}}const v=` ${s} `;class b{constructor(t,e,r,n){this.strings=t,this.values=e,this.type=r,this.processor=n}getHTML(){const t=this.strings.length-1;let e="",r=!1;for(let n=0;n<t;n++){const t=this.strings[n],o=t.lastIndexOf("\x3c!--");r=(o>-1||r)&&-1===t.indexOf("--\x3e",o+1);const a=m.exec(t);e+=null===a?t+(r?v:u):t.substr(0,a.index)+a[1]+a[2]+c+a[3]+s}return e+=this.strings[t]}getTemplateElement(){const t=document.createElement("template");return t.innerHTML=this.getHTML(),t}}class y extends b{getHTML(){return`<svg>${super.getHTML()}</svg>`}getTemplateElement(){const t=super.getTemplateElement(),e=t.content,r=e.firstChild;return e.removeChild(r),n(e,r.firstChild),t}}const x=t=>null===t||!("object"==typeof t||"function"==typeof t),w=t=>Array.isArray(t)||!(!t||!t[Symbol.iterator]);class k{constructor(t,e,r){this.dirty=!0,this.element=t,this.name=e,this.strings=r,this.parts=[];for(let t=0;t<r.length-1;t++)this.parts[t]=this._createPart()}_createPart(){return new C(this)}_getValue(){const t=this.strings,e=t.length-1;let r="";for(let n=0;n<e;n++){r+=t[n];const e=this.parts[n];if(void 0!==e){const t=e.value;if(x(t)||!w(t))r+="string"==typeof t?t:String(t);else for(const e of t)r+="string"==typeof e?e:String(e)}}return r+=t[e]}commit(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}}class C{constructor(t){this.value=void 0,this.committer=t}setValue(t){t===a||x(t)&&t===this.value||(this.value=t,e(t)||(this.committer.dirty=!0))}commit(){for(;e(this.value);){const t=this.value;this.value=a,t(this)}this.value!==a&&this.committer.commit()}}class S{constructor(t){this.value=void 0,this.__pendingValue=void 0,this.options=t}appendInto(t){this.startNode=t.appendChild(f()),this.endNode=t.appendChild(f())}insertAfterNode(t){this.startNode=t,this.endNode=t.nextSibling}appendIntoPart(t){t.__insert(this.startNode=f()),t.__insert(this.endNode=f())}insertAfterPart(t){t.__insert(this.startNode=f()),this.endNode=t.endNode,t.endNode=this.startNode}setValue(t){this.__pendingValue=t}commit(){for(;e(this.__pendingValue);){const t=this.__pendingValue;this.__pendingValue=a,t(this)}const t=this.__pendingValue;t!==a&&(x(t)?t!==this.value&&this.__commitText(t):t instanceof b?this.__commitTemplateResult(t):t instanceof Node?this.__commitNode(t):w(t)?this.__commitIterable(t):t===i?(this.value=i,this.clear()):this.__commitText(t))}__insert(t){this.endNode.parentNode.insertBefore(t,this.endNode)}__commitNode(t){this.value!==t&&(this.clear(),this.__insert(t),this.value=t)}__commitText(t){const e=this.startNode.nextSibling,r="string"==typeof(t=null==t?"":t)?t:String(t);e===this.endNode.previousSibling&&3===e.nodeType?e.data=r:this.__commitNode(document.createTextNode(r)),this.value=t}__commitTemplateResult(t){const e=this.options.templateFactory(t);if(this.value instanceof g&&this.value.template===e)this.value.update(t.values);else{const r=new g(e,t.processor,this.options),n=r._clone();r.update(t.values),this.__commitNode(n),this.value=r}}__commitIterable(t){Array.isArray(this.value)||(this.value=[],this.clear());const e=this.value;let r,n=0;for(const o of t)void 0===(r=e[n])&&(r=new S(this.options),e.push(r),0===n?r.appendIntoPart(this):r.insertAfterPart(e[n-1])),r.setValue(o),r.commit(),n++;n<e.length&&(e.length=n,this.clear(r&&r.endNode))}clear(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startNode;o(this.startNode.parentNode,t.nextSibling,this.endNode)}}class E{constructor(t,e,r){if(this.value=void 0,this.__pendingValue=void 0,2!==r.length||""!==r[0]||""!==r[1])throw new Error("Boolean attributes can only contain a single expression");this.element=t,this.name=e,this.strings=r}setValue(t){this.__pendingValue=t}commit(){for(;e(this.__pendingValue);){const t=this.__pendingValue;this.__pendingValue=a,t(this)}if(this.__pendingValue===a)return;const t=!!this.__pendingValue;this.value!==t&&(t?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name),this.value=t),this.__pendingValue=a}}class z extends k{constructor(t,e,r){super(t,e,r),this.single=2===r.length&&""===r[0]&&""===r[1]}_createPart(){return new I(this)}_getValue(){return this.single?this.parts[0].value:super._getValue()}commit(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}}class I extends C{}let A=!1;try{const t={get capture(){return A=!0,!1}};window.addEventListener("test",t,t),window.removeEventListener("test",t,t)}catch(Hn){}class N{constructor(t,e,r){this.value=void 0,this.__pendingValue=void 0,this.element=t,this.eventName=e,this.eventContext=r,this.__boundHandleEvent=(t=>this.handleEvent(t))}setValue(t){this.__pendingValue=t}commit(){for(;e(this.__pendingValue);){const t=this.__pendingValue;this.__pendingValue=a,t(this)}if(this.__pendingValue===a)return;const t=this.__pendingValue,r=this.value,n=null==t||null!=r&&(t.capture!==r.capture||t.once!==r.once||t.passive!==r.passive),o=null!=t&&(null==r||n);n&&this.element.removeEventListener(this.eventName,this.__boundHandleEvent,this.__options),o&&(this.__options=R(t),this.element.addEventListener(this.eventName,this.__boundHandleEvent,this.__options)),this.value=t,this.__pendingValue=a}handleEvent(t){"function"==typeof this.value?this.value.call(this.eventContext||this.element,t):this.value.handleEvent(t)}}const R=t=>t&&(A?{capture:t.capture,passive:t.passive,once:t.once}:t.capture);const T=new class{handleAttributeExpressions(t,e,r,n){const o=e[0];return"."===o?new z(t,e.slice(1),r).parts:"@"===o?[new N(t,e.slice(1),n.eventContext)]:"?"===o?[new E(t,e.slice(1),r)]:new k(t,e,r).parts}handleTextExpression(t){return new S(t)}};function D(t){let e=_.get(t.type);void 0===e&&(e={stringsArray:new WeakMap,keyString:new Map},_.set(t.type,e));let r=e.stringsArray.get(t.strings);if(void 0!==r)return r;const n=t.strings.join(s);return void 0===(r=e.keyString.get(n))&&(r=new p(t,t.getTemplateElement()),e.keyString.set(n,r)),e.stringsArray.set(t.strings,r),r}const _=new Map,O=new WeakMap,F=(t,e,r)=>{let n=O.get(e);void 0===n&&(o(e,e.firstChild),O.set(e,n=new S(Object.assign({templateFactory:D},r))),n.appendInto(e)),n.setValue(t),n.commit()};(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.1.2");const M=function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return new b(t,r,"html",T)},L=function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return new y(t,r,"svg",T)},P=function(t){return[{name:"init",fn:function(t,e){this.dom={},this.model=e||{},this.template=t,this.attachShadow({mode:"open"}),this.render()}},{name:"render",fn:function(){this.template&&F(this.template.render(this,this.model),this.shadowRoot)}}]},B=function(t,e){let r="propertyChangedCallback";e&&e.changeCallbackFnName&&(r=e.changeCallbackFnName);const n=[],o=t.observedAttributes;if(o){for(let t=0;t<o.length;t++)n.push({name:o[t],accessors:{set:function(e){const n=this.getAttribute(o[t]);!1===e?this.removeAttribute(o[t]):this.setAttribute(o[t],e),this[r]&&this[r](o[t],n,e)},get:function(){return this.getAttribute(o[t])}}});n.push({name:"attributeChangedCallback",fn:function(t,e,n){this[r]&&this[r](t,e,n)}})}return n},q=function(t,e,r){Array.isArray(e)||(e=[e]);return e.forEach(e=>{!function e(n){n.fn?t.prototype[n.name]=n.fn:n.accessors?Object.defineProperty(t.prototype,n.name,n.accessors):n(t,r).forEach(t=>e(t))}(e)}),t},V=function(t,e,r,n){let o=r||[];Array.isArray(o)||(o=[o]),n||o.push(B),customElements.get(t)||customElements.define(t,q(e,o))};var W={render(t,e){return M`${this.css()} ${this.html(t,e)}`},html:(t,e)=>M`<canvas></canvas><video playsinline loop></video>`,css:()=>M`<style>:host{display:inline-block;background-color:#000}video{transform:scaleX(1);display:none}</style>`};class U{constructor(){this._listeners=[]}addEventListener(t,e){let r={type:t,callback:e};return this._listeners.push(r),r}removeEventListener(t){for(let e=0;e<this._listeners.length;e++)if(t===this._listeners[e])return void this._listeners.splice(e,0)}triggerEvent(t){this._listeners.forEach(function(e){t.type===e.type&&e.callback.apply(this,[t])})}}let j=null;class H extends U{constructor(){return super(),j||(j=this),j}get instance(){return j||(j=new H),j}}const G=L`<svg xmlns="http://www.w3.org/2000/svg" height="18" viewBox="0 0 18 18" width="18">
  <defs>
    <style>
      .a {
        fill: #707070;
      }
    </style>
  </defs>
  <title>S RailRightOpen 18 N</title>
  <rect id="Canvas" fill="#ff13dc" opacity="0" width="18" height="18" /><path class="a" d="M7,7h4.503A.497.497,0,0,1,12,7.497v3.006a.497.497,0,0,1-.497.497H7v4.456a.25.25,0,0,1-.424.1755L0,9,6.576,2.368A.25.25,0,0,1,7,2.544Z" />
  <rect class="a" height="14" rx="0.3535" width="2" x="14" y="2" />
</svg>`,$=L`<svg xmlns="http://www.w3.org/2000/svg" height="18" viewBox="0 0 18 18" width="18">
  <defs>
    <style>
      .a {
        fill: #707070;
      }
    </style>
  </defs>
  <title>S RailRightClose 18 N</title>
  <rect id="Canvas" fill="#ff13dc" opacity="0" width="18" height="18" /><path class="a" d="M11,7H6.497A.497.497,0,0,0,6,7.497v3.006A.497.497,0,0,0,6.497,11H11v4.456a.25.25,0,0,0,.424.1755L18,9,11.424,2.368A.25.25,0,0,0,11,2.544Z" />
  <rect class="a" height="14" rx="0.3535" width="2" x="2" y="2" />
</svg>`,K=L`<svg xmlns="http://www.w3.org/2000/svg" height="18" viewBox="0 0 18 18" width="18">
  <defs>
    <style>
      .a {
        fill: #707070;
      }
    </style>
  </defs>
  <title>S Edit 18 N</title>
  <rect id="Canvas" fill="#ff13dc" opacity="0" width="18" height="18" /><path class="a" d="M16.7835,4.1,13.9,1.216a.60751.60751,0,0,0-.433-.1765H13.45a.6855.6855,0,0,0-.4635.203L2.542,11.686a.49494.49494,0,0,0-.1255.211L1.0275,16.55c-.057.1885.2295.4255.3915.4255a.12544.12544,0,0,0,.031-.0035c.138-.0315,3.933-1.172,4.6555-1.389a.486.486,0,0,0,.207-.1245L16.7565,5.014a.686.686,0,0,0,.2-.4415A.61049.61049,0,0,0,16.7835,4.1ZM5.7,14.658c-1.0805.3245-2.431.7325-3.3645,1.011L3.34,12.304Z" />
</svg>`,X=L`<svg xmlns="http://www.w3.org/2000/svg" height="18" viewBox="0 0 18 18" width="18">
  <defs>
    <style>
      .a {
        fill: #707070;
      }
    </style>
  </defs>
  <title>S Camera 18 N</title>
  <rect id="Canvas" fill="#ff13dc" opacity="0" width="18" height="18" /><path class="a" d="M9,6a3,3,0,1,0,3,3A3,3,0,0,0,9,6Z" />
  <path class="a" d="M16.5,4H13.475L11.8,2.163A.5.5,0,0,0,11.4295,2H6.5705a.5.5,0,0,0-.3695.163L4.525,4H1.5a.5.5,0,0,0-.5.5v10a.5.5,0,0,0,.5.5h15a.5.5,0,0,0,.5-.5V4.5A.5.5,0,0,0,16.5,4ZM9,13.1A4.1,4.1,0,1,1,13.1,9,4.1,4.1,0,0,1,9,13.1Z" />
</svg>`;L`<svg xmlns="http://www.w3.org/2000/svg" height="18" viewBox="0 0 18 18" width="18">
  <defs>
    <style>
      .a {
        fill: #707070;
      }
    </style>
  </defs>
  <title>S MovieCamera 18 N</title>
  <rect id="Canvas" fill="#ff13dc" opacity="0" width="18" height="18" /><path class="a" d="M16.2,5.1,12,8.25V4.909A.909.909,0,0,0,11.091,4H2.909A.909.909,0,0,0,2,4.909v8.182A.909.909,0,0,0,2.909,14h8.182A.909.909,0,0,0,12,13.091V9.75l4.2,3.15a.5.5,0,0,0,.8-.4v-7a.5.5,0,0,0-.8-.4Z" />
</svg>`;function Y(t,e,r,n){var o,a=arguments.length,i=a<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(i=(a<3?o(i):a>3?o(e,r,i):o(e,r))||i);return a>3&&i&&Object.defineProperty(e,r,i),i}const J=133;function Z(t,e){const{element:{content:r},parts:n}=t,o=document.createTreeWalker(r,J,null,!1);let a=tt(n),i=n[a],s=-1,u=0;const l=[];let c=null;for(;o.nextNode();){s++;const t=o.currentNode;for(t.previousSibling===c&&(c=null),e.has(t)&&(l.push(t),null===c&&(c=t)),null!==c&&u++;void 0!==i&&i.index===s;)i.index=null!==c?-1:i.index-u,i=n[a=tt(n,a)]}l.forEach(t=>t.parentNode.removeChild(t))}const Q=t=>{let e=11===t.nodeType?0:1;const r=document.createTreeWalker(t,J,null,!1);for(;r.nextNode();)e++;return e},tt=function(t){for(let e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1)+1;e<t.length;e++){const r=t[e];if(h(r))return e}return-1};const et=(t,e)=>`${t}--${e}`;let rt=!0;void 0===window.ShadyCSS?rt=!1:void 0===window.ShadyCSS.prepareTemplateDom&&(console.warn("Incompatible ShadyCSS version detected. Please update to at least @webcomponents/webcomponentsjs@2.0.2 and @webcomponents/shadycss@1.3.1."),rt=!1);const nt=t=>e=>{const r=et(e.type,t);let n=_.get(r);void 0===n&&(n={stringsArray:new WeakMap,keyString:new Map},_.set(r,n));let o=n.stringsArray.get(e.strings);if(void 0!==o)return o;const a=e.strings.join(s);if(void 0===(o=n.keyString.get(a))){const r=e.getTemplateElement();rt&&window.ShadyCSS.prepareTemplateDom(r,t),o=new p(e,r),n.keyString.set(a,o)}return n.stringsArray.set(e.strings,o),o},ot=["html","svg"],at=new Set,it=(t,e,r)=>{at.add(t);const n=r?r.element:document.createElement("template"),o=e.querySelectorAll("style"),{length:a}=o;if(0===a)return void window.ShadyCSS.prepareTemplateStyles(n,t);const i=document.createElement("style");for(let t=0;t<a;t++){const e=o[t];e.parentNode.removeChild(e),i.textContent+=e.textContent}(t=>{ot.forEach(e=>{const r=_.get(et(e,t));void 0!==r&&r.keyString.forEach(t=>{const{element:{content:e}}=t,r=new Set;Array.from(e.querySelectorAll("style")).forEach(t=>{r.add(t)}),Z(t,r)})})})(t);const s=n.content;r?function(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const{element:{content:n},parts:o}=t;if(null==r)return void n.appendChild(e);const a=document.createTreeWalker(n,J,null,!1);let i=tt(o),s=0,u=-1;for(;a.nextNode();)for(u++,a.currentNode===r&&(s=Q(e),r.parentNode.insertBefore(e,r));-1!==i&&o[i].index===u;){if(s>0){for(;-1!==i;)o[i].index+=s,i=tt(o,i);return}i=tt(o,i)}}(r,i,s.firstChild):s.insertBefore(i,s.firstChild),window.ShadyCSS.prepareTemplateStyles(n,t);const u=s.querySelector("style");if(window.ShadyCSS.nativeShadow&&null!==u)e.insertBefore(u.cloneNode(!0),e.firstChild);else if(r){s.insertBefore(i,s.firstChild);const t=new Set;t.add(i),Z(r,t)}};window.JSCompiler_renameProperty=((t,e)=>t);const st={toAttribute(t,e){switch(e){case Boolean:return t?"":null;case Object:case Array:return null==t?t:JSON.stringify(t)}return t},fromAttribute(t,e){switch(e){case Boolean:return null!==t;case Number:return null===t?null:Number(t);case Object:case Array:return JSON.parse(t)}return t}},ut=(t,e)=>e!==t&&(e==e||t==t),lt={attribute:!0,type:String,converter:st,reflect:!1,hasChanged:ut},ct=Promise.resolve(!0),pt=1,dt=4,ht=8,ft=16,mt=32,gt="finalized";class vt extends HTMLElement{constructor(){super(),this._updateState=0,this._instanceProperties=void 0,this._updatePromise=ct,this._hasConnectedResolver=void 0,this._changedProperties=new Map,this._reflectingProperties=void 0,this.initialize()}static get observedAttributes(){this.finalize();const t=[];return this._classProperties.forEach((e,r)=>{const n=this._attributeNameForProperty(r,e);void 0!==n&&(this._attributeToPropertyMap.set(n,r),t.push(n))}),t}static _ensureClassProperties(){if(!this.hasOwnProperty(JSCompiler_renameProperty("_classProperties",this))){this._classProperties=new Map;const t=Object.getPrototypeOf(this)._classProperties;void 0!==t&&t.forEach((t,e)=>this._classProperties.set(e,t))}}static createProperty(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:lt;if(this._ensureClassProperties(),this._classProperties.set(t,e),e.noAccessor||this.prototype.hasOwnProperty(t))return;const r="symbol"==typeof t?Symbol():`__${t}`;Object.defineProperty(this.prototype,t,{get(){return this[r]},set(e){const n=this[t];this[r]=e,this._requestUpdate(t,n)},configurable:!0,enumerable:!0})}static finalize(){const t=Object.getPrototypeOf(this);if(t.hasOwnProperty(gt)||t.finalize(),this[gt]=!0,this._ensureClassProperties(),this._attributeToPropertyMap=new Map,this.hasOwnProperty(JSCompiler_renameProperty("properties",this))){const t=this.properties,e=[...Object.getOwnPropertyNames(t),..."function"==typeof Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(t):[]];for(const r of e)this.createProperty(r,t[r])}}static _attributeNameForProperty(t,e){const r=e.attribute;return!1===r?void 0:"string"==typeof r?r:"string"==typeof t?t.toLowerCase():void 0}static _valueHasChanged(t,e){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:ut)(t,e)}static _propertyValueFromAttribute(t,e){const r=e.type,n=e.converter||st,o="function"==typeof n?n:n.fromAttribute;return o?o(t,r):t}static _propertyValueToAttribute(t,e){if(void 0===e.reflect)return;const r=e.type,n=e.converter;return(n&&n.toAttribute||st.toAttribute)(t,r)}initialize(){this._saveInstanceProperties(),this._requestUpdate()}_saveInstanceProperties(){this.constructor._classProperties.forEach((t,e)=>{if(this.hasOwnProperty(e)){const t=this[e];delete this[e],this._instanceProperties||(this._instanceProperties=new Map),this._instanceProperties.set(e,t)}})}_applyInstanceProperties(){this._instanceProperties.forEach((t,e)=>this[e]=t),this._instanceProperties=void 0}connectedCallback(){this._updateState=this._updateState|mt,this._hasConnectedResolver&&(this._hasConnectedResolver(),this._hasConnectedResolver=void 0)}disconnectedCallback(){}attributeChangedCallback(t,e,r){e!==r&&this._attributeToProperty(t,r)}_propertyToAttribute(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:lt;const n=this.constructor,o=n._attributeNameForProperty(t,r);if(void 0!==o){const t=n._propertyValueToAttribute(e,r);if(void 0===t)return;this._updateState=this._updateState|ht,null==t?this.removeAttribute(o):this.setAttribute(o,t),this._updateState=this._updateState&~ht}}_attributeToProperty(t,e){if(this._updateState&ht)return;const r=this.constructor,n=r._attributeToPropertyMap.get(t);if(void 0!==n){const t=r._classProperties.get(n)||lt;this._updateState=this._updateState|ft,this[n]=r._propertyValueFromAttribute(e,t),this._updateState=this._updateState&~ft}}_requestUpdate(t,e){let r=!0;if(void 0!==t){const n=this.constructor,o=n._classProperties.get(t)||lt;n._valueHasChanged(this[t],e,o.hasChanged)?(this._changedProperties.has(t)||this._changedProperties.set(t,e),!0!==o.reflect||this._updateState&ft||(void 0===this._reflectingProperties&&(this._reflectingProperties=new Map),this._reflectingProperties.set(t,o))):r=!1}!this._hasRequestedUpdate&&r&&this._enqueueUpdate()}requestUpdate(t,e){return this._requestUpdate(t,e),this.updateComplete}async _enqueueUpdate(){let t,e;this._updateState=this._updateState|dt;const r=this._updatePromise;this._updatePromise=new Promise((r,n)=>{t=r,e=n});try{await r}catch(t){}this._hasConnected||await new Promise(t=>this._hasConnectedResolver=t);try{const t=this.performUpdate();null!=t&&await t}catch(t){e(t)}t(!this._hasRequestedUpdate)}get _hasConnected(){return this._updateState&mt}get _hasRequestedUpdate(){return this._updateState&dt}get hasUpdated(){return this._updateState&pt}performUpdate(){this._instanceProperties&&this._applyInstanceProperties();let t=!1;const e=this._changedProperties;try{(t=this.shouldUpdate(e))&&this.update(e)}catch(e){throw t=!1,e}finally{this._markUpdated()}t&&(this._updateState&pt||(this._updateState=this._updateState|pt,this.firstUpdated(e)),this.updated(e))}_markUpdated(){this._changedProperties=new Map,this._updateState=this._updateState&~dt}get updateComplete(){return this._getUpdateComplete()}_getUpdateComplete(){return this._updatePromise}shouldUpdate(t){return!0}update(t){void 0!==this._reflectingProperties&&this._reflectingProperties.size>0&&(this._reflectingProperties.forEach((t,e)=>this._propertyToAttribute(e,this[e],t)),this._reflectingProperties=void 0)}updated(t){}firstUpdated(t){}}vt[gt]=!0;const bt=(t,e)=>"method"!==e.kind||!e.descriptor||"value"in e.descriptor?{kind:"field",key:Symbol(),placement:"own",descriptor:{},initializer(){"function"==typeof e.initializer&&(this[e.key]=e.initializer.call(this))},finisher(r){r.createProperty(e.key,t)}}:Object.assign({},e,{finisher(r){r.createProperty(e.key,t)}}),yt=(t,e,r)=>{e.constructor.createProperty(r,t)};function xt(t){return(e,r)=>void 0!==r?yt(t,e,r):bt(t,e)}function wt(t){return(e,r)=>{const n={get(){return this.renderRoot.querySelector(t)},enumerable:!0,configurable:!0};return void 0!==r?kt(n,e,r):Ct(n,e)}}const kt=(t,e,r)=>{Object.defineProperty(e,r,t)},Ct=(t,e)=>({kind:"method",placement:"prototype",key:e.key,descriptor:t}),St="adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,Et=Symbol();class zt{constructor(t,e){if(e!==Et)throw new Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t}get styleSheet(){return void 0===this._styleSheet&&(St?(this._styleSheet=new CSSStyleSheet,this._styleSheet.replaceSync(this.cssText)):this._styleSheet=null),this._styleSheet}toString(){return this.cssText}}const It=function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];const o=r.reduce((e,r,n)=>e+(t=>{if(t instanceof zt)return t.cssText;if("number"==typeof t)return t;throw new Error(`Value passed to 'css' function must be a 'css' function result: ${t}. Use 'unsafeCSS' to pass non-literal values, but\n            take care to ensure page security.`)})(r)+t[n+1],t[0]);return new zt(o,Et)};(window.litElementVersions||(window.litElementVersions=[])).push("2.2.1");const At=t=>t.flat?t.flat(1/0):function t(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];for(let n=0,o=e.length;n<o;n++){const o=e[n];Array.isArray(o)?t(o,r):r.push(o)}return r}(t);class Nt extends vt{static finalize(){super.finalize.call(this),this._styles=this.hasOwnProperty(JSCompiler_renameProperty("styles",this))?this._getUniqueStyles():this._styles||[]}static _getUniqueStyles(){const t=this.styles,e=[];if(Array.isArray(t)){At(t).reduceRight((t,e)=>(t.add(e),t),new Set).forEach(t=>e.unshift(t))}else t&&e.push(t);return e}initialize(){super.initialize(),this.renderRoot=this.createRenderRoot(),window.ShadowRoot&&this.renderRoot instanceof window.ShadowRoot&&this.adoptStyles()}createRenderRoot(){return this.attachShadow({mode:"open"})}adoptStyles(){const t=this.constructor._styles;0!==t.length&&(void 0===window.ShadyCSS||window.ShadyCSS.nativeShadow?St?this.renderRoot.adoptedStyleSheets=t.map(t=>t.styleSheet):this._needsShimAdoptedStyleSheets=!0:window.ShadyCSS.ScopingShim.prepareAdoptedCssText(t.map(t=>t.cssText),this.localName))}connectedCallback(){super.connectedCallback(),this.hasUpdated&&void 0!==window.ShadyCSS&&window.ShadyCSS.styleElement(this)}update(t){super.update(t);const e=this.render();e instanceof b&&this.constructor.render(e,this.renderRoot,{scopeName:this.localName,eventContext:this}),this._needsShimAdoptedStyleSheets&&(this._needsShimAdoptedStyleSheets=!1,this.constructor._styles.forEach(t=>{const e=document.createElement("style");e.textContent=t.cssText,this.renderRoot.appendChild(e)}))}render(){}}Nt.finalized=!0,Nt.render=((t,e,r)=>{if(!r||"object"!=typeof r||!r.scopeName)throw new Error("The `scopeName` option is required.");const n=r.scopeName,a=O.has(e),i=rt&&11===e.nodeType&&!!e.host,s=i&&!at.has(n),u=s?document.createDocumentFragment():e;if(F(t,u,Object.assign({templateFactory:nt(n)},r)),s){const t=O.get(u);O.delete(u);const r=t.value instanceof g?t.value.template:void 0;it(n,u,r),o(e,e.firstChild),e.appendChild(u),O.set(e,t)}!a&&i&&window.ShadyCSS.styleElement(e.host)});const Rt=(e=>(function(){const r=e(...arguments);return t.set(r,!0),r}))(t=>e=>{if(void 0===t&&e instanceof C){if(t!==e.value){const t=e.committer.name;e.committer.element.removeAttribute(t)}}else e.setValue(t)}),Tt=It`:host([disabled]){pointer-events:none}`,Dt=t=>{var e;const r=t=>{if(null==t.shadowRoot||t.hasAttribute("data-js-focus-visible"))return()=>{};if(!self.applyFocusVisiblePolyfill){const e=()=>{self.applyFocusVisiblePolyfill&&t.shadowRoot&&self.applyFocusVisiblePolyfill(t.shadowRoot),t.manageAutoFocus&&t.manageAutoFocus()};return self.addEventListener("focus-visible-polyfill-ready",e,{once:!0}),()=>{self.removeEventListener("focus-visible-polyfill-ready",e)}}return self.applyFocusVisiblePolyfill(t.shadowRoot),()=>{}},n=Symbol("endPolyfillCoordination");return e=n,class extends t{constructor(){super(...arguments),this[e]=null}connectedCallback(){super.connectedCallback&&super.connectedCallback(),importShim("./focus-visible-7f07070e.js"),null==this[n]&&(this[n]=r(this))}disconnectedCallback(){super.disconnectedCallback&&super.disconnectedCallback(),null!=this[n]&&(this[n](),this[n]=null)}}};class _t extends(Dt(Nt)){constructor(){super(...arguments),this.disabled=!1,this.autofocus=!1,this.tabIndex=0,this.isShiftTabbing=!1,this.newTabindex=0,this.oldTabindex=0}static get styles(){return[Tt]}get focusElement(){throw new Error("Must implement focusElement getter!")}focus(){this.disabled||this.focusElement.focus()}blur(){this.focusElement.blur()}manageAutoFocus(){this.autofocus&&(this.dispatchEvent(new KeyboardEvent("keydown",{code:"Tab"})),this.focus())}firstUpdated(){this.manageAutoFocus(),this.addEventListener("focusin",t=>{t.composedPath()[0]===this&&this.handleFocus()}),this.addEventListener("keydown",t=>{!t.defaultPrevented&&t.shiftKey&&"Tab"===t.code&&(this.isShiftTabbing=!0,HTMLElement.prototype.focus.apply(this),setTimeout(()=>this.isShiftTabbing=!1,0))})}update(t){t.has("disabled")&&this.handleDisabledChanged(this.disabled,t.get("disabled")),t.has("tabIndex")&&(this.newTabindex=this.tabIndex,this.handleTabIndexChanged(this.tabIndex)),super.update(t)}updated(t){super.updated(t),t.has("disabled")&&(this.focusElement.disabled=this.disabled,this.disabled&&this.blur()),t.has("tabIndex")&&void 0!==this.newTabindex&&(this.focusElement.tabIndex=this.newTabindex,this.newTabindex=void 0)}handleFocus(){this.isShiftTabbing||this.focusElement.focus()}handleDisabledChanged(t,e){t?(this.oldTabindex=this.tabIndex,this.tabIndex=-1,this.setAttribute("aria-disabled","true")):e&&(this.tabIndex=this.oldTabindex,this.removeAttribute("aria-disabled"))}handleTabIndexChanged(t){this.disabled&&t&&(-1!==this.tabIndex&&(this.oldTabindex=this.tabIndex),this.tabIndex=-1)}}Y([xt({type:Boolean,reflect:!0})],_t.prototype,"disabled",void 0),Y([xt({type:Boolean})],_t.prototype,"autofocus",void 0),Y([xt({type:Number,reflect:!0})],_t.prototype,"tabIndex",void 0);const Ot=Symbol("observedSlotElement"),Ft=Symbol("slotElementObserver"),Mt=Symbol("startObserving");function Lt(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#slot";return class extends t{constructor(){super(...arguments),this.slotHasContent=!1}manageObservedSlot(){if(this[Ot]=this[Ot]||(this.shadowRoot?this.shadowRoot.querySelector(e):void 0),!this[Ot])return;const t=this[Ot];let r=t.assignedNodes?t.assignedNodes():[...this.childNodes].filter(t=>{return!t.hasAttribute("slot")});r=r.filter(t=>!!t.tagName||!!t.textContent&&t.textContent.trim()),this.slotHasContent=r.length>0,this.requestUpdate()}firstUpdated(t){super.firstUpdated(t),this.manageObservedSlot()}[Mt](){if(!this[Ft]){const t=t=>{for(const e of t)"characterData"===e.type&&this.manageObservedSlot()};this[Ft]=new MutationObserver(t)}this[Ft].observe(this,{characterData:!0,subtree:!0})}connectedCallback(){super.connectedCallback(),this[Mt]()}disconnectedCallback(){this[Ft]&&this[Ft].disconnect(),super.disconnectedCallback()}}}class Pt extends(Lt(_t)){constructor(){super(...arguments),this.iconRight=!1}get hasIcon(){return!!this.querySelector('[slot="icon"]')}get hasLabel(){return this.slotHasContent}get focusElement(){return this.shadowRoot?this.shadowRoot.querySelector("#button"):this}get buttonContent(){const t=M`<slot name="icon"></slot>`,e=[M`<div id="label" ?hidden="${!this.hasLabel}"><slot id="slot" @slotchange="${this.manageObservedSlot}"></slot></div>`];return this.hasIcon?(this.iconRight?e.push(t):e.unshift(t),e):e}render(){return this.href&&this.href.length>0?M`<a href="${this.href}" id="button" target="${Rt(this.target)}" aria-label="${Rt(this.label)}">${this.buttonContent}</a>`:M`<button id="button" aria-label="${Rt(this.label)}">${this.buttonContent}</button>`}}Y([xt()],Pt.prototype,"href",void 0),Y([xt()],Pt.prototype,"label",void 0),Y([xt()],Pt.prototype,"target",void 0),Y([xt({type:Boolean,reflect:!0,attribute:"icon-right"})],Pt.prototype,"iconRight",void 0);const Bt=It`#button{display:inline-flex;box-sizing:border-box;align-items:center;justify-content:center;overflow:visible;margin:0;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-appearance:button;vertical-align:top;transition:background var(--spectrum-global-animation-duration-100,.13s) ease-out,border-color var(--spectrum-global-animation-duration-100,.13s) ease-out,color var(--spectrum-global-animation-duration-100,.13s) ease-out,box-shadow var(--spectrum-global-animation-duration-100,.13s) ease-out;text-decoration:none;font-family:adobe-clean-ux,adobe-clean,Source Sans Pro,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif;line-height:1.3;cursor:pointer;border-width:var(--spectrum-button-primary-border-size,var(--spectrum-alias-border-size-thick));border-style:solid;border-radius:var(--spectrum-button-primary-border-radius,var(--spectrum-alias-border-radius-large));min-height:var(--spectrum-button-primary-height,var(--spectrum-alias-single-line-height));height:auto;min-width:var(--spectrum-button-primary-min-width);padding:var(--spectrum-global-dimension-size-50) calc(var(--spectrum-button-primary-padding-x,var(--spectrum-global-dimension-size-200)) - var(--spectrum-button-primary-border-size,var(--spectrum-alias-border-size-thick)));padding-bottom:calc(var(--spectrum-global-dimension-size-50) + .5px);padding-top:calc(var(--spectrum-global-dimension-size-50) - .5px);font-size:var(--spectrum-button-primary-text-size,var(--spectrum-alias-pill-button-text-size));font-weight:var(--spectrum-button-primary-text-font-weight,var(--spectrum-global-font-weight-bold))}#button:focus{outline:0}#button::-moz-focus-inner{border:0;border-style:none;padding:0;margin-top:-2px;margin-bottom:-2px}:host([disabled]) #button{cursor:default}::slotted([slot=icon]){max-height:100%;flex-shrink:0}#button:active,#button:hover{box-shadow:none}slot[name=icon]+#label{margin-left:var(--spectrum-button-primary-text-gap,var(--spectrum-global-dimension-size-100))}#label+::slotted([slot=icon]){margin-left:calc(var(--spectrum-button-primary-text-gap,
var(--spectrum-global-dimension-size-100))/2)}#label{align-self:center;justify-self:center;text-align:center;width:100%}#label:empty{display:none}#button.focus-visible{box-shadow:0 0 0 1px var(--spectrum-button-primary-border-color-key-focus,var(--spectrum-semantic-cta-color-background-key-focus))}#button:active{box-shadow:none}:host([variant=cta]) #button{background-color:var(--spectrum-button-cta-background-color,var(--spectrum-semantic-cta-color-background-default));border-color:var(--spectrum-button-cta-border-color,var(--spectrum-semantic-cta-color-background-default));color:var(--spectrum-button-cta-text-color,var(--spectrum-global-color-static-white))}:host([variant=cta]) #button:hover{background-color:var(--spectrum-button-cta-background-color-hover,var(--spectrum-semantic-cta-color-background-hover));border-color:var(--spectrum-button-cta-border-color-hover,var(--spectrum-semantic-cta-color-background-hover));color:var(--spectrum-button-cta-text-color-hover,var(--spectrum-global-color-static-white))}:host([variant=cta]) #button.focus-visible{background-color:var(--spectrum-button-cta-background-color-key-focus,var(--spectrum-semantic-cta-color-background-key-focus));border-color:var(--spectrum-button-cta-border-color-key-focus,var(--spectrum-semantic-cta-color-background-key-focus));color:var(--spectrum-button-cta-text-color-key-focus,var(--spectrum-global-color-static-white))}:host([variant=cta]) #button:active{background-color:var(--spectrum-button-cta-background-color-down,var(--spectrum-semantic-cta-color-background-down));border-color:var(--spectrum-button-cta-border-color-down,var(--spectrum-semantic-cta-color-background-down));color:var(--spectrum-button-cta-text-color-down,var(--spectrum-global-color-static-white))}:host([variant=cta][disabled]) #button{background-color:var(--spectrum-button-cta-background-color-disabled,var(--spectrum-global-color-gray-200));border-color:var(--spectrum-button-cta-border-color-disabled,var(--spectrum-global-color-gray-200));color:var(--spectrum-button-cta-text-color-disabled,var(--spectrum-global-color-gray-500))}:host([variant=primary]) #button{background-color:var(--spectrum-button-primary-background-color,var(--spectrum-alias-background-color-transparent));border-color:var(--spectrum-button-primary-border-color,var(--spectrum-global-color-gray-800));color:var(--spectrum-button-primary-text-color,var(--spectrum-global-color-gray-800))}:host([variant=primary]) #button:hover{background-color:var(--spectrum-button-primary-background-color-hover,var(--spectrum-global-color-gray-800));border-color:var(--spectrum-button-primary-border-color-hover,var(--spectrum-global-color-gray-800));color:var(--spectrum-button-primary-text-color-hover,var(--spectrum-global-color-gray-50))}:host([variant=primary]) #button.focus-visible{background-color:var(--spectrum-button-primary-background-color-key-focus,var(--spectrum-semantic-cta-color-background-key-focus));border-color:var(--spectrum-button-primary-border-color-key-focus,var(--spectrum-semantic-cta-color-background-key-focus));color:var(--spectrum-button-primary-text-color-key-focus,var(--spectrum-global-color-static-white))}:host([variant=primary]) #button:active{background-color:var(--spectrum-button-primary-background-color-down,var(--spectrum-global-color-gray-900));border-color:var(--spectrum-button-primary-border-color-down,var(--spectrum-global-color-gray-900));color:var(--spectrum-button-primary-text-color-down,var(--spectrum-global-color-gray-50))}:host([variant=primary][disabled]) #button{background-color:var(--spectrum-button-primary-background-color-disabled,var(--spectrum-global-color-gray-200));border-color:var(--spectrum-button-primary-border-color-disabled,var(--spectrum-global-color-gray-200));color:var(--spectrum-button-primary-text-color-disabled,var(--spectrum-global-color-gray-500))}:host([variant=secondary]) #button{background-color:var(--spectrum-button-secondary-background-color,var(--spectrum-alias-background-color-transparent));border-color:var(--spectrum-button-secondary-border-color,var(--spectrum-global-color-gray-700));color:var(--spectrum-button-secondary-text-color,var(--spectrum-global-color-gray-700))}:host([variant=secondary]) #button:hover{background-color:var(--spectrum-button-secondary-background-color-hover,var(--spectrum-global-color-gray-700));border-color:var(--spectrum-button-secondary-border-color-hover,var(--spectrum-global-color-gray-700));color:var(--spectrum-button-secondary-text-color-hover,var(--spectrum-global-color-gray-50))}:host([variant=secondary]) #button.focus-visible{background-color:var(--spectrum-button-secondary-background-color-key-focus,var(--spectrum-semantic-cta-color-background-key-focus));border-color:var(--spectrum-button-secondary-border-color-key-focus,var(--spectrum-semantic-cta-color-background-key-focus));color:var(--spectrum-button-secondary-text-color-key-focus,var(--spectrum-global-color-static-white))}:host([variant=secondary]) #button:active{background-color:var(--spectrum-button-secondary-background-color-down,var(--spectrum-global-color-gray-800));border-color:var(--spectrum-button-secondary-border-color-down,var(--spectrum-global-color-gray-800));color:var(--spectrum-button-secondary-text-color-down,var(--spectrum-global-color-gray-50))}:host([variant=secondary][disabled]) #button{background-color:var(--spectrum-button-secondary-background-color-disabled,var(--spectrum-global-color-gray-200));border-color:var(--spectrum-button-secondary-border-color-disabled,var(--spectrum-global-color-gray-200));color:var(--spectrum-button-secondary-text-color-disabled,var(--spectrum-global-color-gray-500))}:host([variant=negative]) #button{background-color:var(--spectrum-button-warning-background-color,var(--spectrum-alias-background-color-transparent));border-color:var(--spectrum-button-warning-border-color,var(--spectrum-semantic-negative-color-text-small));color:var(--spectrum-button-warning-text-color,var(--spectrum-semantic-negative-color-text-small))}:host([variant=negative]) #button:hover{background-color:var(--spectrum-button-warning-background-color-hover,var(--spectrum-semantic-negative-color-text-small));border-color:var(--spectrum-button-warning-border-color-hover,var(--spectrum-semantic-negative-color-text-small));color:var(--spectrum-button-warning-text-color-hover,var(--spectrum-global-color-gray-50))}:host([variant=negative]) #button.focus-visible{background-color:var(--spectrum-button-warning-background-color-key-focus,var(--spectrum-semantic-cta-color-background-key-focus));border-color:var(--spectrum-button-warning-border-color-key-focus,var(--spectrum-semantic-cta-color-background-key-focus));color:var(--spectrum-button-warning-text-color-key-focus,var(--spectrum-global-color-static-white))}:host([variant=negative]) #button:active{background-color:var(--spectrum-button-warning-background-color-down,var(--spectrum-global-color-red-700));border-color:var(--spectrum-button-warning-border-color-down,var(--spectrum-global-color-red-700));color:var(--spectrum-button-warning-text-color-down,var(--spectrum-global-color-gray-50))}:host([variant=negative][disabled]) #button{background-color:var(--spectrum-button-warning-background-color-disabled,var(--spectrum-global-color-gray-200));border-color:var(--spectrum-button-warning-border-color-disabled,var(--spectrum-global-color-gray-200));color:var(--spectrum-button-warning-text-color-disabled,var(--spectrum-global-color-gray-500))}:host([variant=overBackground]) #button{background-color:var(--spectrum-button-over-background-background-color,var(--spectrum-alias-background-color-transparent));border-color:var(--spectrum-button-over-background-border-color,var(--spectrum-global-color-static-white));color:var(--spectrum-button-over-background-text-color,var(--spectrum-global-color-static-white))}:host([variant=overBackground]) #button:hover{background-color:var(--spectrum-button-over-background-background-color-hover,var(--spectrum-global-color-static-white));border-color:var(--spectrum-button-over-background-border-color-hover,var(--spectrum-global-color-static-white));color:inherit}:host([variant=overBackground]) #button.focus-visible{background-color:var(--spectrum-button-over-background-background-color-key-focus,var(--spectrum-global-color-static-white));border-color:var(--spectrum-button-over-background-border-color-key-focus,var(--spectrum-global-color-static-white));color:inherit;box-shadow:0 0 0 1px var(--spectrum-button-over-background-border-color-key-focus,var(--spectrum-global-color-static-white))}:host([variant=overBackground]) #button:active{background-color:var(--spectrum-button-over-background-background-color-down,var(--spectrum-global-color-static-white));border-color:var(--spectrum-button-over-background-border-color-down,var(--spectrum-global-color-static-white));color:inherit;box-shadow:none}:host([variant=overBackground][disabled]) #button{background-color:var(--spectrum-button-over-background-background-color-disabled,hsla(0,0%,100%,.1));border-color:var(--spectrum-button-over-background-border-color-disabled,var(--spectrum-alias-border-color-transparent));color:var(--spectrum-button-over-background-text-color-disabled,hsla(0,0%,100%,.35))}:host([variant=overBackground][quiet]) #button{background-color:var(--spectrum-button-quiet-over-background-background-color,var(--spectrum-alias-background-color-transparent));border-color:var(--spectrum-button-quiet-over-background-border-color,var(--spectrum-alias-border-color-transparent));color:var(--spectrum-button-quiet-over-background-text-color,var(--spectrum-global-color-static-white))}:host([variant=overBackground][quiet]) #button:hover{background-color:var(--spectrum-button-quiet-over-background-background-color-hover,hsla(0,0%,100%,.1));border-color:var(--spectrum-button-quiet-over-background-border-color-hover,var(--spectrum-alias-border-color-transparent));color:var(--spectrum-button-quiet-over-background-text-color-hover,var(--spectrum-global-color-static-white))}:host([variant=overBackground][quiet]) #button.focus-visible{background-color:var(--spectrum-button-quiet-over-background-background-color-key-focus,var(--spectrum-global-color-static-white));border-color:var(--spectrum-button-quiet-over-background-border-color-key-focus,var(--spectrum-global-color-static-white));color:inherit;box-shadow:0 0 0 1px var(--spectrum-button-quiet-over-background-border-color-key-focus,var(--spectrum-global-color-static-white))}:host([variant=overBackground][quiet]) #button:active{background-color:var(--spectrum-button-quiet-over-background-background-color-down,hsla(0,0%,100%,.15));border-color:var(--spectrum-button-quiet-over-background-border-color-down,var(--spectrum-alias-border-color-transparent));color:var(--spectrum-button-quiet-over-background-text-color-down,var(--spectrum-global-color-static-white));box-shadow:none}:host([variant=overBackground][quiet][disabled]) #button{background-color:var(--spectrum-button-quiet-over-background-background-color-disabled,var(--spectrum-alias-background-color-transparent));border-color:var(--spectrum-button-quiet-over-background-border-color-disabled,var(--spectrum-alias-border-color-transparent));color:var(--spectrum-button-quiet-over-background-text-color-disabled,hsla(0,0%,100%,.15))}:host([variant=primary][quiet]) #button{background-color:var(--spectrum-button-quiet-primary-background-color,var(--spectrum-alias-background-color-transparent));border-color:var(--spectrum-button-quiet-primary-border-color,var(--spectrum-alias-border-color-transparent));color:var(--spectrum-button-quiet-primary-text-color,var(--spectrum-global-color-gray-800))}:host([variant=primary][quiet]) #button:hover{background-color:var(--spectrum-button-quiet-primary-background-color-hover,var(--spectrum-global-color-gray-200));border-color:var(--spectrum-button-quiet-primary-border-color-hover,var(--spectrum-global-color-gray-200));color:var(--spectrum-button-quiet-primary-text-color-hover,var(--spectrum-global-color-gray-900))}:host([variant=primary][quiet]) #button.focus-visible{background-color:var(--spectrum-button-quiet-primary-background-color-key-focus,var(--spectrum-semantic-cta-color-background-key-focus));border-color:var(--spectrum-button-quiet-primary-border-color-key-focus,var(--spectrum-semantic-cta-color-background-key-focus));color:var(--spectrum-button-quiet-primary-text-color-key-focus,var(--spectrum-global-color-static-white))}:host([variant=primary][quiet]) #button:active{background-color:var(--spectrum-button-quiet-primary-background-color-down,var(--spectrum-global-color-gray-300));border-color:var(--spectrum-button-quiet-primary-border-color-down,var(--spectrum-global-color-gray-300));color:var(--spectrum-button-quiet-primary-text-color-down,var(--spectrum-global-color-gray-900))}:host([variant=primary][quiet][disabled]) #button{background-color:var(--spectrum-button-quiet-primary-background-color-disabled,var(--spectrum-alias-background-color-transparent));border-color:var(--spectrum-button-quiet-primary-border-color-disabled,var(--spectrum-alias-border-color-transparent));color:var(--spectrum-button-quiet-primary-text-color-disabled,var(--spectrum-global-color-gray-500))}:host([variant=secondary][quiet]) #button{background-color:var(--spectrum-button-quiet-secondary-background-color,var(--spectrum-alias-background-color-transparent));border-color:var(--spectrum-button-quiet-secondary-border-color,var(--spectrum-alias-border-color-transparent));color:var(--spectrum-button-quiet-secondary-text-color,var(--spectrum-global-color-gray-700))}:host([variant=secondary][quiet]) #button:hover{background-color:var(--spectrum-button-quiet-secondary-background-color-hover,var(--spectrum-global-color-gray-200));border-color:var(--spectrum-button-quiet-secondary-border-color-hover,var(--spectrum-global-color-gray-200));color:var(--spectrum-button-quiet-secondary-text-color-hover,var(--spectrum-global-color-gray-800))}:host([variant=secondary][quiet]) #button.focus-visible{background-color:var(--spectrum-button-quiet-secondary-background-color-key-focus,var(--spectrum-semantic-cta-color-background-key-focus));border-color:var(--spectrum-button-quiet-secondary-border-color-key-focus,var(--spectrum-semantic-cta-color-background-key-focus));color:var(--spectrum-button-quiet-secondary-text-color-key-focus,var(--spectrum-global-color-static-white))}:host([variant=secondary][quiet]) #button:active{background-color:var(--spectrum-button-quiet-secondary-background-color-down,var(--spectrum-global-color-gray-300));border-color:var(--spectrum-button-quiet-secondary-border-color-down,var(--spectrum-global-color-gray-300));color:var(--spectrum-button-quiet-secondary-text-color-down,var(--spectrum-global-color-gray-800))}:host([variant=secondary][quiet][disabled]) #button{background-color:var(--spectrum-button-quiet-secondary-background-color-disabled,var(--spectrum-alias-background-color-transparent));border-color:var(--spectrum-button-quiet-secondary-border-color-disabled,var(--spectrum-alias-border-color-transparent));color:var(--spectrum-button-quiet-secondary-text-color-disabled,var(--spectrum-global-color-gray-500))}:host([variant=negative][quiet]) #button{background-color:var(--spectrum-button-quiet-warning-background-color,var(--spectrum-alias-background-color-transparent));border-color:var(--spectrum-button-quiet-warning-border-color,var(--spectrum-alias-border-color-transparent));color:var(--spectrum-button-quiet-warning-text-color,var(--spectrum-semantic-negative-color-text-small))}:host([variant=negative][quiet]) #button:hover{background-color:var(--spectrum-button-quiet-warning-background-color-hover,var(--spectrum-global-color-gray-200));border-color:var(--spectrum-button-quiet-warning-border-color-hover,var(--spectrum-global-color-gray-200));color:var(--spectrum-button-quiet-warning-text-color-hover,var(--spectrum-global-color-red-700))}:host([variant=negative][quiet]) #button.focus-visible{background-color:var(--spectrum-button-quiet-warning-background-color-key-focus,var(--spectrum-semantic-cta-color-background-key-focus));border-color:var(--spectrum-button-quiet-warning-border-color-key-focus,var(--spectrum-semantic-cta-color-background-key-focus));color:var(--spectrum-button-quiet-warning-text-color-key-focus,var(--spectrum-global-color-static-white))}:host([variant=negative][quiet]) #button:active{background-color:var(--spectrum-button-quiet-warning-background-color-down,var(--spectrum-global-color-gray-300));border-color:var(--spectrum-button-quiet-warning-border-color-down,var(--spectrum-global-color-gray-300));color:var(--spectrum-button-quiet-warning-text-color-down,var(--spectrum-global-color-red-700))}:host([variant=negative][quiet][disabled]) #button{background-color:var(--spectrum-button-quiet-warning-background-color-disabled,var(--spectrum-alias-background-color-transparent));border-color:var(--spectrum-button-quiet-warning-border-color-disabled,var(--spectrum-alias-border-color-transparent));color:var(--spectrum-button-quiet-warning-text-color-disabled,var(--spectrum-global-color-gray-500))}:host{display:inline-flex;flex-direction:row;vertical-align:top}#button{display:flex;flex:1 1 auto;-webkit-appearance:none}:host([disabled]){pointer-events:none}slot[name=icon]::slotted(svg){fill:currentColor;stroke:currentColor;width:var(--spectrum-alias-workflow-icon-size,18px);height:var(--spectrum-alias-workflow-icon-size,18px)}`;class qt extends Pt{constructor(){super(...arguments),this.variant="cta",this.warning=!1,this.quiet=!1}static get styles(){return[Bt]}}Y([xt({reflect:!0})],qt.prototype,"variant",void 0),Y([xt({type:Boolean,reflect:!0})],qt.prototype,"warning",void 0),Y([xt({type:Boolean,reflect:!0})],qt.prototype,"quiet",void 0);const Vt=It`#button{display:inline-flex;box-sizing:border-box;align-items:center;justify-content:center;overflow:visible;margin:0;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-appearance:button;vertical-align:top;transition:background var(--spectrum-global-animation-duration-100,.13s) ease-out,border-color var(--spectrum-global-animation-duration-100,.13s) ease-out,color var(--spectrum-global-animation-duration-100,.13s) ease-out,box-shadow var(--spectrum-global-animation-duration-100,.13s) ease-out;text-decoration:none;font-family:adobe-clean-ux,adobe-clean,Source Sans Pro,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif;line-height:1.3;cursor:pointer;position:relative;height:var(--spectrum-actionbutton-height,var(--spectrum-alias-single-line-height));min-width:var(--spectrum-actionbutton-min-width,var(--spectrum-global-dimension-size-400));padding:0 calc(var(--spectrum-actionbutton-icon-padding-x,var(--spectrum-global-dimension-size-85)) - var(--spectrum-actionbutton-border-size,var(--spectrum-alias-border-size-thin)));border-radius:var(--spectrum-actionbutton-border-radius,var(--spectrum-alias-border-radius-regular));font-size:var(--spectrum-actionbutton-text-size,var(--spectrum-alias-font-size-default));font-weight:var(--spectrum-actionbutton-text-font-weight,var(--spectrum-alias-body-text-font-weight));background-color:var(--spectrum-actionbutton-background-color,var(--spectrum-global-color-gray-75));border:var(--spectrum-actionbutton-border-size,var(--spectrum-alias-border-size-thin)) solid var(--spectrum-actionbutton-border-color,var(--spectrum-alias-border-color));color:var(--spectrum-actionbutton-text-color,var(--spectrum-alias-text-color))}#button:focus{outline:0}#button::-moz-focus-inner{border:0;border-style:none;padding:0;margin-top:-2px;margin-bottom:-2px}:host([disabled]) #button{cursor:default;background-color:var(--spectrum-actionbutton-background-color-disabled,var(--spectrum-global-color-gray-200));border-color:var(--spectrum-actionbutton-border-color-disabled,var(--spectrum-global-color-gray-200));color:var(--spectrum-actionbutton-text-color-disabled,var(--spectrum-alias-text-color-disabled))}::slotted([slot=icon]){max-height:100%;color:var(--spectrum-actionbutton-icon-color,var(--spectrum-alias-icon-color))}slot[name=icon]+#label{padding-left:var(--spectrum-actionbutton-icon-padding-x,var(--spectrum-global-dimension-size-85));padding-right:calc(var(--spectrum-actionbutton-text-padding-x,var(--spectrum-global-dimension-size-150)) - var(--spectrum-actionbutton-icon-padding-x,var(--spectrum-global-dimension-size-85)))}.spectrum-Icon--sizeS:only-child{position:absolute;top:calc(50% - var(--spectrum-actionbutton-icon-size,var(--spectrum-alias-workflow-icon-size))/ 2);left:calc(50% - var(--spectrum-actionbutton-icon-size,var(--spectrum-alias-workflow-icon-size))/ 2)}#label:only-child{padding:0 calc(var(--spectrum-actionbutton-text-padding-x,var(--spectrum-global-dimension-size-150)) - var(--spectrum-actionbutton-icon-padding-x,var(--spectrum-global-dimension-size-85)))}#hold-affordance{position:absolute;right:var(--spectrum-actionbutton-hold-icon-padding-right,var(--spectrum-global-dimension-size-40));bottom:var(--spectrum-actionbutton-hold-icon-padding-bottom,var(--spectrum-global-dimension-size-40));color:var(--spectrum-actionbutton-hold-icon-color,var(--spectrum-alias-icon-color))}#label{align-self:center;justify-self:center;text-align:center;width:100%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}#label:empty{display:none}:host([quiet]) #button{border-width:var(--spectrum-actionbutton-quiet-border-size,var(--spectrum-alias-border-size-thin));border-radius:var(--spectrum-actionbutton-quiet-border-radius,var(--spectrum-alias-border-radius-regular));font-size:var(--spectrum-actionbutton-quiet-text-size,var(--spectrum-alias-font-size-default));font-weight:var(--spectrum-actionbutton-quiet-text-font-weight,var(--spectrum-alias-body-text-font-weight));background-color:var(--spectrum-actionbutton-quiet-background-color,var(--spectrum-alias-background-color-transparent));border-color:var(--spectrum-actionbutton-quiet-border-color,var(--spectrum-alias-border-color-transparent));color:var(--spectrum-actionbutton-quiet-text-color,var(--spectrum-alias-text-color))}#button:hover{background-color:var(--spectrum-actionbutton-background-color-hover,var(--spectrum-global-color-gray-50));border-color:var(--spectrum-actionbutton-border-color-hover,var(--spectrum-alias-border-color-hover));box-shadow:none;color:var(--spectrum-actionbutton-text-color-hover,var(--spectrum-alias-text-color-hover))}#button:hover ::slotted([slot=icon]){color:var(--spectrum-actionbutton-icon-color-hover,var(--spectrum-alias-icon-color-hover))}#button:hover #hold-affordance{color:var(--spectrum-actionbutton-hold-icon-color-hover,var(--spectrum-alias-icon-color-hover))}#button.focus-visible{background-color:var(--spectrum-actionbutton-background-color-key-focus,var(--spectrum-global-color-gray-50));border-color:var(--spectrum-actionbutton-border-color-key-focus,var(--spectrum-alias-border-color-focus));box-shadow:0 0 0 1px var(--spectrum-actionbutton-border-color-key-focus,var(--spectrum-alias-border-color-focus));color:var(--spectrum-actionbutton-text-color-key-focus,var(--spectrum-alias-text-color-hover))}#button.focus-visible ::slotted([slot=icon]){color:var(--spectrum-actionbutton-icon-color-key-focus,var(--spectrum-alias-icon-color-focus))}#button.focus-visible #hold-affordance{color:var(--spectrum-actionbutton-hold-icon-color-key-focus,var(--spectrum-alias-icon-color-hover))}#button:active{background-color:var(--spectrum-actionbutton-background-color-down,var(--spectrum-global-color-gray-200));border-color:var(--spectrum-actionbutton-border-color-down,var(--spectrum-global-color-gray-400));box-shadow:none;color:var(--spectrum-actionbutton-text-color-down,var(--spectrum-alias-text-color-down))}#button:active #hold-affordance{color:var(--spectrum-actionbutton-hold-icon-color-down,var(--spectrum-alias-icon-color-down))}:host([disabled]) #button ::slotted([slot=icon]){color:var(--spectrum-actionbutton-icon-color-disabled,var(--spectrum-alias-icon-color-disabled))}:host([disabled]) #button #hold-affordance{color:var(--spectrum-actionbutton-hold-icon-color-disabled,var(--spectrum-alias-icon-color-disabled))}:host([selected]) #button{background-color:var(--spectrum-actionbutton-background-color-selected,var(--spectrum-global-color-gray-200));border-color:var(--spectrum-actionbutton-border-color-selected,var(--spectrum-global-color-gray-300));color:var(--spectrum-actionbutton-text-color-selected,var(--spectrum-alias-text-color))}:host([selected]) #button ::slotted([slot=icon]){color:var(--spectrum-actionbutton-icon-color-selected,var(--spectrum-alias-icon-color))}:host([selected]) #button.focus-visible{background-color:var(--spectrum-actionbutton-background-color-selected-key-focus,var(--spectrum-global-color-gray-200));border-color:var(--spectrum-actionbutton-border-color-selected-key-focus,var(--spectrum-alias-border-color-focus));color:var(--spectrum-actionbutton-text-color-selected-key-focus,var(--spectrum-alias-text-color-hover))}:host([selected]) #button.focus-visible ::slotted([slot=icon]){color:var(--spectrum-actionbutton-icon-color-selected-key-focus,var(--spectrum-alias-icon-color-hover))}:host([selected]) #button:hover{background-color:var(--spectrum-actionbutton-background-color-selected-hover,var(--spectrum-global-color-gray-200));border-color:var(--spectrum-actionbutton-border-color-selected-hover,var(--spectrum-global-color-gray-400));color:var(--spectrum-actionbutton-text-color-selected-hover,var(--spectrum-alias-text-color-hover))}:host([selected]) #button:hover ::slotted([slot=icon]){color:var(--spectrum-actionbutton-icon-color-selected-hover,var(--spectrum-alias-icon-color-hover))}:host([selected]) #button:active{background-color:var(--spectrum-actionbutton-background-color-selected-down,var(--spectrum-global-color-gray-200));border-color:var(--spectrum-actionbutton-border-color-selected-down,var(--spectrum-global-color-gray-400));color:var(--spectrum-actionbutton-text-color-selected-down,var(--spectrum-alias-text-color-down))}:host([selected]) #button:active ::slotted([slot=icon]){color:var(--spectrum-actionbutton-icon-color-selected-down,var(--spectrum-alias-icon-color-down))}:host([selected][disabled]) #button{background-color:var(--spectrum-actionbutton-background-color-selected-disabled,var(--spectrum-global-color-gray-200));border-color:var(--spectrum-actionbutton-border-color-selected-disabled,var(--spectrum-global-color-gray-200));color:var(--spectrum-actionbutton-text-color-selected-disabled,var(--spectrum-alias-text-color-disabled))}:host([selected][disabled]) #button ::slotted([slot=icon]){color:var(--spectrum-actionbutton-icon-color-selected-disabled,var(--spectrum-alias-icon-color-disabled))}:host([quiet]) #button:hover{background-color:var(--spectrum-actionbutton-quiet-background-color-hover,var(--spectrum-alias-background-color-transparent));border-color:var(--spectrum-actionbutton-quiet-border-color-hover,var(--spectrum-alias-border-color-transparent));color:var(--spectrum-actionbutton-quiet-text-color-hover,var(--spectrum-alias-text-color-hover));box-shadow:none}:host([quiet]) #button.focus-visible{background-color:var(--spectrum-actionbutton-quiet-background-color-key-focus,var(--spectrum-alias-background-color-transparent));box-shadow:0 0 0 1px var(--spectrum-actionbutton-quiet-border-color-key-focus,var(--spectrum-alias-border-color-focus));border-color:var(--spectrum-actionbutton-quiet-border-color-key-focus,var(--spectrum-alias-border-color-focus));color:var(--spectrum-actionbutton-quiet-text-color-key-focus,var(--spectrum-alias-text-color-hover))}:host([quiet]) #button:active{background-color:var(--spectrum-actionbutton-quiet-background-color-down,var(--spectrum-global-color-gray-300));border-color:var(--spectrum-actionbutton-quiet-border-color-down,var(--spectrum-global-color-gray-300));color:var(--spectrum-actionbutton-quiet-text-color-down,var(--spectrum-alias-text-color-down));box-shadow:none}:host([quiet][disabled]) #button{background-color:var(--spectrum-actionbutton-quiet-background-color-disabled,var(--spectrum-alias-background-color-transparent));border-color:var(--spectrum-actionbutton-quiet-border-color-disabled,var(--spectrum-alias-border-color-transparent));color:var(--spectrum-actionbutton-quiet-text-color-disabled,var(--spectrum-alias-text-color-disabled))}:host([quiet][selected]) #button{background-color:var(--spectrum-actionbutton-quiet-background-color-selected,var(--spectrum-global-color-gray-300));border-color:var(--spectrum-actionbutton-quiet-border-color-selected,var(--spectrum-global-color-gray-300));color:var(--spectrum-actionbutton-quiet-text-color-selected,var(--spectrum-alias-text-color))}:host([quiet][selected]) #button.focus-visible{background-color:var(--spectrum-actionbutton-quiet-background-color-selected-key-focus,var(--spectrum-global-color-gray-300));border-color:var(--spectrum-actionbutton-quiet-border-color-selected-key-focus,var(--spectrum-alias-border-color-focus));color:var(--spectrum-actionbutton-quiet-text-color-selected-key-focus,var(--spectrum-alias-text-color-hover))}:host([quiet][selected]) #button:hover{background-color:var(--spectrum-actionbutton-quiet-background-color-selected-hover,var(--spectrum-global-color-gray-300));border-color:var(--spectrum-actionbutton-quiet-border-color-selected-hover,var(--spectrum-global-color-gray-300));color:var(--spectrum-actionbutton-quiet-text-color-selected-hover,var(--spectrum-alias-text-color-hover))}:host([quiet][selected]) #button:active{background-color:var(--spectrum-actionbutton-quiet-background-color-selected-down,var(--spectrum-global-color-gray-300));border-color:var(--spectrum-actionbutton-quiet-border-color-selected-down,var(--spectrum-global-color-gray-300));color:var(--spectrum-actionbutton-quiet-text-color-selected-down,var(--spectrum-alias-text-color-down))}:host([quiet][selected][disabled]) #button{background-color:var(--spectrum-actionbutton-quiet-background-color-selected-disabled,var(--spectrum-global-color-gray-200));border-color:var(--spectrum-actionbutton-quiet-border-color-selected-disabled,var(--spectrum-global-color-gray-200));color:var(--spectrum-actionbutton-quiet-text-color-selected-disabled,var(--spectrum-alias-text-color-disabled))}:host{display:inline-flex;flex-direction:row;vertical-align:top}#button{display:flex;flex:1 1 auto;-webkit-appearance:none}:host([disabled]){pointer-events:none}slot[name=icon]::slotted(svg){fill:currentColor;stroke:currentColor;width:var(--spectrum-alias-workflow-icon-size,18px);height:var(--spectrum-alias-workflow-icon-size,18px)}:host(.spectrum-Dropdown-trigger) #button{text-align:left}::slotted([slot=icon]){flex-shrink:0}`;class Wt extends Pt{constructor(){super(...arguments),this.quiet=!1,this.selected=!1,this.holdAffordance=!1}static get styles(){return[Vt]}}Y([xt({type:Boolean,reflect:!0})],Wt.prototype,"quiet",void 0),Y([xt({type:Boolean,reflect:!0})],Wt.prototype,"selected",void 0),Y([xt({type:Boolean,reflect:!0,attribute:"hold-affordance"})],Wt.prototype,"holdAffordance",void 0),customElements.get("sp-action-button")||customElements.define("sp-action-button",Wt),customElements.get("sp-button")||customElements.define("sp-button",qt);class Ut{constructor(){this.iconsetMap=new Map}static getInstance(){return Ut.instance||(Ut.instance=new Ut),Ut.instance}addIconset(t,e){this.iconsetMap.set(t,e);const r=new CustomEvent("sp-iconset-added",{bubbles:!0,composed:!0,detail:{name:t,iconset:e}});setTimeout(()=>window.dispatchEvent(r),0)}removeIconset(t){this.iconsetMap.delete(t);const e=new CustomEvent("sp-iconset-removed",{bubbles:!0,composed:!0,detail:{name:t}});setTimeout(()=>window.dispatchEvent(e),0)}getIconset(t){return this.iconsetMap.get(t)}}const jt=It`:host{display:inline-block;color:inherit;fill:currentColor;pointer-events:none}:host(:not(:root)){overflow:hidden}:host([size=xxs]),:host([size=xxs]) img,:host([size=xxs]) svg{height:calc(var(--spectrum-alias-workflow-icon-size,
var(--spectrum-global-dimension-size-225))/2);width:calc(var(--spectrum-alias-workflow-icon-size,
var(--spectrum-global-dimension-size-225))/2)}:host([size=xs]),:host([size=xs]) img,:host([size=xs]) svg{height:calc(var(--spectrum-global-dimension-size-300)/2);width:calc(var(--spectrum-global-dimension-size-300)/2)}:host([size=s]),:host([size=s]) img,:host([size=s]) svg{height:var(--spectrum-alias-workflow-icon-size,var(--spectrum-global-dimension-size-225));width:var(--spectrum-alias-workflow-icon-size,var(--spectrum-global-dimension-size-225))}:host([size=m]),:host([size=m]) img,:host([size=m]) svg{height:var(--spectrum-global-dimension-size-300);width:var(--spectrum-global-dimension-size-300)}:host([size=l]),:host([size=l]) img,:host([size=l]) svg{height:calc(var(--spectrum-alias-workflow-icon-size,
var(--spectrum-global-dimension-size-225))*2);width:calc(var(--spectrum-alias-workflow-icon-size,
var(--spectrum-global-dimension-size-225))*2)}:host([size=xl]),:host([size=xl]) img,:host([size=xl]) svg{height:calc(var(--spectrum-global-dimension-size-300)*2);width:calc(var(--spectrum-global-dimension-size-300)*2)}:host([size=xxl]),:host([size=xxl]) img,:host([size=xxl]) svg{height:calc(var(--spectrum-global-dimension-size-300)*3);width:calc(var(--spectrum-global-dimension-size-300)*3)}#container{height:100%}img{height:auto}::slotted(*),img{width:100%;vertical-align:top}::slotted(*){height:100%}`;class Ht extends Nt{constructor(){super(...arguments),this.size="m",this.iconsetListener=(t=>{if(!this.name)return;const e=this.parseIcon(this.name);t.detail.name===e.iconset&&(this.updateIconPromise=this.updateIcon())})}static get styles(){return[jt]}connectedCallback(){super.connectedCallback(),window.addEventListener("sp-iconset-added",this.iconsetListener)}disconnectedCallback(){super.disconnectedCallback(),window.removeEventListener("sp-iconset-added",this.iconsetListener)}firstUpdated(){this.updateIconPromise=this.updateIcon()}attributeChangedCallback(t,e,r){super.attributeChangedCallback(t,e,r),this.updateIconPromise=this.updateIcon()}render(){return this.name?M`<div id="container"></div>`:this.src?M`<img src="${this.src}" alt="${Rt(this.label)}">`:M`<slot></slot>`}async updateIcon(){if(!this.name)return Promise.resolve();const t=this.parseIcon(this.name),e=Ut.getInstance().getIconset(t.iconset);return e&&this.iconContainer?(this.iconContainer.innerHTML="",e.applyIconToElement(this.iconContainer,t.icon,this.size,this.label?this.label:"")):Promise.resolve()}parseIcon(t){const e=t.split(":");let r="default",n=t;return e.length>1&&(r=e[0],n=e[1]),{iconset:r,icon:n}}async _getUpdateComplete(){await super._getUpdateComplete(),await this.updateIconPromise}}Ht.is="sp-icon",Y([xt()],Ht.prototype,"src",void 0),Y([xt()],Ht.prototype,"name",void 0),Y([xt({reflect:!0})],Ht.prototype,"size",void 0),Y([xt()],Ht.prototype,"label",void 0),Y([wt("#container")],Ht.prototype,"iconContainer",void 0),customElements.get("sp-icon")||customElements.define("sp-icon",Ht);class Gt extends Nt{constructor(){super(...arguments),this.registered=!1,this.handleRemoved=(t=>{let{detail:e}=t;e.name===this.name&&(this.registered=!1,this.addIconset())})}firstUpdated(){this.style.display="none"}set name(t){this.registered&&(this._name&&Ut.getInstance().removeIconset(this._name),t&&Ut.getInstance().addIconset(t,this)),this._name=t}get name(){return this._name}connectedCallback(){super.connectedCallback(),this.addIconset(),window.addEventListener("sp-iconset-removed",this.handleRemoved)}disconnectedCallback(){super.disconnectedCallback(),window.removeEventListener("sp-iconset-removed",this.handleRemoved),this.removeIconset()}addIconset(){this.name&&!this.registered&&(Ut.getInstance().addIconset(this.name,this),this.registered=!0)}removeIconset(){this.name&&(Ut.getInstance().removeIconset(this.name),this.registered=!1)}}Y([xt()],Gt.prototype,"name",null);class $t extends Gt{constructor(){super(...arguments),this.iconMap=new Map}updated(t){if(!this.slotContainer)return;const e=this.getSVGNodes(this.slotContainer);this.updateSVG(e),super.updated(t)}async applyIconToElement(t,e,r,n){await this.updateComplete;const o=this.iconMap.get(e);if(!o)throw new Error(`Unable to find icon ${e}`);const a=this.prepareSvgClone(o);a.setAttribute("role","img"),n?a.setAttribute("aria-label",n):a.setAttribute("aria-hidden","true"),t.shadowRoot?t.shadowRoot.appendChild(a):t.appendChild(a)}getIconList(){return[...this.iconMap.keys()]}prepareSvgClone(t){const e=t.cloneNode(!0),r=document.createElementNS("http://www.w3.org/2000/svg","svg"),n=e.getAttribute("viewBox")||"";for(r.style.cssText="pointer-events: none; display: block; width: 100%; height: 100%;",r.setAttribute("viewBox",n),r.setAttribute("preserveAspectRatio","xMidYMid meet"),r.setAttribute("focusable","false");e.childNodes.length>0;)r.appendChild(e.childNodes[0]);return r}getSVGIconName(t){return t}getSanitizedIconName(t){return t}renderDefaultContent(){return M``}render(){return M`<slot @slotchange="${this.onSlotChange}">${this.renderDefaultContent()}</slot>`}updateSVG(t){t.reduce((t,e)=>{const r=e.querySelectorAll("symbol");return t.push(...r),t},[]).forEach(t=>{this.iconMap.set(this.getSanitizedIconName(t.id),t)})}getSVGNodes(t){return t.assignedNodes({flatten:!0}).filter(t=>"svg"===t.nodeName)}onSlotChange(t){const e=t.target,r=this.getSVGNodes(e);this.updateSVG(r)}}Y([wt("slot")],$t.prototype,"slotContainer",void 0);var Kt=L`<svg xmlns="http://www.w3.org/2000/svg"><symbol id="spectrum-icon-AlertMedium" viewBox="0 0 22 22"><path d="M10.563 2.206l-9.249 16.55a.5.5 0 00.436.744h18.5a.5.5 0 00.436-.744l-9.251-16.55a.5.5 0 00-.872 0zm1.436 15.044a.25.25 0 01-.25.25h-1.5a.25.25 0 01-.25-.25v-1.5a.25.25 0 01.25-.25h1.5a.25.25 0 01.25.25zm0-3.5a.25.25 0 01-.25.25h-1.5a.25.25 0 01-.25-.25v-6a.25.25 0 01.25-.25h1.5a.25.25 0 01.25.25z"/></symbol><symbol id="spectrum-icon-AlertSmall" viewBox="0 0 18 18"><path d="M8.564 1.289L.2 16.256A.5.5 0 00.636 17h16.728a.5.5 0 00.436-.744L9.436 1.289a.5.5 0 00-.872 0zM10 14.75a.25.25 0 01-.25.25h-1.5a.25.25 0 01-.25-.25v-1.5a.25.25 0 01.25-.25h1.5a.25.25 0 01.25.25zm0-3a.25.25 0 01-.25.25h-1.5a.25.25 0 01-.25-.25v-6a.25.25 0 01.25-.25h1.5a.25.25 0 01.25.25z"/></symbol><symbol id="spectrum-icon-ArrowDownSmall" viewBox="0 0 10 12"><path d="M9.99 7.01a1 1 0 00-1.707-.707L6 8.586V1.01a1 1 0 00-2 0v7.576L1.717 6.303A1 1 0 10.303 7.717l3.99 3.98a1 1 0 001.414 0l3.99-3.98a.997.997 0 00.293-.707z"/></symbol><symbol id="spectrum-icon-ArrowLeftMedium" viewBox="0 0 18 14"><path d="M16.99 6H3.414l4.283-4.283A1 1 0 106.283.303l-5.98 5.99a1 1 0 000 1.414l5.98 5.99a1 1 0 101.414-1.414L3.414 8H16.99a1 1 0 000-2z"/></symbol><symbol id="spectrum-icon-ArrowUpSmall" viewBox="0 0 10 12"><path d="M9.99 4.99a1 1 0 01-1.707.707L6 3.414v7.576a1 1 0 01-2 0V3.414L1.717 5.697A1 1 0 11.303 4.283l3.99-3.98a1 1 0 011.414 0l3.99 3.98a.997.997 0 01.293.707z"/></symbol><symbol id="spectrum-icon-Asterisk" viewBox="0 0 10 10"><path d="M7.867 7.872c.061.062.103.145 0 .228l-1.283.827c-.104.061-.145.02-.186-.083L4.804 6.07l-2.09 2.297c-.021.042-.083.083-.145 0l-.994-1.035c-.103-.062-.082-.124 0-.186l2.36-1.966-2.691-1.014c-.042 0-.104-.083-.062-.186l.703-1.41a.11.11 0 01.187-.04L4.43 4.06l.145-3.02A.109.109 0 014.7.917l1.718.227c.104 0 .124.042.104.145l-.808 2.96 2.734-.828c.061-.042.124-.042.165.082l.27 1.532c.02.103 0 .145-.084.145l-2.856.227z"/></symbol><symbol id="spectrum-icon-CheckmarkMedium" viewBox="0 0 16 16"><path d="M6 14a1 1 0 01-.789-.385l-4-5a1 1 0 111.577-1.23L6 11.376l7.213-8.99a1 1 0 111.576 1.23l-8 10a1 1 0 01-.789.384z"/></symbol><symbol id="spectrum-icon-CheckmarkSmall" viewBox="0 0 12 12"><path d="M4.5 11a.999.999 0 01-.788-.385l-3-4a1 1 0 111.576-1.23L4.5 8.376l5.212-6.99a1 1 0 111.576 1.23l-6 8A.999.999 0 014.5 11z"/></symbol><symbol id="spectrum-icon-ChevronDownMedium" viewBox="0 0 12 8"><path d="M11.99 1.51a1 1 0 00-1.707-.707L6 5.086 1.717.803A1 1 0 10.303 2.217l4.99 4.99a1 1 0 001.414 0l4.99-4.99a.997.997 0 00.293-.707z"/></symbol><symbol id="spectrum-icon-ChevronDownSmall" viewBox="0 0 10 8"><path d="M5 7a.747.747 0 00.53-.22l4.24-4.24a.75.75 0 10-1.06-1.06L5 5.19 1.29 1.48A.75.75 0 10.23 2.54l4.24 4.24A.747.747 0 005 7z"/></symbol><symbol id="spectrum-icon-ChevronLeftLarge" viewBox="0 0 16 20"><path d="M12.109 17.853l-8.066-7.849 8.066-7.84a1.243 1.243 0 00.381-.894 1.24 1.24 0 00-2.12-.894L1.379 9.108a1.246 1.246 0 00.003 1.79l8.99 8.744a1.247 1.247 0 101.738-1.789z"/></symbol><symbol id="spectrum-icon-ChevronLeftMedium" viewBox="0 0 8 12"><path d="M7.197 10.283L2.914 6l4.283-4.283A1 1 0 105.783.303l-4.99 4.99a1 1 0 000 1.414l4.99 4.99a1 1 0 101.414-1.414z"/></symbol><symbol id="spectrum-icon-ChevronRightLarge" viewBox="0 0 16 20"><path d="M15 10.004a1.243 1.243 0 00-.38-.894L5.631.364a1.249 1.249 0 10-1.741 1.79l8.066 7.85-8.069 7.847a1.249 1.249 0 001.741 1.79l8.992-8.74a1.246 1.246 0 00.379-.897z"/></symbol><symbol id="spectrum-icon-ChevronRightMedium" viewBox="0 0 8 12"><path d="M7.5 6a.997.997 0 00-.293-.707L2.217.303A1 1 0 10.803 1.717L5.086 6 .803 10.283a1 1 0 101.414 1.414l4.99-4.99A.997.997 0 007.5 6z"/></symbol><symbol id="spectrum-icon-ChevronRightSmall" viewBox="0 0 8 10"><path d="M7 5a.747.747 0 00-.22-.53L2.54.23a.75.75 0 10-1.06 1.06L5.19 5 1.48 8.71a.75.75 0 101.06 1.06l4.24-4.24A.747.747 0 007 5z"/></symbol><symbol id="spectrum-icon-ChevronUpSmall" viewBox="0 0 10 8"><path d="M5 1a.747.747 0 00-.53.22L.23 5.46a.75.75 0 101.06 1.06L5 2.81l3.71 3.71a.75.75 0 101.06-1.06L5.53 1.22A.747.747 0 005 1z"/></symbol><symbol id="spectrum-icon-CornerTriangle" viewBox="0 0 6 6"><path d="M5.74.01a.25.25 0 00-.177.073l-5.48 5.48a.25.25 0 00.177.427h5.48a.25.25 0 00.25-.25V.26a.25.25 0 00-.25-.25z"/></symbol><symbol id="spectrum-icon-CrossLarge" viewBox="0 0 16 16"><path d="M15.697 14.283L9.414 8l6.283-6.283A1 1 0 1014.283.303L8 6.586 1.717.303A1 1 0 10.303 1.717L6.586 8 .303 14.283a1 1 0 101.414 1.414L8 9.414l6.283 6.283a1 1 0 101.414-1.414z"/></symbol><symbol id="spectrum-icon-CrossMedium" viewBox="0 0 10 10"><path d="M9.77 8.71L6.06 5l3.71-3.71A.75.75 0 108.71.23L5 3.94 1.29.23A.75.75 0 10.23 1.29L3.94 5 .23 8.71a.75.75 0 101.06 1.06L5 6.06l3.71 3.71a.75.75 0 101.06-1.06z"/></symbol><symbol id="spectrum-icon-CrossSmall" viewBox="0 0 10 10"><path d="M9.317 8.433L5.884 5l3.433-3.433a.625.625 0 10-.884-.884L5 4.116 1.567.683a.625.625 0 10-.884.884C.83 1.713 2.77 3.657 4.116 5L.683 8.433a.625.625 0 10.884.884L5 5.884l3.433 3.433a.625.625 0 00.884-.884z"/></symbol><symbol id="spectrum-icon-DashSmall" viewBox="0 0 12 12"><path d="M10.99 5H1.01a1 1 0 000 2h9.98a1 1 0 100-2z"/></symbol><symbol id="spectrum-icon-DoubleGripper" viewBox="0 0 20 5"><path d="M19.49 4H.51a.5.5 0 100 1h18.98a.5.5 0 000-1zM.51 1h18.98a.5.5 0 000-1H.51a.5.5 0 000 1z"/></symbol><symbol id="spectrum-icon-FolderBreadcrumb" viewBox="0 0 22 22"><path d="M19.5 6l-9.166.004-1.668-1.7A.998.998 0 007.946 4H3a1 1 0 00-1 1v13a.5.5 0 00.5.5h17a.5.5 0 00.5-.5V6.5a.5.5 0 00-.5-.5zm-16-.5h4.237l1.964 2H3.5zm11.544 6.044l-3.5 3.5a.77.77 0 01-1.088 0l-3.5-3.5a.77.77 0 011.088-1.088L11 13.41l2.956-2.955a.77.77 0 011.088 1.088z"/></symbol><symbol id="spectrum-icon-HelpMedium" viewBox="0 0 22 22"><path d="M11 2a9 9 0 109 9 9 9 0 00-9-9zm-.007 14.681a1.145 1.145 0 01-1.227-1.215 1.159 1.159 0 011.115-1.201q.056-.002.112.001a1.159 1.159 0 011.226 1.088q.003.056.001.112a1.127 1.127 0 01-1.227 1.215zm1.981-6.63c-.684.642-1.344 1.215-1.333 1.736a2.275 2.275 0 00.176.732.25.25 0 01-.232.343h-1.26a.3.3 0 01-.228-.069 1.886 1.886 0 01-.421-1.2c0-.816.508-1.336 1.35-2.17.578-.573.911-.937.911-1.475 0-.625-.421-1.059-1.49-1.059a5.337 5.337 0 00-2 .473.249.249 0 01-.347-.23v-1.24a.5.5 0 01.3-.459 6.413 6.413 0 012.434-.5c2.1.006 3.261 1.2 3.261 2.725a3.053 3.053 0 01-1.121 2.393z"/></symbol><symbol id="spectrum-icon-HelpSmall" viewBox="0 0 18 18"><path d="M9 1a8 8 0 108 8 8 8 0 00-8-8zm.023 13.438a1.345 1.345 0 01-.104-2.688q.052-.002.104 0a1.31 1.31 0 011.397 1.217q.004.059.003.118a1.291 1.291 0 01-1.4 1.353zm1.783-6.409l-.1.1c-.395.414-.842.884-.842 1.175a1.386 1.386 0 00.179.674l.073.139-.057.215a.308.308 0 01-.284.189H8.436a.434.434 0 01-.325-.117 2.056 2.056 0 01-.422-1.262A3.058 3.058 0 018.8 7.071c.1-.11.2-.21.288-.3.314-.325.507-.535.507-.758 0-.154 0-.622-.893-.622a2.958 2.958 0 00-1.58.459.3.3 0 01-.327-.01l-.118-.085-.028-.225V4.081a.44.44 0 01.2-.41A4.135 4.135 0 019 3.119a2.552 2.552 0 012.751 2.636 3.067 3.067 0 01-.944 2.274z"/></symbol><symbol id="spectrum-icon-InfoMedium" viewBox="0 0 22 22"><path d="M11 2a9 9 0 109 9 9 9 0 00-9-9zm-.15 2.65a1.359 1.359 0 011.431 1.283q.004.064.001.129a1.332 1.332 0 01-1.432 1.432 1.353 1.353 0 01-1.432-1.433 1.359 1.359 0 011.304-1.412q.064-.002.128.001zM13.5 16a.5.5 0 01-.5.5H9a.5.5 0 01-.5-.5v-1a.5.5 0 01.5-.5h1v-4H9a.5.5 0 01-.5-.5V9a.5.5 0 01.5-.5h2.5a.5.5 0 01.5.5v5.5h1a.5.5 0 01.5.5z"/></symbol><symbol id="spectrum-icon-InfoSmall" viewBox="0 0 18 18"><path d="M9 1a8 8 0 108 8 8 8 0 00-8-8zm-.15 2.15a1.359 1.359 0 011.431 1.283q.004.064.001.129A1.332 1.332 0 018.85 5.994a1.353 1.353 0 01-1.432-1.433 1.359 1.359 0 011.304-1.412q.064-.002.128.001zM11 13.5a.5.5 0 01-.5.5h-3a.5.5 0 01-.5-.5v-1a.5.5 0 01.5-.5H8V9h-.5a.5.5 0 01-.5-.5v-1a.5.5 0 01.5-.5h2a.5.5 0 01.5.5V12h.5a.5.5 0 01.5.5z"/></symbol><symbol id="spectrum-icon-Magnifier" viewBox="0 0 20 20"><path d="M19.77 18.71l-5.464-5.464a7.503 7.503 0 10-1.06 1.06l5.463 5.464a.75.75 0 101.061-1.06zM2.5 8.5a6 6 0 116 6 6.007 6.007 0 01-6-6z"/></symbol><symbol id="spectrum-icon-More" viewBox="0 0 22 22"><path d="M11 8.95A2.05 2.05 0 118.95 11 2.05 2.05 0 0111 8.95zm6 0A2.05 2.05 0 1114.95 11 2.05 2.05 0 0117 8.95zm-12 0A2.05 2.05 0 112.95 11 2.05 2.05 0 015 8.95z"/></symbol><symbol id="spectrum-icon-SkipLeft" viewBox="0 0 10 12"><path d="M9.697 10.283L5.414 6l4.283-4.283A1 1 0 108.283.303l-4.99 4.99a1 1 0 000 1.414l4.99 4.99a1 1 0 101.414-1.414zM1 .01a1 1 0 00-1 1v9.98a1 1 0 002 0V1.01a1 1 0 00-1-1z"/></symbol><symbol id="spectrum-icon-SkipRight" viewBox="0 0 10 12"><path d="M9 .01a1 1 0 00-1 1v9.98a1 1 0 102 0V1.01a1 1 0 00-1-1zM7 6a.997.997 0 00-.293-.707L1.717.303A1 1 0 10.303 1.717L4.586 6 .303 10.283a1 1 0 101.414 1.414l4.99-4.99A.997.997 0 007 6z"/></symbol><symbol id="spectrum-icon-Star" viewBox="0 0 22 22"><path d="M11.361 1.68l2.259 5.975a.257.257 0 00.228.166l6.381.3a.386.386 0 01.223.686L15.467 12.8a.257.257 0 00-.087.268l1.684 6.162a.386.386 0 01-.584.424l-5.34-3.506a.257.257 0 00-.282 0l-5.34 3.506a.386.386 0 01-.584-.424l1.686-6.158a.257.257 0 00-.087-.268L1.548 8.809a.386.386 0 01.223-.686l6.381-.3a.257.257 0 00.228-.166l2.259-5.977a.386.386 0 01.722 0z"/></symbol><symbol id="spectrum-icon-StarOutline" viewBox="0 0 22 22"><path d="M11 4.9l1.231 3.255A1.777 1.777 0 0013.809 9.3l3.476.165-2.715 2.18a1.777 1.777 0 00-.6 1.855l.918 3.357-2.909-1.91a1.777 1.777 0 00-1.951 0l-2.909 1.91.914-3.357a1.778 1.778 0 00-.6-1.856L4.715 9.469 8.191 9.3a1.777 1.777 0 001.578-1.142zm0-3.458a.448.448 0 00-.426.294L8.35 7.621a.26.26 0 01-.231.168l-6.282.3a.455.455 0 00-.263.81l4.907 3.933a.26.26 0 01.088.271l-1.657 6.064a.457.457 0 00.44.577.45.45 0 00.249-.076l5.257-3.452a.26.26 0 01.285 0l5.257 3.451a.45.45 0 00.249.076.457.457 0 00.44-.577L15.43 13.1a.26.26 0 01.088-.271L20.426 8.9a.455.455 0 00-.263-.81l-6.282-.3a.26.26 0 01-.231-.168l-2.224-5.883A.448.448 0 0011 1.445z"/></symbol><symbol id="spectrum-icon-SuccessMedium" viewBox="0 0 22 22"><path d="M11 2a9 9 0 109 9 9 9 0 00-9-9zm5.638 5.609L10.1 15.652a.5.5 0 01-.742.038L5.086 11.5a.5.5 0 010-.707l.707-.707a.5.5 0 01.707 0L9.6 13.1l5.486-6.751a.5.5 0 01.7-.073l.776.631a.5.5 0 01.076.702z"/></symbol><symbol id="spectrum-icon-SuccessSmall" viewBox="0 0 18 18"><path d="M9 1a8 8 0 108 8 8 8 0 00-8-8zm5.333 4.54l-6.324 8.13a.6.6 0 01-.437.23h-.037a.6.6 0 01-.425-.176l-3.893-3.9a.6.6 0 010-.849l.663-.663a.6.6 0 01.848 0L7.4 10.991l5.256-6.754a.6.6 0 01.843-.1l.728.566a.6.6 0 01.106.837z"/></symbol><symbol id="spectrum-icon-TripleGripper" viewBox="0 0 12 9"><path d="M11.49 8H.51a.5.5 0 100 1h10.98a.5.5 0 100-1zM11.49 4H.51a.5.5 0 100 1h10.98a.5.5 0 000-1zM.51 1h10.98a.5.5 0 000-1H.51a.5.5 0 000 1z"/></symbol></svg>`;class Xt extends $t{constructor(){super(),this.name="ui"}renderDefaultContent(){return Kt}getSVGIconName(t){return`spectrum-icon-${t}`}getSanitizedIconName(t){return t.replace("spectrum-icon-","")}}var Yt=L`<svg xmlns="http://www.w3.org/2000/svg"><symbol id="spectrum-icon-AlertMedium" viewBox="0 0 18 18"><path d="M8.564 1.289L.2 16.256A.5.5 0 00.636 17h16.728a.5.5 0 00.436-.744L9.436 1.289a.5.5 0 00-.872 0zM10 14.75a.25.25 0 01-.25.25h-1.5a.25.25 0 01-.25-.25v-1.5a.25.25 0 01.25-.25h1.5a.25.25 0 01.25.25zm0-3a.25.25 0 01-.25.25h-1.5a.25.25 0 01-.25-.25v-6a.25.25 0 01.25-.25h1.5a.25.25 0 01.25.25z"/></symbol><symbol id="spectrum-icon-AlertSmall" viewBox="0 0 14 14"><path d="M6.66 1.003L.157 12.643a.389.389 0 00.339.58h13.01a.389.389 0 00.34-.58L7.338 1.004a.389.389 0 00-.678 0zm1.118 10.47a.194.194 0 01-.195.194H6.417a.194.194 0 01-.195-.195v-1.166a.194.194 0 01.195-.195h1.166a.194.194 0 01.195.195zm0-2.334a.194.194 0 01-.195.194H6.417a.194.194 0 01-.195-.194V4.472a.194.194 0 01.195-.194h1.166a.194.194 0 01.195.194z"/></symbol><symbol id="spectrum-icon-ArrowDownSmall" viewBox="0 0 8 10"><path d="M7.99 6.01a1 1 0 00-1.707-.707L5 6.586V1a1 1 0 00-2 0v5.586L1.717 5.303A1 1 0 10.303 6.717l2.99 2.98a1 1 0 001.414 0l2.99-2.98a.997.997 0 00.293-.707z"/></symbol><symbol id="spectrum-icon-ArrowLeftMedium" viewBox="0 0 14 10"><path d="M12.99 4H3.414l2.283-2.283A1 1 0 104.283.303l-3.98 3.99a1 1 0 000 1.414l3.98 3.99a1 1 0 101.414-1.414L3.414 6h9.576a1 1 0 100-2z"/></symbol><symbol id="spectrum-icon-ArrowUpSmall" viewBox="0 0 8 10"><path d="M7.99 3.99a1 1 0 01-1.707.707L5 3.414V9a1 1 0 01-2 0V3.414L1.717 4.697A1 1 0 11.303 3.283l2.99-2.98a1 1 0 011.414 0l2.99 2.98a.997.997 0 01.293.707z"/></symbol><symbol id="spectrum-icon-Asterisk" viewBox="0 0 8 8"><path d="M6.573 6.558c.056.055.092.13 0 .204l-1.148.74c-.093.056-.13.02-.167-.073L3.832 4.947l-1.87 2.055c-.02.037-.075.074-.13 0l-.889-.926c-.092-.055-.074-.111 0-.167l2.111-1.76-2.408-.906c-.037 0-.092-.074-.055-.167l.63-1.259a.097.097 0 01.166-.036l2.111 1.37.13-2.704a.097.097 0 01.111-.11L5.277.54c.092 0 .11.037.092.13l-.722 2.647 2.444-.74c.056-.038.111-.038.148.073l.241 1.37c.019.093 0 .13-.074.13l-2.556.204z"/></symbol><symbol id="spectrum-icon-CheckmarkMedium" viewBox="0 0 12 12"><path d="M4.5 10a1.022 1.022 0 01-.799-.384l-2.488-3a1 1 0 011.576-1.233L4.5 7.376l4.712-5.991a1 1 0 111.576 1.23l-5.51 7A.978.978 0 014.5 10z"/></symbol><symbol id="spectrum-icon-CheckmarkSmall" viewBox="0 0 10 10"><path d="M3.788 9A.999.999 0 013 8.615l-2.288-3a1 1 0 111.576-1.23l1.5 1.991 3.924-4.991a1 1 0 111.576 1.23l-4.712 6A.999.999 0 013.788 9z"/></symbol><symbol id="spectrum-icon-ChevronDownMedium" viewBox="0 0 10 6"><path d="M9.99 1.01A1 1 0 008.283.303L5 3.586 1.717.303A1 1 0 10.303 1.717l3.99 3.98a1 1 0 001.414 0l3.99-3.98a.997.997 0 00.293-.707z"/></symbol><symbol id="spectrum-icon-ChevronDownSmall" viewBox="0 0 8 6"><path d="M4 5.5a.747.747 0 00.53-.22c.607-.577 1.97-2.038 3.24-3.24A.75.75 0 106.71.98L4 3.69 1.29.98A.75.75 0 10.23 2.04l3.24 3.24A.747.747 0 004 5.5z"/></symbol><symbol id="spectrum-icon-ChevronLeftLarge" viewBox="0 0 12 16"><path d="M9.605 13.843L3.55 8l6.056-5.84A1.248 1.248 0 107.876.363L.882 7.1a1.243 1.243 0 00.003 1.797l6.988 6.742a1.248 1.248 0 101.732-1.796z"/></symbol><symbol id="spectrum-icon-ChevronLeftMedium" viewBox="0 0 6 10"><path d="M5.697 8.283L2.414 5l3.283-3.283A1 1 0 104.283.303l-3.98 3.99a1 1 0 000 1.414l3.98 3.99a1 1 0 101.414-1.414z"/></symbol><symbol id="spectrum-icon-ChevronRightLarge" viewBox="0 0 12 16"><path d="M11.5 8a1.241 1.241 0 00-.386-.897L4.128.36a1.248 1.248 0 10-1.733 1.797L8.45 8l-6.058 5.84a1.248 1.248 0 101.733 1.797L11.117 8.9A1.245 1.245 0 0011.5 8z"/></symbol><symbol id="spectrum-icon-ChevronRightMedium" viewBox="0 0 6 10"><path d="M5.99 5a.997.997 0 00-.293-.707L1.717.303A1 1 0 10.303 1.717L3.586 5 .303 8.283a1 1 0 101.414 1.414l3.98-3.99A.997.997 0 005.99 5z"/></symbol><symbol id="spectrum-icon-ChevronRightSmall" viewBox="0 0 6 8"><path d="M5.5 4a.747.747 0 00-.22-.53C4.703 2.862 3.242 1.5 2.04.23A.75.75 0 10.98 1.29L3.69 4 .98 6.71a.75.75 0 101.06 1.06l3.24-3.24A.747.747 0 005.5 4z"/></symbol><symbol id="spectrum-icon-ChevronUpSmall" viewBox="0 0 8 6"><path d="M4 .5a.747.747 0 00-.53.22C2.862 1.297 1.5 2.758.23 3.96a.75.75 0 101.06 1.06L4 2.31l2.71 2.71a.75.75 0 101.06-1.06L4.53.72A.747.747 0 004 .5z"/></symbol><symbol id="spectrum-icon-CornerTriangle" viewBox="0 0 5 5"><path d="M4.74.01a.25.25 0 00-.177.073l-4.48 4.48a.25.25 0 00.177.427h4.48a.25.25 0 00.25-.25V.26a.25.25 0 00-.25-.25z"/></symbol><symbol id="spectrum-icon-CrossLarge" viewBox="0 0 12 12"><path d="M11.697 10.283L7.414 6l4.283-4.283A1 1 0 1010.283.303L6 4.586 1.717.303A1 1 0 10.303 1.717L4.586 6 .303 10.283a1 1 0 101.414 1.414L6 7.414l4.283 4.283a1 1 0 101.414-1.414z"/></symbol><symbol id="spectrum-icon-CrossMedium" viewBox="0 0 8 8"><path d="M7.77 6.71L5.06 4l2.71-2.71A.75.75 0 106.71.23L4 2.94 1.29.23A.75.75 0 10.23 1.29L2.94 4 .23 6.71a.75.75 0 101.06 1.06L4 5.06l2.71 2.71a.75.75 0 101.06-1.06z"/></symbol><symbol id="spectrum-icon-CrossSmall" viewBox="0 0 8 8"><path d="M7.317 6.433L4.884 4l2.433-2.433a.625.625 0 10-.884-.884L4 3.116 1.567.683a.625.625 0 10-.884.884L3.116 4 .683 6.433a.625.625 0 10.884.884L4 4.884l2.433 2.433a.625.625 0 00.884-.884z"/></symbol><symbol id="spectrum-icon-DashSmall" viewBox="0 0 10 10"><path d="M8 4H2a1 1 0 000 2h6a1 1 0 000-2z"/></symbol><symbol id="spectrum-icon-DoubleGripper" viewBox="0 0 16 4"><path d="M15.49 3H.51a.5.5 0 100 1h14.98a.5.5 0 100-1zM.51 1h14.98a.5.5 0 000-1H.51a.5.5 0 000 1z"/></symbol><symbol id="spectrum-icon-FolderBreadcrumb" viewBox="0 0 18 18"><path d="M16.5 4l-7.166.004-1.652-1.7A1 1 0 006.965 2H2a1 1 0 00-1 1v11.5a.5.5 0 00.5.5h15a.5.5 0 00.5-.5v-10a.5.5 0 00-.5-.5zM2 3h4.965l1.943 2H2zm10.354 5.854l-3 3a.5.5 0 01-.707 0l-3-3a.5.5 0 01.707-.707L9 10.793l2.646-2.646a.5.5 0 01.707.707z"/></symbol><symbol id="spectrum-icon-HelpMedium" viewBox="0 0 18 18"><path d="M9 1a8 8 0 108 8 8 8 0 00-8-8zm1.3 12.3a1.222 1.222 0 01-.3.9 1.223 1.223 0 01-.9.3 1.2 1.2 0 010-2.4c.8 0 1.3.5 1.2 1.2zm.1-4.5c-.4.4-.8.8-.8 1.2a1.135 1.135 0 00.3.8v.1a.098.098 0 01-.096.1H8.4a.229.229 0 01-.2-.1 1.666 1.666 0 01-.4-1.1 2.772 2.772 0 011-1.7 2.772 2.772 0 001-1.7c0-.5-.4-1.1-1.4-1.1a5.018 5.018 0 00-2 .4h-.2V4.3c0-.1 0-.2.1-.2a6.183 6.183 0 012.4-.5c1.9 0 3.1 1.1 3.1 2.7a3.704 3.704 0 01-1.4 2.5z"/></symbol><symbol id="spectrum-icon-HelpSmall" viewBox="0 0 14 14"><path d="M7 .778A6.222 6.222 0 1013.222 7 6.222 6.222 0 007 .778zm.018 10.452a1.046 1.046 0 11-.08-2.091q.04-.002.08 0a1.019 1.019 0 011.087.946q.003.046.002.092a1.004 1.004 0 01-1.09 1.053zm1.387-4.985l-.078.078c-.307.322-.655.687-.655.913a1.078 1.078 0 00.14.525l.056.108-.044.167a.24.24 0 01-.221.147H6.56a.338.338 0 01-.252-.091 1.6 1.6 0 01-.329-.982 2.378 2.378 0 01.864-1.61c.078-.086.156-.164.224-.234.245-.252.395-.416.395-.59 0-.119 0-.483-.695-.483a2.3 2.3 0 00-1.229.357.233.233 0 01-.254-.008l-.092-.066-.022-.175V3.174a.342.342 0 01.156-.319A3.216 3.216 0 017 2.425a1.985 1.985 0 012.14 2.051 2.385 2.385 0 01-.735 1.769z"/></symbol><symbol id="spectrum-icon-InfoMedium" viewBox="0 0 18 18"><path d="M9 1a8 8 0 108 8 8 8 0 00-8-8zm-.15 2.15a1.359 1.359 0 011.431 1.283q.004.064.001.129A1.332 1.332 0 018.85 5.994a1.353 1.353 0 01-1.432-1.433 1.359 1.359 0 011.304-1.412q.064-.002.128.001zM11 13.5a.5.5 0 01-.5.5h-3a.5.5 0 01-.5-.5v-1a.5.5 0 01.5-.5H8V9h-.5a.5.5 0 01-.5-.5v-1a.5.5 0 01.5-.5h2a.5.5 0 01.5.5V12h.5a.5.5 0 01.5.5z"/></symbol><symbol id="spectrum-icon-InfoSmall" viewBox="0 0 14 14"><path d="M7 .778A6.222 6.222 0 1013.222 7 6.222 6.222 0 007 .778zM6.883 2.45a1.057 1.057 0 011.113.998q.003.05.001.1a1.036 1.036 0 01-1.114 1.114A1.052 1.052 0 015.77 3.547 1.057 1.057 0 016.784 2.45q.05-.002.1.001zm1.673 8.05a.389.389 0 01-.39.389H5.834a.389.389 0 01-.389-.389v-.778a.389.389 0 01.39-.389h.388V7h-.389a.389.389 0 01-.389-.389v-.778a.389.389 0 01.39-.389h1.555a.389.389 0 01.389.39v3.5h.389a.389.389 0 01.389.388z"/></symbol><symbol id="spectrum-icon-Magnifier" viewBox="0 0 16 16"><path d="M15.77 14.71l-4.534-4.535a6.014 6.014 0 10-1.06 1.06l4.533 4.535a.75.75 0 101.061-1.06zM6.5 11A4.5 4.5 0 1111 6.5 4.505 4.505 0 016.5 11z"/></symbol><symbol id="spectrum-icon-More" viewBox="0 0 18 18"><path d="M9 7.1A1.9 1.9 0 117.1 9 1.9 1.9 0 019 7.1zm6 0A1.9 1.9 0 1113.1 9 1.9 1.9 0 0115 7.1zm-12 0A1.9 1.9 0 111.1 9 1.9 1.9 0 013 7.1z"/></symbol><symbol id="spectrum-icon-SkipLeft" viewBox="0 0 9 10"><path d="M8.697 8.283L5.414 5l3.283-3.283A1 1 0 107.283.303l-3.99 3.99a1 1 0 000 1.414l3.99 3.99a1 1 0 101.414-1.414zM1 .01a1 1 0 00-1 1v7.98a1 1 0 002 0V1.01a1 1 0 00-1-1z"/></symbol><symbol id="spectrum-icon-SkipRight" viewBox="0 0 9 10"><path d="M8 .01a1 1 0 00-1 1v7.98a1 1 0 102 0V1.01a1 1 0 00-1-1zM6 5a.997.997 0 00-.293-.707L1.717.303A1 1 0 10.303 1.717L3.586 5 .303 8.283a1 1 0 101.414 1.414l3.99-3.99A.997.997 0 006 5z"/></symbol><symbol id="spectrum-icon-Star" viewBox="0 0 18 18"><path d="M9.241.3l2.161 5.715 6.106.289a.255.255 0 01.147.454l-4.77 3.823 1.612 5.9a.255.255 0 01-.386.28L9.002 13.4l-5.11 3.358a.255.255 0 01-.386-.28l1.612-5.9-4.77-3.821A.255.255 0 01.495 6.3l6.107-.285L8.763.3a.255.255 0 01.478 0z"/></symbol><symbol id="spectrum-icon-StarOutline" viewBox="0 0 18 18"><path d="M9.031 2.541l1.777 4.753 5.11.241-3.987 3.2 1.336 4.913-4.266-2.782-4.282 2.808 1.352-4.937-3.987-3.2 5.1-.245zM9.042.412a.369.369 0 00-.349.239L6.486 6.326l-6.1.293a.375.375 0 00-.217.667l4.762 3.821L3.318 17a.376.376 0 00.362.475.371.371 0 00.2-.063l5.121-3.351 5.095 3.324a.371.371 0 00.2.062.376.376 0 00.363-.475l-1.595-5.866 4.767-3.826a.375.375 0 00-.217-.667l-6.1-.287L9.393.655a.369.369 0 00-.351-.243z"/></symbol><symbol id="spectrum-icon-SuccessMedium" viewBox="0 0 18 18"><path d="M9 1a8 8 0 108 8 8 8 0 00-8-8zm5.333 4.54l-6.324 8.13a.6.6 0 01-.437.23h-.037a.6.6 0 01-.425-.176l-3.893-3.9a.6.6 0 010-.849l.663-.663a.6.6 0 01.848 0L7.4 10.991l5.256-6.754a.6.6 0 01.843-.1l.728.566a.6.6 0 01.106.837z"/></symbol><symbol id="spectrum-icon-SuccessSmall" viewBox="0 0 14 14"><path d="M7 .778A6.222 6.222 0 1013.222 7 6.222 6.222 0 007 .778zm4.148 3.53l-4.919 6.324a.467.467 0 01-.34.18h-.028a.467.467 0 01-.331-.138L2.502 7.641a.467.467 0 010-.66l.516-.516a.467.467 0 01.66 0l2.078 2.084 4.088-5.254a.467.467 0 01.655-.078l.566.44a.467.467 0 01.083.652z"/></symbol><symbol id="spectrum-icon-TripleGripper" viewBox="0 0 10 7"><path d="M9.49 6H.51a.5.5 0 100 1h8.98a.5.5 0 000-1zM9.49 3H.51a.5.5 0 100 1h8.98a.5.5 0 000-1zM.51 1h8.98a.5.5 0 000-1H.51a.5.5 0 000 1z"/></symbol></svg>`;class Jt extends $t{constructor(){super(),this.name="ui"}renderDefaultContent(){return Yt}getSVGIconName(t){return`spectrum-icon-${t}`}getSanitizedIconName(t){return t.replace("spectrum-icon-","")}}customElements.get("sp-icons-large")||customElements.define("sp-icons-large",Xt),customElements.get("sp-icons-medium")||customElements.define("sp-icons-medium",Jt);const Zt=It`#input{box-sizing:border-box;border:var(--spectrum-textfield-border-size,var(--spectrum-alias-border-size-thin)) solid;border-radius:var(--spectrum-textfield-border-radius,var(--spectrum-alias-border-radius-regular));padding:3px var(--spectrum-textfield-padding-x,var(--spectrum-global-dimension-size-150)) 5px var(--spectrum-textfield-padding-x,var(--spectrum-global-dimension-size-150));text-indent:0;min-width:var(--spectrum-textfield-min-width,var(--spectrum-global-dimension-size-600));height:var(--spectrum-textfield-height,var(--spectrum-alias-single-line-height));width:var(--spectrum-alias-single-line-width,var(--spectrum-global-dimension-size-2400));vertical-align:top;margin:0;overflow:visible;font-family:adobe-clean,Helvetica,Arial,sans-serif;font-size:var(--spectrum-textfield-text-size,var(--spectrum-alias-font-size-default));line-height:var(--spectrum-textfield-text-line-height,var(--spectrum-alias-body-text-line-height));text-overflow:ellipsis;transition:border-color var(--spectrum-global-animation-duration-100,.13s) ease-in-out,box-shadow var(--spectrum-global-animation-duration-100,.13s) ease-in-out;outline:0;-webkit-appearance:none;-moz-appearance:textfield;background-color:var(--spectrum-textfield-background-color,var(--spectrum-global-color-gray-50));border-color:var(--spectrum-textfield-border-color,var(--spectrum-global-color-gray-300));color:var(--spectrum-textfield-text-color,var(--spectrum-alias-text-color))}#input::placeholder{font-weight:var(--spectrum-textfield-placeholder-text-font-weight,var(--spectrum-global-font-weight-regular));font-style:var(--spectrum-textfield-placeholder-text-font-style,var(--spectrum-global-font-style-italic));transition:color var(--spectrum-global-animation-duration-100,.13s) ease-in-out;opacity:1;color:var(--spectrum-textfield-placeholder-text-color,var(--spectrum-alias-placeholder-text-color))}#input:lang(ja)::placeholder,#input:lang(ko)::placeholder,#input:lang(zh)::placeholder{font-style:normal}#input:hover::placeholder{font-weight:var(--spectrum-textfield-placeholder-text-font-weight,var(--spectrum-global-font-weight-regular));color:var(--spectrum-textfield-placeholder-text-color-hover,var(--spectrum-alias-placeholder-text-color-hover))}#input:disabled{opacity:1}#input:disabled::placeholder{font-weight:var(--spectrum-textfield-placeholder-text-font-weight,var(--spectrum-global-font-weight-regular))}#input::-ms-clear{width:0;height:0}#input::-webkit-inner-spin-button,#input::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}#input:-moz-ui-invalid{box-shadow:none}#input:invalid,:host([invalid]) #input,:host([valid]) #input{background-repeat:no-repeat}#input:invalid,:host([invalid]) #input{background-size:var(--spectrum-icon-alert-medium-width,var(--spectrum-global-dimension-size-225)) var(--spectrum-icon-alert-medium-width,var(--spectrum-global-dimension-size-225));padding-right:calc(var(--spectrum-textfield-padding-x,var(--spectrum-global-dimension-size-150)) + var(--spectrum-icon-alert-medium-width,var(--spectrum-global-dimension-size-225)) + var(--spectrum-textfield-icon-margin-left,var(--spectrum-global-dimension-size-150)))}#input:invalid,:host([invalid]) #input,:host([valid]) #input{background-position:calc(100% - var(--spectrum-textfield-padding-x,var(--spectrum-global-dimension-size-150))) 50%}:host([valid]) #input{background-size:var(--spectrum-icon-checkmark-medium-width) var(--spectrum-icon-checkmark-medium-width);padding-right:calc(var(--spectrum-textfield-padding-x,var(--spectrum-global-dimension-size-150)) + var(--spectrum-icon-checkmark-medium-width) + var(--spectrum-textfield-icon-margin-left,var(--spectrum-global-dimension-size-150)));background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' height='12' viewBox='0 0 12 12' width='12'%3E%3Cpath style='fill:var%28--spectrum-alert-success-icon-color%2C var%28--spectrum-semantic-positive-color-icon%29%29' d='M4.5 10a1.023 1.023 0 0 1-.8-.384l-2.488-3a1 1 0 0 1 1.577-1.233L4.5 7.376l4.712-5.991a1 1 0 1 1 1.576 1.23l-5.511 7A.977.977 0 0 1 4.5 10z'/%3E%3C/svg%3E")}:host([multiline]) #input{height:auto;min-height:var(--spectrum-global-dimension-size-700);padding:3px var(--spectrum-textfield-padding-x,var(--spectrum-global-dimension-size-150)) 5px var(--spectrum-textfield-padding-x,var(--spectrum-global-dimension-size-150));overflow:auto}:host([multiline]) #input:invalid,:host([multiline][invalid]) #input,:host([multiline][valid]) #input{background-position:calc(100% - var(--spectrum-textfield-icon-size,var(--spectrum-global-dimension-size-225))/ 2) calc(100% - var(--spectrum-textfield-icon-size,var(--spectrum-global-dimension-size-225))/ 2)}:host([quiet]) #input{border-radius:0;border-left-width:0;border-bottom-width:var(--spectrum-textfield-quiet-border-size,var(--spectrum-alias-border-size-thin));border-right-width:0;border-top-width:0;padding-left:var(--spectrum-textfield-quiet-padding-x,0);padding-right:var(--spectrum-textfield-quiet-padding-x,0);resize:none;overflow-y:hidden;background-color:var(--spectrum-textfield-quiet-background-color,var(--spectrum-alias-background-color-transparent));border-color:var(--spectrum-textfield-quiet-border-color,var(--spectrum-global-color-gray-300))}:host([quiet]) #input:invalid,:host([quiet][invalid]) #input,:host([quiet][valid]) #input{background-position:100% 50%}#input:hover{border-color:var(--spectrum-textfield-border-color-hover,var(--spectrum-global-color-gray-400));box-shadow:none}#input:focus{border-color:var(--spectrum-textfield-border-color-down,var(--spectrum-alias-border-color-down))}#input.focus-visible:not(:active){border-color:var(--spectrum-textfield-border-color-key-focus,var(--spectrum-alias-border-color-focus));box-shadow:0 0 0 1px var(--spectrum-textfield-border-color-key-focus,var(--spectrum-alias-border-color-focus))}#input[disabled]{background-color:var(--spectrum-textfield-background-color-disabled,var(--spectrum-global-color-gray-200));border-color:var(--spectrum-textfield-border-color-disabled,var(--spectrum-alias-border-color-transparent));color:var(--spectrum-textfield-text-color-disabled,var(--spectrum-alias-text-color-disabled));-webkit-text-fill-color:var(--spectrum-textfield-text-color-disabled,var(--spectrum-alias-text-color-disabled))}#input[disabled]::placeholder{color:var(--spectrum-textfield-placeholder-text-color-disabled,var(--spectrum-alias-text-color-disabled))}#input:invalid,:host([invalid]) #input{border-color:var(--spectrum-textfield-border-color-error,var(--spectrum-global-color-red-500));background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' height='18' viewBox='0 0 18 18' width='18'%3E%3Cpath style='fill:var%28--spectrum-alert-error-border-color%2C var%28--spectrum-semantic-negative-color-border%29%29' d='M8.564 1.289L.2 16.256A.5.5 0 0 0 .636 17h16.728a.5.5 0 0 0 .5-.5.494.494 0 0 0-.064-.244L9.436 1.289a.5.5 0 0 0-.872 0zM10 14.75a.25.25 0 0 1-.25.25h-1.5a.25.25 0 0 1-.25-.25v-1.5a.25.25 0 0 1 .25-.25h1.5a.25.25 0 0 1 .25.25zm0-3a.25.25 0 0 1-.25.25h-1.5a.25.25 0 0 1-.25-.25v-6a.25.25 0 0 1 .25-.25h1.5a.25.25 0 0 1 .25.25z'/%3E%3C/svg%3E")}#input:invalid.focus-visible:not(:active),:host([invalid]) #input.focus-visible:not(:active){border-color:var(--spectrum-textfield-border-color-error,var(--spectrum-global-color-red-500));box-shadow:0 0 0 1px var(--spectrum-textfield-border-color-error,var(--spectrum-global-color-red-500))}:host([quiet]) #input:hover{border-color:var(--spectrum-textfield-quiet-border-color-hover,var(--spectrum-global-color-gray-400))}:host([quiet]) #input:active{border-color:var(--spectrum-textfield-quiet-border-color-down,var(--spectrum-alias-border-color-down))}:host([quiet]) #input:focus{border-color:var(--spectrum-textfield-quiet-border-color-key-focus,var(--spectrum-alias-border-color-focus));box-shadow:0 1px 0 var(--spectrum-textfield-quiet-border-color-key-focus,var(--spectrum-alias-border-color-focus))}:host([quiet]) #input.focus-visible:not(:active){border-color:var(--spectrum-textfield-border-color-key-focus,var(--spectrum-alias-border-color-focus));box-shadow:0 1px 0 var(--spectrum-textfield-border-color-key-focus,var(--spectrum-alias-border-color-focus))}:host([quiet]) #input:disabled{background-color:var(--spectrum-textfield-quiet-background-color-disabled,var(--spectrum-alias-background-color-transparent));border-color:var(--spectrum-textfield-quiet-border-color-disabled,var(--spectrum-alias-border-color-mid))}:host([quiet]) #input:invalid,:host([quiet][invalid]) #input{border-color:var(--spectrum-textfield-border-color-error,var(--spectrum-global-color-red-500))}:host([quiet]) #input:invalid:focus,:host([quiet][invalid]) #input:focus{box-shadow:0 1px 0 var(--spectrum-textfield-border-color-error,var(--spectrum-global-color-red-500))}:host([quiet]) #input:invalid.focus-visible:not(:active),:host([quiet][invalid]) #input.focus-visible:not(:active){border-color:var(--spectrum-textfield-border-color-error,var(--spectrum-global-color-red-500));box-shadow:0 1px 0 var(--spectrum-textfield-border-color-error,var(--spectrum-global-color-red-500))}:host{position:relative;display:inline-flex;vertical-align:top}:host([disabled]){pointer-events:none}#input:invalid,:host([invalid]) #input{background-image:none}#invalid,#valid{position:absolute;top:50%;right:calc(var(--spectrum-textfield-padding-x,var(--spectrum-global-dimension-size-150)) - 3px);transform:translateY(-50%)}#valid{color:var(--spectrum-alert-success-icon-color,var(--spectrum-global-color-green-600))}#invalid{color:var(--spectrum-alert-error-border-color,var(--spectrum-global-color-red-400))}:host([valid]) #input{background-image:none}:host([grows]) #input{position:absolute;top:0;left:0;height:100%}:host([grows]) #sizer{box-sizing:border-box;padding:4px 8px;min-width:var(--spectrum-textfield-min-width,var(--spectrum-global-dimension-size-600));width:var(--spectrum-alias-single-line-width,var(--spectrum-global-dimension-size-2400));min-height:50px;border:1px solid transparent;pointer-events:none;opacity:0;font-family:adobe-clean,Helvetica,Arial,sans-serif;font-size:var(--spectrum-textfield-text-size,var(--spectrum-global-dimension-font-size-100));line-height:var(--spectrum-alias-line-height-medium,var(--spectrum-global-dimension-size-250))}:host([grows][quiet]) #sizer{padding-left:var(--spectrum-textfield-quiet-padding-x,0);padding-right:var(--spectrum-textfield-quiet-padding-x,0);border-right-width:0;border-left-width:0}:host([quiet]) #invalid,:host([quiet]) #valid{right:-2px}:host([multiline]) #invalid,:host([multiline]) #valid{top:calc(100% - 12px)}`,Qt=It`.checkmark-small{width:var(--spectrum-icon-checkmark-small-width);height:var(--spectrum-icon-checkmark-small-height)}`,te=It`.alert-small{width:var(--spectrum-icon-alert-small-width,var(--spectrum-global-dimension-size-175));height:var(--spectrum-icon-alert-small-height,var(--spectrum-global-dimension-size-175))}`;class ee extends _t{constructor(){super(...arguments),this.invalid=!1,this.label="",this.placeholder="",this.grows=!1,this.multiline=!1,this.valid=!1,this.value="",this.quiet=!1,this.required=!1}static get styles(){return[Zt,Qt,te]}get focusElement(){return this.inputElement}onInput(){this.value=this.inputElement.value}onChange(){this.dispatchEvent(new Event("change",{bubbles:!0,composed:!0}))}renderStateIcons(){return this.invalid?M`<sp-icons-large></sp-icons-large><sp-icon id="invalid" name="ui:AlertSmall" class="alert-small"></sp-icon>`:this.valid?M`<sp-icons-large></sp-icons-large><sp-icon id="valid" name="ui:CheckmarkSmall" class="checkmark-small"></sp-icon>`:i}render(){return this.multiline?M`${this.grows?M`<div id="sizer">${this.value}</div>`:i} <textarea aria-label="${this.label||this.placeholder}" id="input" pattern="${Rt(this.pattern)}" placeholder="${this.placeholder}" .value="${this.value}" @change="${this.onChange}" @input="${this.onInput}" ?disabled="${this.disabled}" ?required="${this.required}"></textarea> ${this.renderStateIcons()}`:M`<input aria-label="${this.label||this.placeholder}" id="input" pattern="${Rt(this.pattern)}" placeholder="${this.placeholder}" .value="${this.value}" @change="${this.onChange}" @input="${this.onInput}" ?disabled="${this.disabled}" ?required="${this.required}"> ${this.renderStateIcons()}`}updated(t){t.has("value")&&this.checkValidity()}checkValidity(){if(this.value&&(this.pattern||this.required)){let t=this.inputElement.checkValidity();if((this.disabled||this.multiline)&&this.pattern){t=new RegExp(this.pattern).test(this.value)}return t?(this.valid=!0,this.invalid=!1):(this.valid=!1,this.invalid=!0),this.valid}return!0}}Y([wt("#input")],ee.prototype,"inputElement",void 0),Y([xt({type:Boolean,reflect:!0})],ee.prototype,"invalid",void 0),Y([xt()],ee.prototype,"label",void 0),Y([xt()],ee.prototype,"placeholder",void 0),Y([xt()],ee.prototype,"pattern",void 0),Y([xt({type:Boolean,reflect:!0})],ee.prototype,"grows",void 0),Y([xt({type:Boolean,reflect:!0})],ee.prototype,"multiline",void 0),Y([xt({type:Boolean,reflect:!0})],ee.prototype,"valid",void 0),Y([xt({type:String})],ee.prototype,"value",void 0),Y([xt({type:Boolean,reflect:!0})],ee.prototype,"quiet",void 0),Y([xt({type:Boolean,reflect:!0})],ee.prototype,"required",void 0),customElements.get("sp-textfield")||customElements.define("sp-textfield",ee);var re={render(t,e){return M`${this.css()} ${this.html(t,e)}`},html:(t,e)=>M`<sp-button variant="primary" @click="${e=>t.takePhoto()}">${X} Take Photo #${e.photoCount+1}</sp-button><sp-textfield placeholder="Enter your name" @input="${e=>t.enterName(e)}" value="${e.sessionName}">${e.sessionName}</sp-textfield><sp-button variant="primary" quiet @click="${e=>t.resetSession()}">Reset Session</sp-button><br><span class="filename">${t.generateFilename()}</span>`,css:()=>M`<style>:host{padding:20px;position:relative}sp-button[variant="negative"] svg path{fill:red}.filename{position:absolute;display:inline-block;width:100%;text-align:center;color:#9a9a9a}</style>`};class ne extends HTMLElement{static get TAKE_PHOTO(){return"onTakePhoto"}connectedCallback(){this.init(re,{photoCount:0,sessionName:"",shareCode:""})}generateFilename(){return""!==this.model.sessionName?this.model.sessionName:"unnamed_"+this.model.shareCode+"_"+this.model.photoCount}takePhoto(){this.model.photoCount++,1===this.model.photoCount&&(this.model.shareCode=parseInt(Date.now()/1e3).toString(36));const t=new CustomEvent(ne.TAKE_PHOTO,{detail:this.generateFilename(),bubbles:!0,composed:!0});(new H).triggerEvent(t),this.render()}enterName(t){this.model.sessionName=t.target.value}resetSession(){this.model.photoCount=0,this.model.sessionName="",this.shadowRoot.querySelector("sp-textfield").value="",this.render()}}V("dy-capture",ne,P);var oe={get CHANGE_SETTINGS(){return"onChangeSettings"},setValue(t,e,r){let n=!1;t?this[t][e]=r:this[e]=r,"architecture"===e&&("MobileNetV1"===r?(this.input.outputStride=16,this.input.multiplier=.75,this.input.inputResolution=500):(this.input.outputStride=32,this.input.multiplier=1,this.input.inputResolution=250),n=!0);const o=new CustomEvent(this.CHANGE_SETTINGS,{detail:{category:t,key:e,value:r}});return(new H).triggerEvent(o),n},algorithm:"multi-pose",input:{architecture:"MobileNetV1",outputStride:16,outputStrideOptions:{MobileNetV1:[8,16],ResNet50:[32,16]},inputResolution:500,multiplier:.75,quantBytes:2},singlePoseDetection:{minPoseConfidence:.1,minPartConfidence:.5},multiPoseDetection:{maxPoseDetections:5,minPoseConfidence:.15,minPartConfidence:.1,nmsRadius:30},output:{showVideo:!0,showSkeleton:!0,showPoints:!0,showBoundingBox:!1}};const ae=[{label:"Camera 1920x1080 (16:9)",settings:{source:"camera",width:1920,height:1080}},{label:"Camera 1280x720 (16:9)",settings:{source:"camera",width:1280,height:720}},{label:"Camera 800x600 (4:3)",settings:{source:"camera",width:800,height:600}},{label:"Camera 640x480 (4:3)",settings:{source:"camera",width:640,height:480}}],ie=[{label:"Default",id:"default",type:"camera"}];let se=0,ue=0,le=null;var ce={get VIDEO_SOURCE_CHANGE(){return"onVideoSourceChange"},set preferredResolutionIndex(t){se=t;const e=new CustomEvent(this.VIDEO_SOURCE_CHANGE,{detail:{resolution:this.preferredResolution,device:this.currentDevice}});(new H).triggerEvent(e)},get preferredResolutionIndex(){return se},set currentDevice(t){for(let e=0;e<ie.length;e++)t===ie[e].id&&(ue=e);const e=new CustomEvent(this.VIDEO_SOURCE_CHANGE,{detail:this.preferredResolution,device:this.currentDevice});(new H).triggerEvent(e)},get currentDeviceIndex(){return ue},get preferredResolution(){return ae[se]},get currentDevice(){return ie[ue]},get devices(){return ie},get resolutions(){return ae},set uploaded(t){le=t,ie.find(t=>"uploaded"===t.id)||ie.push({label:"Uploaded Video",id:"uploaded",type:"video"})},get uploaded(){return le}},pe=function(t,e){return(pe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function de(t,e){function r(){this.constructor=t}pe(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}function he(t,e,r,n){return new(r||(r=Promise))(function(o,a){function i(t){try{u(n.next(t))}catch(t){a(t)}}function s(t){try{u(n.throw(t))}catch(t){a(t)}}function u(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(i,s)}u((n=n.apply(t,e||[])).next())})}function fe(t,e){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(t,i)}catch(t){a=[6,t],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}var me=function(){function t(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return t.prototype.setPlatform=function(t,e){null!=this.platform&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+e+"."),this.platformName=t,this.platform=e},t.prototype.registerFlag=function(t,e,r){if(this.flagRegistry[t]={evaluationFn:e,setHook:r},null!=this.urlFlags[t]){var n=this.urlFlags[t];console.warn("Setting feature override from URL "+t+": "+n+"."),this.set(t,n)}},t.prototype.get=function(t){return t in this.flags?this.flags[t]:(this.flags[t]=this.evaluateFlag(t),this.flags[t])},t.prototype.getNumber=function(t){return this.get(t)},t.prototype.getBool=function(t){return this.get(t)},t.prototype.getFlags=function(){return this.flags},Object.defineProperty(t.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),t.prototype.set=function(t,e){if(null==this.flagRegistry[t])throw new Error("Cannot set flag "+t+" as it has not been registered.");this.flags[t]=e,null!=this.flagRegistry[t].setHook&&this.flagRegistry[t].setHook(e)},t.prototype.evaluateFlag=function(t){if(null==this.flagRegistry[t])throw new Error("Cannot evaluate flag '"+t+"': no evaluation function found.");return this.flagRegistry[t].evaluationFn()},t.prototype.setFlags=function(t){this.flags=Object.assign({},t)},t.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},t.prototype.populateURLFlags=function(){var t=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var e,r,n=(e=this.global.location.search,r={},e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return function(t,e,r){t[decodeURIComponent(e)]=decodeURIComponent(r||"")}(r,e[0],e[1]),e.join("=")}),r);"tfjsflags"in n&&n.tfjsflags.split(",").forEach(function(e){var r=e.split(":"),n=r[0],o=r[1];t.urlFlags[n]=function(t,e){if("true"===(e=e.toLowerCase())||"false"===e)return"true"===e;if(""+ +e===e)return+e;throw new Error("Could not parse value flag value "+e+" for flag "+t+".")}(n,o)})}},t}();function ge(){return ve}var ve=null,be=new Map;function ye(t,e){var r=ke(t,e);return be.get(r)}function xe(t){for(var e=be.entries(),r=[];;){var n=e.next(),o=n.done,a=n.value;if(o)break;var i=a[0],s=a[1];i.split("_")[0]===t&&r.push(s)}return r}function we(t){var e=t.kernelName,r=t.backendName,n=ke(e,r);if(be.has(n))throw new Error("The kernel '"+e+"' for backend '"+r+"' is already registered");be.set(n,t)}function ke(t,e){return e+"_"+t}function Ce(t){for(var e=t.length,r=0,n=0;e>0;)n=Math.random()*e|0,r=t[--e],t[e]=t[n],t[n]=r}function Se(t,e,r){return Math.max(t,Math.min(e,r))}function Ee(t){return t%2==0?t:t+1}function ze(t){for(var e=0,r=0;r<t.length;r++)e+=t[r];return e}function Ie(t,e){if(!t)throw new Error("string"==typeof e?e:e())}function Ae(t,e,r){void 0===r&&(r=""),Ie(De(t,e),function(){return r+" Shapes "+t+" and "+e+" must match"})}function Ne(t){Ie(null!=t,function(){return"The input to the tensor constructor must be a non-null value."})}function Re(t,e,r){if(void 0===e&&(e=[]),void 0===r&&(r=!1),null==e&&(e=[]),Array.isArray(t)||Ge(t)&&!r)for(var n=0;n<t.length;++n)Re(t[n],e,r);else e.push(t);return e}function Te(t){if(0===t.length)return 1;for(var e=t[0],r=1;r<t.length;r++)e*=t[r];return e}function De(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!==e.length)return!1;for(var r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function _e(t){return t%1==0}function Oe(t){if(null!=Math.tanh)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;var e=Math.exp(2*t);return(e-1)/(e+1)}function Fe(t){var e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function Me(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function Le(t,e,r){return void 0===e&&(e=function(t){return 0}),new Promise(function(n,o){var a=0;!function i(){if(t())n();else{var s=e(++a);null!=r&&a>=r?o():setTimeout(i,s)}}()})}function Pe(t,e){for(var r=1,n=-1,o=0;o<t.length;++o)if(t[o]>=0)r*=t[o];else if(-1===t[o]){if(-1!==n)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+n+" and dim "+o);n=o}else if(t[o]<0)throw Error("Shapes can not be < 0. Found "+t[o]+" at dim "+o);if(-1===n){if(e>0&&e!==r)throw Error("Size("+e+") must match the product of shape "+t);return t}if(0===r)throw Error("Cannot infer the missing size in ["+t+"] when there are 0 elements");if(e%r!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+r);var a=t.slice();return a[n]=e/r,a}function Be(t,e){var r=e.length;return Ie((t=null==t?e.map(function(t,e){return e}):[].concat(t)).every(function(t){return t>=-r&&t<r}),function(){return"All values in axis param must be in range [-"+r+", "+r+") but got axis "+t}),Ie(t.every(function(t){return _e(t)}),function(){return"All values in axis param must be integers but got axis "+t}),t.map(function(t){return t<0?r+t:t})}function qe(t,e){for(var r=[],n=[],o=null!=e&&Array.isArray(e)&&0===e.length,a=null==e||o?null:Be(e,t).sort(),i=0,s=0;s<t.length;++s){if(null!=a){if(a[i]===s&&1!==t[s])throw new Error("Can't squeeze axis "+s+" since its dim '"+t[s]+"' is not 1");(null==a[i]||a[i]>s)&&1===t[s]&&(r.push(t[s]),n.push(s)),a[i]<=s&&i++}1!==t[s]&&(r.push(t[s]),n.push(s))}return{newShape:r,keptDims:n}}function Ve(t,e){var r=null;if(null==t||"float32"===t)r=new Float32Array(e);else if("int32"===t)r=new Int32Array(e);else{if("bool"!==t)throw new Error("Unknown data type "+t);r=new Uint8Array(e)}return r}function We(t,e){var r=null;if(null==t||"float32"===t)r=new Float32Array(e);else if("int32"===t)r=new Int32Array(e);else if("bool"===t)r=new Uint8Array(e);else{if("string"!==t)throw new Error("Unknown data type "+t);r=new Array(e)}return r}function Ue(t,e){for(var r=0;r<t.length;r++){var n=t[r];if(isNaN(n)||!isFinite(n))throw Error("A tensor of type "+e+" being uploaded contains "+n+".")}}function je(t){return"bool"===t||"complex64"===t||"float32"===t||"int32"===t||"string"===t}function He(t,e){return!("complex64"===e||"float32"===e&&"complex64"!==t||"int32"===e&&"float32"!==t&&"complex64"!==t||"bool"===e&&"bool"===t)}function Ge(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array}function $e(t){if("float32"===t||"int32"===t)return 4;if("complex64"===t)return 8;if("bool"===t)return 1;throw new Error("Unknown dtype "+t)}function Ke(t){if(null==t)return 0;var e=0;return t.forEach(function(t){return e+=t.length}),e}function Xe(t){return"string"==typeof t||t instanceof String}function Ye(t){return"boolean"==typeof t}function Je(t){return"number"==typeof t}function Ze(t){return Array.isArray(t)?Ze(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array?"int32":Je(t)?"float32":Xe(t)?"string":Ye(t)?"bool":"float32"}function Qe(t){return!!(t&&t.constructor&&t.call&&t.apply)}function tr(t,e){for(var r=e;r<t;++r)if(t%r==0)return r;return t}function er(t){var e=t.length;if(e<2)return[];var r=new Array(e-1);r[e-2]=t[e-1];for(var n=e-3;n>=0;--n)r[n]=r[n+1]*t[n+1];return r}function rr(t,e,r){if("string"===e)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=Re(t)),r&&Ue(t,e),function(t,e){return t instanceof Float32Array&&"float32"===e||t instanceof Int32Array&&"int32"===e||t instanceof Uint8Array&&"bool"===e}(t,e))return t;if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e){for(var n=new Uint8Array(t.length),o=0;o<n.length;++o)0!==Math.round(t[o])&&(n[o]=1);return n}throw new Error("Unknown data type "+e)}function nr(t,e){if(0===t.length)return e[0];var r=t.reduce(function(t,e){return t*e});if(0===r)return[];if(r!==e.length)throw new Error("["+t+"] does not match the input size.");return function t(e,r,n){var o=new Array;if(1===r.length)for(var a=r[0],i=0;i<a;i++)o[i]=n[e+i];else{a=r[0];var s=r.slice(1),u=s.reduce(function(t,e){return t*e});for(i=0;i<a;i++)o[i]=t(e+i*u,s,n)}return o}(0,t,e)}function or(t,e){for(var r=ar(t,e),n=0;n<r.length;n++)r[n]=1;return r}function ar(t,e){if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e)return new Uint8Array(t);throw new Error("Unknown data type "+e)}function ir(){return ge().platform.now()}function sr(t){t.forEach(function(e){Ie(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+t+"]."})})}function ur(t,e){return void 0===e&&(e="utf-8"),e=e||"utf-8",ge().platform.encode(t,e)}function lr(t,e){return void 0===e&&(e="utf-8"),e=e||"utf-8",ge().platform.decode(t,e)}var cr=Object.freeze({shuffle:Ce,clamp:Se,nearestLargerEven:Ee,sum:ze,randUniform:function(t,e){var r=Math.random();return e*r+(1-r)*t},distSquared:function(t,e){for(var r=0,n=0;n<t.length;n++){var o=Number(t[n])-Number(e[n]);r+=o*o}return r},assert:Ie,assertShapesMatch:Ae,assertNonNull:Ne,flatten:Re,sizeFromShape:Te,isScalarShape:function(t){return 0===t.length},arraysEqual:De,isInt:_e,tanh:Oe,sizeToSquarishShape:Fe,createShuffledIndices:function(t){for(var e=new Uint32Array(t),r=0;r<t;++r)e[r]=r;return Ce(e),e},rightPad:Me,repeatedTry:Le,inferFromImplicitShape:Pe,parseAxisParam:Be,squeezeShape:qe,getTypedArrayFromDType:Ve,getArrayFromDType:We,checkConversionForErrors:Ue,isValidDtype:je,hasEncodingLoss:He,isTypedArray:Ge,bytesPerElement:$e,bytesFromStringArray:Ke,isString:Xe,isBoolean:Ye,isNumber:Je,inferDtype:Ze,isFunction:Qe,nearestDivisor:tr,computeStrides:er,toTypedArray:rr,toNestedArray:nr,makeOnesTypedArray:or,makeZerosTypedArray:ar,now:ir,assertNonNegativeIntegerDimensions:sr,fetch:function(t,e){return ge().platform.fetch(t,e)},encodeString:ur,decodeString:lr}),pr=function(){function t(t,e){this.backendTimer=t,this.logger=e,null==e&&(this.logger=new dr)}return t.prototype.profileKernel=function(t,e,r){var n,o=this,a=this.backendTimer.time(function(){n=r()});return n.forEach(function(r){r.data().then(function(n){!function(t,e,r){if("float32"!==e)return!1;for(var n=0;n<t.length;n++){var o=t[n];if(isNaN(o)||!isFinite(o))return console.warn("Found "+o+" in the result of '"+r+"'"),!0}}(n,r.dtype,t),a.then(function(a){var i="";null!=a.getExtraProfileInfo&&(i=a.getExtraProfileInfo()),o.logger.logKernelProfile(t,r,n,a.kernelMs,e,i)})})}),n},t}(),dr=function(){function t(){}return t.prototype.logKernelProfile=function(t,e,r,n,o,a){var i=Me(n+"ms",9),s=Me(t,25),u=e.rank,l=e.size,c=Me(e.shape.toString(),14),p="";for(var d in o){var h=o[d].shape,f=h.length;p+=d+": "+f+"D "+(f>0?h:"")+" "}console.log("%c"+s+"\t%c"+i+"\t%c"+u+"D "+c+"\t%c"+l+"\t%c"+p+"\t%c"+a,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},t}(),hr=20,fr=3,mr=7;function gr(t,e,r){return Me(Array.isArray(t)?parseFloat(t[0].toFixed(mr))+" + "+parseFloat(t[1].toFixed(mr))+"j":Xe(t)?"'"+t+"'":"bool"===r?vr(t):parseFloat(t.toFixed(mr)).toString(),e)}function vr(t){return 0===t?"false":"true"}function br(t){for(var e=[],r=0;r<t.length;r+=2)e.push([t[r],t[r+1]]);return e}var yr=function(){function t(t,e,r){var n=this;if(this.dtype=e,this.shape=t.slice(),this.size=Te(t),null!=r){var o=r.length;Ie(o===this.size,function(){return"Length of values '"+o+"' does not match the size inferred by the shape '"+n.size+"'."})}if("complex64"===e)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||We(e,this.size),this.strides=er(t)}return t.prototype.set=function(t){for(var e=this,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];0===r.length&&(r=[0]),Ie(r.length===this.rank,function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+e.rank+")"});var o=this.locToIndex(r);this.values[o]=t},t.prototype.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];0===t.length&&(t=[0]);for(var r=0,n=0,o=t;n<o.length;n++){var a=o[n];if(a<0||a>=this.shape[r]){var i="Requested out of range element at "+t+".   Buffer shape="+this.shape;throw new Error(i)}r++}for(var s=t[t.length-1],u=0;u<t.length-1;++u)s+=this.strides[u]*t[u];return this.values[s]},t.prototype.locToIndex=function(t){if(0===this.rank)return 0;if(1===this.rank)return t[0];for(var e=t[t.length-1],r=0;r<t.length-1;++r)e+=this.strides[r]*t[r];return e},t.prototype.indexToLoc=function(t){if(0===this.rank)return[];if(1===this.rank)return[t];for(var e=new Array(this.shape.length),r=0;r<e.length-1;++r)e[r]=Math.floor(t/this.strides[r]),t-=e[r]*this.strides[r];return e[e.length-1]=t,e},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.toTensor=function(){return xr().makeTensor(this.values,this.shape,this.dtype)},t}(),xr=null,wr=null,kr=null,Cr=function(){function t(t,e,r,n){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=Te(t),this.strides=er(t),this.dataId=r,this.id=n,this.rankType=this.rank<5?this.rank.toString():"higher"}return t.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},t.prototype.asScalar=function(){return this.throwIfDisposed(),Ie(1===this.size,function(){return"The array must have only 1 element."}),this.reshape([])},t.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},t.prototype.as2D=function(t,e){return this.throwIfDisposed(),this.reshape([t,e])},t.prototype.as3D=function(t,e,r){return this.throwIfDisposed(),this.reshape([t,e,r])},t.prototype.as4D=function(t,e,r,n){return this.throwIfDisposed(),this.reshape([t,e,r,n])},t.prototype.as5D=function(t,e,r,n,o){return this.throwIfDisposed(),this.reshape([t,e,r,n,o])},t.prototype.asType=function(t){return this.throwIfDisposed(),wr.cast(this,t)},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.buffer=function(){return he(this,void 0,void 0,function(){var t;return fe(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,wr.buffer(this.shape,this.dtype,t)]}})})},t.prototype.bufferSync=function(){return wr.buffer(this.shape,this.dtype,this.dataSync())},t.prototype.array=function(){return he(this,void 0,void 0,function(){var t;return fe(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,nr(this.shape,t)]}})})},t.prototype.arraySync=function(){return nr(this.shape,this.dataSync())},t.prototype.data=function(){return he(this,void 0,void 0,function(){var t,e;return fe(this,function(r){switch(r.label){case 0:return this.throwIfDisposed(),t=xr().read(this.dataId),"string"!==this.dtype?[3,2]:[4,t];case 1:e=r.sent();try{return[2,e.map(function(t){return lr(t)})]}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,t]}})})},t.prototype.dataSync=function(){this.throwIfDisposed();var t=xr().readSync(this.dataId);if("string"===this.dtype)try{return t.map(function(t){return lr(t)})}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t},t.prototype.bytes=function(){return he(this,void 0,void 0,function(){var t;return fe(this,function(e){switch(e.label){case 0:return this.throwIfDisposed(),[4,xr().read(this.dataId)];case 1:return t=e.sent(),"string"===this.dtype?[2,t]:[2,new Uint8Array(t.buffer)]}})})},t.prototype.dispose=function(){this.isDisposed||(xr().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),t.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},t.prototype.toFloat=function(){return this.asType("float32")},t.prototype.toInt=function(){return this.asType("int32")},t.prototype.toBool=function(){return this.asType("bool")},t.prototype.print=function(t){return void 0===t&&(t=!1),wr.print(this,t)},t.prototype.reshape=function(t){return this.throwIfDisposed(),wr.reshape(this,t)},t.prototype.reshapeAs=function(t){return this.throwIfDisposed(),this.reshape(t.shape)},t.prototype.expandDims=function(t){return void 0===t&&(t=0),wr.expandDims(this,t)},t.prototype.cumsum=function(t,e,r){return void 0===t&&(t=0),void 0===e&&(e=!1),void 0===r&&(r=!1),wr.cumsum(this,t,e,r)},t.prototype.squeeze=function(t){return this.throwIfDisposed(),wr.squeeze(this,t)},t.prototype.clone=function(){return this.throwIfDisposed(),wr.clone(this)},t.prototype.oneHot=function(t,e,r){return this.throwIfDisposed(),wr.oneHot(this,t,e,r)},t.prototype.toString=function(t){return void 0===t&&(t=!1),function(t,e,r,n){var o=er(e),a=function(t,e,r,n){var o=Te(e),a=n[n.length-1],i=new Array(a).fill(0),s=e.length,u="complex64"===r?br(t):t;if(s>1)for(var l=0;l<o/a;l++)for(var c=l*a,p=0;p<a;p++)i[p]=Math.max(i[p],gr(u[c+p],0,r).length);return i}(t,e,r,o),i=e.length,s=function t(e,r,n,o,a,i){void 0===i&&(i=!0);var s="complex64"===n?2:1,u=r[0],l=r.length;if(0===l)return"complex64"===n?[gr(br(e)[0],0,n)]:"bool"===n?[vr(e[0])]:[e[0].toString()];if(1===l){if(u>hr){var c=fr*s,p=Array.from(e.slice(0,c)),d=Array.from(e.slice((u-fr)*s,u*s));return"complex64"===n&&(p=br(p),d=br(d)),["["+p.map(function(t,e){return gr(t,a[e],n)}).join(", ")+", ..., "+d.map(function(t,e){return gr(t,a[u-fr+e],n)}).join(", ")+"]"]}return["["+("complex64"===n?br(e):Array.from(e)).map(function(t,e){return gr(t,a[e],n)}).join(", ")+"]"]}var h=r.slice(1),f=o.slice(1),m=o[0]*s,g=[];if(u>hr){for(var v=0;v<fr;v++){var b=(y=v*m)+m;g.push.apply(g,t(e.slice(y,b),h,n,f,a,!1))}for(g.push("..."),v=u-fr;v<u;v++)b=(y=v*m)+m,g.push.apply(g,t(e.slice(y,b),h,n,f,a,v===u-1))}else for(v=0;v<u;v++){var y;b=(y=v*m)+m,g.push.apply(g,t(e.slice(y,b),h,n,f,a,v===u-1))}var x=2===l?",":"";for(g[0]="["+g[0]+x,v=1;v<g.length-1;v++)g[v]=" "+g[v]+x;var w=",\n";for(v=2;v<l;v++)w+="\n";return g[g.length-1]=" "+g[g.length-1]+"]"+(i?"":w),g}(t,e,r,o,a),u=["Tensor"];return n&&(u.push("  dtype: "+r),u.push("  rank: "+i),u.push("  shape: ["+e+"]"),u.push("  values:")),u.push(s.map(function(t){return"    "+t}).join("\n")),u.join("\n")}(this.dataSync(),this.shape,this.dtype,t)},t.prototype.tile=function(t){return this.throwIfDisposed(),wr.tile(this,t)},t.prototype.gather=function(t,e){return void 0===e&&(e=0),this.throwIfDisposed(),wr.gather(this,t,e)},t.prototype.matMul=function(t,e,r){return void 0===e&&(e=!1),void 0===r&&(r=!1),this.throwIfDisposed(),wr.matMul(this,t,e,r)},t.prototype.dot=function(t){return this.throwIfDisposed(),wr.dot(this,t)},t.prototype.norm=function(t,e,r){return void 0===t&&(t="euclidean"),void 0===e&&(e=null),void 0===r&&(r=!1),this.throwIfDisposed(),wr.norm(this,t,e,r)},t.prototype.slice=function(t,e){return this.throwIfDisposed(),wr.slice(this,t,e)},t.prototype.reverse=function(t){return this.throwIfDisposed(),wr.reverse(this,t)},t.prototype.concat=function(e,r){return void 0===r&&(r=0),this.throwIfDisposed(),e instanceof t&&(e=[e]),wr.concat([this].concat(e),r)},t.prototype.split=function(t,e){return void 0===e&&(e=0),this.throwIfDisposed(),wr.split(this,t,e)},t.prototype.stack=function(t,e){return void 0===e&&(e=0),wr.stack([this,t],e)},t.prototype.unstack=function(t){return void 0===t&&(t=0),wr.unstack(this,t)},t.prototype.pad=function(t,e){return void 0===e&&(e=0),wr.pad(this,t,e)},t.prototype.batchNormalization=function(t,e,r,n,o){return void 0===r&&(r=.001),kr("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(t,e,o,n,r)},t.prototype.batchNorm=function(t,e,r,n,o){return void 0===o&&(o=.001),this.throwIfDisposed(),wr.batchNorm(this,t,e,r,n,o)},t.prototype.all=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),wr.all(this,t,e)},t.prototype.any=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),wr.any(this,t,e)},t.prototype.logSumExp=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),wr.logSumExp(this,t,e)},t.prototype.sum=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),wr.sum(this,t,e)},t.prototype.prod=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),wr.prod(this,t,e)},t.prototype.mean=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),wr.mean(this,t,e)},t.prototype.min=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),wr.min(this,t,e)},t.prototype.max=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),wr.max(this,t,e)},t.prototype.argMin=function(t){return void 0===t&&(t=null),this.throwIfDisposed(),wr.argMin(this,t)},t.prototype.argMax=function(t){return void 0===t&&(t=null),this.throwIfDisposed(),wr.argMax(this,t)},t.prototype.cast=function(t){return this.throwIfDisposed(),wr.cast(this,t)},t.prototype.add=function(t){return this.throwIfDisposed(),wr.add(this,t)},t.prototype.addStrict=function(t){return this.throwIfDisposed(),wr.addStrict(this,t)},t.prototype.atan2=function(t){return this.throwIfDisposed(),wr.atan2(this,t)},t.prototype.sub=function(t){return this.throwIfDisposed(),wr.sub(this,t)},t.prototype.subStrict=function(t){return this.throwIfDisposed(),wr.subStrict(this,t)},t.prototype.pow=function(t){return this.throwIfDisposed(),wr.pow(this,t)},t.prototype.powStrict=function(t){return this.throwIfDisposed(),wr.powStrict(this,t)},t.prototype.mul=function(t){return this.throwIfDisposed(),wr.mul(this,t)},t.prototype.mulStrict=function(t){return this.throwIfDisposed(),wr.mulStrict(this,t)},t.prototype.div=function(t){return this.throwIfDisposed(),wr.div(this,t)},t.prototype.divNoNan=function(t){return this.throwIfDisposed(),wr.divNoNan(this,t)},t.prototype.floorDiv=function(t){return this.throwIfDisposed(),wr.floorDiv(this,t)},t.prototype.divStrict=function(t){return this.throwIfDisposed(),wr.divStrict(this,t)},t.prototype.minimum=function(t){return this.throwIfDisposed(),wr.minimum(this,t)},t.prototype.minimumStrict=function(t){return this.throwIfDisposed(),wr.minimumStrict(this,t)},t.prototype.maximum=function(t){return this.throwIfDisposed(),wr.maximum(this,t)},t.prototype.maximumStrict=function(t){return this.throwIfDisposed(),wr.maximumStrict(this,t)},t.prototype.mod=function(t){return this.throwIfDisposed(),wr.mod(this,t)},t.prototype.modStrict=function(t){return this.throwIfDisposed(),wr.modStrict(this,t)},t.prototype.squaredDifference=function(t){return this.throwIfDisposed(),wr.squaredDifference(this,t)},t.prototype.squaredDifferenceStrict=function(t){return this.throwIfDisposed(),wr.squaredDifferenceStrict(this,t)},t.prototype.transpose=function(t){return this.throwIfDisposed(),wr.transpose(this,t)},t.prototype.notEqual=function(t){return this.throwIfDisposed(),wr.notEqual(this,t)},t.prototype.notEqualStrict=function(t){return this.throwIfDisposed(),wr.notEqualStrict(this,t)},t.prototype.less=function(t){return this.throwIfDisposed(),wr.less(this,t)},t.prototype.lessStrict=function(t){return this.throwIfDisposed(),wr.lessStrict(this,t)},t.prototype.equal=function(t){return this.throwIfDisposed(),wr.equal(this,t)},t.prototype.equalStrict=function(t){return this.throwIfDisposed(),wr.equalStrict(this,t)},t.prototype.lessEqual=function(t){return this.throwIfDisposed(),wr.lessEqual(this,t)},t.prototype.lessEqualStrict=function(t){return this.throwIfDisposed(),wr.lessEqualStrict(this,t)},t.prototype.greater=function(t){return this.throwIfDisposed(),wr.greater(this,t)},t.prototype.greaterStrict=function(t){return this.throwIfDisposed(),wr.greaterStrict(this,t)},t.prototype.greaterEqual=function(t){return this.throwIfDisposed(),wr.greaterEqual(this,t)},t.prototype.greaterEqualStrict=function(t){return this.throwIfDisposed(),wr.greaterEqualStrict(this,t)},t.prototype.logicalAnd=function(t){return this.throwIfDisposed(),wr.logicalAnd(this,t)},t.prototype.logicalOr=function(t){return this.throwIfDisposed(),wr.logicalOr(this,t)},t.prototype.logicalNot=function(){return this.throwIfDisposed(),wr.logicalNot(this)},t.prototype.logicalXor=function(t){return this.throwIfDisposed(),wr.logicalXor(this,t)},t.prototype.where=function(t,e){return this.throwIfDisposed(),wr.where(t,this,e)},t.prototype.neg=function(){return this.throwIfDisposed(),wr.neg(this)},t.prototype.ceil=function(){return this.throwIfDisposed(),wr.ceil(this)},t.prototype.floor=function(){return this.throwIfDisposed(),wr.floor(this)},t.prototype.sign=function(){return this.throwIfDisposed(),wr.sign(this)},t.prototype.isNaN=function(){return this.throwIfDisposed(),wr.isNaN(this)},t.prototype.isInf=function(){return this.throwIfDisposed(),wr.isInf(this)},t.prototype.isFinite=function(){return this.throwIfDisposed(),wr.isFinite(this)},t.prototype.exp=function(){return this.throwIfDisposed(),wr.exp(this)},t.prototype.expm1=function(){return this.throwIfDisposed(),wr.expm1(this)},t.prototype.log=function(){return this.throwIfDisposed(),wr.log(this)},t.prototype.log1p=function(){return this.throwIfDisposed(),wr.log1p(this)},t.prototype.sqrt=function(){return this.throwIfDisposed(),wr.sqrt(this)},t.prototype.rsqrt=function(){return this.throwIfDisposed(),wr.rsqrt(this)},t.prototype.square=function(){return this.throwIfDisposed(),wr.square(this)},t.prototype.reciprocal=function(){return this.throwIfDisposed(),wr.reciprocal(this)},t.prototype.abs=function(){return this.throwIfDisposed(),wr.abs(this)},t.prototype.clipByValue=function(t,e){return this.throwIfDisposed(),wr.clipByValue(this,t,e)},t.prototype.relu=function(){return this.throwIfDisposed(),wr.relu(this)},t.prototype.relu6=function(){return this.throwIfDisposed(),wr.relu6(this)},t.prototype.elu=function(){return this.throwIfDisposed(),wr.elu(this)},t.prototype.selu=function(){return this.throwIfDisposed(),wr.selu(this)},t.prototype.leakyRelu=function(t){return void 0===t&&(t=.2),this.throwIfDisposed(),wr.leakyRelu(this,t)},t.prototype.prelu=function(t){return this.throwIfDisposed(),wr.prelu(this,t)},t.prototype.sigmoid=function(){return this.throwIfDisposed(),wr.sigmoid(this)},t.prototype.logSigmoid=function(){return this.throwIfDisposed(),wr.logSigmoid(this)},t.prototype.softplus=function(){return this.throwIfDisposed(),wr.softplus(this)},t.prototype.zerosLike=function(){return this.throwIfDisposed(),wr.zerosLike(this)},t.prototype.onesLike=function(){return this.throwIfDisposed(),wr.onesLike(this)},t.prototype.sin=function(){return this.throwIfDisposed(),wr.sin(this)},t.prototype.cos=function(){return this.throwIfDisposed(),wr.cos(this)},t.prototype.tan=function(){return this.throwIfDisposed(),wr.tan(this)},t.prototype.asin=function(){return this.throwIfDisposed(),wr.asin(this)},t.prototype.acos=function(){return this.throwIfDisposed(),wr.acos(this)},t.prototype.atan=function(){return this.throwIfDisposed(),wr.atan(this)},t.prototype.sinh=function(){return this.throwIfDisposed(),wr.sinh(this)},t.prototype.cosh=function(){return this.throwIfDisposed(),wr.cosh(this)},t.prototype.tanh=function(){return this.throwIfDisposed(),wr.tanh(this)},t.prototype.asinh=function(){return this.throwIfDisposed(),wr.asinh(this)},t.prototype.acosh=function(){return this.throwIfDisposed(),wr.acosh(this)},t.prototype.atanh=function(){return this.throwIfDisposed(),wr.atanh(this)},t.prototype.erf=function(){return this.throwIfDisposed(),wr.erf(this)},t.prototype.round=function(){return this.throwIfDisposed(),wr.round(this)},t.prototype.step=function(t){return void 0===t&&(t=0),this.throwIfDisposed(),wr.step(this,t)},t.prototype.softmax=function(t){return void 0===t&&(t=-1),this.throwIfDisposed(),wr.softmax(this,t)},t.prototype.logSoftmax=function(t){return void 0===t&&(t=-1),this.throwIfDisposed(),wr.logSoftmax(this,t)},t.prototype.resizeBilinear=function(t,e){return void 0===e&&(e=!1),this.throwIfDisposed(),wr.image.resizeBilinear(this,t,e)},t.prototype.resizeNearestNeighbor=function(t,e){return void 0===e&&(e=!1),this.throwIfDisposed(),wr.image.resizeNearestNeighbor(this,t,e)},t.prototype.conv1d=function(t,e,r,n,o,a){return void 0===n&&(n="NWC"),void 0===o&&(o=1),this.throwIfDisposed(),wr.conv1d(this,t,e,r,n,o,a)},t.prototype.conv2d=function(t,e,r,n,o,a){return void 0===n&&(n="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),wr.conv2d(this,t,e,r,n,o,a)},t.prototype.conv2dTranspose=function(t,e,r,n,o){return this.throwIfDisposed(),wr.conv2dTranspose(this,t,e,r,n,o)},t.prototype.depthwiseConv2D=function(t,e,r,n,o,a){return void 0===n&&(n="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),wr.depthwiseConv2d(this,t,e,r,n,o,a)},t.prototype.separableConv2d=function(t,e,r,n,o,a){return void 0===o&&(o=[1,1]),void 0===a&&(a="NHWC"),this.throwIfDisposed(),wr.separableConv2d(this,t,e,r,n,o,a)},t.prototype.avgPool=function(t,e,r,n){return this.throwIfDisposed(),wr.avgPool(this,t,e,r,n)},t.prototype.maxPool=function(t,e,r,n){return this.throwIfDisposed(),wr.maxPool(this,t,e,r,n)},t.prototype.localResponseNormalization=function(t,e,r,n){return void 0===t&&(t=5),void 0===e&&(e=1),void 0===r&&(r=1),void 0===n&&(n=.5),wr.localResponseNormalization(this,t,e,r,n)},t.prototype.pool=function(t,e,r,n,o){return this.throwIfDisposed(),wr.pool(this,t,e,r,n,o)},t.prototype.variable=function(t,e,r){return void 0===t&&(t=!0),this.throwIfDisposed(),xr().makeVariable(this,t,e,r)},t.prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),wr.unsortedSegmentSum(this,t,e)},t.prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),wr.batchToSpaceND(this,t,e)},t.prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),wr.spaceToBatchND(this,t,e)},t.prototype.topk=function(t,e){return void 0===t&&(t=1),void 0===e&&(e=!0),this.throwIfDisposed(),wr.topk(this,t,e)},t.prototype.stridedSlice=function(t,e,r,n,o,a,i,s){return void 0===n&&(n=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===i&&(i=0),void 0===s&&(s=0),this.throwIfDisposed(),wr.stridedSlice(this,t,e,r,n,o,a,i,s)},t.prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),wr.depthToSpace(this,t,e)},t.prototype.fft=function(){return this.throwIfDisposed(),wr.spectral.fft(this)},t.prototype.ifft=function(){return this.throwIfDisposed(),wr.spectral.ifft(this)},t.prototype.rfft=function(){return this.throwIfDisposed(),wr.spectral.rfft(this)},t.prototype.irfft=function(){return this.throwIfDisposed(),wr.spectral.irfft(this)},t}();Object.defineProperty(Cr,Symbol.hasInstance,{value:function(t){return!!t&&null!=t.dataId&&null!=t.shape&&null!=t.dtype}});var Sr,Er,zr,Ir,Ar,Nr,Rr=function(t){function e(e,r,n,o){var a=t.call(this,e.shape,e.dtype,e.dataId,o)||this;return a.trainable=r,a.name=n,a}return de(e,t),e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!De(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");xr().disposeTensor(this),this.dataId=t.dataId,xr().incRef(this,null)},e.prototype.dispose=function(){xr().disposeVariable(this),this.isDisposedInternal=!0},e}(Cr);Object.defineProperty(Rr,Symbol.hasInstance,{value:function(t){return t instanceof Cr&&null!=t.assign&&t.assign instanceof Function}}),(Nr=Sr||(Sr={})).R0="R0",Nr.R1="R1",Nr.R2="R2",Nr.R3="R3",Nr.R4="R4",Nr.R5="R5",Nr.R6="R6",function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"}(Er||(Er={})),function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"}(zr||(zr={})),function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"}(Ir||(Ir={})),function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"}(Ar||(Ar={}));var Tr={float32:Ir,int32:Er,bool:zr,complex64:Ar};function Dr(t,e){if("string"===t||"string"===e){if("string"===t&&"string"===e)return"string";throw new Error("Can not upcast "+t+" with "+e)}return Tr[t][e]}function _r(t){return Dr(t,"int32")}function Or(t,e){if(t.dtype===e.dtype)return[t,e];var r=Dr(t.dtype,e.dtype);return[t.cast(r),e.cast(r)]}function Fr(t,e){Ie(t.dtype===e.dtype,function(){return"The dtypes of the first("+t.dtype+") and second("+e.dtype+") input must match"})}function Mr(t){var e=[];return function t(e,r,n){if(null!=e)if(e instanceof Cr)r.push(e);else if(o=e,Array.isArray(o)||"object"==typeof o){var o,a=e;for(var i in a){var s=a[i];n.has(s)||(n.add(s),t(s,r,n))}}}(t,e,new Set),e}var Lr,Pr=Object.freeze({makeTypesMatch:Or,assertTypesMatch:Fr,isTensorInList:function(t,e){for(var r=0;r<e.length;r++)if(e[r].id===t.id)return!0;return!1},getTensorsInContainer:Mr}),Br=function(){function t(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return t.prototype.dispose=function(){for(var t in this.registeredVariables)this.registeredVariables[t].dispose()},t}(),qr=function(){function t(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Br}return t.prototype.ready=function(){return he(this,void 0,void 0,function(){var t,e,r;return fe(this,function(n){switch(n.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then(function(){})];if(null!=this.backendInstance)return[2];t=this.getSortedBackends(),e=0,n.label=1;case 1:return e<t.length?(r=t[e],[4,this.initializeBackend(r).success]):[3,5];case 2:return n.sent()?[4,this.setBackend(r)]:[3,4];case 3:return n.sent(),[2];case 4:return e++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(t.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() before calling other methods");if(null==this.backendInstance){var t=this.initializeBackendsAndReturnBest(),e=t.name;if(t.asyncInit)throw new Error("The highest priority backend '"+e+"' has not yet been initialized. Make sure to await tf.ready() before calling other methods");this.setBackend(e)}return this.backendInstance},enumerable:!0,configurable:!0}),t.prototype.backendNames=function(){return Object.keys(this.registryFactory)},t.prototype.findBackend=function(t){if(!(t in this.registry)){if(!(t in this.registryFactory))return null;if(this.initializeBackend(t).asyncInit)return null}return this.registry[t]},t.prototype.findBackendFactory=function(t){return t in this.registryFactory?this.registryFactory[t].factory:null},t.prototype.registerBackend=function(t,e,r){return void 0===r&&(r=1),t in this.registryFactory?(console.warn(t+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[t]={factory:e,priority:r},!0)},t.prototype.setBackend=function(t){return he(this,void 0,void 0,function(){var e,r,n;return fe(this,function(o){switch(o.label){case 0:if(null==this.registryFactory[t])throw new Error("Backend name '"+t+"' not found in registry");return this.backendName=t,null!=this.registry[t]?[3,4]:(this.backendInstance=null,e=this.initializeBackend(t),r=e.success,e.asyncInit?[4,r]:[3,2]);case 1:return n=o.sent(),[3,3];case 2:n=r,o.label=3;case 3:if(!n)return[2,!1];o.label=4;case 4:return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new pr(this.backendInstance),[2,!0]}})})},t.prototype.setupRegisteredKernels=function(){var t=this;xe(this.backendName).forEach(function(e){null!=e.setupFunc&&e.setupFunc(t.backendInstance)})},t.prototype.disposeRegisteredKernels=function(t){var e=this;xe(t).forEach(function(r){null!=r.disposeFunc&&r.disposeFunc(e.registry[t])})},t.prototype.initializeBackend=function(t){var e=this,r=this.registryFactory[t];if(null==r)throw new Error("Cannot initialize backend "+t+", no registration found.");try{var n=r.factory();if(Promise.resolve(n)===n){var o=++this.pendingBackendInitId,a=n.then(function(r){return!(o<e.pendingBackendInitId||(e.registry[t]=r,e.pendingBackendInit=null,0))}).catch(function(r){return!(o<e.pendingBackendInitId||(e.pendingBackendInit=null,console.warn("Initialization of backend "+t+" failed"),console.warn(r.stack||r.message),1))});return this.pendingBackendInit=a,{success:a,asyncInit:!0}}return this.registry[t]=n,{success:!0,asyncInit:!1}}catch(e){return console.warn("Initialization of backend "+t+" failed"),console.warn(e.stack||e.message),{success:!1,asyncInit:!1}}},t.prototype.removeBackend=function(t){if(!(t in this.registryFactory))throw new Error(t+" backend not found in registry");this.backendName===t&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},t.prototype.getSortedBackends=function(){var t=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(e,r){return t.registryFactory[r].priority-t.registryFactory[e].priority})},t.prototype.initializeBackendsAndReturnBest=function(){for(var t=this.getSortedBackends(),e=0;e<t.length;e++){var r=t[e],n=this.initializeBackend(r),o=n.success,a=n.asyncInit;if(a||o)return{name:r,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")},t.prototype.moveData=function(t,e){var r=this.state.tensorInfo.get(e),n=r.backend,o=this.readSync(e);n.disposeData(e),r.backend=t,t.move(e,o,r.shape,r.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},t.prototype.tidy=function(t,e){var r,n=this,o=null;if(null==e){if("function"!=typeof t)throw new Error("Please provide a function to tidy()");e=t}else{if("string"!=typeof t&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof e)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=t}return this.scopedRun(function(){return n.startScope(o)},function(){return n.endScope(r)},function(){return(r=e())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r})},t.prototype.scopedRun=function(t,e,r){t();try{var n=r();return e(),n}catch(t){throw e(),t}},t.prototype.nextTensorId=function(){return t.nextTensorId++},t.prototype.nextVariableId=function(){return t.nextVariableId++},t.prototype.clone=function(t){var e=this.makeTensorFromDataId(t.dataId,t.shape,t.dtype),r={x:t};return this.addTapeNode(this.state.activeScope.name,r,[e],function(t){return{x:function(){return t.toFloat()}}},[]),e},t.prototype.runKernel=function(t,e,r,n,o){return this.runKernelFunc(null,e,null,t,r,n,o)},t.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},t.prototype.checkKernelForMemLeak=function(t,e,r){var n=this.backend.numDataIds(),o=0;r.forEach(function(t){o+="complex64"===t.dtype?3:1});var a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],i=n-e-o-a;if(i>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+i+" data ids) after running '"+t+"'")},t.prototype.runKernelFunc=function(t,e,r,n,o,a,i){var s,u=this;void 0===a&&(a=[]),void 0===i&&(i=[]);var l,c=[],p=this.isTapeOn(),d=null!=this.state.activeScope?this.state.activeScope.name:"",h=function(t){p&&(c=t.map(function(t){return u.keep(u.clone(t))}))},f=this.state.numBytes,m=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var g,v=ye(n,this.backendName);return l=null!=v?function(){var t=u.backend.numDataIds();g=v.kernelFunc({inputs:e,attrs:o,backend:u.backend});var r=Array.isArray(g)?g:[g];u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(d,t,r);var n=r.map(function(t){var e=t.dataId,r=t.shape,n=t.dtype;return u.makeTensorFromDataId(e,r,n)}),s=n.filter(function(t,e){return i[e]});return h(a.slice().concat(s)),n}:function(){var e=u.backend.numDataIds();g=u.tidy(function(){return t(u.backend,h)});var r=Array.isArray(g)?g:[g];return u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(d,e,r),r},this.scopedRun(function(){return u.state.kernelDepth++},function(){return u.state.kernelDepth--},function(){s=u.ENV.getBool("DEBUG")?u.profiler.profileKernel(d,e,function(){return l()}):l()}),p&&this.addTapeNode(d,e,s,r,c),this.state.profiling&&this.state.activeProfile.kernels.push({name:d,bytesAdded:this.state.numBytes-f,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-m,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(e).map(function(t){return e[t].shape}),outputShapes:s.map(function(t){return t.shape})}),Array.isArray(g)?s:s[0]},t.prototype.makeTensor=function(t,e,r,n){if(null==t)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",n=n||this.backend;var o=t;"string"===r&&Xe(t[0])&&(o=t.map(function(t){return ur(t)}));var a=n.write(o,e,r),i=new Cr(e,r,a,this.nextTensorId());if(this.incRef(i,n),"string"===r){var s=this.state.tensorInfo.get(a),u=Ke(o);this.state.numBytes+=u-s.bytes,s.bytes=u}return i},t.prototype.makeTensorFromDataId=function(t,e,r,n){var o=new Cr(e,r=r||"float32",t,this.nextTensorId());return this.incRef(o,n),o},t.prototype.makeVariable=function(t,e,r,n){void 0===e&&(e=!0),r=r||this.nextVariableId().toString(),null!=n&&n!==t.dtype&&(t=t.asType(n));var o=new Rr(t,e,r,this.nextTensorId());if(null!=this.state.registeredVariables[o.name])throw new Error("Variable with name "+o.name+" was already registered");return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o},t.prototype.incRef=function(t,e){var r=this.state.tensorInfo.has(t.dataId)?this.state.tensorInfo.get(t.dataId).refCount:0;if(this.state.numTensors++,"string"===t.dtype&&this.state.numStringTensors++,0===r){this.state.numDataBuffers++;var n=0;"complex64"!==t.dtype&&"string"!==t.dtype&&(n=t.size*$e(t.dtype)),this.state.tensorInfo.set(t.dataId,{backend:e||this.backend,dtype:t.dtype,shape:t.shape,bytes:n,refCount:0}),this.state.numBytes+=n}this.state.tensorInfo.get(t.dataId).refCount++,t instanceof Rr||this.track(t)},t.prototype.disposeTensor=function(t){if(this.state.tensorInfo.has(t.dataId)){this.state.numTensors--,"string"===t.dtype&&this.state.numStringTensors--;var e=this.state.tensorInfo.get(t.dataId);e.refCount<=1?("complex64"!==t.dtype&&(this.state.numBytes-=e.bytes),this.state.numDataBuffers--,e.backend.disposeData(t.dataId),this.state.tensorInfo.delete(t.dataId)):this.state.tensorInfo.get(t.dataId).refCount--}},t.prototype.disposeVariables=function(){for(var t in this.state.registeredVariables){var e=this.state.registeredVariables[t];this.disposeVariable(e)}},t.prototype.disposeVariable=function(t){this.disposeTensor(t),null!=this.state.registeredVariables[t.name]&&delete this.state.registeredVariables[t.name]},t.prototype.memory=function(){var t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,null==t.reasons&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t},t.prototype.profile=function(t){return he(this,void 0,void 0,function(){var e,r;return fe(this,function(n){return this.state.profiling=!0,e=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(t){return t.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-r,[2,this.state.activeProfile]})})},t.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},t.prototype.addTapeNode=function(t,e,r,n,o){var a=this,i={id:this.state.nextTapeNodeId++,name:t,inputs:e,outputs:r,saved:o};null!=n&&(i.gradient=function(t){return t=t.map(function(t,e){if(null==t){var n=r[e],o=ar(n.size,n.dtype);return a.makeTensor(o,n.shape,n.dtype)}return t}),n(t.length>1?t:t[0],o)}),this.state.activeTape.push(i)},t.prototype.keep=function(t){return t.kept=!0,t},t.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},t.prototype.endTape=function(){this.state.gradientDepth--},t.prototype.startScope=function(t){var e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(e.name=t),this.state.scopeStack.push(e),this.state.activeScope=e},t.prototype.endScope=function(t){for(var e=this,r=Mr(t),n=new Set(r.map(function(t){return t.id})),o=0;o<this.state.activeScope.track.length;o++){var a=this.state.activeScope.track[o];a.kept||n.has(a.id)||a.dispose()}var i=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(function(t){t.kept||t.scopeId!==i.id||e.track(t)})},t.prototype.gradients=function(t,e,r,n){var o=this;if(void 0===n&&(n=!1),Ie(e.length>0,function(){return"gradients() received an empty list of xs."}),null!=r&&"float32"!==r.dtype)throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var a=this.scopedRun(function(){return o.startTape()},function(){return o.endTape()},function(){return o.tidy("forward",t)});Ie(a instanceof Cr,function(){return"The result y returned by f() must be a tensor."});var i=function(t,e,r){for(var n={},o={},a=0;a<e.length;a++)n[e[a].id]=!0;for(a=0;a<t.length;a++){var i=(f=t[a]).inputs;for(var s in i){for(var u=i[s],l=!1,c=0;c<e.length;c++)if(n[u.id]){f.outputs.forEach(function(t){return n[t.id]=!0}),l=!0,o[f.id]=!0;break}if(l)break}}var p={};p[r.id]=!0;var d={};for(a=t.length-1;a>=0;a--)for(i=(f=t[a]).inputs,c=0;c<f.outputs.length;c++)if(p[f.outputs[c].id]){for(var s in i)p[i[s].id]=!0,d[f.id]=!0;break}var h=[];for(a=0;a<t.length;a++){var f;if(o[(f=t[a]).id]&&d[f.id]){var m={};for(var s in f.inputs){var g=f.inputs[s];n[g.id]&&(m[s]=g)}var v=Object.assign({},f);v.inputs=m,v.outputs=f.outputs,h.push(v)}}return h}(this.state.activeTape,e,a);if(!n&&0===i.length&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var t,n,s={};s[a.id]=null==r?(n=or(Te(t=a.shape),"float32"),Vr.makeTensor(n,t,"float32")):r,function(t,e,r){for(var n=function(n){var o=e[n],a=[];if(o.outputs.forEach(function(e){var r=t[e.id];null!=r?a.push(r):a.push(null)}),null==o.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+o.name+".");var i=o.gradient(a),s=function(e){if(!(e in i))throw new Error("Cannot backprop through input "+e+". Available gradients found: "+Object.keys(i)+".");var n=r(function(){return i[e]()});if("float32"!==n.dtype)throw new Error("Error in gradient for op "+o.name+". The gradient of input "+e+" must have 'float32' dtype, but has '"+n.dtype+"'");var a=o.inputs[e];if(!De(n.shape,a.shape))throw new Error("Error in gradient for op "+o.name+". The gradient of input '"+e+"' has shape '"+n.shape+"', which does not match the shape of the input '"+a.shape+"'");if(null==t[a.id])t[a.id]=n;else{var s=t[a.id];t[a.id]=s.add(n),s.dispose()}};for(var u in o.inputs)s(u)},o=e.length-1;o>=0;o--)n(o)}(s,i,function(t){return o.tidy(t)});var u=e.map(function(t){return s[t.id]});return 0===o.state.gradientDepth&&(o.state.activeTape.forEach(function(t){for(var e in t.saved)t.saved[e].dispose()}),o.state.activeTape=null),{value:a,grads:u}})},t.prototype.customGrad=function(t){var e=this;return Ie(Qe(t),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var r,n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];Ie(n.every(function(t){return t instanceof Cr}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var a={};return n.forEach(function(t,e){a[e]=t}),e.runKernelFunc(function(e,o){return Ie((r=t.apply(void 0,n.concat([o]))).value instanceof Cr,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),Ie(Qe(r.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),r.value},a,function(t,e){var o=r.gradFunc(t,e),a=Array.isArray(o)?o:[o];Ie(a.length===n.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),Ie(a.every(function(t){return t instanceof Cr}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var i={};return a.forEach(function(t,e){i[e]=function(){return t}}),i})}},t.prototype.readSync=function(t){return this.state.tensorInfo.get(t).backend.readSync(t)},t.prototype.read=function(t){return this.state.tensorInfo.get(t).backend.read(t)},t.prototype.fromPixels=function(t,e){return this.backend.fromPixels(t,e)},t.prototype.time=function(t){return he(this,void 0,void 0,function(){var e,r;return fe(this,function(n){switch(n.label){case 0:return e=ir(),[4,this.backend.time(t)];case 1:return(r=n.sent()).wallMs=ir()-e,[2,r]}})})},t.prototype.track=function(t){return null!=this.state.activeScope&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t},Object.defineProperty(t.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),t.prototype.reset=function(){for(var t in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Br,this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},t.nextTensorId=0,t.nextVariableId=0,t}(),Vr=function(){var t=function(){if(null==Lr){var t=void 0;if("undefined"!=typeof window)t=window;else if("undefined"!=typeof global)t=global;else if("undefined"!=typeof process)t=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");t=self}Lr=t}return Lr}();if(null==t._tfengine){var e=new me(t);t._tfengine=new qr(e)}return function(t){ve=t}(t._tfengine.ENV),xr=function(){return t._tfengine},t._tfengine}();function Wr(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var Ur=ge();Ur.registerFlag("DEBUG",function(){return!1},function(t){t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),Ur.registerFlag("IS_BROWSER",function(){return Wr()}),Ur.registerFlag("IS_NODE",function(){return"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node}),Ur.registerFlag("IS_CHROME",function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),Ur.registerFlag("PROD",function(){return!1}),Ur.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return Ur.getBool("DEBUG")}),Ur.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),Ur.registerFlag("IS_TEST",function(){return!1});var jr,Hr,Gr,$r={},Kr={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Xr(t,e){$r[t]=e}function Yr(t){t in $r||($r[t]=function(t){if(1!==t&&2!==t)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var e=Jr(t);return e.addEventListener("webglcontextlost",function(e){e.preventDefault(),delete $r[t]},!1),1===t?e.getContext("webgl",Kr)||e.getContext("experimental-webgl",Kr):e.getContext("webgl2",Kr)}(t));var e=$r[t];return e.isContextLost()?(delete $r[t],Yr(t)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),$r[t])}function Jr(t){if("undefined"!=typeof OffscreenCanvas&&2===t)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function Zr(t,e){return[e,t]}function Qr(t){var e=Te(t);return Fe(Math.ceil(e/4))}function tn(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function en(t,e){var r,n,o,a,i,s,u,l,c,p=t;return 2===ge().getNumber("WEBGL_VERSION")?(r=p.R32F,n=p.R16F,o=p.RGBA16F,a=p.RGBA32F,i=p.RED,s=4,u=1,l=p.HALF_FLOAT,c=p.FLOAT):(r=t.RGBA,n=t.RGBA,o=t.RGBA,a=p.RGBA,i=t.RGBA,s=4,u=4,l=null!=e?e.HALF_FLOAT_OES:null,c=t.FLOAT),{internalFormatFloat:r,internalFormatHalfFloat:n,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:a,textureFormatFloat:i,downloadTextureFormat:t.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:l,textureTypeFloat:c}}function rn(t,e,r){var n=r();return e&&function(t){var e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+sn(t,e))}(t),n}!function(t){t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH"}(jr||(jr={})),function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"}(Hr||(Hr={})),function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Gr||(Gr={}));var nn=5.96e-8,on=65504;function an(t){return!!(ge().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===t||nn<Math.abs(t)&&Math.abs(t)<on)}function sn(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}function un(t,e,r){return Tn(t,e,function(){return t.getExtension(r)},'Extension "'+r+'" not supported on this browser.')}function ln(t,e,r){var n=Tn(t,e,function(){return t.createShader(t.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(rn(t,e,function(){return t.shaderSource(n,r)}),rn(t,e,function(){return t.compileShader(n)}),!1===t.getShaderParameter(n,t.COMPILE_STATUS))throw console.log(t.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function cn(t,e,r){var n=Tn(t,e,function(){return t.createShader(t.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(rn(t,e,function(){return t.shaderSource(n,r)}),rn(t,e,function(){return t.compileShader(n)}),!1===t.getShaderParameter(n,t.COMPILE_STATUS))throw function(t,e){var r=hn.exec(e);if(null==r)return console.log("Couldn't parse line number in error: "+e),void console.log(t);for(var n=+r[1],o=t.split("\n"),a=o.length.toString().length+2,i=o.map(function(t,e){return Me((e+1).toString(),a)+t}),s=0,u=0;u<i.length;u++)s=Math.max(i[u].length,s);var l=i.slice(0,n-1),c=i.slice(n-1,n),p=i.slice(n);console.log(l.join("\n")),console.log(e.split("\n")[0]),console.log("%c "+Me(c[0],s),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(p.join("\n"))}(r,t.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}var pn,dn,hn=/ERROR: [0-9]+:([0-9]+):/g;function fn(t,e){return Tn(t,e,function(){return t.createProgram()},"Unable to create WebGLProgram.")}function mn(t,e,r){if(rn(t,e,function(){return t.linkProgram(r)}),!1===t.getProgramParameter(r,t.LINK_STATUS))throw console.log(t.getProgramInfoLog(r)),new Error("Failed to link vertex and fragment shaders.")}function gn(t,e,r){if(rn(t,e,function(){return t.validateProgram(r)}),!1===t.getProgramParameter(r,t.VALIDATE_STATUS))throw console.log(t.getProgramInfoLog(r)),new Error("Shader program validation failed.")}function vn(t,e,r){var n=Tn(t,e,function(){return t.createBuffer()},"Unable to create WebGLBuffer");return rn(t,e,function(){return t.bindBuffer(t.ARRAY_BUFFER,n)}),rn(t,e,function(){return t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW)}),n}function bn(t,e,r){var n=Tn(t,e,function(){return t.createBuffer()},"Unable to create WebGLBuffer");return rn(t,e,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n)}),rn(t,e,function(){return t.bufferData(t.ELEMENT_ARRAY_BUFFER,r,t.STATIC_DRAW)}),n}function yn(t,e){return Tn(t,e,function(){return t.createTexture()},"Unable to create WebGLTexture.")}function xn(t,e){var r=ge().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0){var n="["+t+"x"+e+"]";throw new Error("Requested texture size "+n+" is invalid.")}if(t>r||e>r)throw n="["+t+"x"+e+"]",new Error("Requested texture size "+n+" greater than WebGL maximum on this browser / GPU ["+r+"x"+r+"].")}function wn(t,e){return Tn(t,e,function(){return t.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function kn(t,e,r,n,o,a,i,s){var u=t.getAttribLocation(r,n);return-1!==u&&(rn(t,e,function(){return t.bindBuffer(t.ARRAY_BUFFER,o)}),rn(t,e,function(){return t.vertexAttribPointer(u,a,t.FLOAT,!1,i,s)}),rn(t,e,function(){return t.enableVertexAttribArray(u)}),!0)}function Cn(t,e,r,n){Dn(t,n),rn(t,e,function(){return t.activeTexture(t.TEXTURE0+n)}),rn(t,e,function(){return t.bindTexture(t.TEXTURE_2D,r)})}function Sn(t,e,r,n){return Tn(t,e,function(){return t.getUniformLocation(r,n)},'uniform "'+n+'" not present in program.')}function En(t,e,r){return t.getUniformLocation(e,r)}function zn(t,e,r,n,o,a){rn(t,e,function(){return Cn(t,e,n,a)}),rn(t,e,function(){return t.uniform1i(o,a)})}function In(t,e,r,n){rn(t,e,function(){return t.bindFramebuffer(t.FRAMEBUFFER,n)}),rn(t,e,function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0)})}function An(t,e,r){rn(t,e,function(){return t.bindFramebuffer(t.FRAMEBUFFER,r)}),rn(t,e,function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0)})}function Nn(t){var e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Rn(t,e))}function Rn(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}function Tn(t,e,r,n){var o=rn(t,e,function(){return r()});if(null==o)throw new Error(n);return o}function Dn(t,e){var r=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,n=e+t.TEXTURE0;if(n<t.TEXTURE0||n>r)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+r+"].")}function _n(t,e){return void 0===e&&(e=2),Te(t.slice(0,t.length-e))}function On(t){if(0===t.length)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function Fn(t){var e=[1,1,1];return 0===t.length||1===t.length&&1===t[0]||(e=[_n(t)].concat(On(t))),e}function Mn(t,e){var r;void 0===e&&(e=!1);var n=ge().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e&&(n*=2,1===(t=t.map(function(e,r){return r>=t.length-2?Ee(t[r]):t[r]})).length&&(t=[2,t[0]])),2!==t.length){var o=qe(t);t=o.newShape}var a=Te(t);if(t.length<=1&&a<=n)return[1,a];if(2===t.length&&t[0]<=n&&t[1]<=n)return t;if(3===t.length&&t[0]*t[1]<=n&&t[2]<=n)return[t[0]*t[1],t[2]];if(3===t.length&&t[0]<=n&&t[1]*t[2]<=n)return[t[0],t[1]*t[2]];if(4===t.length&&t[0]*t[1]*t[2]<=n&&t[3]<=n)return[t[0]*t[1]*t[2],t[3]];if(4===t.length&&t[0]<=n&&t[1]*t[2]*t[3]<=n)return[t[0],t[1]*t[2]*t[3]];if(e){var i=_n(t),s=2,u=2;return t.length&&(s=(r=On(t))[0],u=r[1]),Fe(a=i*(s/2)*(u/2)).map(function(t){return 2*t})}return Fe(a)}function Ln(t){return t%2==0}function Pn(t,e){if(De(t=t.slice(-2),e=e.slice(-2)))return!0;if(!t.length||!e.length)return!0;if(0===t[0]||0===t[1]||0===e[0]||0===e[1])return!0;if(t.length!==e.length){var r=t.slice(-1)[0],n=e.slice(-1)[0];if(r===n)return!0;if(Ln(r)&&Ln(n)&&(1===t[0]||1===e[0]))return!0}return t[1]===e[1]&&Ln(t[0])&&Ln(e[0])}function Bn(t){if(null==pn){var e=Yr(t);pn=e.getParameter(e.MAX_TEXTURE_SIZE)}return pn}function qn(t){if(null==dn){var e=Yr(t);dn=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,dn)}function Vn(t){if(0===t)return 0;var e=Yr(t);return Wn(e,"EXT_disjoint_timer_query_webgl2")&&2===t?2:Wn(e,"EXT_disjoint_timer_query")?1:0}function Wn(t,e){return null!=t.getExtension(e)}function Un(t){try{if(null!=Yr(t))return!0}catch(t){return!1}return!1}function jn(t){if(0===t)return!1;var e=Yr(t);if(1===t){if(!Wn(e,"OES_texture_float"))return!1}else if(!Wn(e,"EXT_color_buffer_float"))return!1;return Gn(e)}function Hn(t){if(0===t)return!1;var e=Yr(t);if(1!==t){if(Wn(e,"EXT_color_buffer_float"))return Gn(e);if(Wn(e,"EXT_color_buffer_half_float")){var r=e.getExtension("EXT_color_buffer_half_float");return function(t,e){var r=en(t,e),n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,r.internalFormatHalfFloat,1,1,0,r.textureFormatFloat,r.textureTypeHalfFloat,null);var o=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,o),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);var a=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(n),t.deleteFramebuffer(o),a}(e,r)}return!1}return!!Wn(e,"OES_texture_float")&&!!Wn(e,"WEBGL_color_buffer_float")&&Gn(e)}function Gn(t){var e=en(t),r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);var n=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0);var o=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(r),t.deleteFramebuffer(n),o}function $n(t){return 2===t&&null!=Yr(t).fenceSync}var Kn=Object.freeze({callAndCheck:rn,canBeRepresented:an,getWebGLErrorMessage:sn,getExtensionOrThrow:un,createVertexShader:ln,createFragmentShader:cn,createProgram:fn,linkProgram:mn,validateProgram:gn,createStaticVertexBuffer:vn,createStaticIndexBuffer:bn,getNumChannels:function(){return 2===ge().getNumber("WEBGL_VERSION")?1:4},createTexture:yn,validateTextureSize:xn,createFramebuffer:wn,bindVertexBufferToProgramAttribute:kn,bindTextureUnit:Cn,unbindTextureUnit:function(t,e,r){Dn(t,r),rn(t,e,function(){return t.activeTexture(t.TEXTURE0+r)}),rn(t,e,function(){return t.bindTexture(t.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:Sn,getProgramUniformLocation:En,bindTextureToProgramUniformSampler:zn,bindCanvasToFramebuffer:function(t,e){rn(t,e,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),rn(t,e,function(){return t.viewport(0,0,t.canvas.width,t.canvas.height)}),rn(t,e,function(){return t.scissor(0,0,t.canvas.width,t.canvas.height)})},bindColorTextureToFramebuffer:In,unbindColorTextureFromFramebuffer:An,validateFramebuffer:Nn,getFramebufferErrorMessage:Rn,getBatchDim:_n,getRowsCols:On,getShapeAs3D:Fn,getTextureShapeFromLogicalShape:Mn,isReshapeFree:Pn,getWebGLMaxTextureSize:Bn,resetMaxTextureSize:function(){pn=null},resetMaxTexturesInShader:function(){dn=null},getMaxTexturesInShader:qn,getWebGLDisjointQueryTimerVersion:Vn,hasExtension:Wn,isWebGLVersionEnabled:Un,isCapableOfRenderingToFloatTexture:jn,isDownloadFloatTextureEnabled:Hn,isWebGLFenceEnabled:$n}),Xn=ge();function Yn(t){ge().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(t+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Jn(){return Vr.memory()}function Zn(t,e){return Vr.tidy(t,e)}function Qn(t){Mr(t).forEach(function(t){return t.dispose()})}function to(t){return Vr.keep(t)}function eo(){return Vr.backend}function ro(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];ge().getBool("IS_TEST")||console.warn.apply(console,t)}function no(t,e){var r=t;if(Ge(t))return"string"===e?[]:[t.length];if(!Array.isArray(t))return[];for(var n=[];Array.isArray(r)||Ge(r)&&"string"!==e;)n.push(r.length),r=r[0];return Array.isArray(t)&&ge().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function t(e,r,n){if(n=n||[],Array.isArray(e)||Ge(e)){Ie(r.length>0,function(){return"Element arr["+n.join("][")+"] should be a primitive, but is an array of "+e.length+" elements"}),Ie(e.length===r[0],function(){return"Element arr["+n.join("][")+"] should have "+r[0]+" elements, but has "+e.length+" elements"});for(var o=r.slice(1),a=0;a<e.length;++a)t(e[a],o,n.concat(a))}else Ie(0===r.length,function(){return"Element arr["+n.join("][")+"] is a primitive, but should be an array/TypedArray of "+r[0]+" elements"})}(t,n,[]),n}function oo(t,e,r,n){if(null!=t&&("numeric"!==t&&t!==e||"numeric"===t&&"string"===e))throw new Error("Argument '"+r+"' passed to '"+n+"' must be "+t+" tensor, but got "+e+" tensor")}function ao(t,e,r,n){if(void 0===n&&(n="numeric"),t instanceof Cr)return oo(n,t.dtype,e,r),t;var o=Ze(t);if("string"!==o&&["bool","int32","float32"].indexOf(n)>=0&&(o=n),oo(n,o,e,r),null==t||!Ge(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t){var a=null==t?"null":t.constructor.name;throw new Error("Argument '"+e+"' passed to '"+r+"' must be a Tensor or TensorLike, but got '"+a+"'")}var i=no(t,o);Ge(t)||Array.isArray(t)||(t=[t]);var s="string"!==o?rr(t,o,ge().getBool("DEBUG")):Re(t,[],!0);return Vr.makeTensor(s,i,o)}function io(t,e,r,n){if(void 0===n&&(n="numeric"),!Array.isArray(t))throw new Error("Argument "+e+" passed to "+r+" must be a `Tensor[]` or `TensorLike[]`");return t.map(function(t,n){return ao(t,e+"["+n+"]",r)},n)}function so(t,e){for(var r=0;r<t.length;++r)if(t[t.length-r-1]!==e-1-r)return!1;return!0}function uo(t,e,r){for(var n=t.length+e.length,o=[],a=0,i=0,s=0;s<n;s++)-1===r.indexOf(s)?o.push(t[a++]):o.push(e[i++]);return o}function lo(t,e){for(var r=[],n=t.length,o=0;o<n;o++)-1===e.indexOf(o)&&r.push(t[o]);return[r,e.map(function(e){return t[e]})]}function co(t,e){return uo(t,e.map(function(t){return 1}),e)}function po(t,e,r){Ie(so(e,r),function(){return t+" supports only inner-most axes for now. Got axes "+e+" and rank-"+r+" input."})}function ho(t,e){if(so(t,e))return null;for(var r=[],n=0;n<e;++n)-1===t.indexOf(n)&&r.push(n);return t.forEach(function(t){return r.push(t)}),r}function fo(t){return t.map(function(t,e){return[e,t]}).sort(function(t,e){return t[1]-e[1]}).map(function(t){return t[0]})}function mo(t,e){for(var r=[],n=e-t;n<e;++n)r.push(n);return r}function go(t,e){var r=t[0].length;t.forEach(function(t,e){Ie(t.length===r,function(){return"Error in concat"+r+"D: rank of tensors["+e+"] must be the same as the rank of the rest ("+r+")"})}),Ie(e>=0&&e<r,function(){return"Error in concat"+r+"D: axis must be between 0 and "+(r-1)+"."});var n=t[0];t.forEach(function(t,o){for(var a=0;a<r;a++)Ie(a===e||t[a]===n[a],function(){return"Error in concat"+r+"D: Shape of tensors["+o+"] ("+t+") does not match the shape of the rest ("+n+") along the non-concatenated axis "+o+"."})})}function vo(t,e){for(var r=t[0].slice(),n=1;n<t.length;n++)r[e]+=t[n][e];return r}function bo(t){var e=Object.keys(t);if(1!==e.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+e.length+" keys.");var r=e[0],n=t[r];r.endsWith("_")&&(r=r.substring(0,r.length-1));var o=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Vr.startScope(r);try{var o=n.apply(void 0,t);return o instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),Vr.endScope(o),o}catch(t){throw Vr.endScope(null),t}};return Object.defineProperty(o,"name",{value:r,configurable:!0}),o}Xn.registerFlag("HAS_WEBGL",function(){return Xn.getNumber("WEBGL_VERSION")>0}),Xn.registerFlag("WEBGL_VERSION",function(){return Un(2)?2:Un(1)?1:0}),Xn.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return 2===Xn.get("WEBGL_VERSION")}),Xn.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),Xn.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),Xn.registerFlag("WEBGL_PACK",function(){return Xn.getBool("HAS_WEBGL")}),Xn.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return Xn.getBool("WEBGL_PACK")}),Xn.registerFlag("WEBGL_PACK_CLIP",function(){return Xn.getBool("WEBGL_PACK")}),Xn.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),Xn.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return Xn.getBool("WEBGL_PACK")}),Xn.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return Xn.getBool("WEBGL_PACK")}),Xn.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return Xn.getBool("WEBGL_PACK")}),Xn.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return Xn.getBool("WEBGL_PACK")}),Xn.registerFlag("WEBGL_PACK_REDUCE",function(){return Xn.getBool("WEBGL_PACK")}),Xn.registerFlag("WEBGL_LAZILY_UNPACK",function(){return Xn.getBool("WEBGL_PACK")}),Xn.registerFlag("WEBGL_CONV_IM2COL",function(){return Xn.getBool("WEBGL_PACK")}),Xn.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return Bn(Xn.getNumber("WEBGL_VERSION"))}),Xn.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return qn(Xn.getNumber("WEBGL_VERSION"))}),Xn.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var t=Xn.getNumber("WEBGL_VERSION");return 0===t?0:Vn(t)}),Xn.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return Xn.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(t=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))));var t}),Xn.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return jn(Xn.getNumber("WEBGL_VERSION"))}),Xn.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!Xn.getBool("WEBGL_FORCE_F16_TEXTURES")&&Xn.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),Xn.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return Hn(Xn.getNumber("WEBGL_VERSION"))}),Xn.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return $n(Xn.getNumber("WEBGL_VERSION"))}),Xn.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return Xn.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),kr=Yn;var yo=bo({complex_:function(t,e){var r=ao(t,"real","complex"),n=ao(e,"imag","complex");return Ae(r.shape,n.shape,"real and imag shapes, "+r.shape+" and "+n.shape+", must match in call to tf.complex()."),Vr.runKernelFunc(function(t){return t.complex(r,n)},{$real:r,$imag:n})}}),xo=bo({real_:function(t){var e=ao(t,"input","real");return Vr.runKernelFunc(function(t){return t.real(e)},{$input:e})}}),wo=bo({imag_:function(t){var e=ao(t,"input","imag");return Vr.runKernelFunc(function(t){return t.imag(e)},{$input:e})}});function ko(t,e,r){return Co(t,e,no(t,r),r)}function Co(t,e,r,n){if(null==n&&(n=Ze(t)),"complex64"===n)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Ge(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=e){sr(e);var o=Te(e),a=Te(r);Ie(o===a,function(){return"Based on the provided shape, ["+e+"], the tensor should have "+o+" values but has "+a});for(var i=0;i<r.length;++i){var s=r[i],u=i!==r.length-1||s!==Te(e.slice(i));Ie(r[i]===e[i]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+r+") does not match the provided shape ("+e+"). "})}}return Ge(t)||Array.isArray(t)||(t=[t]),e=e||r,t="string"!==n?rr(t,n,ge().getBool("DEBUG")):Re(t,[],!0),Vr.makeTensor(t,e,n)}function So(t,e){if((Ge(t)&&"string"!==e||Array.isArray(t))&&"complex64"!==e)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===e&&Ge(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Co(t,[],[],e)}function Eo(t,e){Ne(t);var r=no(t,e);if(1!==r.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Co(t,null,r,e)}function zo(t,e,r){if(Ne(t),null!=e&&2!==e.length)throw new Error("tensor2d() requires shape to have two numbers");var n=no(t,r);if(2!==n.length&&1!==n.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===n.length&&null==e)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Co(t,e,n,r)}function Io(t,e,r){if(Ne(t),null!=e&&3!==e.length)throw new Error("tensor3d() requires shape to have three numbers");var n=no(t,r);if(3!==n.length&&1!==n.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===n.length&&null==e)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Co(t,e,n,r)}function Ao(t,e,r){if(Ne(t),null!=e&&4!==e.length)throw new Error("tensor4d() requires shape to have four numbers");var n=no(t,r);if(4!==n.length&&1!==n.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===n.length&&null==e)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Co(t,e,n,r)}function No(t,e,r){if(Ne(t),null!=e&&5!==e.length)throw new Error("tensor5d() requires shape to have five numbers");var n=no(t,r);if(5!==n.length&&1!==n.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===n.length&&null==e)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Co(t,e,n,r)}function Ro(t,e,r){if(Ne(t),null!=e&&6!==e.length)throw new Error("tensor6d() requires shape to have six numbers");var n=no(t,r);if(6!==n.length&&1!==n.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===n.length&&null==e)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Co(t,e=e||n,n,r)}function To(t,e,r,n){return void 0===e&&(e=!0),Vr.makeVariable(t,e,r,n)}function Do(t,e){if(void 0===e&&(e="float32"),"complex64"===e){var r=Do(t,"float32"),n=_o(t,"float32");return yo(r,n)}var o=or(Te(t),e);return Vr.makeTensor(o,t,e)}function _o(t,e){if(void 0===e&&(e="float32"),"complex64"===e){var r=_o(t,"float32"),n=_o(t,"float32");return yo(r,n)}var o=ar(Te(t),e);return Vr.makeTensor(o,t,e)}function Oo(t,e,r){return Vr.runKernelFunc(function(n){return n.fill(t,e,r)},{})}function Fo(t,e,r){if(r<=0)throw new Error("The number of values should be positive.");return Vr.runKernelFunc(function(n){return n.linspace(t,e,r)},{})}function Mo(t,e,r,n){if(void 0===r&&(r=1),void 0===n&&(n="float32"),0===r)throw new Error("Cannot have a step of zero");if(t===e||t<e&&r<0||e<t&&r>1)return _o([0],n);var o=ar(Math.abs(Math.ceil((e-t)/r)),n);e<t&&1===r&&(r=-1),o[0]=t;for(var a=1;a<o.length;a++)o[a]=o[a-1]+r;return Eo(o,n)}var Lo=bo({onesLike_:function(t){var e=ao(t,"x","onesLike");if("complex64"===e.dtype){var r=Lo(xo(e)),n=Po(wo(e));return yo(r,n)}return Vr.runKernelFunc(function(t){return t.onesLike(e)},{$x:e},function(t,e){return{$x:function(){return Po(t)}}})}}),Po=bo({zerosLike_:function(t){var e=ao(t,"x","zerosLike");return Vr.runKernelFunc(function(t){return t.zerosLike(e)},{$x:e},function(t,e){return{$x:function(){return Po(t)}}})}}),Bo=bo({concat_:function(t,e){void 0===e&&(e=0),Ie(t.length>=1,function(){return"Pass at least one tensor to concat"});var r=io(t,"tensors","concat");"complex64"===r[0].dtype&&r.forEach(function(t){if("complex64"!==t.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype "+t.dtype+". ")}),e=Be(e,r[0].shape)[0];var n=vo(r.map(function(t){return t.shape}),e);if(0===Te(n))return ko([],n);if(1===(r=r.filter(function(t){return t.size>0})).length)return r[0];var o=r.map(function(t){return t.shape});go(o,e);var a=r,i={axis:e};return Vr.runKernelFunc(function(t){return t.concat(r,e)},a,function(t){var r=o.map(function(t){return t[e]});return jo(t,r,e).map(function(t){return function(){return t}})},"Concat",i)}}),qo=bo({concat1d_:function(t){return Bo(t,0)}}),Vo=bo({concat2d_:function(t,e){return Bo(t,e)}}),Wo=bo({concat3d_:function(t,e){return Bo(t,e)}}),Uo=bo({concat4d_:function(t,e){return Bo(t,e)}}),jo=bo({split_:function(t,e,r){void 0===r&&(r=0);var n,o=ao(t,"x","split");return r=Be(r,o.shape)[0],"number"==typeof e?(Ie(o.shape[r]%e==0,function(){return"Number of splits must evenly divide the axis."}),n=new Array(e).fill(o.shape[r]/e)):(Ie(o.shape[r]===e.reduce(function(t,e){return t+e}),function(){return"The sum of sizes must match the size of the axis dimension."}),n=e),Vr.runKernelFunc(function(t){return t.split(o,n,r)},{$x:o},function(t){return{$x:function(){return Bo(t,r)}}})}});function Ho(t,e){return t(e={exports:{}},e.exports),e.exports}var Go=Ho(function(t){!function(t,e,r){function n(t){var e,r=this,n=(e=4022871197,function(t){t=t.toString();for(var r=0;r<t.length;r++){var n=.02519603282416938*(e+=t.charCodeAt(r));n-=e=n>>>0,e=(n*=e)>>>0,e+=4294967296*(n-=e)}return 2.3283064365386963e-10*(e>>>0)});r.next=function(){var t=2091639*r.s0+2.3283064365386963e-10*r.c;return r.s0=r.s1,r.s1=r.s2,r.s2=t-(r.c=0|t)},r.c=1,r.s0=n(" "),r.s1=n(" "),r.s2=n(" "),r.s0-=n(t),r.s0<0&&(r.s0+=1),r.s1-=n(t),r.s1<0&&(r.s1+=1),r.s2-=n(t),r.s2<0&&(r.s2+=1),n=null}function o(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function a(t,e){var r=new n(t),a=e&&e.state,i=r.next;return i.int32=function(){return 4294967296*r.next()|0},i.double=function(){return i()+1.1102230246251565e-16*(2097152*i()|0)},i.quick=i,a&&("object"==typeof a&&o(a,r),i.state=function(){return o(r,{})}),i}e&&e.exports?e.exports=a:this.alea=a}(0,t)}),$o=Ho(function(t){!function(t,e,r){function n(t){var e=this,r="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:r+=t;for(var n=0;n<r.length+64;n++)e.x^=0|r.charCodeAt(n),e.next()}function o(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function a(t,e){var r=new n(t),a=e&&e.state,i=function(){return(r.next()>>>0)/4294967296};return i.double=function(){do{var t=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=r.next,i.quick=i,a&&("object"==typeof a&&o(a,r),i.state=function(){return o(r,{})}),i}e&&e.exports?e.exports=a:this.xor128=a}(0,t)}),Ko=Ho(function(t){!function(t,e,r){function n(t){var e=this,r="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:r+=t;for(var n=0;n<r.length+64;n++)e.x^=0|r.charCodeAt(n),n==r.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function o(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function a(t,e){var r=new n(t),a=e&&e.state,i=function(){return(r.next()>>>0)/4294967296};return i.double=function(){do{var t=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=r.next,i.quick=i,a&&("object"==typeof a&&o(a,r),i.state=function(){return o(r,{})}),i}e&&e.exports?e.exports=a:this.xorwow=a}(0,t)}),Xo=Ho(function(t){!function(t,e,r){function n(t){var e=this;e.next=function(){var t,r,n=e.x,o=e.i;return t=n[o],r=(t^=t>>>7)^t<<24,r^=(t=n[o+1&7])^t>>>10,r^=(t=n[o+3&7])^t>>>3,r^=(t=n[o+4&7])^t<<7,t=n[o+7&7],r^=(t^=t<<13)^t<<9,n[o]=r,e.i=o+1&7,r},function(t,e){var r,n=[];if(e===(0|e))n[0]=e;else for(e=""+e,r=0;r<e.length;++r)n[7&r]=n[7&r]<<15^e.charCodeAt(r)+n[r+1&7]<<13;for(;n.length<8;)n.push(0);for(r=0;r<8&&0===n[r];++r);for(8==r?n[7]=-1:n[r],t.x=n,t.i=0,r=256;r>0;--r)t.next()}(e,t)}function o(t,e){return e.x=t.x.slice(),e.i=t.i,e}function a(t,e){null==t&&(t=+new Date);var r=new n(t),a=e&&e.state,i=function(){return(r.next()>>>0)/4294967296};return i.double=function(){do{var t=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=r.next,i.quick=i,a&&(a.x&&o(a,r),i.state=function(){return o(r,{})}),i}e&&e.exports?e.exports=a:this.xorshift7=a}(0,t)}),Yo=Ho(function(t){!function(t,e,r){function n(t){var e=this;e.next=function(){var t,r,n=e.w,o=e.X,a=e.i;return e.w=n=n+1640531527|0,r=o[a+34&127],t=o[a=a+1&127],r^=r<<13,t^=t<<17,r^=r>>>15,t^=t>>>12,r=o[a]=r^t,e.i=a,r+(n^n>>>16)|0},function(t,e){var r,n,o,a,i,s=[],u=128;for(e===(0|e)?(n=e,e=null):(e+="\0",n=0,u=Math.max(u,e.length)),o=0,a=-32;a<u;++a)e&&(n^=e.charCodeAt((a+32)%e.length)),0===a&&(i=n),n^=n<<10,n^=n>>>15,n^=n<<4,n^=n>>>13,a>=0&&(i=i+1640531527|0,o=0==(r=s[127&a]^=n+i)?o+1:0);for(o>=128&&(s[127&(e&&e.length||0)]=-1),o=127,a=512;a>0;--a)n=s[o+34&127],r=s[o=o+1&127],n^=n<<13,r^=r<<17,n^=n>>>15,r^=r>>>12,s[o]=n^r;t.w=i,t.X=s,t.i=o}(e,t)}function o(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function a(t,e){null==t&&(t=+new Date);var r=new n(t),a=e&&e.state,i=function(){return(r.next()>>>0)/4294967296};return i.double=function(){do{var t=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=r.next,i.quick=i,a&&(a.X&&o(a,r),i.state=function(){return o(r,{})}),i}e&&e.exports?e.exports=a:this.xor4096=a}(0,t)}),Jo=Ho(function(t){!function(t,e,r){function n(t){var e=this,r="";e.next=function(){var t=e.b,r=e.c,n=e.d,o=e.a;return t=t<<25^t>>>7^r,r=r-n|0,n=n<<24^n>>>8^o,o=o-t|0,e.b=t=t<<20^t>>>12^r,e.c=r=r-n|0,e.d=n<<16^r>>>16^o,e.a=o-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):r+=t;for(var n=0;n<r.length+20;n++)e.b^=0|r.charCodeAt(n),e.next()}function o(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function a(t,e){var r=new n(t),a=e&&e.state,i=function(){return(r.next()>>>0)/4294967296};return i.double=function(){do{var t=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=r.next,i.quick=i,a&&("object"==typeof a&&o(a,r),i.state=function(){return o(r,{})}),i}e&&e.exports?e.exports=a:this.tychei=a}(0,t)}),Zo=Ho(function(t){!function(e,r){var n,o=this,a=256,i=6,s="random",u=r.pow(a,i),l=r.pow(2,52),c=2*l,p=a-1;function d(t,p,d){var v=[],b=m(function t(e,r){var n,o=[],a=typeof e;if(r&&"object"==a)for(n in e)try{o.push(t(e[n],r-1))}catch(t){}return o.length?o:"string"==a?e:e+"\0"}((p=1==p?{entropy:!0}:p||{}).entropy?[t,g(e)]:null==t?function(){try{var t;return n&&(t=n.randomBytes)?t=t(a):(t=new Uint8Array(a),(o.crypto||o.msCrypto).getRandomValues(t)),g(t)}catch(t){var r=o.navigator,i=r&&r.plugins;return[+new Date,o,i,o.screen,g(e)]}}():t,3),v),y=new h(v),x=function(){for(var t=y.g(i),e=u,r=0;t<l;)t=(t+r)*a,e*=a,r=y.g(1);for(;t>=c;)t/=2,e/=2,r>>>=1;return(t+r)/e};return x.int32=function(){return 0|y.g(4)},x.quick=function(){return y.g(4)/4294967296},x.double=x,m(g(y.S),e),(p.pass||d||function(t,e,n,o){return o&&(o.S&&f(o,y),t.state=function(){return f(y,{})}),n?(r[s]=t,e):t})(x,b,"global"in p?p.global:this==r,p.state)}function h(t){var e,r=t.length,n=this,o=0,i=n.i=n.j=0,s=n.S=[];for(r||(t=[r++]);o<a;)s[o]=o++;for(o=0;o<a;o++)s[o]=s[i=p&i+t[o%r]+(e=s[o])],s[i]=e;(n.g=function(t){for(var e,r=0,o=n.i,i=n.j,s=n.S;t--;)e=s[o=p&o+1],r=r*a+s[p&(s[o]=s[i=p&i+e])+(s[i]=e)];return n.i=o,n.j=i,r})(a)}function f(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function m(t,e){for(var r,n=t+"",o=0;o<n.length;)e[p&o]=p&(r^=19*e[p&o])+n.charCodeAt(o++);return g(e)}function g(t){return String.fromCharCode.apply(0,t)}if(r["seed"+s]=d,m(r.random(),e),t.exports){t.exports=d;try{n=require("crypto")}catch(t){}}}([],Math)});Zo.alea=Go,Zo.xor128=$o,Zo.xorwow=Ko,Zo.xorshift7=Xo,Zo.xor4096=Yo,Zo.tychei=Jo;var Qo=Zo.alea,ta=function(){function t(t,e,r,n,o){this.mean=t,this.stdDev=e,this.dtype=r,this.nextVal=NaN,this.truncated=n,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var a=o||Math.random();this.random=Qo(a.toString())}return t.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var t=this.nextVal;return this.nextVal=NaN,t}for(var e,r,n=!1;!n;){var o=void 0,a=void 0,i=void 0;do{i=(o=2*this.random()-1)*o+(a=2*this.random()-1)*a}while(i>=1||0===i);var s=Math.sqrt(-2*Math.log(i)/i);e=this.mean+this.stdDev*o*s,r=this.mean+this.stdDev*a*s,this.truncated&&!this.isValidTruncated(e)||(n=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(e)},t.prototype.convertValue=function(t){return null==this.dtype||"float32"===this.dtype?t:Math.round(t)},t.prototype.isValidTruncated=function(t){return t<=this.upper&&t>=this.lower},t}(),ea=function(){function t(t,e,r,n){this.alpha=t,this.beta=1/e,this.dtype=r;var o=n||Math.random();this.randu=Qo(o.toString()),this.randn=new ta(0,1,r,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}return t.prototype.nextValue=function(){for(var t,e,r,n,o,a;;){do{n=this.randn.nextValue(),a=1+this.c*n}while(a<=0);if(a*=a*a,e=1-.331*(t=n*n)*t,r=.5*t+this.d*(1-a+Math.log(a)),(o=this.randu())<e||Math.log(o)<r)break}return a=1/this.beta*this.d*a,this.alpha<1&&(a*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(a)},t.prototype.convertValue=function(t){return"float32"===this.dtype?t:Math.round(t)},t}(),ra=function(){function t(t,e,r,n){var o=this;if(void 0===t&&(t=0),void 0===e&&(e=1),this.canReturnFloat=function(){return null==o.dtype||"float32"===o.dtype},this.min=t,this.range=e-t,this.dtype=r,null==n&&(n=Math.random()),"number"==typeof n&&(n=n.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+t+" - "+e+" <= 1 and dtype is not float");this.random=Qo(n)}return t.prototype.convertValue=function(t){return this.canReturnFloat()?t:Math.round(t)},t.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},t}();function na(t,e,r){return void 0===e&&(e="float32"),e=e||"float32",sr(t),new yr(t,e,r)}function oa(t,e){void 0===e&&(e=!1),console.log(t.toString(e))}var aa=bo({batchToSpaceND_:function(t,e,r){var n=ao(t,"x","batchToSpaceND"),o=e.reduce(function(t,e){return t*e});return Ie(n.rank>=1+e.length,function(){return"input rank is "+n.rank+" but should be > than blockShape.length "+e.length}),Ie(r.length===e.length,function(){return"crops.length is "+r.length+" but should be equal to blockShape.length  "+e.length}),Ie(n.shape[0]%o==0,function(){return"input tensor batch is "+n.shape[0]+" but is not divisible by the product of the elements of blockShape "+e.join(" * ")+" === "+o}),Vr.runKernelFunc(function(t){return t.batchToSpaceND(n,e,r)},{$x:n},function(t){return{$x:function(){return t.spaceToBatchND(e,r)}}})}}),ia=bo({cast_:function(t,e){var r=ao(t,"x","cast");if(!je(e))throw new Error("Failed to cast to unknown dtype "+e);if("string"===e&&"string"!==r.dtype||"string"!==e&&"string"===r.dtype)throw new Error("Only strings can be casted to strings");var n={dtype:e};return Vr.runKernelFunc(function(t){return t.cast(r,e)},{x:r},function(t){return{x:function(){return t.clone()}}},"Cast",n)}}),sa=bo({clone_:function(t){var e=ao(t,"x","clone",null);return Vr.runKernelFunc(function(){return Vr.makeTensorFromDataId(e.dataId,e.shape,e.dtype)},{$x:e},function(t){return{$x:function(){return t.toFloat()}}})}}),ua=bo({cumsum_:function(t,e,r,n){void 0===e&&(e=0),void 0===r&&(r=!1),void 0===n&&(n=!1);var o=ao(t,"x","cumsum"),a=ho([e|=0],o.rank),i=o;null!=a&&(i=o.transpose(a));var s=mo(1,o.rank)[0],u=Vr.runKernelFunc(function(t){return t.cumsum(i,s,r,n)},{permutedX:i},function(t){return{permutedX:function(){return t.cumsum(e,r,!n)}}});return null!=a&&(u=u.transpose(a)),u}}),la=bo({depthToSpace_:function(t,e,r){void 0===r&&(r="NHWC");var n=ao(t,"x","depthToSpace"),o="NHWC"===r?n.shape[1]:n.shape[2],a="NHWC"===r?n.shape[2]:n.shape[3],i="NHWC"===r?n.shape[3]:n.shape[1];return Ie(o*e>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+o+" and "+e+"  for depthToSpace with input shape\n      "+n.shape}),Ie(a*e>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+a+" and "+e+" for depthToSpace with input shape\n          "+n.shape}),Ie(i%(e*e)==0,function(){return"Dimension size must be evenly divisible by "+e*e+" but is "+i+" for depthToSpace with input shape "+n.shape}),Vr.runKernelFunc(function(t){return t.depthToSpace(n,e,r)},{$x:n})}}),ca=bo({expandDims_:function(t,e){void 0===e&&(e=0);var r=ao(t,"x","expandDims",null);Ie(e<=r.rank,function(){return"Axis must be <= rank of the tensor"});var n=r.shape.slice();return e<0&&(Ie(-(r.rank+1)<=e,function(){return"Axis must be in the interval ["+-(r.rank+1)+", "+r.rank+"]"}),e=r.rank+e+1),n.splice(e,0,1),Ca(r,n)}}),pa=bo({eye_:function(t,e,r,n){void 0===n&&(n="float32"),null==e&&(e=t);for(var o=na([t,e],n),a=t<=e?t:e,i=0;i<a;++i)o.set(1,i,i);var s=o.toTensor().as2D(t,e);if(null==r)return s;if(1===r.length)return Ia(ca(s,0),[r[0],1,1]);if(2===r.length)return Ia(ca(ca(s,0),0),[r[0],r[1],1,1]);if(3===r.length)return Ia(ca(ca(ca(s,0),0),0),[r[0],r[1],r[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+r.length+"D.")}}),da=bo({multinomial_:function(t,e,r,n){void 0===n&&(n=!1);var o=ao(t,"logits","multinomial"),a=o.size,i=o.rank;if(a<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+a+".");if(i>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+i);r=r||Math.random();var s=1===i?o.as2D(1,-1):o,u=Vr.runKernelFunc(function(t){return t.multinomial(s,n,e,r)},{logits2D:s});return 1===i?u.as1D():u}}),ha=bo({oneHot_:function(t,e,r,n){if(void 0===r&&(r=1),void 0===n&&(n=0),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var o=ao(t,"indices","oneHot","int32"),a=o.shape.concat([e]);return o=o.flatten(),Vr.runKernelFunc(function(t){return t.oneHot(o,e,r,n)},{$indices:o},function(t){return{$indices:function(){return _o(o.shape,"float32")}}}).reshape(a)}}),fa=bo({pad_:function(t,e,r){void 0===r&&(r=0);var n=ao(t,"x","pad");if(0===n.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var o=e.map(function(t){return t[0]});return Vr.runKernelFunc(function(t){return t.pad(n,e,r)},{$x:n},function(t){return{$x:function(){return t.slice(o,n.shape)}}})}}),ma=bo({pad1d_:function(t,e,r){return void 0===r&&(r=0),Ie(2===e.length,function(){return"Invalid number of paddings. Must be length of 2."}),fa(t,[e],r)}}),ga=bo({pad2d_:function(t,e,r){return void 0===r&&(r=0),Ie(2===e.length&&2===e[0].length&&2===e[1].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),fa(t,e,r)}}),va=bo({pad3d_:function(t,e,r){return void 0===r&&(r=0),Ie(3===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),fa(t,e,r)}}),ba=bo({pad4d_:function(t,e,r){return void 0===r&&(r=0),Ie(4===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length&&2===e[3].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),fa(t,e,r)}}),ya=bo({rand_:function(t,e,r){var n=Te(t),o=null;if(null==r||"float32"===r)o=new Float32Array(n);else if("int32"===r)o=new Int32Array(n);else{if("bool"!==r)throw new Error("Unknown data type "+r);o=new Uint8Array(n)}for(var a=0;a<n;a++)o[a]=e();return Vr.makeTensor(o,t,r)}}),xa=bo({randomNormal_:function(t,e,r,n,o){if(void 0===e&&(e=0),void 0===r&&(r=1),null!=n&&"bool"===n)throw new Error("Unsupported data type "+n);for(var a=new ta(e,r,n,!1,o),i=na(t,n),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),wa=bo({randomGamma_:function(t,e,r,n,o){if(void 0===r&&(r=1),void 0===n&&(n="float32"),null==r&&(r=1),null==n&&(n="float32"),"float32"!==n&&"int32"!==n)throw new Error("Unsupported data type "+n);for(var a=new ea(e,r,n,o),i=na(t,n),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),ka=bo({randomUniform_:function(t,e,r,n,o){void 0===e&&(e=0),void 0===r&&(r=1),void 0===n&&(n="float32");for(var a=na(t,n),i=new ra(e,r,null,o),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),Ca=bo({reshape_:function(t,e){var r=ao(t,"x","reshape",null);e=Pe(e,r.size),Ie(r.size===Te(e),function(){return"new shape and old shape must have the same number of elements."});var n={shape:e};return Vr.runKernelFunc(function(t){return t.reshape(r,e)},{x:r},function(t){return{x:function(){return t.reshape(r.shape)}}},"Reshape",n)}}),Sa=bo({spaceToBatchND_:function(t,e,r){var n=ao(t,"x","spaceToBatchND");return Ie(n.rank>=1+e.length,function(){return"input rank "+n.rank+" should be > than [blockShape] "+e.length}),Ie(r.length===e.length,function(){return"paddings.shape[0] "+r.length+" must be equal to [blockShape] "+e.length}),Ie(n.shape.reduce(function(t,n,o){return o>0&&o<=e.length?t&&(n+r[o-1][0]+r[o-1][1])%e[o-1]==0:t},!0),function(){return"input spatial dimensions "+n.shape.slice(1)+" with paddings "+r.toString()+" must be divisible by blockShapes "+e.toString()}),Vr.runKernelFunc(function(t){return t.spaceToBatchND(n,e,r)},{$x:n},function(t){return{$x:function(){return t.batchToSpaceND(e,r)}}})}}),Ea=bo({squeeze_:function(t,e){var r=ao(t,"x","squeeze");return Ca(r,qe(r.shape,e).newShape)}}),za=bo({stack_:function(t,e){void 0===e&&(e=0);var r=io(t,"tensors","stack");if(Ie(r.length>=1,function(){return"Pass at least one tensor to tf.stack"}),1===r.length)return r[0].expandDims(e);var n=r[0].rank,o=r[0].shape,a=r[0].dtype;Ie(e<=n,function(){return"Axis must be <= rank of the tensor"}),r.forEach(function(t){Ae(o,t.shape,"All tensors passed to stack must have matching shapes")}),r.forEach(function(t){Ie(a===t.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var i=r.map(function(t){return t.expandDims(e)});return Bo(i,e)}}),Ia=bo({tile_:function(t,e){var r=ao(t,"x","tile",null);return Ie(r.rank===e.length,function(){return"Error in transpose: rank of input "+r.rank+" must match length of reps "+e+"."}),Vr.runKernelFunc(function(t,n){var o=t.tile(r,e);return n([r]),o},{$x:r},function(t,r){var n=r[0];return{$x:function(){var r=Po(n);if(1===n.rank)for(var o=0;o<e[0];++o)r=r.add(t.slice([o*n.shape[0]],[n.shape[0]]));else if(2===n.rank)for(o=0;o<e[0];++o)for(var a=0;a<e[1];++a)r=r.add(t.slice([o*n.shape[0],a*n.shape[1]],[n.shape[0],n.shape[1]]));else if(3===n.rank)for(o=0;o<e[0];++o)for(a=0;a<e[1];++a)for(var i=0;i<e[2];++i)r=r.add(t.slice([o*n.shape[0],a*n.shape[1],i*n.shape[2]],[n.shape[0],n.shape[1],n.shape[2]]));else{if(4!==n.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+n.rank+" tensors yet.");for(o=0;o<e[0];++o)for(a=0;a<e[1];++a)for(i=0;i<e[2];++i)for(var s=0;s<e[3];++s)r=r.add(t.slice([o*n.shape[0],a*n.shape[1],i*n.shape[2],s*n.shape[3]],[n.shape[0],n.shape[1],n.shape[2],n.shape[3]]))}return r}}})}}),Aa=bo({truncatedNormal_:function(t,e,r,n,o){if(void 0===e&&(e=0),void 0===r&&(r=1),null!=n&&"bool"===n)throw new Error("Unsupported data type "+n);for(var a=new ta(e,r,n,!0,o),i=na(t,n),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),Na=bo({unstack_:function(t,e){void 0===e&&(e=0),e=e||0;var r=ao(t,"x","unstack");return Ie(e>=-r.shape.length&&e<r.shape.length,function(){return"Axis = "+e+" is not in [-"+r.shape.length+", "+r.shape.length+")"}),e<0&&(e+=r.shape.length),Vr.runKernelFunc(function(t){return t.unstack(r,e)},{$x:r},function(t){return{$x:function(){return za(t,e)}}})}}),Ra=function(t,e){return he(this,void 0,void 0,function(){var r,n,o,a,i,s,u,l,c,p;return fe(this,function(d){switch(d.label){case 0:return r=ao(t,"x","setdiff1d"),n=ao(e,"y","setdiff1d"),Ie(r.dtype===n.dtype,function(){return"x and y should have the same dtype, but got x ("+r.dtype+") and y ("+n.dtype+")."}),Ie(1===r.rank,function(){return"x should be 1D tensor, but got x ("+r.shape+")."}),Ie(1===n.rank,function(){return"y should be 1D tensor, but got y ("+n.shape+")."}),[4,r.data()];case 1:return o=d.sent(),[4,n.data()];case 2:for(a=d.sent(),i=new Set(a),s=0,c=0;c<o.length;c++)i.has(o[c])||s++;for(u=new yr([s],r.dtype),l=new yr([s],"int32"),c=0,p=0;c<o.length;c++)i.has(o[c])||(u.values[p]=o[c],l.values[p]=c,p++);return[2,[u.toTensor(),l.toTensor()]]}})})};function Ta(t,e,r,n){void 0===n&&(n=!0);var o=[];if(n)(o=o.concat(e.slice(0))).push(t[0]/r),o=o.concat(t.slice(1));else{o=o.concat(t[0]);for(var a=e.length,i=0;i<a;++i)o=o.concat([t[i+1]/e[i],e[i]]);o=o.concat(t.slice(a+1))}return o}function Da(t,e,r){void 0===r&&(r=!0);var n=[];if(r){n.push(e);for(var o=e+1;o<t;++o)o<=2*e?(n.push(o),n.push(o-(e+1))):n.push(o)}else{var a=[],i=[];for(o=1;o<t;++o)o>=2*e+1||o%2==1?i.push(o):a.push(o);n.push.apply(n,a),n.push(0),n.push.apply(n,i)}return n}function _a(t,e,r,n){void 0===n&&(n=!0);var o=[];n?o.push(t[0]/r):o.push(t[0]*r);for(var a=1;a<t.length;++a)a<=e.length?n?o.push(e[a-1]*t[a]):o.push(t[a]/e[a-1]):o.push(t[a]);return o}function Oa(t,e){for(var r=[0],n=0;n<e;++n)r.push(t[n][0]);return r}function Fa(t,e,r){for(var n=t.slice(0,1),o=0;o<r;++o)n.push(t[o+1]-e[o][0]-e[o][1]);return n}function Ma(t,e){if(t.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+t.rank+".");if(e.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if("int32"!==e.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.shape[e.rank-1]>t.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+e.shape[e.rank-1]+" vs. "+t.rank);if(0===t.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+t.shape+".");for(var r=e.shape,n=r[r.length-1],o=1,a=0;a<r.length-1;++a)o*=r[a];var i=t.shape,s=r.slice();s.pop();var u=1;for(a=n;a<t.rank;++a)u*=i[a],s.push(i[a]);var l=er(t.shape).map(function(t){return t/u}).concat([1]).slice(0,n);return[s,o,u,l]}var La=30;function Pa(t){return t<=La?t:tr(t,Math.floor(Math.sqrt(t)))}function Ba(t,e,r){for(var n=e.rank>1?e.shape[e.rank-1]:1,o=r.length,a=1,i=n;i<o;++i)a*=r[i];var s=n<1?1:n;return{sliceRank:n,numUpdates:e.size/s,sliceSize:a,strides:er(r.slice(0,n)).concat([1]),outputSize:Te(r)}}function qa(t,e,r){Ie(t.rank===e.length,function(){return"Error in slice"+t.rank+"D: Length of begin "+e+" must match the rank of the array ("+t.rank+")."}),Ie(t.rank===r.length,function(){return"Error in slice"+t.rank+"D: Length of size "+r+" must match the rank of the array ("+t.rank+")."});for(var n=function(n){Ie(e[n]+r[n]<=t.shape[n],function(){return"Error in slice"+t.rank+"D: begin["+n+"] + size["+n+"] ("+(e[n]+r[n])+") would overflow input.shape["+n+"] ("+t.shape[n]+")"})},o=0;o<t.rank;++o)n(o)}function Va(t){for(var e=[],r=0;t>0;)1&t&&e.push(r),t/=2,r++;return e}function Wa(t,e,r){for(var n=[],o=0;o<t.length;o++)n[o]=Math.ceil((e[o]-t[o])/r[o]);return n}function Ua(t,e,r,n,o){var a=e[o],i=r[o]||1;(t&1<<o||null==a)&&(a=i>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=n[o];return a<0&&(a+=s),Se(0,a,s-1)}function ja(t,e,r,n,o){var a=e[o],i=r[o]||1;(t&1<<o||null==a)&&(a=i>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=n[o];return a<0&&(a+=s),i>0?Se(0,a,s):Se(-1,a,s-1)}function Ha(t,e,r){for(var n=r.length,o=0;o<r.length;o++)if(r[o]>1){n=o;break}for(o=n+1;o<r.length;o++)if(e[o]>0||r[o]!==t[o])return!1;return!0}function Ga(t,e){for(var r=t.length>0?t[t.length-1]:1,n=0;n<t.length-1;n++)r+=t[n]*e[n];return r}var $a=Object.freeze({assertParamsValid:qa,maskToAxes:Va,computeOutShape:Wa,startForAxis:Ua,stopForAxis:ja,isSliceContinous:Ha,computeFlatOffset:Ga});function Ka(t,e){Ie(Qe(t),function(){return"The f passed in variableGrads(f) must be a function"}),Ie(null==e||Array.isArray(e)&&e.every(function(t){return t instanceof Rr}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var r=null!=e;if(!r)for(var n in e=[],Vr.registeredVariables)e.push(Vr.registeredVariables[n]);var o=r?e.filter(function(t){return!t.trainable}):null,a=e.length;Ie((e=e.filter(function(t){return t.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+a+" variables is trainable."});var i=Vr.gradients(t,e,null,!0),s=i.value,u=i.grads;Ie(u.some(function(t){return null!=t}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),Ie(0===s.rank,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"});var l={};return e.forEach(function(t,e){null!=u[e]&&(l[t.name]=u[e])}),null!=o&&o.forEach(function(t){return l[t.name]=null}),{value:s,grads:l}}function Xa(t){return Vr.customGrad(t)}function Ya(t){if(t.filter(function(t){return null==t}).length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}var Ja=bo({softmax_:function(t,e){void 0===e&&(e=-1);var r=ao(t,"logits","softmax");if(-1===e&&(e=r.rank-1),e!==r.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+r.rank+" and dim was "+e);return Xa(function(t,r){var n=t.logSumExp([e],!0),o=t.toFloat().sub(n).exp();return r([o]),{value:o,gradFunc:function(t,r){var n=r[0],o=t.mul(n);return o.sub(o.sum([e],!0).mul(n))}}})(r)}}),Za=bo({logSoftmax_:function(t,e){void 0===e&&(e=-1);var r=ao(t,"logits","logSoftmax");if(-1===e&&(e=r.rank-1),e!==r.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+r.rank+" and axis was "+e);return Xa(function(t,r){var n=t.max(e,!0),o=t.sub(n),a=o.toFloat().sub(o.exp().sum(e,!0).log());return r([a]),{value:a,gradFunc:function(t,r){var n=r[0].exp();return t.sub(t.sum(e,!0).mul(n))}}})(r)}}),Qa=function(){function t(t,e){this.backend=t,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}return t.prototype.get=function(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)},t.prototype.set=function(t,e){this.dataIdsCount++,this.data.set(t,e)},t.prototype.has=function(t){return this.data.has(t)},t.prototype.delete=function(t){return this.dataIdsCount--,this.data.delete(t)},t.prototype.numDataIds=function(){return this.dataIdsCount},t}(),ti=function(){function t(){}return t.prototype.time=function(t){return ei("time")},t.prototype.read=function(t){return ei("read")},t.prototype.readSync=function(t){return ei("readSync")},t.prototype.numDataIds=function(){return ei("numDataIds")},t.prototype.disposeData=function(t){return ei("disposeData")},t.prototype.fromPixels=function(t,e){return ei("fromPixels")},t.prototype.write=function(t,e,r){return ei("write")},t.prototype.move=function(t,e,r,n){return ei("move")},t.prototype.memory=function(){return ei("memory")},t.prototype.floatPrecision=function(){return ei("floatPrecision")},t.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},t.prototype.batchMatMul=function(t,e,r,n){return ei("batchMatMul")},t.prototype.fusedBatchMatMul=function(t){return t.a,t.b,t.transposeA,t.transposeB,t.bias,t.activation,t.preluActivationWeights,ei("fusedBatchMatMul")},t.prototype.slice=function(t,e,r){return ei("slice")},t.prototype.stridedSlice=function(t,e,r,n){return ei("stridedSlice")},t.prototype.unstack=function(t,e){return ei("unstack")},t.prototype.reverse=function(t,e){return ei("reverse")},t.prototype.concat=function(t,e){return ei("concat")},t.prototype.neg=function(t){return ei("neg")},t.prototype.add=function(t,e){return ei("add")},t.prototype.addN=function(t){return ei("addN")},t.prototype.subtract=function(t,e){return ei("subtract")},t.prototype.multiply=function(t,e){return ei("multiply")},t.prototype.realDivide=function(t,e){return ei("realDivide")},t.prototype.floorDiv=function(t,e){return ei("floorDiv")},t.prototype.sum=function(t,e){return ei("sum")},t.prototype.prod=function(t,e){return ei("prod")},t.prototype.unsortedSegmentSum=function(t,e,r){return ei("unsortedSegmentSum")},t.prototype.argMin=function(t,e){return ei("argMin")},t.prototype.argMax=function(t,e){return ei("argMax")},t.prototype.equal=function(t,e){return ei("equal")},t.prototype.notEqual=function(t,e){return ei("notEqual")},t.prototype.less=function(t,e){return ei("less")},t.prototype.lessEqual=function(t,e){return ei("lessEqual")},t.prototype.greater=function(t,e){return ei("greater")},t.prototype.greaterEqual=function(t,e){return ei("greaterEqual")},t.prototype.logicalNot=function(t){return ei("logicalNot")},t.prototype.logicalAnd=function(t,e){return ei("logicalAnd")},t.prototype.logicalOr=function(t,e){return ei("logicalOr")},t.prototype.where=function(t){return ei("where")},t.prototype.select=function(t,e,r){return ei("select")},t.prototype.topk=function(t,e,r){return ei("topk")},t.prototype.min=function(t,e){return ei("min")},t.prototype.minimum=function(t,e){return ei("minimum")},t.prototype.mod=function(t,e){return ei("mod")},t.prototype.max=function(t,e){return ei("max")},t.prototype.maximum=function(t,e){return ei("maximum")},t.prototype.all=function(t,e){return ei("all")},t.prototype.any=function(t,e){return ei("any")},t.prototype.squaredDifference=function(t,e){return ei("squaredDifference")},t.prototype.ceil=function(t){return ei("ceil")},t.prototype.floor=function(t){return ei("floor")},t.prototype.round=function(t){return ei("round")},t.prototype.sign=function(t){return ei("sign")},t.prototype.isNaN=function(t){return ei("isNaN")},t.prototype.isInf=function(t){return ei("isInf")},t.prototype.isFinite=function(t){return ei("isFinite")},t.prototype.pow=function(t,e){return ei("pow")},t.prototype.exp=function(t){return ei("exp")},t.prototype.expm1=function(t){return ei("expm1")},t.prototype.log=function(t){return ei("log")},t.prototype.log1p=function(t){return ei("log1p")},t.prototype.sqrt=function(t){return ei("sqrt")},t.prototype.rsqrt=function(t){return ei("rsqrt")},t.prototype.square=function(t){return ei("square")},t.prototype.reciprocal=function(t){return ei("reciprocal")},t.prototype.relu=function(t){return ei("relu")},t.prototype.relu6=function(t){return ei("relu6")},t.prototype.prelu=function(t,e){return ei("prelu")},t.prototype.elu=function(t){return ei("elu")},t.prototype.eluDer=function(t,e){return ei("eluDer")},t.prototype.selu=function(t){return ei("selu")},t.prototype.int=function(t){return ei("int")},t.prototype.clip=function(t,e,r){return ei("clip")},t.prototype.abs=function(t){return ei("abs")},t.prototype.complexAbs=function(t){return ei("complexAbs")},t.prototype.sigmoid=function(t){return ei("sigmoid")},t.prototype.softplus=function(t){return ei("softplus")},t.prototype.sin=function(t){return ei("sin")},t.prototype.cos=function(t){return ei("cos")},t.prototype.tan=function(t){return ei("tan")},t.prototype.asin=function(t){return ei("asin")},t.prototype.acos=function(t){return ei("acos")},t.prototype.atan=function(t){return ei("atan")},t.prototype.atan2=function(t,e){return ei("atan2")},t.prototype.sinh=function(t){return ei("sinh")},t.prototype.cosh=function(t){return ei("cosh")},t.prototype.tanh=function(t){return ei("tanh")},t.prototype.asinh=function(t){return ei("asinh")},t.prototype.acosh=function(t){return ei("acosh")},t.prototype.atanh=function(t){return ei("atanh")},t.prototype.erf=function(t){return ei("erf")},t.prototype.step=function(t,e){return ei("step")},t.prototype.fusedConv2d=function(t){return t.input,t.filter,t.convInfo,t.bias,t.activation,t.preluActivationWeights,ei("fusedConv2d")},t.prototype.conv2d=function(t,e,r){return ei("conv2d")},t.prototype.conv2dDerInput=function(t,e,r){return ei("conv2dDerInput")},t.prototype.conv2dDerFilter=function(t,e,r){return ei("conv2dDerFilter")},t.prototype.fusedDepthwiseConv2D=function(t){return t.input,t.filter,t.convInfo,t.bias,t.activation,t.preluActivationWeights,ei("fusedDepthwiseConv2D")},t.prototype.depthwiseConv2D=function(t,e,r){return ei("depthwiseConv2D")},t.prototype.depthwiseConv2DDerInput=function(t,e,r){return ei("depthwiseConv2DDerInput")},t.prototype.depthwiseConv2DDerFilter=function(t,e,r){return ei("depthwiseConv2DDerFilter")},t.prototype.conv3d=function(t,e,r){return ei("conv3d")},t.prototype.conv3dDerInput=function(t,e,r){return ei("conv3dDerInput")},t.prototype.conv3dDerFilter=function(t,e,r){return ei("conv3dDerFilter")},t.prototype.maxPool=function(t,e){return ei("maxPool")},t.prototype.maxPoolBackprop=function(t,e,r,n){return ei("maxPoolBackprop")},t.prototype.avgPool=function(t,e){return ei("avgPool")},t.prototype.avgPoolBackprop=function(t,e,r){return ei("avgPoolBackprop")},t.prototype.avgPool3d=function(t,e){return ei("avgPool3d")},t.prototype.avgPool3dBackprop=function(t,e,r){return ei("avgPool3dBackprop")},t.prototype.maxPool3d=function(t,e){return ei("maxPool3d")},t.prototype.maxPool3dBackprop=function(t,e,r,n){return ei("maxPool3dBackprop")},t.prototype.reshape=function(t,e){return ei("reshape")},t.prototype.cast=function(t,e){return ei("cast")},t.prototype.tile=function(t,e){return ei("tile")},t.prototype.pad=function(t,e,r){return ei("pad")},t.prototype.transpose=function(t,e){return ei("transpose")},t.prototype.gather=function(t,e,r){return ei("gather")},t.prototype.gatherND=function(t,e){return ei("gatherND")},t.prototype.scatterND=function(t,e,r){return ei("scatterND")},t.prototype.batchToSpaceND=function(t,e,r){return ei("batchToSpaceND")},t.prototype.spaceToBatchND=function(t,e,r){return ei("spaceToBatchND")},t.prototype.resizeBilinear=function(t,e,r,n){return ei("resizeBilinear")},t.prototype.resizeBilinearBackprop=function(t,e,r){return ei("resizeBilinearBackprop")},t.prototype.resizeNearestNeighbor=function(t,e,r,n){return ei("resizeNearestNeighbor")},t.prototype.resizeNearestNeighborBackprop=function(t,e,r){return ei("resizeNearestNeighborBackprop")},t.prototype.batchNormalization=function(t,e,r,n,o,a){return ei("batchNormalization")},t.prototype.localResponseNormalization4D=function(t,e,r,n,o){return ei("localResponseNormalization4D")},t.prototype.LRNGrad=function(t,e,r,n,o,a,i){return ei("LRNGrad")},t.prototype.multinomial=function(t,e,r,n){return ei("multinomial")},t.prototype.oneHot=function(t,e,r,n){return ei("oneHot")},t.prototype.cumsum=function(t,e,r,n){return ei("cumsum")},t.prototype.nonMaxSuppression=function(t,e,r,n,o){return ei("nonMaxSuppression")},t.prototype.fft=function(t){return ei("fft")},t.prototype.ifft=function(t){return ei("ifft")},t.prototype.complex=function(t,e){return ei("complex")},t.prototype.real=function(t){return ei("real")},t.prototype.imag=function(t){return ei("imag")},t.prototype.cropAndResize=function(t,e,r,n,o,a){return ei("cropAndResize")},t.prototype.depthToSpace=function(t,e,r){return ei("depthToSpace")},t.prototype.split=function(t,e,r){return ei("split")},t.prototype.sparseToDense=function(t,e,r,n){return ei("sparseToDense")},t.prototype.diag=function(t){return ei("diag")},t.prototype.fill=function(t,e,r){return ei("fill")},t.prototype.onesLike=function(t){return ei("onesLike")},t.prototype.zerosLike=function(t){return ei("zerosLike")},t.prototype.linspace=function(t,e,r){return ei("linspace")},t.prototype.dispose=function(){return ei("dispose")},t}();function ei(t){throw new Error("'"+t+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function ri(t,e){for(var r=t.length,n=[],o=0;o<r;o++){var a=r-1-o,i=t[a]||1;(e[e.length-1-o]||1)>1&&1===i&&n.unshift(a)}return n}function ni(t,e){for(var r=[],n=0;n<e.length;n++){var o=t[t.length-n-1],a=e.length-n-1,i=e[a];(null==o||1===o&&i>1)&&r.unshift(a)}return r}function oi(t,e){for(var r=[],n=Math.max(t.length,e.length),o=0;o<n;o++){var a=t[t.length-o-1];null==a&&(a=1);var i=e[e.length-o-1];if(null==i&&(i=1),1===a)r.unshift(i);else if(1===i)r.unshift(a);else{if(a!==i)throw Error("Operands could not be broadcast together with shapes "+t+" and "+e+".");r.unshift(a)}}return r}function ai(t,e,r,n,o,a,i){void 0===i&&(i="channelsLast");var s,u=ci(e),l=u[0],c=u[1];if("channelsLast"===i)s=[l,c,t[3],t[3]];else{if("channelsFirst"!==i)throw new Error("Unknown dataFormat "+i);s=[l,c,t[1],t[1]]}return si(t,s,r,n,o,a,!1,i)}function ii(t,e,r,n,o,a,i){void 0===i&&(i="NDHWC");var s,u,l=pi(e),c=l[0],p=l[1],d=l[2];if("NDHWC"===i)u="channelsLast",s=[c,p,d,t[4],t[4]];else{if("NCDHW"!==i)throw new Error("Unknown dataFormat "+i);u="channelsFirst",s=[c,p,d,t[1],t[1]]}return ui(t,s,r,n,o,!1,u,a)}function si(t,e,r,n,o,a,i,s){void 0===i&&(i=!1),void 0===s&&(s="channelsLast");var u=[-1,-1,-1,-1],l=u[0],c=u[1],p=u[2],d=u[3];if("channelsLast"===s)l=t[0],c=t[1],p=t[2],d=t[3];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);l=t[0],d=t[1],c=t[2],p=t[3]}var h,f=e[0],m=e[1],g=e[3],v=ci(r),b=v[0],y=v[1],x=ci(n),w=x[0],k=x[1],C=di(f,w),S=di(m,k),E=function(t,e,r,n,o,a,i,s){var u,l,c;if("number"==typeof t){u={top:t,bottom:t,left:t,right:t,type:0===t?"VALID":"NUMBER"};var p=function(t,e,r,n,o){null==n&&(n=li(t,e,r));var a=t[1],i=hi((t[0]-e+2*n)/r+1,o);Ie(_e(i),function(){return"The output # of rows ("+i+") must be an integer. Change the stride and/or zero pad parameters"});var s=hi((a-e+2*n)/r+1,o);return Ie(_e(s),function(){return"The output # of columns ("+s+") must be an integer. Change the stride and/or zero pad parameters"}),[i,s]}([e,r],a,n,t,s);l=p[0],c=p[1]}else if("same"===t){l=Math.ceil(e/n),c=Math.ceil(r/o);var d=Math.max(0,(l-1)*n+a-e),h=Math.max(0,(c-1)*o+i-r),f=Math.floor(d/2),m=d-f,g=Math.floor(h/2);u={top:f,bottom:m,left:g,right:h-g,type:"SAME"}}else{if("valid"!==t)throw Error("Unknown padding parameter: "+t);u={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((e-a+1)/n),c=Math.ceil((r-i+1)/o)}return{padInfo:u,outHeight:l,outWidth:c}}(o,c,p,b,y,C,S,a),z=E.padInfo,I=E.outHeight,A=E.outWidth,N=i?g*d:g;return"channelsFirst"===s?h=[l,N,I,A]:"channelsLast"===s&&(h=[l,I,A,N]),{batchSize:l,dataFormat:s,inHeight:c,inWidth:p,inChannels:d,outHeight:I,outWidth:A,outChannels:N,padInfo:z,strideHeight:b,strideWidth:y,filterHeight:f,filterWidth:m,effectiveFilterHeight:C,effectiveFilterWidth:S,dilationHeight:w,dilationWidth:k,inShape:t,outShape:h,filterShape:e}}function ui(t,e,r,n,o,a,i,s){void 0===a&&(a=!1),void 0===i&&(i="channelsLast");var u=[-1,-1,-1,-1,-1],l=u[0],c=u[1],p=u[2],d=u[3],h=u[4];if("channelsLast"===i)l=t[0],c=t[1],p=t[2],d=t[3],h=t[4];else{if("channelsFirst"!==i)throw new Error("Unknown dataFormat "+i);l=t[0],h=t[1],c=t[2],p=t[3],d=t[4]}var f,m=e[0],g=e[1],v=e[2],b=e[4],y=pi(r),x=y[0],w=y[1],k=y[2],C=pi(n),S=C[0],E=C[1],z=C[2],I=di(m,S),A=di(g,E),N=di(v,z),R=function(t,e,r,n,o,a,i,s,u,l,c){var p,d,h,f;if("number"==typeof t){p={top:t,bottom:t,left:t,right:t,front:t,back:t,type:0===t?"VALID":"NUMBER"};var m=function(t,e,r,n,o,a){null==o&&(o=li(t,e,n));var i=t[1],s=t[2],u=hi((t[0]-e+2*o)/n+1,a);Ie(_e(u),function(){return"The output # of depths ("+u+") must be an integer. Change the stride and/or zero pad parameters"});var l=hi((i-e+2*o)/n+1,a);Ie(_e(l),function(){return"The output # of rows ("+l+") must be an integer. Change the stride and/or zero pad parameters"});var c=hi((s-e+2*o)/n+1,a);return Ie(_e(c),function(){return"The output # of columns ("+c+") must be an integer. Change the stride and/or zero pad parameters"}),[u,l,c,1]}([e,r,n,1],s,0,o,t,c);d=m[0],h=m[1],f=m[2]}else if("same"===t){var g=((d=Math.ceil(e/o))-1)*o+s-e,v=((h=Math.ceil(r/a))-1)*a+u-r,b=((f=Math.ceil(n/i))-1)*i+l-n,y=Math.floor(g/2),x=g-y,w=Math.floor(v/2),k=v-w,C=Math.floor(b/2);p={top:w,bottom:k,left:C,right:b-C,front:y,back:x,type:"SAME"}}else{if("valid"!==t)throw Error("Unknown padding parameter: "+t);p={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},d=Math.ceil((e-s+1)/o),h=Math.ceil((r-u+1)/a),f=Math.ceil((n-l+1)/i)}return{padInfo:p,outDepth:d,outHeight:h,outWidth:f}}(o,c,p,d,x,w,k,I,A,N,s),T=R.padInfo,D=R.outDepth,_=R.outHeight,O=R.outWidth,F=a?b*h:b;return"channelsFirst"===i?f=[l,F,D,_,O]:"channelsLast"===i&&(f=[l,D,_,O,F]),{batchSize:l,dataFormat:i,inDepth:c,inHeight:p,inWidth:d,inChannels:h,outDepth:D,outHeight:_,outWidth:O,outChannels:F,padInfo:T,strideDepth:x,strideHeight:w,strideWidth:k,filterDepth:m,filterHeight:g,filterWidth:v,effectiveFilterDepth:I,effectiveFilterHeight:A,effectiveFilterWidth:N,dilationDepth:S,dilationHeight:E,dilationWidth:z,inShape:t,outShape:f,filterShape:e}}function li(t,e,r,n){void 0===n&&(n=1);var o=di(e,n);return Math.floor((t[0]*(r-1)-r+o)/2)}function ci(t){return"number"==typeof t?[t,t,t]:2===t.length?[t[0],t[1],1]:t}function pi(t){return"number"==typeof t?[t,t,t]:t}function di(t,e){return e<=1?t:t+(t-1)*(e-1)}function hi(t,e){if(!e)return t;switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error("Unknown roundingMode "+e)}}function fi(t){var e=ci(t),r=e[0],n=e[1],o=e[2];return 1===r&&1===n&&1===o}function mi(t,e){return fi(t)||fi(e)}function gi(t){if("NHWC"===t)return"channelsLast";if("NCHW"===t)return"channelsFirst";throw new Error("Unknown dataFormat "+t)}function vi(t,e,r){if("complex64"===e){if("complex64"===t.dtype)return t.clone();var n=_o(t.shape),o=t.toFloat(),a=r.complex(o,n);return n.dispose(),o.dispose(),a}if(!He(t.dtype,e))return Vr.makeTensorFromDataId(t.dataId,t.shape,e);if("complex64"===t.dtype){var i=r.real(t);return a=i.cast(e),i.dispose(),a}if("int32"===e)return r.int(t);if("bool"===e){var s=So(0,t.dtype);return a=r.notEqual(t,s),s.dispose(),a}throw new Error("Error in Cast: failed to cast "+t.dtype+" to "+e)}function bi(t,e){return Vr.makeTensorFromDataId(t.dataId,e,t.dtype)}function yi(t,e,r){var n=(e-t)/(r-1),o=ar(r,"float32");o[0]=t;for(var a=1;a<o.length;a++)o[a]=o[a-1]+n;return Eo(o,"float32")}var xi=Object.freeze({castTensor:vi,reshapeTensor:bi,linspaceImpl:yi,upcastType:Dr,axesAreInnerMostDims:so,combineLocations:uo,computeOutAndReduceShapes:lo,expandShapeToKeepDim:co,assertAxesAreInnerMostDims:po,getAxesPermutation:ho,getUndoAxesPermutation:fo,getInnerMostAxes:mo,getBroadcastDims:ri,getReductionAxes:ni,assertAndGetBroadcastShape:oi,assertParamsConsistent:go,computeOutShape:vo,computePool2DInfo:ai,computePool3DInfo:ii,computeConv2DInfo:si,computeConv3DInfo:ui,computeDefaultPad:li,tupleValuesAreOne:fi,eitherStridesOrDilationsAreOne:mi,convertConv2DDataFormat:gi});function wi(t,e){if(t.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+t.length+", imag: "+e.length+".");for(var r=new Float32Array(2*t.length),n=0;n<r.length;n+=2)r[n]=t[n/2],r[n+1]=e[n/2];return r}function ki(t,e){return{real:t[2*e],imag:t[2*e+1]}}function Ci(t,e,r,n){t[2*n]=e,t[2*n+1]=r}function Si(t,e,r){var n=(r?2:-2)*Math.PI*(t/e);return{real:Math.cos(n),imag:Math.sin(n)}}function Ei(t,e,r,n,o){for(var a=Array.from(e).map(function(t,e){return{score:t,boxIndex:e}}).filter(function(t){return t.score>o}).sort(function(t,e){return e.score-t.score}),i=[],s=0;s<a.length;s++){var u=a[s],l=u.score,c=u.boxIndex;if(l<o)break;for(var p=!1,d=i.length-1;d>=0;--d)if(zi(t,c,i[d])>=n){p=!0;break}if(!p&&(i.push(c),i.length>=r))break}return Eo(i,"int32")}function zi(t,e,r){var n=t.subarray(4*e,4*e+4),o=t.subarray(4*r,4*r+4),a=Math.min(n[0],n[2]),i=Math.min(n[1],n[3]),s=Math.max(n[0],n[2]),u=Math.max(n[1],n[3]),l=Math.min(o[0],o[2]),c=Math.min(o[1],o[3]),p=Math.max(o[0],o[2]),d=Math.max(o[1],o[3]),h=(s-a)*(u-i),f=(p-l)*(d-c);if(h<=0||f<=0)return 0;var m=Math.max(a,l),g=Math.max(i,c),v=Math.min(s,p),b=Math.min(u,d),y=Math.max(v-m,0)*Math.max(b-g,0);return y/(h+f-y)}function Ii(t,e,r){var n=new Array(t.rank).fill(0),o=t.shape.slice();return e.map(function(e){o[r]=e;var a=t.slice(n,o);return n[r]+=e,a})}function Ai(t,e){for(var r=new Array(t.rank),n=0;n<r.length;n++)r[n]=t.shape[n]*e[n];var o=na(r,t.dtype);for(n=0;n<o.values.length;++n){for(var a=o.indexToLoc(n),i=new Array(t.rank),s=0;s<i.length;s++)i[s]=a[s]%t.shape[s];var u=t.locToIndex(i);o.values[n]=t.values[u]}return o.toTensor()}function Ni(t,e,r,n,o){for(var a=e[e.length-1],i=[t.length/a,a],s=i[0],u=i[1],l=Ve(r,s*n),c=Ve("int32",s*n),p=0;p<s;p++){for(var d=p*u,h=t.subarray(d,d+u),f=[],m=0;m<h.length;m++)f.push({value:h[m],index:m});f.sort(function(t,e){return e.value-t.value});var g=p*n,v=l.subarray(g,g+n),b=c.subarray(g,g+n);for(m=0;m<n;m++)v[m]=f[m].value,b[m]=f[m].index}var y=e.slice();return y[y.length-1]=n,[ko(l,y,r),ko(c,y,"int32")]}function Ri(t,e){for(var r=[],n=0;n<e.length;n++)e[n]&&r.push(n);var o=na(t,"int32"),a=na([r.length,t.length],"int32");for(n=0;n<r.length;n++){var i=o.indexToLoc(r[n]),s=n*t.length;a.values.set(i,s)}return a.toTensor()}var Ti=function(t,e){this.outputShape=[],this.outputShape=t,this.variableNames=e.map(function(t,e){return"T"+e});var r=[];this.variableNames.forEach(function(t){r.push("float v"+t+" = get"+t+"AtOutCoords();")});var n=this.variableNames.map(function(t){return"v"+t}).join(" + ");this.userCode="\n      void main() {\n        "+r.join("\n        ")+"\n\n        float result = "+n+";\n        setOutput(result);\n      }\n    "},Di=function(t,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=e.map(function(t,e){return"T"+e});var r=[];this.variableNames.forEach(function(t){r.push("vec4 v"+t+" = get"+t+"AtOutCoords();")});var n=this.variableNames.map(function(t){return"v"+t}).join(" + ");this.userCode="\n      void main() {\n        "+r.join("\n        ")+"\n\n        vec4 result = "+n+";\n        setOutput(result);\n      }\n    "},_i=function(t,e,r){this.variableNames=["A"];var n=t.windowSize,o=t.batchSize,a=t.inSize,i=Math.ceil(a/n);r||this.variableNames.push("bestIndicesA"),this.outputShape=[o,i];var s="max"===e?">":"<",u=r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+n+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+n+"; i++) {\n          int inIdx = "+u+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+s+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};function Oi(t,e){return["x","y","z","w","u","v"].slice(0,e).map(function(e){return t+"."+e})}function Fi(t,e){return 1===e?[t]:Oi(t,e)}function Mi(){var t,e,r,n,o,a,i,s,u,l;return 2===ge().getNumber("WEBGL_VERSION")?(t="#version 300 es",e="in",r="out",n="in",o="texture",a="outputColor",i="out vec4 outputColor;",s="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",u="",l="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(t="",e="attribute",r="varying",n="varying",o="texture2D",a="gl_FragColor",i="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",l="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:t,attribute:e,varyingVs:r,varyingFs:n,texture2D:o,output:a,defineOutput:i,defineSpecialNaN:s,defineSpecialInf:u,defineRound:l}}function Li(t,e,r){void 0===r&&(r="index");var n=er(e);return n.map(function(e,o){return"int "+t[o]+" = "+r+" / "+e+"; "+(o===n.length-1?"int "+t[o+1]+" = "+r+" - "+t[o]+" * "+e:"index -= "+t[o]+" * "+e)+";"}).join("")}function Pi(t){var e=er(t).map(function(t){return t.toString()});return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * "+e[0]+" + coords.y * "+e[1]+" + coords.z;\n  }\n"}var Bi="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";function qi(t,e,r,n){var o=[];t.forEach(function(t){var e=Te(t.shapeInfo.logicalShape);t.shapeInfo.isUniform?o.push("uniform float "+t.name+(e>1?"["+e+"]":"")+";"):(o.push("uniform sampler2D "+t.name+";"),o.push("uniform int offset"+t.name+";"))});var a,i,s=o.join("\n"),u=t.map(function(t){return function(t,e,r){void 0===r&&(r=!1);var n="";n+=r?function t(e){var r,n,o;switch(e.shapeInfo.logicalShape.length){case 0:return r=e.name,n="get"+r.charAt(0).toUpperCase()+r.slice(1),o=Mi(),"\n    vec4 "+n+"() {\n      return "+o.texture2D+"("+r+", halfCR);\n    }\n  ";case 1:return function(t){var e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),n=t.shapeInfo.texShape,o=[Math.ceil(n[0]/2),Math.ceil(n[1]/2)],a=Mi();return"\n    vec4 "+r+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+o[0]+", "+o[1]+", index);\n      return "+a.texture2D+"("+e+", uv);\n    }\n  "}(e);case 2:return function(t){var e=t.shapeInfo.logicalShape,r=t.name,n="get"+r.charAt(0).toUpperCase()+r.slice(1),o=t.shapeInfo.texShape,a=o[0],i=o[1],s=Mi();if(null!=o&&De(e,o))return"\n      vec4 "+n+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+i+".0, "+a+".0);\n\n        return "+s.texture2D+"("+r+", uv);\n      }\n    ";var u=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],l=Math.ceil(e[1]/2);return"\n    vec4 "+n+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+l+", "+u[0]+", "+u[1]+", row, col);\n      return "+s.texture2D+"("+r+", uv);\n    }\n  "}(e);case 3:return function(e){var r=e.shapeInfo.logicalShape,n=e.name,o="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape,i=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];if(1===r[0]){var s=r.slice(1),u=Ki(e,s);return"\n        "+t(u)+"\n        vec4 "+o+"(int b, int row, int col) {\n          return "+o+"("+Xi(["b","row","col"],[1,2])+");\n        }\n      "}var l=i[0],c=i[1],p=Math.ceil(r[2]/2),d=p*Math.ceil(r[1]/2),h=Mi();return"\n    vec4 "+o+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+l+", "+c+", "+d+", "+p+", b, row, col);\n      return "+h.texture2D+"("+n+", uv);\n    }\n  "}(e);default:return function(t){for(var e=t.shapeInfo.logicalShape,r=e.length,n=t.name,o="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t.shapeInfo.texShape,i=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],s=i[0],u=i[1],l=Math.ceil(e[r-1]/2),c=l*Math.ceil(e[r-2]/2),p="int b, int row, int col",d="b * "+c+" + (row / 2) * "+l+" + (col / 2)",h=2;h<r-1;h++)p="int b"+h+", "+p,c*=e[r-h-1],d="b"+h+" * "+c+" + "+d;var f=Mi();return"\n    vec4 "+o+"("+p+") {\n      int index = "+d+";\n      int texR = index / "+u+";\n      int texC = index - texR * "+u+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+u+", "+s+");\n      return "+f.texture2D+"("+n+", uv);\n    }\n  "}(e)}}(t):function t(e){var r=e.shapeInfo.logicalShape;switch(r.length){case 0:return function(t){var e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1);if(t.shapeInfo.isUniform)return"float "+r+"() {return "+e+";}";var n=t.shapeInfo.texShape,o=n[0],a=n[1];if(1===o&&1===a)return"\n      float "+r+"() {\n        return sampleTexture("+e+", halfCR);\n      }\n    ";var i=t.shapeInfo.texShape,s=i[0],u=i[1],l=Hi(e);return"\n    float "+r+"() {\n      vec2 uv = uvFromFlat("+s+", "+u+", "+l+");\n      return sampleTexture("+e+", uv);\n    }\n  "}(e);case 1:return function(t){var e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1);if(t.shapeInfo.isUniform)return"\n      float "+r+"(int index) {\n        "+Gi(t)+"\n      }\n    ";var n=t.shapeInfo.texShape,o=n[0],a=n[1];if(1===a&&1===o)return"\n      float "+r+"(int index) {\n        return sampleTexture("+e+", halfCR);\n      }\n    ";var i=Hi(e);return 1===a?"\n      float "+r+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+i+") + 0.5) / "+o+".0);\n        return sampleTexture("+e+", uv);\n      }\n    ":1===o?"\n      float "+r+"(int index) {\n        vec2 uv = vec2((float(index + "+i+") + 0.5) / "+a+".0, 0.5);\n        return sampleTexture("+e+", uv);\n      }\n    ":"\n    float "+r+"(int index) {\n      vec2 uv = uvFromFlat("+o+", "+a+", index + "+i+");\n      return sampleTexture("+e+", uv);\n    }\n  "}(e);case 2:return function(e){var r=e.shapeInfo.logicalShape,n=e.name,o="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape;if(null!=a&&De(r,a)){var i=a[0],s=a[1];return"\n    float "+o+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+s+".0, "+i+".0);\n      return sampleTexture("+n+", uv);\n    }\n  "}var u=qe(r),l=u.newShape,c=u.keptDims,p=l;if(p.length<r.length){var d=Ki(e,p);return"\n      "+t(d)+"\n      float "+o+"(int row, int col) {\n        return "+o+"("+Xi(["row","col"],c)+");\n      }\n    "}if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+r[1]+", 1)));\n        "+Gi(e)+"\n      }\n    ";var h=a[0],f=a[1],m=Hi(n);return 1===f?"\n    float "+o+"(int row, int col) {\n      float index = dot(vec3(row, col, "+m+"), vec3("+r[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+h+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ":1===h?"\n    float "+o+"(int row, int col) {\n      float index = dot(vec3(row, col, "+m+"), vec3("+r[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+f+".0, 0.5);\n      return sampleTexture("+n+", uv);\n    }\n  ":"\n  float "+o+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+r[1]+" + col + "+m+";\n    vec2 uv = uvFromFlat("+h+", "+f+", index);\n    return sampleTexture("+n+", uv);\n  }\n"}(e);case 3:return function(e){var r=e.shapeInfo.logicalShape,n=e.name,o="get"+n.charAt(0).toUpperCase()+n.slice(1),a=r[1]*r[2],i=r[2],s=qe(r),u=s.newShape,l=s.keptDims,c=u;if(c.length<r.length){var p=Ki(e,c);return"\n        "+t(p)+"\n        float "+o+"(int row, int col, int depth) {\n          return "+o+"("+Xi(["row","col","depth"],l)+");\n        }\n      "}if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+a+", "+i+", 1)));\n        "+Gi(e)+"\n      }\n    ";var d=e.shapeInfo.texShape,h=d[0],f=d[1],m=e.shapeInfo.flatOffset;if(f===a&&null==m)return"\n        float "+o+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+i+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+f+".0, "+h+".0);\n          return sampleTexture("+n+", uv);\n        }\n      ";if(f===i&&null==m)return"\n    float "+o+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+r[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+f+".0, "+h+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ";var g=Hi(n);return"\n      float "+o+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+a+" + col * "+i+" + depth + "+g+";\n        vec2 uv = uvFromFlat("+h+", "+f+", index);\n        return sampleTexture("+n+", uv);\n      }\n  "}(e);case 4:return function(e){var r=e.shapeInfo.logicalShape,n=e.name,o="get"+n.charAt(0).toUpperCase()+n.slice(1),a=r[3],i=r[2]*a,s=r[1]*i,u=qe(r),l=u.newShape,c=u.keptDims;if(l.length<r.length){var p=Ki(e,l);return"\n      "+t(p)+"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        return "+o+"("+Xi(["row","col","depth","depth2"],c)+");\n      }\n    "}if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+s+", "+i+", "+a+", 1)));\n        "+Gi(e)+"\n      }\n    ";var d=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,f=h[0],m=h[1];if(m===s&&null==d)return"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+i+", "+a+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+m+".0, "+f+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ";if(m===a&&null==d)return"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+r[1]*r[2]+", "+r[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+m+".0, "+f+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ";var g=Hi(n);return"\n    float "+o+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+s+" + col * "+i+" +\n          depth * "+a+" + depth2;\n      vec2 uv = uvFromFlat("+f+", "+m+", index + "+g+");\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);case 5:return function(e){var r=e.shapeInfo.logicalShape,n=e.name,o="get"+n.charAt(0).toUpperCase()+n.slice(1),a=r[4],i=r[3]*a,s=r[2]*i,u=r[1]*s,l=qe(r),c=l.newShape,p=l.keptDims;if(c.length<r.length){var d=Ki(e,c);return"\n      "+t(d)+"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+o+"("+Xi(["row","col","depth","depth2","depth3"],p)+");\n      }\n    "}if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+u+", "+s+", "+i+", "+a+")) +\n          depth3;\n        "+Gi(e)+"\n      }\n    ";var h=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,m=f[0],g=f[1];if(g===u&&null==h)return"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+s+", "+i+", "+a+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+g+".0, "+m+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ";if(g===a&&null==h)return"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+r[1]*r[2]*r[3]+",\n               "+r[2]*r[3]+", "+r[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+g+".0, "+m+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ";var v=Hi(n);return"\n    float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+u+" + col * "+s+" + depth * "+i+" +\n          depth2 * "+a+" + depth3 + "+v+";\n      vec2 uv = uvFromFlat("+m+", "+g+", index);\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);case 6:return function(e){var r=e.shapeInfo.logicalShape,n=e.name,o="get"+n.charAt(0).toUpperCase()+n.slice(1),a=qe(r),i=a.newShape,s=a.keptDims;if(i.length<r.length){var u=Ki(e,i);return"\n      "+t(u)+"\n      float "+o+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+o+"("+Xi(["row","col","depth","depth2","depth3","depth4"],s)+");\n      }\n    "}var l=r[5],c=r[4]*l,p=r[3]*c,d=r[2]*p,h=r[1]*d;if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+h+", "+d+", "+p+", "+c+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+l+", 1)));\n        "+Gi(e)+"\n      }\n    ";var f=e.shapeInfo.flatOffset,m=e.shapeInfo.texShape,g=m[0],v=m[1];if(v===h&&null==f)return"\n      float "+o+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+d+", "+p+", "+c+", "+l+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+v+".0, "+g+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ";if(v===l&&null==f)return"\n      float "+o+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+r[1]*r[2]*r[3]*r[4]+",\n               "+r[2]*r[3]*r[4]+",\n               "+r[3]*r[4]+",\n               "+r[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+v+".0, "+g+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ";var b=Hi(n);return"\n    float "+o+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+h+" + col * "+d+" + depth * "+p+" +\n          depth2 * "+c+" + depth3 * "+l+" + depth4 + "+b+";\n      vec2 uv = uvFromFlat("+g+", "+v+", index);\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);default:throw new Error(r.length+"-D input sampling is not yet supported")}}(t);var o=t.shapeInfo.logicalShape,a=e.logicalShape;return o.length<=a.length&&(n+=r?function(t,e){var r,n=t.name,o=n.charAt(0).toUpperCase()+n.slice(1),a="get"+o+"AtOutCoords",i=t.shapeInfo.logicalShape.length,s=e.logicalShape.length,u=ri(t.shapeInfo.logicalShape,e.logicalShape),l=$i(s),c=s-i,p=["x","y","z","w","u","v"];r=0===i?"":s<2&&u.length>=1?"coords = 0;":u.map(function(t){return"coords."+p[t+c]+" = 0;"}).join("\n");var d;d=s<2&&i>0?"coords":t.shapeInfo.logicalShape.map(function(t,e){return"coords."+p[e+c]}).join(", ");var h="return outputValue;",f=1===Te(t.shapeInfo.logicalShape),m=1===Te(e.logicalShape);if(1!==i||f||m){if(f&&!m)h=1===s?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(u.length){var g=i-2,v=i-1;u.indexOf(g)>-1&&u.indexOf(v)>-1?h="return vec4(outputValue.x);":u.indexOf(g)>-1?h="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":u.indexOf(v)>-1&&(h="return vec4(outputValue.xx, outputValue.zz);")}}else h="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 "+a+"() {\n      "+l+" coords = getOutputCoords();\n      "+r+"\n      vec4 outputValue = get"+o+"("+d+");\n      "+h+"\n    }\n  "}(t,e):function(t,e){var r=t.name,n=r.charAt(0).toUpperCase()+r.slice(1),o="get"+n+"AtOutCoords",a=e.texShape,i=t.shapeInfo.texShape,s=t.shapeInfo.logicalShape.length,u=e.logicalShape.length;if(!t.shapeInfo.isUniform&&s===u&&null==t.shapeInfo.flatOffset&&De(i,a))return"\n      float "+o+"() {\n        return sampleTexture("+r+", resultUV);\n      }\n    ";var l=$i(u),c=ri(t.shapeInfo.logicalShape,e.logicalShape),p=u-s,d=["x","y","z","w","u","v"];return"\n    float "+o+"() {\n      "+l+" coords = getOutputCoords();\n      "+(0===s?"":u<2&&c.length>=1?"coords = 0;":c.map(function(t){return"coords."+d[t+p]+" = 0;"}).join("\n"))+"\n      return get"+n+"("+(u<2&&s>0?"coords":t.shapeInfo.logicalShape.map(function(t,e){return"coords."+d[e+p]}).join(", "))+");\n    }\n  "}(t,e)),n}(t,e,n)}).join("\n"),l=e.texShape,c=Mi(),p="\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+c.texture2D+"(textureSampler, uv).r;\n    }\n  ",d=function(t){return t.version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+t.varyingFs+" vec2 resultUV;\n    "+t.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    "+t.defineSpecialNaN+"\n    "+t.defineSpecialInf+"\n    "+t.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    "+Vi+"\n    "+Wi+"\n    "+Ui+"\n  "}(c);return e.isPacked?(a=function(t,e){switch(t.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(t,e){var r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return 1===r[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+r[1]+".0);\n      }\n    ":1===r[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+r[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+r[0]+", "+r[1]+"));\n      return 2 * (resTexRC.x * "+r[1]+" + resTexRC.y);\n    }\n  "}(0,e);case 2:return function(t,e){var r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(De(t,e))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+r[0]+", "+r[1]+"));\n      }\n    ";var n=Math.ceil(t[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+r[0]+", "+r[1]+"));\n\n      int index = resTexRC.x * "+r[1]+" + resTexRC.y;\n      int r = 2 * (index / "+n+");\n      int c = imod(index, "+n+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}(t,e);case 3:return r=t,n=e,o=[Math.ceil(n[0]/2),Math.ceil(n[1]/2)],i=(a=Math.ceil(r[2]/2))*Math.ceil(r[1]/2),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+o[0]+", "+o[1]+"));\n      int index = resTexRC.x * "+o[1]+" + resTexRC.y;\n\n      int b = index / "+i+";\n      index -= b * "+i+";\n\n      int r = 2 * (index / "+a+");\n      int c = imod(index, "+a+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";default:return function(t,e){for(var r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],n=Math.ceil(t[t.length-1]/2),o=n*Math.ceil(t[t.length-2]/2),a=o,i="",s="b, r, c",u=2;u<t.length-1;u++)i="\n      int b"+u+" = index / "+(a*=t[t.length-u-1])+";\n      index -= b"+u+" * "+a+";\n    "+i,s="b"+u+", "+s;return"\n    ivec"+t.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+r[0]+", "+r[1]+"));\n      int index = resTexRC.x * "+r[1]+" + resTexRC.y;\n\n      "+i+"\n\n      int b = index / "+o+";\n      index -= b * "+o+";\n\n      int r = 2 * (index / "+n+");\n      int c = imod(index, "+n+") * 2;\n\n      return ivec"+t.length+"("+s+");\n    }\n  "}(t,e)}var r,n,o,a,i}(e.logicalShape,l),i="\n    void setOutput(vec4 val) {\n      "+c.output+" = val;\n    }\n  "):(a=function(t,e){switch(t.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(t,e){return 1===e[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+e[1]+".0);\n      }\n    ":1===e[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+e[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+e[0]+", "+e[1]+"));\n      return resTexRC.x * "+e[1]+" + resTexRC.y;\n    }\n  "}(0,e);case 2:return function(t,e){return De(t,e)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+e[0]+", "+e[1]+"));\n      }\n    ":1===t[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+e[0]+", "+e[1]+"));\n        int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===t[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+e[0]+", "+e[1]+"));\n        int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n      int r = index / "+t[1]+";\n      int c = index - r * "+t[1]+";\n      return ivec2(r, c);\n    }\n  "}(t,e);case 3:return r=e,n=Li(["r","c","d"],t),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+r[0]+", "+r[1]+"));\n      int index = resTexRC.x * "+r[1]+" + resTexRC.y;\n      "+n+"\n      return ivec3(r, c, d);\n    }\n  ";case 4:return function(t,e){var r=Li(["r","c","d","d2"],t);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n      "+r+"\n      return ivec4(r, c, d, d2);\n    }\n  "}(t,e);case 5:return function(t,e){var r=Li(["r","c","d","d2","d3"],t);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+e[0]+",\n                             "+e[1]+"));\n\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n\n      "+r+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(t,e);case 6:return function(t,e){var r=Li(["r","c","d","d2","d3","d4"],t);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n\n      "+r+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(t,e);default:throw new Error(t.length+"-D output sampling is not yet supported")}var r,n}(e.logicalShape,l),i="\n    void setOutput(float val) {\n      "+c.output+" = vec4(val, 0, 0, 0);\n    }\n  "),n&&(d+=ji),[d,p,i,s,a,u,r].join("\n")}var Vi="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Wi="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Ui="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",ji="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function Hi(t){return"offset"+t}function Gi(t){var e=t.name,r=Te(t.shapeInfo.logicalShape);return r<2?"return "+e+";":"\n    for (int i = 0; i < "+r+"; i++) {\n      if (i == index) {\n        return "+e+"[i];\n      }\n    }\n  "}function $i(t){if(t<=1)return"int";if(2===t)return"ivec2";if(3===t)return"ivec3";if(4===t)return"ivec4";if(5===t)return"ivec5";if(6===t)return"ivec6";throw Error("GPU for rank "+t+" is not yet supported")}function Ki(t,e){var r=JSON.parse(JSON.stringify(t));return r.shapeInfo.logicalShape=e,r}function Xi(t,e){return e.map(function(e){return t[e]}).join(", ")}var Yi=function(t,e,r,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,Ie(t.length>2,function(){return"Packed arg"+(r.charAt(0).toUpperCase()+r.slice(1))+" supports only inputs with rank above 2."});var o=t[t.length-1],a=Math.ceil(o/e);this.outputShape=t.slice(0,-1),a>1&&this.outputShape.push(a),n||this.variableNames.push("bestIndicesA");var i,s,u=this.outputShape,l=u.length,c=$i(l),p=Fi("coords",l);if(1===a){var d=$i(s=l+1);i="\n        "+d+" sourceLocR = "+d+"("+p.join()+", 0);\n        ++"+p[l-1]+";\n        "+d+" sourceLocG = "+d+"("+p.join()+", 0);\n        ++"+p[l-2]+";\n        "+d+" sourceLocA = "+d+"("+p.join()+", 0);\n        --"+p[l-1]+";\n        "+d+" sourceLocB = "+d+"("+p.join()+", 0);\n        --"+p[l-2]+";"}else s=l,i="\n        "+c+" sourceLocR = coords;\n        ++"+p[l-1]+";\n        "+c+" sourceLocG = coords;\n        ++"+p[l-2]+";\n        "+c+" sourceLocA = coords;\n        --"+p[l-1]+";\n        "+c+" sourceLocB = coords;\n        --"+p[l-2]+";";var h=["x","y","z","w","u","v"].slice(0,s),f="."+h[s-1],m=h.map(function(t){return"int "+t}),g=Fi("sourceLocR",s-1).concat("inIdx.r"),v=Fi("sourceLocG",s-1).concat("inIdx.g"),b=Fi("sourceLocB",s-1).concat("inIdx.b"),y=Fi("sourceLocA",s-1).concat("inIdx.a"),x="max"===r?"greaterThan":"lessThan",w=n?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+g.join()+"),\n                             getBestIndicesAChannel("+v.join()+"),\n                             getBestIndicesAChannel("+b.join()+"),\n                             getBestIndicesAChannel("+y.join()+")));",k="vec4(\n            getAChannel("+g.join()+"),\n            hasNextCol ? getAChannel("+v.join()+") : 0.,\n            hasNextRow ? getAChannel("+b.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+y.join()+") : 0.)",C=n?"":"\n      float getBestIndicesAChannel("+m.join()+") {\n        return getChannel(getBestIndicesA("+h.join()+"),\n                                          vec2("+h.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+m.join()+") {\n        return getChannel(getA("+h.join()+"),\n                               vec2("+h.slice(-2).join()+"));\n      }\n      "+C+"\n      void main() {\n        "+c+" coords = getOutputCoords();\n        bool hasNextCol = "+p[l-1]+" < "+(u[l-1]-1)+";\n        bool hasNextRow = "+p[l-2]+" < "+(u[l-2]-1)+";\n        "+i+"\n        ivec4 srcIdx = ivec4(sourceLocR"+f+", sourceLocG"+f+",\n          sourceLocB"+f+", sourceLocA"+f+") * "+e+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+k+";\n\n        for (int i = 0; i < "+e+"; i++) {\n          inIdx = srcIdx;\n          "+w+"\n          vec4 candidate = "+k+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+x+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "},Ji=function(t){this.variableNames=["dy"],this.outputShape=t.inShape;var e=t.filterHeight,r=t.filterWidth,n=t.strideHeight,o=t.strideWidth,a=t.dilationHeight,i=t.dilationWidth,s=t.effectiveFilterHeight,u=t.effectiveFilterWidth,l=s-1-t.padInfo.top,c=u-1-t.padInfo.left,p=1/(e*r);this.userCode="\n      const ivec2 pads = ivec2("+l+", "+c+");\n      const float avgMultiplier = float("+p+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+s+";\n            wR += "+a+") {\n          float dyR = float(dyRCorner + wR) / "+n+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+u+";\n            wC+= "+i+") {\n            float dyC = float(dyCCorner + wC) / "+o+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Zi=function(t){this.variableNames=["dy"],this.outputShape=t.inShape;var e=t.filterDepth,r=t.filterHeight,n=t.filterWidth,o=t.strideDepth,a=t.strideHeight,i=t.strideWidth,s=t.dilationDepth,u=t.dilationHeight,l=t.dilationWidth,c=t.effectiveFilterDepth,p=t.effectiveFilterHeight,d=t.effectiveFilterWidth,h=c-1-t.padInfo.front,f=p-1-t.padInfo.top,m=d-1-t.padInfo.left,g=1/(e*r*n);this.userCode="\n      const ivec3 pads = ivec3("+h+", "+f+", "+m+");\n      const float avgMultiplier = float("+g+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+c+";\n            wD += "+s+") {\n          float dyD = float(dyDCorner + wD) / "+o+".0;\n\n          if (dyD < 0.0 || dyD >= "+t.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+p+";\n              wR += "+u+") {\n            float dyR = float(dyRCorner + wR) / "+a+".0;\n\n            if (dyR < 0.0 || dyR >= "+t.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+d+";\n                wC += "+l+") {\n              float dyC = float(dyCCorner + wC) / "+i+".0;\n\n              if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Qi=function(t,e,r,n,o,a){this.outputShape=[],this.variableNames=["x","mean","variance"],oi(t,e),oi(t,r);var i="0.0";null!=n&&(oi(t,n),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");var s="1.0";null!=o&&(oi(t,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+i+";\n        float scale = "+s+";\n        float inv = scale * inversesqrt(variance + float("+a+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "},ts=function(t,e,r,n,o,a){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],oi(t,e),oi(t,r);var i="vec4(0.0)";null!=n&&(oi(t,n),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");var s="vec4(1.0)";null!=o&&(oi(t,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        vec4 offset = "+i+";\n        vec4 scale = "+s+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+a+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "},es=function(t,e,r){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=oi(e,r),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+t+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},rs="return a + b;",ns="return a - b;",os="return a * b;",as="return (a < 0.) ? b * a : a;",is=function(t,e,r){this.variableNames=["A","B"],this.outputShape=oi(e,r),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+t+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},ss="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",us=function(t,e,r,n){void 0===n&&(n=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=oi(e,r);var o=this.outputShape.length,a="";if(n)if(0===o||1===Te(this.outputShape))a="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(a="\n          "+$i(o)+" coords = getOutputCoords();\n        ",1===o)a+="\n            result.y = (coords + 1) >= "+this.outputShape[0]+" ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ";else{var i=Fi("coords",o);a+="\n            bool nextRowOutOfBounds =\n              ("+i[o-2]+" + 1) >= "+this.outputShape[o-2]+";\n            bool nextColOutOfBounds =\n              ("+i[o-1]+" + 1) >= "+this.outputShape[o-1]+";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+t+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        "+a+"\n\n        setOutput(result);\n      }\n    "},ls=function(){function t(t){this.variableNames=["A"],this.outputShape=t,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t,e){var r=this;return function(n,o){null==r.minLoc&&(r.minLoc=n.getUniformLocationNoThrow(o,"minVal"),r.maxLoc=n.getUniformLocationNoThrow(o,"maxVal")),n.gl.uniform1f(r.minLoc,t),n.gl.uniform1f(r.maxLoc,e)}},t}(),cs=function(){function t(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t,e){var r=this;return function(n,o){null==r.minLoc&&(r.minLoc=n.getUniformLocationNoThrow(o,"minVal"),r.maxLoc=n.getUniformLocationNoThrow(o,"maxVal")),n.gl.uniform1f(r.minLoc,t),n.gl.uniform1f(r.maxLoc,e)}},t}(),ps=function(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},ds=function(t){this.outputShape=[],this.outputShape=vo(t,1),this.variableNames=t.map(function(t,e){return"T"+e});var e=new Array(t.length-1);e[0]=t[0][1];for(var r=1;r<e.length;r++)e[r]=e[r-1]+t[r][1];var n=["if (yC < "+e[0]+") setOutput(getT0(yR, yC));"];for(r=1;r<e.length;r++){var o=e[r-1];n.push("else if (yC < "+e[r]+") setOutput(getT"+r+"(yR, yC-"+o+"));")}var a=e.length,i=e[e.length-1];n.push("else setOutput(getT"+a+"(yR, yC-"+i+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+n.join("\n        ")+"\n      }\n    "},hs=function(t,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=vo(t,e);var r=this.outputShape,n=r.length,o=$i(n),a=Fi("coords",n),i=["x","y","z","w","u","v"].slice(0,n);this.variableNames=t.map(function(t,e){return"T"+e});var s=new Array(t.length-1);s[0]=t[0][e];for(var u=1;u<s.length;u++)s[u]=s[u-1]+t[u][e];var l=i[e],c=i.slice(-2),p=i.join(),d="if ("+l+" < "+s[0]+") {\n        return getChannel(\n            getT0("+p+"), vec2("+c.join()+"));\n        }";for(u=1;u<s.length;u++){var h=s[u-1];d+="\n        if ("+l+" < "+s[u]+"  && "+l+" >= "+s[u-1]+") {\n          return getChannel(\n            getT"+u+"("+fs(i,l,h)+"),\n            vec2("+fs(c,l,h)+"));\n        }"}var f=s.length,m=s[s.length-1];d+="\n        return getChannel(\n          getT"+f+"("+fs(i,l,m)+"),\n          vec2("+fs(c,l,m)+"));",this.userCode="\n      float getValue("+i.map(function(t){return"int "+t})+") {\n        "+d+"\n      }\n\n      void main() {\n        "+o+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+a+"), 0., 0., 0.);\n\n        "+a[n-1]+" = "+a[n-1]+" + 1;\n        if ("+a[n-1]+" < "+r[n-1]+") {\n          result.g = getValue("+a+");\n        }\n\n        "+a[n-2]+" = "+a[n-2]+" + 1;\n        if ("+a[n-2]+" < "+r[n-2]+") {\n          result.a = getValue("+a+");\n        }\n\n        "+a[n-1]+" = "+a[n-1]+" - 1;\n        if ("+a[n-2]+" < "+r[n-2]+" &&\n            "+a[n-1]+" < "+r[n-1]+") {\n          result.b = getValue("+a+");\n        }\n        setOutput(result);\n      }\n    "};function fs(t,e,r){var n=t.indexOf(e);return t.map(function(t,e){return e===n?t+" - "+r:t}).join()}var ms=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;var e=t.strideHeight,r=t.strideWidth,n=t.padInfo.top,o=t.padInfo.left,a="channelsLast"===t.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n            int xR = wR + yR * "+e+" - "+n+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n              int xC = wC + yC * "+r+" - "+o+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              if ("+a+") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},gs=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterHeight,r=t.filterWidth,n=t.strideHeight,o=t.strideWidth,a="channelsLast"===t.dataFormat,i=e-1-t.padInfo.top,s=r-1-t.padInfo.left,u=a?1:2,l=a?2:3,c=a?3:1;this.userCode="\n      const ivec2 pads = ivec2("+i+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords["+c+"];\n\n        ivec2 dyCorner = ivec2(coords["+u+"], coords["+l+"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+e+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+n+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+e+" - 1 - wR;\n\n          for (int wC = 0; wC < "+r+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+o+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+r+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+t.outChannels+"; d2++) {\n\n              if ("+a+") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},vs=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;var e=t.strideDepth,r=t.strideHeight,n=t.strideWidth,o=t.padInfo.front,a=t.padInfo.top,i=t.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yF = 0; yF < "+t.outDepth+"; yF++) {\n            int xF = wF + yF * "+e+" - "+o+";\n\n            if (xF < 0 || xF >= "+t.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n              int xR = wR + yR * "+r+" - "+a+";\n\n              if (xR < 0 || xR >= "+t.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n                int xC = wC + yC * "+n+" - "+i+";\n\n                if (xC < 0 || xC >= "+t.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},bs=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterDepth,r=t.filterHeight,n=t.filterWidth,o=t.strideDepth,a=t.strideHeight,i=t.strideWidth,s=e-1-t.padInfo.front,u=r-1-t.padInfo.top,l=n-1-t.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3("+s+", "+u+", "+l+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+e+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+o+".0;\n\n          if (dyF < 0.0 || dyF >= "+t.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+e+" - 1 - wF;\n\n          for (int wR = 0; wR < "+r+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+a+".0;\n\n            if (dyR < 0.0 || dyR >= "+t.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+r+" - 1 - wR;\n\n            for (int wC = 0; wC < "+n+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+i+".0;\n\n              if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+n+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+t.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ys=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;var e=t.strideHeight,r=t.strideWidth,n=t.padInfo.top,o=t.padInfo.left,a=t.outChannels/t.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+a+" + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n            int xR = wR + yR * "+e+" - "+n+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n              int xC = wC + yC * "+r+" - "+o+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},xs=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterHeight,r=t.filterWidth,n=t.strideHeight,o=t.strideWidth,a=e-1-t.padInfo.top,i=r-1-t.padInfo.left,s=t.outChannels/t.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+a+", "+i+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+e+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+n+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+e+" - 1 - wR;\n\n          for (int wC = 0; wC < "+r+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+o+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+r+" - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+s+"; dm++) {\n              int d2 = d1 * "+s+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ws=function(t,e,r,n){void 0===e&&(e=!1),void 0===r&&(r=null),void 0===n&&(n=!1),this.variableNames=["x","W"],this.outputShape=t.outShape;var o=t.padInfo.top,a=t.padInfo.left,i=t.strideHeight,s=t.strideWidth,u=t.dilationHeight,l=t.dilationWidth,c=t.filterHeight,p=t.filterWidth,d=4*Math.floor(t.inChannels/4),h=t.inChannels%4,f="channelsLast"===t.dataFormat,m=f?1:2,g=f?2:3,v=f?3:1,b="",y="";r&&(b=n?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+r+"\n        }":"\n          float activation(float x) {\n            "+r+"\n          }\n        ",y="result = activation(result);");var x=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),n&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+b+"\n\n      const ivec2 strides = ivec2("+i+", "+s+");\n      const ivec2 pads = ivec2("+o+", "+a+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords["+v+"];\n\n        ivec2 xRCCorner =\n            ivec2(coords["+m+"], coords["+g+"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+c+"; wR++) {\n          int xR = xRCorner + wR * "+u+";\n\n          if (xR < 0 || xR >= "+t.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+p+"; wC++) {\n            int xC = xCCorner + wC * "+l+";\n\n            if (xC < 0 || xC >= "+t.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+d+"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if ("+f+") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if ("+(1===h)+") {\n\n              if ("+f+") {\n                dotProd +=\n                    getX(batch, xR, xC, "+d+") *\n                    getW(wR, wC, "+d+", d2);\n              } else {\n                dotProd +=\n                    getX(batch, "+d+", xR, xC) *\n                    getW(wR, wC, "+d+", d2);\n              }\n\n            } else if ("+(2===h)+") {\n              vec2 wValues = vec2(\n                getW(wR, wC, "+d+", d2),\n                getW(wR, wC, "+d+" + 1, d2)\n              );\n\n              if ("+f+") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, "+d+"),\n                  getX(batch, xR, xC, "+d+" + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, "+d+", xR, xC),\n                  getX(batch, "+d+" + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if ("+(3===h)+") {\n              vec3 wValues = vec3(\n                getW(wR, wC, "+d+", d2),\n                getW(wR, wC, "+d+" + 1, d2),\n                getW(wR, wC, "+d+" + 2, d2)\n              );\n\n              if ("+f+") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, "+d+"),\n                  getX(batch, xR, xC, "+d+" + 1),\n                  getX(batch, xR, xC, "+d+" + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, "+d+", xR, xC),\n                  getX(batch, "+d+" + 1, xR, xC),\n                  getX(batch, "+d+" + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        "+x+"\n        "+y+"\n        setOutput(result);\n      }\n    "},ks=function(t){this.variableNames=["x","W"],this.outputShape=t.outShape;var e=t.padInfo.front,r=t.padInfo.top,n=t.padInfo.left,o=t.strideDepth,a=t.strideHeight,i=t.strideWidth,s=t.dilationDepth,u=t.dilationHeight,l=t.dilationWidth,c=t.filterDepth,p=t.filterHeight,d=t.filterWidth,h=4*Math.floor(t.inChannels/4),f=t.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+o+", "+a+", "+i+");\n      const ivec3 pads = ivec3("+e+", "+r+", "+n+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+c+"; wF++) {\n          int xF = xFCorner + wF * "+s+";\n\n          if (xF < 0 || xF >= "+t.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+p+"; wR++) {\n            int xR = xRCorner + wR * "+u+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+d+"; wC++) {\n              int xC = xCCorner + wC * "+l+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+h+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===f)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+h+") *\n                  getW(wF, wR, wC, "+h+", d2);\n              } else if ("+(2===f)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+h+"),\n                  getX(batch, xF, xR, xC, "+h+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+h+", d2),\n                  getW(wF, wR, wC, "+h+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===f)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+h+"),\n                  getX(batch, xF, xR, xC, "+h+" + 1),\n                  getX(batch, xF, xR, xC, "+h+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+h+", d2),\n                  getW(wF, wR, wC, "+h+" + 1, d2),\n                  getW(wF, wR, wC, "+h+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Cs=function(t,e,r,n){void 0===e&&(e=!1),void 0===r&&(r=null),void 0===n&&(n=!1),this.variableNames=["x","W"],this.outputShape=t.outShape;var o=t.inHeight,a=t.inWidth,i=t.padInfo.top,s=t.padInfo.left,u=t.strideHeight,l=t.strideWidth,c=t.dilationHeight,p=t.dilationWidth,d=t.filterHeight,h=t.filterWidth,f=t.outChannels/t.inChannels,m="",g="";r&&(m=n?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+r+"\n        }":"\n          float activation(float x) {\n            "+r+"\n          }\n        ",g="result = activation(result);");var v=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),n&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+m+"\n\n      const ivec2 strides = ivec2("+u+", "+l+");\n      const ivec2 pads = ivec2("+i+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+f+";\n        int q = d2 - d1 * "+f+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+d+"; wR++) {\n          int xR = xRCorner + wR * "+c+";\n\n          if (xR < 0 || xR >= "+o+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+h+"; wC++) {\n            int xC = xCCorner + wC * "+p+";\n\n            if (xC < 0 || xC >= "+a+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        "+v+"\n        "+g+"\n        setOutput(result);\n      }\n    "},Ss=function(t,e,r,n){void 0===e&&(e=!1),void 0===r&&(r=null),void 0===n&&(n=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.outShape;for(var o=t.inHeight,a=t.inWidth,i=t.padInfo.top,s=t.padInfo.left,u=t.strideHeight,l=t.strideWidth,c=t.dilationHeight,p=t.dilationWidth,d=t.filterHeight,h=t.filterWidth,f=h,m="int xR; int xC; int xCOffset;",g=0;g<d;g++)for(var v=0;v<h;v++)m+="\n          vec4 xTexelR"+g+"C"+2*v+" = vec4(0.);\n          vec4 wR"+g+"C"+v+" = vec4(0.);\n          vec4 xR"+g+"C"+v+" = vec4(0.);";for(g=0;g<d;g++)for(var b=0;b<f;b++){if(m+="\n          xR = xRCorner + "+g*c+";\n          xC = xCCorner + "+(v=2*b)*p+";\n        ",1===l){if(v<h&&(m+=s%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+o+" && xCOffset >= 0 && xCOffset < "+a+") {\n                  xTexelR"+g+"C"+v+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+g+"C"+v+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+o+" && xCOffset >= 0 && xCOffset < "+a+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n                  xR"+g+"C"+v+" = vec4(previous.zw, xTexelR"+g+"C"+v+".xy);\n                } else {\n                  xR"+g+"C"+v+" = vec4(0, 0, xTexelR"+g+"C"+v+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+o+" && xC >= 0 && xC < "+a+") {\n                  xTexelR"+g+"C"+v+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+g+"C"+v+" = vec4(0.);\n                }\n\n                xR"+g+"C"+v+" = xTexelR"+g+"C"+v+";\n              ",v+1<h)){var y=s%2==0?Ee(p):p;p%2==0&&s%2==1||p%2!=0&&s%2!=1?(m+="\n                  xCOffset = xC + "+s%2+" + "+y+";\n\n                  if(xR >= 0 && xR < "+o+" &&\n                    xCOffset >= 0 && xCOffset < "+a+") {\n                    xTexelR"+g+"C"+(v+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",p>1&&(m+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+o+" &&\n                      xCOffset >= 0 && xCOffset < "+a+") {\n                      xTexelR"+g+"C"+v+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+g+"C"+v+" = vec4(0.);\n                    }\n                  "),m+="\n                  xR"+g+"C"+(v+1)+" = vec4(\n                    xTexelR"+g+"C"+v+".zw, xTexelR"+g+"C"+(v+2)+".xy);\n                "):m+="\n                  xCOffset = xC + "+y+";\n\n                  if(xR >= 0 && xR < "+o+" &&\n                    xCOffset >= 0 && xCOffset < "+a+") {\n                    xTexelR"+g+"C"+(v+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+g+"C"+(v+1)+" = xTexelR"+g+"C"+(v+2)+";\n                "}}else v<h&&(m+="\n              if(xR >= 0 && xR < "+o+") {\n            ",s%2==1?(m+="\n                xCOffset = xC + 1 - "+l+";\n                if(xCOffset >= 0 && xCOffset < "+a+") {\n                  xTexelR"+g+"C"+v+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+g+"C"+v+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+a+") {\n                  xTexelR"+g+"C"+(v+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+g+"C"+(v+2)+" = vec4(0.);\n                }\n\n                xR"+g+"C"+v+" = vec4(\n                  xTexelR"+g+"C"+v+".zw, xTexelR"+g+"C"+(v+2)+".zw);\n              ",v+1<h&&(m+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+l+";\n                  if(xCOffset >= 0 && xCOffset < "+a+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+g+"C"+(v+1)+" = vec4(xTexelR"+g+"C"+(v+2)+".xy, final.xy);\n                ")):(m+="\n                if(xC >= 0 && xC < "+a+") {\n                  xTexelR"+g+"C"+v+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+g+"C"+v+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+l+";\n                if(xCOffset >= 0 && xCOffset < "+a+") {\n                  xTexelR"+g+"C"+(v+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+g+"C"+(v+2)+" = vec4(0.);\n                }\n\n                xR"+g+"C"+v+" = vec4(\n                  xTexelR"+g+"C"+v+".xy, xTexelR"+g+"C"+(v+2)+".xy);\n              ",v+1<h&&(m+="\n                  xR"+g+"C"+(v+1)+" = vec4(\n                    xTexelR"+g+"C"+v+".zw, xTexelR"+g+"C"+(v+2)+".zw);\n                ")),m+="}");v<h&&(m+="\n            vec4 wTexelR"+g+"C"+v+" = getW("+g+", "+v+", d1, q);\n            wR"+g+"C"+v+" = vec4(wTexelR"+g+"C"+v+".xz, wTexelR"+g+"C"+v+".xz);\n          ",v+1<h&&(m+="\n              vec4 wTexelR"+g+"C"+(v+1)+" = getW("+g+", "+(v+1)+", d1, q);\n              wR"+g+"C"+(v+1)+" =\n                vec4(wTexelR"+g+"C"+(v+1)+".xz, wTexelR"+g+"C"+(v+1)+".xz);"))}for(g=0;g<d;g++)for(v=0;v<h;v++)m+="dotProd += xR"+g+"C"+v+" * wR"+g+"C"+v+";";var x="",w="";r&&(x=n?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+r+"\n        }":"vec4 activation(vec4 x) {\n          "+r+"\n        }",w="result = activation(result);");var k=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),n&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+x+"\n\n      const ivec2 strides = ivec2("+u+", "+l+");\n      const ivec2 pads = ivec2("+i+", "+s+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        "+m+"\n\n        vec4 result = dotProd;\n        "+k+"\n        "+w+"\n        setOutput(result);\n      }\n    "},Es=function(t,e,r,n,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var a=t[0],i=t[1],s=t[2],u=t[3],l=e[0],c=r[0],p=r[1];this.outputShape=[l,c,p,u];var d="bilinear"===n?1:0,h=[i-1+".0",s-1+".0"],f=h[0],m=h[1],g=c>1?[""+(i-1)/(c-1),"(y2-y1) * height_ratio","y1*"+f+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+f],v=g[0],b=g[1],y=g[2],x=p>1?[""+(s-1)/(p-1),"(x2-x1) * width_ratio","x1*"+m+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+m],w=x[0],k=x[1],C=x[2];this.userCode="\n      const float height_ratio = float("+v+");\n      const float width_ratio = float("+w+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+a+") {\n          return;\n        }\n\n        float height_scale = "+b+";\n        float width_scale = "+k+";\n\n        float in_y = "+y+";\n        if( in_y < 0.0 || in_y > "+f+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n        float in_x = "+C+";\n        if( in_x < 0.0 || in_x > "+m+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+d+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "},zs=function(t,e,r){this.variableNames=["x"],this.outputShape=t;var n=t.length,o=t[t.length-1],a=r?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(r?"return "+o+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+$i(n)+" coords = getOutputCoords();\n        int end = "+Is(n,"coords")+";\n        float val = 0.0;\n        for (int i = "+o+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+a+" end) {\n            continue;\n          }\n          if (idx == end && "+e+") {\n            continue;\n          }\n          "+Is(n,"coords")+" = idx;\n          val += getX("+function(t,e){if(1===n)return""+e;if(2===n)return e+".x, "+e+".y";if(3===n)return e+".x, "+e+".y, "+e+".z";if(4===n)return e+".x, "+e+".y, "+e+".z, "+e+".w";throw Error("Cumulative sum for rank "+n+" is not yet supported")}(0,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function Is(t,e){if(1===t)return""+e;if(2===t)return e+".y";if(3===t)return e+".z";if(4===t)return e+".w";throw Error("Cumulative sum for rank "+t+" is not yet supported")}var As=function(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=jr.DENSE;var e=Qr(t),r=Mi();this.outputShape=t,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+Li(["r","c","d"],t)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+e[0]+", "+e[1]+"));\n        int index = 4 * (resTexRC.x * "+e[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        "+r.output+" = result;\n      }\n    "},Ns=function(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=jr.DENSE;var e=Qr(t),r=Mi();this.outputShape=t,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+Li(["r","c","d"],t)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+e[0]+", "+e[1]+"));\n        int index = 4 * (resTexRC.x * "+e[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        "+r.output+" = result;\n      }\n    "},Rs=function(){function t(t,e,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=e,this.dataFormat=r,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+e+";\n      int offset_h = imod(h, "+e+");\n      int in_w = w / "+e+";\n      int offset_w = imod(w, "+e+");\n      int offset_d = (offset_h * "+e+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return t.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},t.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},t.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},t.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},t.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},t}(),Ts=function(t){this.variableNames=["X"],this.outputShape=[t,t],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "},Ds=function(t){this.variableNames=["A"],this.outTexUsage=Hr.DOWNLOAD;var e=Mi();this.outputShape=t,this.userCode="\n      "+Bi+"\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+e.output+" = encode_float(x);\n      }\n    "},_s=function(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Hr.DOWNLOAD;var e=Mi();this.outputShape=t,this.userCode="\n      "+Bi+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        "+e.output+" = encode_float(x);\n      }\n    "},Os=function(t,e,r){void 0===r&&(r=!1),this.variableNames=["A"];var n=Mi(),o=e[0],a=e[1];this.outputShape=t;var i="result";r&&(i="floor(result * 255. + 0.5)"),this.userCode="\n      "+Pi(t)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n        \n        int r = flatIndex / "+a+";\n        int c = imod(flatIndex, "+a+");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2("+a+".0, "+o+".0);\n        vec4 values = "+n.texture2D+"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        "+n.output+" = vec4("+i+", 0., 0., 0.);\n      }\n    "},Fs=function(t,e,r){void 0===r&&(r=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var n=Mi(),o=e[0],a=e[1];this.outputShape=t;var i="",s="result";r&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var l=0;l<=1;l++){var c=2*u+l;i+="\n          localCoords = coords;\n          if(localCoords[2] + "+l+" < "+t[2]+") {\n            localCoords[2] += "+l+";\n            if(localCoords[1] + "+u+" < "+t[1]+") {\n              localCoords[1] += "+u+";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / "+a+";\n              c = imod(flatIndex, "+a+");\n              uv = (vec2(c, r) + halfCR) / vec2("+a+".0, "+o+".0);\n              values = "+n.texture2D+"(A, uv);\n\n              if(offset == 0) {\n                result["+c+"] = values[0];\n              } else if(offset == 1) {\n                result["+c+"] = values[1];\n              } else if(offset == 2) {\n                result["+c+"] = values[2];\n              } else {\n                result["+c+"] = values[3];\n              }\n            }\n          }\n        "}this.userCode="\n      "+Pi(t)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        "+i+"\n\n        "+n.output+" = "+s+";\n      }\n    "},Ms=function(t,e,r){this.variableNames=["real","imag"];var n=e[1];this.outputShape=e;var o=r?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,a=r?n+".0":"1.0";this.userCode="\n      const float exponentMultiplier = "+o+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+t+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+n+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+n+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+a+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},Ls=function(){function t(t,e){this.outputShape=[],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;return function(r,n){null==e.valueLoc&&(e.valueLoc=r.getUniformLocationNoThrow(n,"value")),r.gl.uniform1f(e.valueLoc,t)}},t}(),Ps=function(t){this.variableNames=["A"];var e=Mi(),r=t[0],n=t[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+n+".0, "+r+".0);\n\n        vec4 values = "+e.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "},Bs=function(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var e=Mi(),r=t[0],n=t[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2("+n+".0, "+r+".0);\n            vec4 values = "+e.texture2D+"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        "+e.output+" = result;\n      }\n    "},qs=function(t,e,r){this.variableNames=["A","indices"];var n=t.slice();n[r]=e,this.outputShape=n,this.rank=n.length;var o=$i(this.rank),a=function(t,e){var r=t.length;if(r>4)throw Error("Gather for rank "+r+" is not yet supported");if(1===r)return"int(getIndices(resRC))";for(var n=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],a=0;a<t.length;a++)a===e?o.push("int(getIndices("+n[a]+"))"):o.push(""+n[a]);return o.join()}(t,r);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+a+"));\n      }\n    "},Vs=function(t,e,r){this.sliceDim=t,this.strides=e,this.variableNames=["x","indices"],this.outputShape=r;var n=$i(e.length),o=$i(r.length),a=this.sliceDim>1?"strides[j]":"strides";this.userCode="\n        "+n+" strides = "+n+"("+this.strides+");\n         void main() {\n          "+o+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+a+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "};function Ws(t,e){var r=Mi();return ln(t,e,r.version+"\n    precision highp float;\n    "+r.attribute+" vec3 clipSpacePos;\n    "+r.attribute+" vec2 uv;\n    "+r.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function Us(t,e){return vn(t,e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function js(t,e){return bn(t,e,new Uint16Array([0,1,2,2,1,3]))}function Hs(t,e,r,n,o,a,i){xn(r,n);var s=yn(t,e),u=t.TEXTURE_2D;return rn(t,e,function(){return t.bindTexture(u,s)}),rn(t,e,function(){return t.texParameteri(u,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)}),rn(t,e,function(){return t.texParameteri(u,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)}),rn(t,e,function(){return t.texParameteri(u,t.TEXTURE_MIN_FILTER,t.NEAREST)}),rn(t,e,function(){return t.texParameteri(u,t.TEXTURE_MAG_FILTER,t.NEAREST)}),rn(t,e,function(){return t.texImage2D(u,0,o,r,n,0,a,i,null)}),rn(t,e,function(){return t.bindTexture(t.TEXTURE_2D,null)}),s}function Gs(t,e,r,n,o){var a=Zr(r,n);return Hs(t,e,a[0],a[1],o.internalFormatFloat,o.textureFormatFloat,t.FLOAT)}function $s(t,e,r,n,o){var a=Zr(r,n);return Hs(t,e,a[0],a[1],o.internalFormatHalfFloat,o.textureFormatFloat,o.textureTypeHalfFloat)}function Ks(t,e,r,n,o){var a=Zr(r,n);return Hs(t,e,a[0],a[1],t.RGBA,t.RGBA,t.UNSIGNED_BYTE)}function Xs(t,e,r,n,o){var a=tn(r,n);return Hs(t,e,a[0],a[1],o.internalFormatPackedFloat,t.RGBA,t.FLOAT)}function Ys(t,e,r,n,o){var a=tn(r,n);return Hs(t,e,a[0],a[1],o.internalFormatPackedHalfFloat,t.RGBA,o.textureTypeHalfFloat)}function Js(t,e,r,n){return rn(t,e,function(){return t.bindBuffer(t.ARRAY_BUFFER,n)}),kn(t,e,r,"clipSpacePos",n,3,20,0)&&kn(t,e,r,"uv",n,2,20,12)}function Zs(t,e,r,n,o,a,i){var s,u,l;rn(t,e,function(){return t.bindTexture(t.TEXTURE_2D,r)}),a instanceof Uint8Array?(s=new Uint8Array(n*o*4),u=t.UNSIGNED_BYTE,l=t.RGBA):(s=new Float32Array(n*o*4),u=t.FLOAT,l=i.internalFormatPackedFloat),s.set(a),rn(t,e,function(){return t.texImage2D(t.TEXTURE_2D,0,l,n,o,0,t.RGBA,u,s)}),rn(t,e,function(){return t.bindTexture(t.TEXTURE_2D,null)})}function Qs(t,e,r,n){rn(t,e,function(){return t.bindTexture(t.TEXTURE_2D,r)}),n.data instanceof Uint8Array?rn(t,e,function(){return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n.width,n.height,0,t.RGBA,t.UNSIGNED_BYTE,n.data)}):rn(t,e,function(){return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)}),rn(t,e,function(){return t.bindTexture(t.TEXTURE_2D,null)})}function tu(t,e,r,n,o){var a=t.createBuffer();rn(t,e,function(){return t.bindBuffer(t.PIXEL_PACK_BUFFER,a)});var i=16*r*n;return rn(t,e,function(){return t.bufferData(t.PIXEL_PACK_BUFFER,i,t.STREAM_READ)}),rn(t,e,function(){return t.readPixels(0,0,n,r,t.RGBA,t.FLOAT,0)}),rn(t,e,function(){return t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}),a}function eu(t,e,r){var n=t,o=new Float32Array(r);return n.bindBuffer(n.PIXEL_PACK_BUFFER,e),n.getBufferSubData(n.PIXEL_PACK_BUFFER,0,o),n.bindBuffer(n.PIXEL_PACK_BUFFER,null),o}function ru(t,e,r,n,o){var a=Zr(r,n),i=a[0],s=a[1],u=new Uint8Array(r*n*4);return rn(t,e,function(){return t.readPixels(0,0,i,s,o.downloadTextureFormat,t.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function nu(t,e,r,n,o,a,i,s){var u=t,l=new Float32Array(function(t,e){var r=tn(a,i);return r[0]*r[1]*4}());return u.bindBuffer(u.PIXEL_PACK_BUFFER,e),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),l}function ou(t,e,r,n){var o=new Float32Array(r*n*4);return rn(t,e,function(){return t.readPixels(0,0,n,r,t.RGBA,t.FLOAT,o)}),o}var au=Object.freeze({createVertexShader:Ws,createVertexBuffer:Us,createIndexBuffer:js,createFloat32MatrixTexture:Gs,createFloat16MatrixTexture:$s,createUnsignedBytesMatrixTexture:Ks,createPackedMatrixTexture:Xs,createFloat16PackedMatrixTexture:Ys,bindVertexProgramAttributeStreams:Js,uploadDenseMatrixToTexture:Zs,uploadPixelDataToTexture:Qs,createBufferFromOutputTexture:tu,downloadFloat32MatrixFromBuffer:eu,downloadByteEncodedFloatMatrixFromOutputTexture:ru,downloadPackedMatrixFromBuffer:nu,downloadMatrixFromPackedOutputTexture:ou}),iu=function(){function t(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var e=ge().getNumber("WEBGL_VERSION");if(null!=t?(this.gl=t,Xr(e,t)):this.gl=Yr(e),1===ge().getNumber("WEBGL_VERSION"))this.textureFloatExtension=un(this.gl,this.debug,"OES_texture_float"),this.colorBufferFloatExtension=this.gl.getExtension("WEBGL_color_buffer_float"),this.textureHalfFloatExtension=un(this.gl,this.debug,"OES_texture_half_float"),this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float");else if(Wn(this.gl,"EXT_color_buffer_float"))this.colorBufferFloatExtension=this.gl.getExtension("EXT_color_buffer_float");else{if(!Wn(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=Us(this.gl,this.debug),this.indexBuffer=js(this.gl,this.debug),this.framebuffer=wn(this.gl,this.debug),this.textureConfig=en(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(t.prototype,"debug",{get:function(){return ge().getBool("DEBUG")},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){var t=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var e=this.gl;rn(e,this.debug,function(){return e.finish()}),rn(e,this.debug,function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)}),rn(e,this.debug,function(){return e.deleteFramebuffer(t.framebuffer)}),rn(e,this.debug,function(){return e.bindBuffer(e.ARRAY_BUFFER,null)}),rn(e,this.debug,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}),rn(e,this.debug,function(){return e.deleteBuffer(t.indexBuffer)}),this.disposed=!0}},t.prototype.createFloat32MatrixTexture=function(t,e){return this.throwIfDisposed(),Gs(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.createFloat16MatrixTexture=function(t,e){return this.throwIfDisposed(),$s(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.createUnsignedBytesMatrixTexture=function(t,e){return this.throwIfDisposed(),Ks(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.uploadPixelDataToTexture=function(t,e){this.throwIfDisposed(),Qs(this.gl,this.debug,t,e)},t.prototype.uploadDenseMatrixToTexture=function(t,e,r,n){this.throwIfDisposed(),Zs(this.gl,this.debug,t,e,r,n,this.textureConfig)},t.prototype.createFloat16PackedMatrixTexture=function(t,e){return this.throwIfDisposed(),Ys(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.createPackedMatrixTexture=function(t,e){return this.throwIfDisposed(),Xs(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.deleteMatrixTexture=function(t){var e=this;this.throwIfDisposed(),this.outputTexture===t&&(An(this.gl,this.debug,this.framebuffer),this.outputTexture=null),rn(this.gl,this.debug,function(){return e.gl.deleteTexture(t)})},t.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(t,e,r){var n=this;return this.downloadMatrixDriver(t,function(){return ru(n.gl,n.debug,e,r,n.textureConfig)})},t.prototype.downloadPackedMatrixFromBuffer=function(t,e,r,n,o,a){return nu(this.gl,t,0,0,0,o,a,this.textureConfig)},t.prototype.downloadFloat32MatrixFromBuffer=function(t,e){return eu(this.gl,t,e)},t.prototype.createBufferFromTexture=function(t,e,r){this.bindTextureToFrameBuffer(t);var n=tu(this.gl,this.debug,e,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),n},t.prototype.createAndWaitForFence=function(){var t=this.createFence(this.gl);return this.pollFence(t)},t.prototype.createFence=function(t){var e,r,n=this;if(ge().getBool("WEBGL_FENCE_API_ENABLED")){var o=t,a=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),r=function(){var t=o.clientWaitSync(a,0,0);return t===o.ALREADY_SIGNALED||t===o.CONDITION_SATISFIED},e=a}else ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),r=function(){return n.isQueryAvailable(e,ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:e,isFencePassed:r}},t.prototype.downloadMatrixFromPackedTexture=function(t,e,r){var n=this;return this.downloadMatrixDriver(t,function(){return ou(n.gl,n.debug,e,r)})},t.prototype.createProgram=function(t){this.throwIfDisposed();var e=this.gl,r=cn(e,this.debug,t),n=Ws(e,this.debug),o=fn(e,this.debug);return rn(e,this.debug,function(){return e.attachShader(o,n)}),rn(e,this.debug,function(){return e.attachShader(o,r)}),mn(e,this.debug,o),this.debug&&gn(e,this.debug,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=Js(e,this.debug,this.program,this.vertexBuffer)),o},t.prototype.deleteProgram=function(t){var e=this;this.throwIfDisposed(),t===this.program&&(this.program=null),null!=t&&rn(this.gl,this.debug,function(){return e.gl.deleteProgram(t)})},t.prototype.setProgram=function(t){var e=this;this.throwIfDisposed(),this.program=t,null!=this.program&&this.debug&&gn(this.gl,this.debug,this.program),rn(this.gl,this.debug,function(){return e.gl.useProgram(t)})},t.prototype.getUniformLocation=function(t,e,r){return void 0===r&&(r=!0),this.throwIfDisposed(),r?Sn(this.gl,this.debug,t,e):En(this.gl,t,e)},t.prototype.getAttributeLocation=function(t,e){var r=this;return this.throwIfDisposed(),rn(this.gl,this.debug,function(){return r.gl.getAttribLocation(t,e)})},t.prototype.getUniformLocationNoThrow=function(t,e){return this.throwIfDisposed(),this.gl.getUniformLocation(t,e)},t.prototype.setInputMatrixTexture=function(t,e,r){this.throwIfDisposed(),this.throwIfNoProgram(),zn(this.gl,this.debug,this.program,t,e,r)},t.prototype.setOutputMatrixTexture=function(t,e,r){this.setOutputMatrixTextureDriver(t,r,e)},t.prototype.setOutputPackedMatrixTexture=function(t,e,r){this.throwIfDisposed();var n=tn(e,r),o=n[0],a=n[1];this.setOutputMatrixTextureDriver(t,o,a)},t.prototype.setOutputMatrixWriteRegion=function(t,e,r,n){this.setOutputMatrixWriteRegionDriver(r,t,n,e)},t.prototype.setOutputPackedMatrixWriteRegion=function(t,e,r,n){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},t.prototype.debugValidate=function(){null!=this.program&&gn(this.gl,this.debug,this.program),Nn(this.gl)},t.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var t=this.gl;this.debug&&this.debugValidate(),rn(t,this.debug,function(){return t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)})},t.prototype.blockUntilAllProgramsCompleted=function(){var t=this;this.throwIfDisposed(),rn(this.gl,this.debug,function(){return t.gl.finish()})},t.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=un(this.gl,this.debug,2===ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},t.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},t.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},t.prototype.beginQuery=function(){if(2===ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var t=this.gl,e=this.getQueryTimerExtensionWebGL2(),r=t.createQuery();return t.beginQuery(e.TIME_ELAPSED_EXT,r),r}var n=this.getQueryTimerExtensionWebGL1(),o=n.createQueryEXT();return n.beginQueryEXT(n.TIME_ELAPSED_EXT,o),o},t.prototype.endQuery=function(){if(2!==ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}else{var e=this.gl,r=this.getQueryTimerExtensionWebGL2();e.endQuery(r.TIME_ELAPSED_EXT)}},t.prototype.waitForQueryAndGetTime=function(t){return he(this,void 0,void 0,function(){var e=this;return fe(this,function(r){switch(r.label){case 0:return[4,Le(function(){return e.disposed||e.isQueryAvailable(t,ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return r.sent(),[2,this.getQueryTime(t,ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},t.prototype.getQueryTime=function(t,e){if(0===e)return null;if(2===e){var r=this.gl;return r.getQueryParameter(t,r.QUERY_RESULT)/1e6}var n=this.getQueryTimerExtensionWebGL1();return n.getQueryObjectEXT(t,n.QUERY_RESULT_EXT)/1e6},t.prototype.isQueryAvailable=function(t,e){if(0===e)return!0;if(2===e){var r=this.gl,n=this.getQueryTimerExtensionWebGL2(),o=r.getQueryParameter(t,r.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(n.GPU_DISJOINT_EXT)),o&&!this.disjoint}return o=(n=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(t,n.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(n.GPU_DISJOINT_EXT)),o&&!this.disjoint},t.prototype.pollFence=function(t){var e=this;return new Promise(function(r){e.addItemToPoll(function(){return t.isFencePassed()},function(){return r()})})},t.prototype.pollItems=function(){for(var t=function(t){for(var e=0;e<t.length;++e){if(!t[e]())break}return e-1}(this.itemsToPoll.map(function(t){return t.isDoneFn})),e=0;e<=t;++e)(0,this.itemsToPoll[e].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(t+1)},t.prototype.addItemToPoll=function(t,e){var r=this;this.itemsToPoll.push({isDoneFn:t,resolveFn:e}),this.itemsToPoll.length>1||Le(function(){return r.pollItems(),0===r.itemsToPoll.length})},t.prototype.bindTextureToFrameBuffer=function(t){this.throwIfDisposed(),In(this.gl,this.debug,t,this.framebuffer),this.debug&&Nn(this.gl)},t.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(In(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&Nn(this.gl)):An(this.gl,this.debug,this.framebuffer)},t.prototype.downloadMatrixDriver=function(t,e){this.bindTextureToFrameBuffer(t);var r=e();return this.unbindTextureToFrameBuffer(),r},t.prototype.setOutputMatrixTextureDriver=function(t,e,r){this.throwIfDisposed();var n=this.gl;In(n,this.debug,t,this.framebuffer),this.debug&&Nn(n),this.outputTexture=t,rn(n,this.debug,function(){return n.viewport(0,0,e,r)}),rn(n,this.debug,function(){return n.scissor(0,0,e,r)})},t.prototype.setOutputMatrixWriteRegionDriver=function(t,e,r,n){var o=this;this.throwIfDisposed(),rn(this.gl,this.debug,function(){return o.gl.scissor(t,e,r,n)})},t.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},t.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},t}();function su(t,e){if(t.length!==e.length)throw Error("Binary was compiled with "+t.length+" inputs, but was executed with "+e.length+" inputs");t.forEach(function(t,r){var n=t.logicalShape,o=e[r],a=o.shape;if(!De(n,a))throw Error("Binary was compiled with different shapes than the current args. Shapes "+n+" and "+a+" must match");if(!t.isUniform||!o.isUniform){var i=t.texShape,s=o.isUniform?null:o.texData.texShape;if(!De(i,s))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+i+" and "+s+" must match")}})}var uu=function(t,e,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;for(var n=r.filterWidth,o=r.inChannels,a=r.strideWidth,i=r.strideHeight,s=r.padInfo,u=r.outWidth,l=r.dilationWidth,c=r.dilationHeight,p=r.dataFormat,d=s.left,h=s.top,f=o*n,m=Mi(),g="channelsLast"===p,v=g?0:1,b=g?1:2,y="",x=0;x<=1;x++)for(var w=0;w<=1;w++)y+="\n          blockIndex = rc.y + "+w+";\n          pos = rc.x + "+x+";\n\n          if(blockIndex < "+t[1]+" && pos < "+t[0]+") {\n            offsetY = int(blockIndex / ("+u+")) * "+i+" - "+h+";\n            d0 = offsetY + "+c+" * (pos / "+f+");\n\n            if(d0 < "+e[v]+" && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), "+u+".) * "+a+". - "+d+".);\n              d1 = offsetX + "+l+" * (int(mod(float(pos), "+f+".) / "+o+".));\n\n              if(d1 < "+e[b]+" && d1 >= 0) {\n\n                ch = int(mod(float(pos), "+o+".));\n\n                if ("+g+") {\n                  innerDims = vec2(d1, ch);\n                  result["+(2*x+w)+"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result["+(2*x+w)+"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ";this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        "+y+"\n\n        "+m.output+" = result;\n      }\n    "},lu=function(t,e,r,n,o){this.variableNames=["x"],this.outputShape=[];var a,i=e,s=t[3]-1;this.outputShape=t;var u="float("+r+") + float("+n+") * sum";a=.5===o?"inversesqrt("+u+")":1===o?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+i+"; j <= "+i+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+s+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+a+";\n        setOutput(val);\n      }\n    "},cu=function(t,e,r,n,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=e,this.bias=r,this.alpha=n,this.beta=o,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+e+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+e+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+n+") * norm + float("+r+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+n+")\n                * float("+o+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+o+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "},pu=function(t,e,r,n,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var a,i=e,s=t[3]-1;this.outputShape=t;var u="float("+r+") + float("+n+") * sum";a=.5===o?"inversesqrt("+u+")":1===o?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < "+this.outputShape[3]+";\n        bool hasNextRow = c < "+this.outputShape[2]+";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - "+i+";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - "+i+"; j <= "+i+"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2("+s+"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * "+a+";\n        setOutput(result);\n      }\n    "},du=function(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var e=t.strideHeight,r=t.strideWidth,n=t.dilationHeight,o=t.effectiveFilterHeight,a=t.effectiveFilterWidth,i=o-1-t.padInfo.top,s=a-1-t.padInfo.left,u=o*a-1;this.userCode="\n      const ivec2 pads = ivec2("+i+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+o+";\n          wR += "+n+") {\n          float dyR = float(dyRCorner + wR) / "+e+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+a+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+r+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+u+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+a+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},hu=function(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var e=t.strideDepth,r=t.strideHeight,n=t.strideWidth,o=t.dilationDepth,a=t.dilationHeight,i=t.dilationWidth,s=t.effectiveFilterDepth,u=t.effectiveFilterHeight,l=t.effectiveFilterWidth,c=s-1-t.padInfo.front,p=u-1-t.padInfo.top,d=l-1-t.padInfo.left,h=s*u*l-1;this.userCode="\n      const ivec3 pads = ivec3("+c+", "+p+", "+d+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+s+";\n           wD += "+o+") {\n          float dyD = float(dyDCorner + wD) / "+e+".0;\n\n          if (dyD < 0.0 || dyD >= "+t.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+a+") {\n            float dyR = float(dyRCorner + wR) / "+r+".0;\n\n            if (dyR < 0.0 || dyR >= "+t.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+l+";\n                wC += "+i+") {\n              float dyC = float(dyCCorner + wC) / "+n+".0;\n\n              if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = "+h+" -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * "+u+" * "+l+" +\n                  wR * "+l+" + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},fu=function(t,e,r,n,o,a,i){void 0===r&&(r=!1),void 0===n&&(n=!1),void 0===o&&(o=!1),void 0===a&&(a=null),void 0===i&&(i=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;var s=r?t[1]:t[2],u=Math.ceil(s/2),l=r?"i * 2, rc.y":"rc.y, i * 2",c=n?"rc.z, i * 2":"i * 2, rc.z",p=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],d=n?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],h="",f="";a&&(h=i?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+a+"\n        }":"vec4 activation(vec4 x) {\n          "+a+"\n        }",f="result = activation(result);");var m=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+h+"\n\n      const float sharedDimension = "+u+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+u+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+l+");\n          vec4 b = getMatrixB(rc.x, "+c+");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += ("+p[0]+" * "+d[0]+");\n          result += ("+p[1]+" * "+d[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+m+"\n\n        "+f+"\n\n        setOutput(result);\n      }\n    "},mu=function(){function t(t,e,r){this.variableNames=["probs"],this.outputShape=[t,r],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(e-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(e-1)+"));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;return function(r,n){null==e.seedLoc&&(e.seedLoc=r.getUniformLocation(n,"seed")),r.gl.uniform1f(e.seedLoc,t)}},t}(),gu=function(t,e,r,n){this.variableNames=["indices"],this.outputShape=[t,e],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+n+"), float("+r+"),\n                      float(index == coords.y)));\n      }\n    "},vu=function(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t;var e=t.length;if(0===e)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var r=Fi("rc",e),n=$i(e),o=function(t,e,r){if(1===t)return"rc > "+e[0];for(var n="",o=t-2;o<t;o++)n+=r[o]+" >= "+e[o],o<t-1&&(n+="||");return n}(e,t,r),a=function(t,e,r,n){if(1===t)return"";var o=n.slice(-2);return"\n    int r = "+o[0]+";\n    int c = "+o[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+e+";\n    bool rEdge = rp1 >= "+r+";\n  "}(e,t[t.length-1],t[t.length-2],r),i=function(t,e){var r=t.length,n=function(t,e){for(var r=[],n=0;n<=1;n++)for(var o=0;o<=1;o++){for(var a=(0===n?"r":"rp1")+", "+(0===o?"c":"cp1"),i=2;i<t;i++)a=e[e.length-1-i]+","+a;r.push(a)}return r}(r,e);return 1===r?"getA(rc),\n            rc + 1 >= "+t[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+n[0]+"),\n          cEdge ? 0. : getA("+n[1]+"),\n          rEdge ? 0. : getA("+n[2]+"),\n          rEdge || cEdge ? 0. : getA("+n[3]+")"}(t,r);this.userCode="\n        void main() {\n          "+n+" rc = getOutputCoords();\n\n          if("+o+") {\n            setOutput(vec4(0));\n          } else {\n            "+a+"\n\n            setOutput(vec4("+i+"));\n          }\n        }\n      "}},bu=function(t,e,r){this.variableNames=["x"],this.outputShape=e.map(function(e,r){return e[0]+t[r]+e[1]});var n=t.length,o=$i(n),a=e.map(function(t){return t[0]}).join(","),i=e.map(function(e,r){return e[0]+t[r]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,n);this.userCode=1!==n?"\n      "+o+" start = "+o+"("+a+");\n      "+o+" end = "+o+"("+i+");\n\n      void main() {\n        "+o+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+r+"));\n        } else {\n          "+o+" coords = outC - start;\n          setOutput(getX("+s+"));\n        }\n      }\n    ":"\n        int start = "+a+";\n        int end = "+i+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+r+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "},yu=function(t,e,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map(function(e,r){return e[0]+t[r]+e[1]});for(var n=t.length,o=$i(n),a=e.map(function(t){return t[0]}).join(","),i=e.map(function(e,r){return e[0]+t[r]}).join(","),s=Fi("rc",n),u=Fi("source",n),l=s[n-1]+" < "+this.outputShape[n-1],c=1===n?"source":"vec2("+u.slice(-2).join()+")",p=[o+" rc = outputLoc;",s[n-1]+" += 1;\n       if("+l+") {\n      ",1===n?"":"}\n       rc = outputLoc;\n       "+s[n-2]+" += 1;\n       if("+s[n-2]+" < "+this.outputShape[n-2]+") {",1===n?"":"  "+s[n-1]+" += 1;\n         if("+l+") {"],d=1===n?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",h="",f=0,m=1===n?2:4;f<m;f++)h+="\n        "+p[f]+"\n        if ("+d+") {\n          result["+f+"] = float("+r+");\n        } else {\n          "+o+" source = rc - start;\n          result["+f+"] = getChannel(getX("+u.join()+"), "+c+");\n        }\n      ";h+=1===n?"} ":"}}",this.userCode="\n      const "+o+" start = "+o+"("+a+");\n      const "+o+" end = "+o+"("+i+");\n\n      void main() {\n        "+o+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+h+"\n        setOutput(result);\n      }\n    "},xu=function(t,e,r){if(this.variableNames=["x"],"avg"===e&&r)throw new Error("Cannot compute positions for average pool.");var n=t.filterWidth,o=t.strideHeight,a=t.strideWidth,i=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterHeight,l=t.effectiveFilterWidth,c=t.padInfo.top,p=t.padInfo.left;this.outputShape=t.outShape;var d="avg"===e,h="0.0";if(d||(h="-1.0 / 1e-20"),r)this.userCode="\n        const ivec2 strides = ivec2("+o+", "+a+");\n        const ivec2 pads = ivec2("+c+", "+p+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+i+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+l+";\n                wC += "+s+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+l+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var f=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===e&&(f="avgValue / count");var m=4*Math.floor(n/4),g=n%4,v="\n      if ("+d+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+o+", "+a+");\n      const ivec2 pads = ivec2("+c+", "+p+");\n      const float initializationValue = "+h+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+t.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+h+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+u+";\n            wR += "+i+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+t.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+m+"; wC += 4) {\n            int xC = xCCorner + wC * "+s+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              getValue(batch, xR, xC + 3 * "+s+", d)\n            );\n\n            "+v+"\n          }\n\n          int xC = xCCorner + "+m+";\n          if ("+(1===g)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+v+"\n          } else if ("+(2===g)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+v+"\n          } else if ("+(3===g)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              initializationValue\n            );\n\n            "+v+"\n          }\n        }\n        setOutput("+f+");\n      }\n    "}},wu=function(t,e,r){if(this.variableNames=["x"],"avg"===e&&r)throw new Error("Cannot compute positions for average pool.");var n=t.filterWidth,o=t.strideDepth,a=t.strideHeight,i=t.strideWidth,s=t.dilationDepth,u=t.dilationHeight,l=t.dilationWidth,c=t.effectiveFilterDepth,p=t.effectiveFilterHeight,d=t.effectiveFilterWidth,h=t.padInfo.front,f=t.padInfo.top,m=t.padInfo.left;this.outputShape=t.outShape;var g="avg"===e,v="0.0";if(g||(v="-1.0 / 1e-20"),r)this.userCode="\n        const ivec3 strides =\n            ivec3("+o+", "+a+", "+i+");\n        const ivec3 pads = ivec3("+h+", "+f+", "+m+");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < "+c+";\n              wD += "+s+") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= "+t.inDepth+") {\n              continue;\n            }\n\n            for (int wR = 0; wR < "+p+";\n                wR += "+u+") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= "+t.inHeight+") {\n                continue;\n              }\n\n              for (int wC = 0; wC < "+d+";\n                  wC += "+l+") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= "+t.inWidth+") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition =\n                      wD * "+p+" * "+d+" +\n                      wR * "+d+" + wC;;\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var b=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===e&&(b="avgValue / count");var y=4*Math.floor(n/4),x=n%4,w="\n      if ("+g+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec3 strides =\n        ivec3("+o+", "+a+", "+i+");\n      const ivec3 pads = ivec3("+h+", "+f+", "+m+");\n      const float initializationValue = "+v+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= "+t.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+v+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < "+c+";\n            wD += "+s+") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= "+t.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+p+";\n            wR += "+u+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+y+"; wC += 4) {\n              int xC = xCCorner + wC * "+l+";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+l+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+l+", ch),\n                getValue(batch, xD, xR, xC + 3 * "+l+", ch)\n              );\n\n              "+w+"\n            }\n\n            int xC = xCCorner + "+y+";\n            if ("+(1===x)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              "+w+"\n            } else if ("+(2===x)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+l+", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              "+w+"\n            } else if ("+(3===x)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+l+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+l+", ch),\n                initializationValue\n              );\n\n              "+w+"\n            }\n          }\n          setOutput("+b+");\n        }\n      }\n    "}},ku=function(t,e){this.variableNames=["x"];var r=t.windowSize,n=t.batchSize,o=t.inSize,a=Math.ceil(o/r);this.outputShape=[n,a];var i="0.0",s="";"prod"===e?i="1.0":"min"===e?(i="1.0 / 1e-20",s="min"):"max"===e&&(i="-1.0 / 1e-20",s="max");var u=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===e?u="sumValue":"prod"===e?u="prodValue":"all"===e?u="allValue":"any"===e&&(u="anyValue");var l=4*Math.floor(r/4),c=r%4,p="\n      if ("+("sum"===e)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===e)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+s+"(values, minMaxValue);\n      }\n    ",d="vec4";"all"===e?(i="1.0",p="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",d="bvec4"):"any"===e&&(i="0.0",p="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",d="bvec4");var h="";o%r>0&&(h="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+i+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+h+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        vec4 minMaxValue = vec4("+i+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+l+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+p+"\n        }\n\n        int inIdx = inOffset + "+l+";\n        if ("+(1===c)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+p+"\n        } else if ("+(2===c)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+p+"\n        } else if ("+(3===c)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+p+"\n        }\n        setOutput("+u+");\n      }\n    "},Cu=function(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;for(var r="",n=0;n<4;n++){var o="thisRC = rc;";n%2==1&&(o+="thisRC.z += 1;"),n>1&&(o+="thisRC.y += 1;"),r+="\n        "+o+"\n        "+(n>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+n+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(n>0?"}":"")+"\n      "}this.userCode="\n      \n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+Li(["r","c","d"],e)+"\n      return ivec3(r, c, d);\n    }\n  \n      "+Pi(t)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+t[1]+";\n        int cols = "+t[2]+";\n\n        "+r+"\n\n        setOutput(result);\n      }\n    "},Su=function(t,e,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var n=e.shape,o=n[1],a=n[2],i=t.shape,s=i[1],u=i[2],l=[r&&s>1?o-1:o,r&&u>1?a-1:a],c=[r&&s>1?s-1:s,r&&u>1?u-1:u],p=l[0]/c[0],d=l[1]/c[1],h=1/p,f=1/d,m=2*Math.ceil(h)+2,g=2*Math.ceil(f)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+p+");\n        const float widthScale = float("+d+");\n\n        const float invHeightScale = float("+h+");\n        const float invWidthScale = float("+f+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+g+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(o-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(a-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},Eu=function(t,e,r,n){this.variableNames=["A"],this.outputShape=[];var o=t[0],a=t[1],i=t[2],s=t[3];this.outputShape=[o,e,r,s];var u=[n&&e>1?a-1:a,n&&r>1?i-1:i],l=[n&&e>1?e-1:e,n&&r>1?r-1:r];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/l[0]+",\n          "+u[1]/l[1]+");\n      const vec2 inputShapeRC = vec2("+a+".0, "+i+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "},zu=function(t,e,r,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=t[0],a=t[1],i=t[2],s=t[3];this.outputShape=[o,e,r,s];var u=[n&&e>1?a-1:a,n&&r>1?i-1:i],l=[n&&e>1?e-1:e,n&&r>1?r-1:r];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+u[0]/l[0]+",\n          "+u[1]/l[1]+",\n          "+u[1]/l[1]+");\n      const vec3 inputShapeRC = vec3("+a+".0, "+i+".0,\n                                     "+i+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(s-1)+";\n        bool hasNextRow = coords.z < "+(r-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "},Iu=function(t,e,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var n=e.shape,o=n[1],a=n[2],i=t.shape,s=i[1],u=i[2],l=[r&&s>1?o-1:o,r&&u>1?a-1:a],c=[r&&s>1?s-1:s,r&&u>1?u-1:u],p=l[0]/c[0],d=l[1]/c[1],h=1/p,f=1/d,m=2*Math.ceil(h)+2,g=2*Math.ceil(f)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+p+");\n        const float widthScale = float("+d+");\n\n        const float invHeightScale = float("+h+");\n        const float invWidthScale = float("+f+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+g+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+l[0]+") *\n                (float(dyR) / float("+c[0]+"));\n\n            float sourceFracCol =\n                float("+l[1]+") *\n                  (float(dyC) / float("+c[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+o+") - 1),\n                "+r+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+a+") - 1),\n                "+r+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},Au=function(t,e,r,n){this.variableNames=["A"],this.outputShape=[];var o=t[0],a=t[1],i=t[2],s=t[3];this.outputShape=[o,e,r,s];var u=[n&&e>1?a-1:a,n&&r>1?i-1:i],l=[n&&e>1?e-1:e,n&&r>1?r-1:r],c=n?"0.5":"0.0";this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/l[0]+",\n          "+u[1]/l[1]+");\n      const vec2 inputShapeRC = vec2("+a+".0, "+i+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+c+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "},Nu=function(t,e){this.variableNames=["x"];var r=t.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-"+r+" tensor is not yet supported");if(this.outputShape=t,1!==r){var n=t.map(function(r,n){return function(r){return-1!==e.indexOf(r)&&1!==t[r]?t[r]+" - coords["+r+"] - 1":"coords["+r+"]"}(n)}).join(","),o=$i(r);this.userCode="\n      void main() {\n        "+o+" coords = getOutputCoords();\n        setOutput(getX("+n+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+t[0]+" - coord - 1));\n        }\n      "},Ru=function(t,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var r=t.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-"+r+" tensor is not yet supported");this.outputShape=t;var n=Fi("rc",r),o=n[r-1]+" + 1 < "+this.outputShape[r-1],a=n[r-2]+" + 1 < "+this.outputShape[r-2],i=$i(r);function s(r){var n=t.map(function(n,o){return function(r,n){return-1!==e.indexOf(r)&&1!==t[r]?t[r]+" - "+n[r]+" - 1":""+n[r]}(o,r)});return"getChannel(getX("+n.join(",")+"), vec2("+n.slice(-2).join(",")+"))"}this.userCode=1===r?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+t[0]+" - rc - 1),\n            "+t[0]+" - rc - 1);\n          if("+o+"){\n              result.g = getChannel(getX("+t[0]+" - (rc  + 1) - 1),\n                "+t[0]+" - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+i+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+s(n.slice())+";\n          if("+o+"){\n            result.g = "+function(t){return t[r-1]="("+t[r-1]+" + 1)",s(t)}(n.slice())+";\n          }\n          if("+a+") {\n            result.b = "+function(t){return t[r-2]="("+t[r-2]+" + 1)",s(t)}(n.slice())+";\n            if("+o+") {\n              result.a = "+function(t){return t[r-1]="("+t[r-1]+" + 1)",t[r-2]="("+t[r-2]+" + 1)",s(t)}(n.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "},Tu=function(t,e,r,n,o,a,i){this.variableNames=["updates","indices","defaultValue"],this.outputShape=a;var s=$i(o.length),u=$i(a.length),l="";1===r?l="i":2===r&&(l="i, j");var c="getIndices("+l+")",p="";1===n?p="i":2===n&&(p="i, coords[1]");var d="getUpdates("+p+")",h=e>1?"strides[j]":"strides";this.userCode="\n        "+s+" strides = "+s+"("+o+");\n\n        void main() {\n          "+u+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+t+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+e+"; j++) {\n              int index = round("+c+");\n              flattenedIndex += index * "+h+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += "+d+";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},Du=function(t,e){this.variableNames=["x","segmentIds"];var r=t.windowSize,n=t.batchSize,o=t.inSize,a=t.numSegments,i=a*Math.ceil(o/r);this.outputShape=[n,i];var s=4*Math.floor(r/4),u=r%4,l="\n        sumValue += dot(values, segFilter);\n    ",c="";o%r>0&&(c="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      ");var p="";o%r>0&&(p="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+c+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+p+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+a+")) * float("+r+"));\n        int currentSeg = int(mod(float(outIdx), float("+a+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+s+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+l+"\n        }\n\n        int inIdx = inOffset + "+s+";\n        if ("+(1===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+l+"\n        } else if ("+(2===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+l+"\n        } else if ("+(3===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+l+"\n        }\n        setOutput(sumValue);\n      }\n    "},_u=function(t,e,r){var n,o;if(this.variableNames=["c","a","b"],this.outputShape=e,r>4)throw Error("Where for rank "+r+" is not yet supported");if(1===r)o="resRC",n="resRC";else{for(var a=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[],s=[],u=0;u<e.length;u++)s.push(""+a[u]),u<t&&i.push(""+a[u]);n=i.join(),o=s.join()}var l=$i(r);this.userCode="\n      void main() {\n        "+l+" resRC = getOutputCoords();\n        float cVal = getC("+n+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+o+"));\n        } else {\n          setOutput(getB("+o+"));\n        }\n      }\n    "},Ou=function(){function t(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var e,r=$i(this.rank),n="uniform int start["+this.rank+"];",o=function(t){if(1===t)return"sourceLoc";if(t<=6)return Fu.slice(0,t).map(function(t){return"sourceLoc."+t}).join(",");throw Error("Slicing for rank "+t+" is not yet supported")}(this.rank);e="\n        "+r+" sourceLoc;\n        "+r+" coords = getOutputCoords();\n        "+t.map(function(t,e){return"sourceLoc."+Fu[e]+" = start["+e+"] + coords."+Fu[e]+";"}).join("\n")+"\n      ",this.userCode="\n      "+n+"\n      void main() {\n        "+e+"\n        setOutput(getSource("+o+"));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(r,n){null==e.startLoc&&(e.startLoc=r.getUniformLocationNoThrow(n,"start"),null==e.startLoc)||r.gl.uniform1iv(e.startLoc,t)}},t}(),Fu=["x","y","z","w","u","v"],Mu=function(){function t(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length;var e=$i(this.rank),r=Fi("coords",this.rank),n=Fi("sourceLoc",this.rank),o=1===this.rank?"sourceLoc":"vec2("+n.slice(-2).join()+")",a="getChannel(getSource("+n.join()+"), "+o+")",i="\n      result.x = "+a+";\n      if (++"+r[this.rank-1]+" < "+t[this.rank-1]+") {\n        ++"+n[this.rank-1]+";\n        result.y = "+a+";\n        --"+n[this.rank-1]+";\n      }\n    ",s=1===this.rank?"":"\n      --"+r[this.rank-1]+";\n      if (++"+r[this.rank-2]+" < "+t[this.rank-2]+") {\n        ++"+n[this.rank-2]+";\n        result.z = "+a+";\n        if (++"+r[this.rank-1]+" < "+t[this.rank-1]+") {\n          ++"+n[this.rank-1]+";\n          result.w = "+a+";\n        }\n      }\n    ",u=this.rank<=4?"sourceLoc = coords +\n            "+e+"("+t.map(function(t,e){return"start["+e+"]"}).join()+");":t.map(function(t,e){return n[e]+" = "+r[e]+" + start["+e+"];"}).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+e+" coords = getOutputCoords();\n        "+e+" sourceLoc;\n        "+u+"\n        vec4 result = vec4(0.);\n        "+i+"\n        "+s+"\n        setOutput(result);\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(r,n){null==e.startLoc&&(e.startLoc=r.getUniformLocationNoThrow(n,"start"),null==e.startLoc)||r.gl.uniform1iv(e.startLoc,t)}},t}(),Lu=function(t,e,r){this.variableNames=["x"],this.outputShape=r;var n=r.length,o=$i(r.length),a=$i(r.length),i="";if(1===n)i="coords * strides + begin";else{var s=0;i=r.map(function(t,e){return s++,1===r.length?"coords * strides["+e+"] + begin["+e+"]":"coords["+(s-1)+"] * strides["+e+"] + begin["+e+"]"}).join(",")}this.userCode="\n      "+o+" begin = "+o+"("+t+");\n      "+o+" strides = "+o+"("+e+");\n\n      void main() {\n        "+a+" coords = getOutputCoords();\n        setOutput(getX("+i+"));\n      }\n    "},Pu=function(){function t(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return t.prototype.acquireTexture=function(t,e,r){var n,o=Bu(e,r),a=qu(t,o,r);if(a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]),this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var i=this.freeTextures[a].shift();return this.usedTextures[a].push(i),i}return this.numUsedTextures++,this.log(),o===Gr.PACKED_2X2_FLOAT32?n=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):o===Gr.PACKED_2X2_FLOAT16?n=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):o===Gr.UNPACKED_FLOAT32?n=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):o===Gr.UNPACKED_FLOAT16?n=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):o===Gr.PACKED_4X1_UNSIGNED_BYTE&&(n=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[a].push(n),n},t.prototype.releaseTexture=function(t,e,r,n){if(null!=this.freeTextures){var o=qu(e,Bu(r,n),n);o in this.freeTextures||(this.freeTextures[o]=[]),this.freeTextures[o].push(t),this.numFreeTextures++,this.numUsedTextures--;var a=this.usedTextures[o],i=a.indexOf(t);if(i<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(i,1),this.log()}},t.prototype.log=function(){if(this.logEnabled){var t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+t+")")}},t.prototype.getNumUsedTextures=function(){return this.numUsedTextures},t.prototype.getNumFreeTextures=function(){return this.numFreeTextures},t.prototype.dispose=function(){var t=this;if(null!=this.freeTextures){for(var e in this.freeTextures)this.freeTextures[e].forEach(function(e){t.gpgpu.deleteMatrixTexture(e)});for(var e in this.usedTextures)this.usedTextures[e].forEach(function(e){t.gpgpu.deleteMatrixTexture(e)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},t}();function Bu(t,e){if(t===Hr.UPLOAD)return Gr.PACKED_2X2_FLOAT32;if(t===Hr.RENDER||null==t)return function(t){return ge().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?Gr.PACKED_2X2_FLOAT32:Gr.UNPACKED_FLOAT32:t?Gr.PACKED_2X2_FLOAT16:Gr.UNPACKED_FLOAT16}(e);if(t===Hr.DOWNLOAD||t===Hr.PIXELS)return Gr.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+t)}function qu(t,e,r){return t[0]+"_"+t[1]+"_"+e+"_"+r}var Vu=function(t,e){this.variableNames=["A"];for(var r=new Array(t.length),n=0;n<r.length;n++)r[n]=t[n]*e[n];this.outputShape=r,this.rank=r.length;var o=$i(this.rank),a=function(t){var e=t.length;if(e>5)throw Error("Tile for rank "+e+" is not yet supported");if(1===e)return"imod(resRC, "+t[0]+")";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],n=[],o=0;o<t.length;o++)n.push("imod("+r[o]+", "+t[o]+")");return n.join()}(t);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+a+"));\n      }\n    "},Wu=function(t,e){this.variableNames=["A"];for(var r=new Array(t.length),n=0;n<r.length;n++)r[n]=t[e[n]];this.outputShape=r,this.rank=r.length;var o=$i(this.rank),a=function(t){var e=t.length;if(e>6)throw Error("Transpose for rank "+e+" is not yet supported");for(var r=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],n=new Array(e),o=0;o<t.length;o++)n[t[o]]=r[o];return n.join()}(e);this.userCode="\n    void main() {\n      "+o+" resRC = getOutputCoords();\n      setOutput(getA("+a+"));\n    }\n    "},Uu=function(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var r=new Array(t.length),n=0;n<r.length;n++)r[n]=t[e[n]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var o=$i(this.rank),a=Oi("rc",this.rank),i=new Array(this.rank);for(n=0;n<e.length;n++)i[e[n]]=a[n];var s="vec2("+i.slice(-2).join()+")",u="++"+a[this.rank-1]+" < "+r[this.rank-1],l="getChannel(getA("+i.join()+"), "+s+")";this.userCode="\n    void main() {\n      "+o+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+l+";\n      if("+u+") {\n        result[1] = "+l+";\n      }\n      --"+a[this.rank-1]+";\n      if(++"+a[this.rank-2]+" < "+r[this.rank-2]+") {\n        result[2] = "+l+";\n        if("+u+") {\n          result[3] = "+l+";\n        }\n      }\n      setOutput(result);\n    }\n    "},ju=1.7580993408473768,Hu=1.0507009873554805,Gu=function(t,e){this.variableNames=["A"],this.outputShape=t,this.userCode="\n      float unaryOperation(float x) {\n        "+e+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},$u="if (isnan(x)) return x;",Ku="return x;",Xu="return abs(x);",Yu=$u+"\n  return (x < 0.0) ? 0.0 : x;\n",Ju=$u+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",Zu="return (x >= 0.0) ? x : (exp(x) - 1.0);",Qu="return -x;",tl="return ceil(x);",el="return floor(x);",rl="return exp(x);",nl="return exp(x) - 1.0;",ol="return x;",al="return x;",il="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",sl="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",ul="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",ll=function(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+e+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},cl=function(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t;var e=t.length,r=Fi("rc",e),n=$i(e),o=function(t,e){if(1===t)return"rc";for(var r="",n=0;n<t;n++)r+=e[n],n<t-1&&(r+=",");return r}(e,r),a=r.slice(-2),i=e<=1?"rc":"vec2("+a.join(",")+")";this.userCode="\n      void main() {\n        "+n+" rc = getOutputCoords();\n        vec4 packedInput = getA("+o+");\n\n        setOutput(getChannel(packedInput, "+i+"));\n      }\n    "},pl={};function dl(t,e){if(void 0===e&&(e=!1),"linear"===t)return e?al:Ku;if("relu"===t)return e?il:Yu;if("elu"===t)return e?ul:Zu;if("relu6"===t)return e?sl:Ju;if("prelu"===t)return e?ss:as;throw new Error("Activation "+t+" has not been implemented for the WebGL backend.")}var hl=600,fl=function(t){function e(e){var r,n=t.call(this)||this;if(n.gpgpu=e,n.pendingRead=new WeakMap,n.pendingDisposal=new WeakSet,n.dataRefCount=new WeakMap,n.numBytesInGPU=0,n.uploadWaitMs=0,n.downloadWaitMs=0,n.warnedAboutMemory=!1,n.pendingDeletes=0,n.disposed=!1,!ge().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==e){var o=Yr(ge().getNumber("WEBGL_VERSION"));n.binaryCache=(r=ge().getNumber("WEBGL_VERSION"))in pl?pl[r]:(pl[r]={},pl[r]),n.gpgpu=new iu(o),n.canvas=o.canvas,n.gpgpuCreatedLocally=!0}else n.binaryCache={},n.gpgpuCreatedLocally=!1,n.canvas=e.gl.canvas;return n.textureManager=new Pu(n.gpgpu),n.numMBBeforeWarning=null==ge().global.screen?1024:ge().global.screen.height*ge().global.screen.width*window.devicePixelRatio*hl/1024/1024,n.texData=new Qa(n,Vr),n}return de(e,t),e.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},e.prototype.fromPixels=function(t,e){if(null==t)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var r="undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement,n=t.data instanceof Uint8Array,o="undefined"!=typeof ImageData&&t instanceof ImageData,a="undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement,i="undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement,s=a?[t.videoWidth,t.videoHeight]:[t.width,t.height],u=s[0],l=s[1],c=[l,u],p=[l,u,e];if(!(r||n||o||a||i))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+t.constructor.name);(i||a)&&(null==this.fromPixels2DContext&&(this.fromPixels2DContext=Jr(ge().getNumber("WEBGL_VERSION")).getContext("2d")),this.fromPixels2DContext.canvas.width=u,this.fromPixels2DContext.canvas.height=l,this.fromPixels2DContext.drawImage(t,0,0,u,l),t=this.fromPixels2DContext.canvas);var d,h,f=this.makeTensorInfo(c,"int32");return this.texData.get(f.dataId).usage=Hr.PIXELS,this.gpgpu.uploadPixelDataToTexture(this.getTexture(f.dataId),t),ge().getBool("WEBGL_PACK")?(d=new Bs(p),h=this.compileAndRun(d,[f])):(d=new Ps(p),h=this.compileAndRun(d,[f])),this.disposeData(f.dataId),h},e.prototype.write=function(t,e,r){if(ge().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r&&null!=t)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var n={};return this.texData.set(n,{shape:e,dtype:r,values:t,usage:Hr.UPLOAD}),n},e.prototype.move=function(t,e,r,n){if(ge().getBool("DEBUG")&&this.checkNumericalProblems(e),"complex64"===n)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:r,dtype:n,values:e,usage:Hr.UPLOAD})},e.prototype.readSync=function(t){var e=this.texData.get(t),r=e.values,n=e.dtype,o=e.complexTensors,a=e.slice,i=e.shape,s=e.isPacked;if(null!=a){var u;u=s?new ll(i,ol):new Gu(i,ol);var l=this.runWebGLProgram(u,[{dataId:t,shape:i,dtype:n}],n),c=this.readSync(l.dataId);return this.disposeData(l.dataId),c}if(null!=r)return this.convertAndCacheOnCPU(t);if("string"===n)return r;var p,d,h=null!=this.activeTimers;return h&&(p=ir()),d="complex64"===n?wi(o.real.dataSync(),o.imag.dataSync()):this.getValuesFromTexture(t),h&&(this.downloadWaitMs+=ir()-p),this.convertAndCacheOnCPU(t,d)},e.prototype.read=function(t){return he(this,void 0,void 0,function(){var e,r,n,o,a,i,s,u,l,c,p,d,h,f,m,g,v,b,y,x,w,k;return fe(this,function(C){switch(C.label){case 0:if(this.pendingRead.has(t))return e=this.pendingRead.get(t),[2,new Promise(function(t){return e.push(t)})];if(r=this.texData.get(t),n=r.values,o=r.shape,a=r.slice,i=r.dtype,s=r.complexTensors,u=r.isPacked,null!=a)return void 0,l=u?new ll(o,ol):new Gu(o,ol),c=this.runWebGLProgram(l,[{dataId:t,shape:o,dtype:i}],i),p=this.read(c.dataId),this.disposeData(c.dataId),[2,p];if(null!=n)return[2,this.convertAndCacheOnCPU(t)];if(!ge().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===ge().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return d=null,"complex64"!==i&&ge().get("WEBGL_BUFFER_SUPPORTED")&&(h=this.decode(t),f=this.texData.get(h.dataId),d=(k=this.gpgpu).createBufferFromTexture.apply(k,[f.texture].concat(Qr(o)))),this.pendingRead.set(t,[]),"complex64"===i?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:C.sent(),C.label=2;case 2:return"complex64"!==i?[3,4]:[4,Promise.all([s.real.data(),s.imag.data()])];case 3:return g=C.sent(),v=g[0],b=g[1],m=wi(v,b),[3,5];case 4:null==d?m=this.getValuesFromTexture(t):(y=Te(o),m=this.gpgpu.downloadFloat32MatrixFromBuffer(d,y)),C.label=5;case 5:return null!=h&&this.disposeData(h.dataId),x=this.convertAndCacheOnCPU(t,m),w=this.pendingRead.get(t),this.pendingRead.delete(t),w.forEach(function(t){return t(x)}),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t),this.pendingDeletes--),[2,x]}})})},e.prototype.checkNumericalProblems=function(t){if(null!=t)for(var e=0;e<t.length;e++){var r=t[e];if(!an(r)){if(ge().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value "+r+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'");throw Error("The value "+r+" cannot be represented on this device.")}}},e.prototype.getValuesFromTexture=function(t){var e,r=this.texData.get(t),n=r.shape,o=r.dtype,a=r.isPacked,i=Te(n);if(ge().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var s=this.decode(t),u=this.texData.get(s.dataId),l=(e=this.gpgpu).downloadMatrixFromPackedTexture.apply(e,[u.texture].concat(Qr(n))).subarray(0,i);return this.disposeData(s.dataId),l}var c=ge().getBool("WEBGL_PACK")&&!0===a,p=c?Fn(n):n,d=c?new _s(p):new Ds(p),h=this.runWebGLProgram(d,[{shape:p,dtype:o,dataId:t}],"float32"),f=this.texData.get(h.dataId),m=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(f.texture,f.texShape[0],f.texShape[1]).subarray(0,i);return this.disposeData(h.dataId),m},e.prototype.time=function(t){return he(this,void 0,void 0,function(){var e,r,n,o,a,i,s;return fe(this,function(u){switch(u.label){case 0:return e=this.activeTimers,r=[],n=!1,null==this.programTimersStack?(this.programTimersStack=r,n=!0):this.activeTimers.push(r),this.activeTimers=r,t(),o=Re(this.activeTimers.map(function(t){return t.query})).filter(function(t){return null!=t}),a=Re(this.activeTimers.map(function(t){return t.name})).filter(function(t){return null!=t}),this.activeTimers=e,n&&(this.programTimersStack=null),[4,Promise.all(o)];case 1:return i=u.sent(),s={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:ze(i),getExtraProfileInfo:function(){return i.map(function(t,e){return{name:a[e],ms:t}}).map(function(t){return t.name+": "+t.ms}).join(", ")},wallMs:null},this.uploadWaitMs=0,this.downloadWaitMs=0,[2,s]}})})},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},e.prototype.startTimer=function(){return ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?this.gpgpu.beginQuery():{startMs:ir(),endMs:null}},e.prototype.endTimer=function(t){return ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(this.gpgpu.endQuery(),t):(t.endMs=ir(),t)},e.prototype.getQueryTime=function(t){return he(this,void 0,void 0,function(){var e;return fe(this,function(r){return ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:[2,(e=t).endMs-e.startMs]})})},e.prototype.disposeData=function(t){if(!this.pendingDisposal.has(t)){if(this.pendingRead.has(t))return this.pendingDisposal.add(t),void this.pendingDeletes++;if(this.texData.has(t)){this.releaseGPUData(t);var e=this.texData.get(t).complexTensors;null!=e&&(e.real.dispose(),e.imag.dispose()),this.texData.delete(t)}}},e.prototype.releaseGPUData=function(t){var e=this.texData.get(t),r=e.texture,n=e.dtype,o=e.texShape,a=e.usage,i=e.isPacked,s=e.slice,u=s&&s.origDataId||t,l=this.dataRefCount.get(u);l>1?this.dataRefCount.set(u,l-1):(this.dataRefCount.delete(u),null!=r&&(this.numBytesInGPU-=this.computeBytes(o,n),this.textureManager.releaseTexture(r,o,a,i)));var c=this.texData.get(t);c.texture=null,c.texShape=null,c.isPacked=!1,c.slice=null},e.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},e.prototype.getDataInfo=function(t){return this.texData.get(t)},e.prototype.getCPUBackend=function(){return ge().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=Vr.findBackend("cpu")),this.cpuBackend):null},e.prototype.shouldExecuteOnCPU=function(t,e){var r=this;return void 0===e&&(e=128),null!=this.getCPUBackend()&&t.every(function(t){return null==r.texData.get(t.dataId).texture&&t.size<e})},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.complex=function(t,e){var r=this.makeOutput(t.shape,"complex64");return this.texData.get(r.dataId).complexTensors={real:Vr.keep(t.clone()),imag:Vr.keep(e.clone())},r},e.prototype.real=function(t){return this.texData.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.texData.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,e,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.slice(t,e,r);if(0===Te(r))return ko([],r,t.dtype);var n=this.texData.get(t.dataId).isPacked,o=Ha(t.shape,e,r);if(n||!o){var a=ge().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Mu(r):new Ou(r),i=a.getCustomSetupFunc(e);return this.compileAndRun(a,[t],null,i)}return this.uploadToGPU(t.dataId),this.shallowSlice(t,e,r)},e.prototype.shallowSlice=function(t,e,r){var n=this.texData.get(t.dataId),o=this.makeOutput(r,t.dtype),a=this.texData.get(o.dataId);Object.assign(a,n),a.shape=r,a.dtype=t.dtype;var i=Ga(e,t.strides);n.slice&&(i+=n.slice.flatOffset),a.slice={flatOffset:i,origDataId:n.slice&&n.slice.origDataId||t.dataId};var s=this.dataRefCount.get(a.slice.origDataId)||1;return this.dataRefCount.set(a.slice.origDataId,s+1),o},e.prototype.stridedSlice=function(t,e,r,n){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.stridedSlice(t,e,r,n);var o=Wa(e,r,n);if(o.some(function(t){return 0===t}))return ko([],o);var a=new Lu(e,n,o);return this.compileAndRun(a,[t])},e.prototype.reverse=function(t,e){var r=ge().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Ru(t.shape,e):new Nu(t.shape,e);return this.compileAndRun(r,[t])},e.prototype.concat=function(t,e){if("complex64"===t[0].dtype){var r=t.map(function(t){return xo(t)}),n=t.map(function(t){return wo(t)});return yo(this.concat(r,e),this.concat(n,e))}if(this.shouldExecuteOnCPU(t))return this.cpuBackend.concat(t,e);if(1===t.length)return t[0];if(t.length>ge().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var o=Math.floor(t.length/2),a=this.concat(t.slice(0,o),e),i=this.concat(t.slice(o),e);return this.concat([a,i],e)}if(ge().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].rank>1){var s=new hs(t.map(function(t){return t.shape}),e);return this.compileAndRun(s,t)}var u=vo(t.map(function(t){return t.shape}),e),l=t.map(function(t){return t.as2D(-1,Te(t.shape.slice(e)))}),c=new ds(l.map(function(t){return t.shape}));return this.compileAndRun(c,l).reshape(u)},e.prototype.neg=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.neg(t);if(ge().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,Qu,t.dtype);var e=new Gu(t.shape,Qu);return this.compileAndRun(e,[t])},e.prototype.batchMatMul=function(t,e,r,n){var o=r?t.shape[2]:t.shape[1],a=n?e.shape[1]:e.shape[2],i=r?t.shape[1]:t.shape[2],s=t.shape[0];if((1===o||1===a)&&i>1e3){r&&(t=t.transpose([0,2,1])),n&&(e=e.transpose([0,2,1]));var u=1===a?t:t.as3D(s,i,1),l=1===a?2:1,c=1===a?e.as3D(s,1,i):e;return this.multiply(u,c).sum(l,!0)}var p=Dr(t.dtype,e.dtype),d=new fu(t.shape,[s,o,a],r,n);return this.compileAndRun(d,[t,e],p)},e.prototype.fusedBatchMatMul=function(t){var e=t.a,r=t.b,n=t.transposeA,o=t.transposeB,a=t.bias,i=t.activation,s=t.preluActivationWeights,u=n?e.shape[2]:e.shape[1],l=o?r.shape[1]:r.shape[2],c=e.shape[0],p=Dr(e.dtype,r.dtype),d=null!=a,h=null!=s,f=i?dl(i,!0):null,m=new fu(e.shape,[c,u,l],n,o,d,f,h),g=[e,r];return a&&g.push(a),s&&g.push(s),this.compileAndRun(m,g,p)},e.prototype.multiply=function(t,e){if("complex64"===t.dtype){var r=this.texData.get(t.dataId),n=this.texData.get(e.dataId),o=new es("return areal * breal - aimag * bimag;",t.shape,e.shape),a=new es("return areal * bimag + aimag * breal;",t.shape,e.shape),i=[this.makeComplexComponentTensorInfo(t,r.complexTensors.real),this.makeComplexComponentTensorInfo(t,r.complexTensors.imag),this.makeComplexComponentTensorInfo(e,n.complexTensors.real),this.makeComplexComponentTensorInfo(e,n.complexTensors.imag)],s=this.compileAndRun(o,i),u=this.compileAndRun(a,i),l=this.complex(s,u);return s.dispose(),u.dispose(),l}if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.multiply(t,e);if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,os,t.dtype);var c=new is(os,t.shape,e.shape);return this.compileAndRun(c,[t,e],t.dtype)},e.prototype.batchNormalization=function(t,e,r,n,o,a){var i=[t,e,r],s=null;null!=a&&(s=a.shape,i.push(a));var u=null;if(null!=o&&(u=o.shape,i.push(o)),ge().getBool("WEBGL_PACK_NORMALIZATION")){var l=new ts(t.shape,e.shape,r.shape,s,u,n);return this.compileAndRun(l,i)}var c=new Qi(t.shape,e.shape,r.shape,s,u,n);return this.compileAndRun(c,i)},e.prototype.localResponseNormalization4D=function(t,e,r,n,o){var a=ge().getBool("WEBGL_PACK_NORMALIZATION")?new pu(t.shape,e,r,n,o):new lu(t.shape,e,r,n,o);return this.compileAndRun(a,[t])},e.prototype.LRNGrad=function(t,e,r,n,o,a,i){var s=new cu(e.shape,n,o,a,i);return this.compileAndRun(s,[e,r,t])},e.prototype.tile=function(t,e){if("string"===t.dtype){var r=this.readSync(t.dataId).map(function(t){return lr(t)});return Ai(na(t.shape,t.dtype,r),e)}var n=new Vu(t.shape,e);return this.compileAndRun(n,[t])},e.prototype.pad=function(t,e,r){var n=ge().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new yu(t.shape,e,r):new bu(t.shape,e,r);return this.compileAndRun(n,[t])},e.prototype.transpose=function(t,e){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.transpose(t,e);var r=ge().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Uu(t.shape,e):new Wu(t.shape,e);return this.compileAndRun(r,[t])},e.prototype.gather=function(t,e,r){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.gather(t,e,r);var n=new qs(t.shape,e.size,r);return this.compileAndRun(n,[t,e])},e.prototype.batchToSpaceND=function(t,e,r){Ie(t.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var n=e.reduce(function(t,e){return t*e}),o=Ta(t.shape,e,n),a=Da(o.length,e.length),i=_a(t.shape,e,n),s=Oa(r,e.length),u=Fa(i,r,e.length);return t.reshape(o).transpose(a).reshape(i).slice(s,u)},e.prototype.spaceToBatchND=function(t,e,r){Ie(t.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var n=e.reduce(function(t,e){return t*e}),o=[[0,0]];o.push.apply(o,r);for(var a=1+e.length;a<t.shape.length;++a)o.push([0,0]);var i=t.pad(o),s=Ta(i.shape,e,n,!1),u=Da(s.length,e.length,!1),l=_a(i.shape,e,n,!1);return i.reshape(s).transpose(u).reshape(l)},e.prototype.reduce=function(t,e,r){var n=t.shape[0],o=t.shape[1],a=Pa(o),i=new ku({windowSize:a,inSize:o,batchSize:n},e),s=this.compileAndRun(i,[t],r);return 1===s.shape[1]?s:this.reduce(s,e,r)},e.prototype.argReduce=function(t,e,r){void 0===r&&(r=null);var n=t.shape[0],o=t.shape[1];null!=r&&(n=r.shape[0],o=r.shape[1]);var a=Pa(o),i=new _i({windowSize:a,inSize:o,batchSize:n},e,null==r),s=[t];null!=r&&s.push(r);var u=this.compileAndRun(i,s,"int32");return 1===u.shape[1]?u:this.argReduce(t,e,u)},e.prototype.argReducePacked=function(t,e,r){void 0===r&&(r=null);var n=null!=r?r.shape:t.shape,o=Pa(n[n.length-1]),a=new Yi(n,o,e,null==r),i=null==r?[t]:[t,r],s=this.compileAndRun(a,i,"int32");return s.rank===t.rank?this.argReducePacked(t,e,s):s},e.prototype.sum=function(t,e){po("sum",e,t.rank);var r=lo(t.shape,e),n=r[0],o=Te(r[1]),a=t.as2D(-1,o),i=_r(t.dtype);return this.reduce(a,"sum",i).reshape(n)},e.prototype.prod=function(t,e){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.prod(t,e);var r=lo(t.shape,e),n=r[0],o=Te(r[1]),a=t.as2D(-1,o),i=_r(t.dtype);return this.reduce(a,"prod",i).reshape(n)},e.prototype.unsortedSegmentSum=function(t,e,r){var n=0,o=ho([n],t.rank),a=t;null!=o&&(a=t.transpose(o),n=mo(1,t.rank)[0]);var i=function(t,e,r){for(var n=[],o=t.length,a=0;a<o;a++)a!==e?n.push(t[a]):n.push(r);return n}(a.shape,n,r),s=Te([a.shape[n]]),u=a.as2D(-1,s),l=_r(t.dtype),c=this.segOpCompute(u,"unsortedSegmentSum",e,l,r).reshape(i);return null!=o&&(c=c.transpose(fo(o))),c},e.prototype.segOpCompute=function(t,e,r,n,o){var a=t.shape[0],i=t.shape[1],s=function(t,e){var r,n=!1;for(t<=La?(r=t,n=!0):r=tr(t,Math.floor(Math.sqrt(t)));!n;)r>e||r===t?n=!0:r=tr(t,r+1);return r}(i,o),u=new Du({windowSize:s,inSize:i,batchSize:a,numSegments:o},e),l=this.compileAndRun(u,[t,r],n);return l.shape[1]===o?l:(r=Mo(0,o).tile([i/s]),this.segOpCompute(l,e,r,n,o))},e.prototype.argMinMaxReduce=function(t,e,r){var n=[e];if(po("arg"+r.charAt(0).toUpperCase()+r.slice(1),n,t.rank),!ge().getBool("WEBGL_PACK_REDUCE")||t.rank<=2){var o=lo(t.shape,n),a=o[0],i=Te(o[1]),s=t.as2D(-1,i);return this.argReduce(s,r).reshape(a)}return this.argReducePacked(t,r)},e.prototype.argMin=function(t,e){return this.argMinMaxReduce(t,e,"min")},e.prototype.argMax=function(t,e){return this.argMinMaxReduce(t,e,"max")},e.prototype.cumsum=function(t,e,r,n){if(e!==t.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(t.rank-1)+" but got axis="+e);var o=new zs(t.shape,r,n);return this.compileAndRun(o,[t])},e.prototype.equal=function(t,e){if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(equal(a, b));\n","bool");var r=new is("return float(a == b);",t.shape,e.shape);return this.compileAndRun(r,[t,e],"bool")},e.prototype.notEqual=function(t,e){if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(notEqual(a, b));\n","bool");var r=new is("return float(a != b);",t.shape,e.shape);return this.compileAndRun(r,[t,e],"bool")},e.prototype.less=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.less(t,e);if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(lessThan(a, b));\n","bool");var r=new is("return float(a < b);",t.shape,e.shape);return this.compileAndRun(r,[t,e],"bool")},e.prototype.lessEqual=function(t,e){if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(lessThanEqual(a, b));\n","bool");var r=new is("return float(a <= b);",t.shape,e.shape);return this.compileAndRun(r,[t,e],"bool")},e.prototype.greater=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.greater(t,e);if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(greaterThan(a, b));\n","bool");var r=new is("return float(a > b);",t.shape,e.shape);return this.compileAndRun(r,[t,e],"bool")},e.prototype.greaterEqual=function(t,e){if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var r=new is("return float(a >= b);",t.shape,e.shape);return this.compileAndRun(r,[t,e],"bool")},e.prototype.logicalNot=function(t){var e=new Gu(t.shape,"return float(!(x >= 1.0));");return this.compileAndRun(e,[t])},e.prototype.logicalAnd=function(t,e){if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var r=new is("return float(a >= 1.0 && b >= 1.0);",t.shape,e.shape);return this.compileAndRun(r,[t,e],"bool")},e.prototype.logicalOr=function(t,e){if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var r=new is("return float(a >= 1.0 || b >= 1.0);",t.shape,e.shape);return this.compileAndRun(r,[t,e],"bool")},e.prototype.select=function(t,e,r){var n=new _u(t.rank,e.shape,e.rank);return this.compileAndRun(n,[t,e,r],Dr(e.dtype,r.dtype))},e.prototype.where=function(t){ro("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var e=t.dataSync();return Ri(t.shape,e)},e.prototype.topk=function(t,e,r){return Ni(t.dataSync(),t.shape,t.dtype,e)},e.prototype.min=function(t,e){po("min",e,t.rank);var r=lo(t.shape,e),n=r[0],o=Te(r[1]),a=t.as2D(-1,o);return this.reduce(a,"min",a.dtype).reshape(n)},e.prototype.minimum=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.minimum(t,e);var r=ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new us("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new is("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",t.shape,e.shape);return this.compileAndRun(r,[t,e])},e.prototype.mod=function(t,e){var r=ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new us("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new is("if (b == 0.0) return NAN;\n  return mod(a, b);",t.shape,e.shape);return this.compileAndRun(r,[t,e])},e.prototype.max=function(t,e){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.max(t,e);po("max",e,t.rank);var r=lo(t.shape,e),n=r[0],o=Te(r[1]),a=t.as2D(-1,o);return this.reduce(a,"max",a.dtype).reshape(n)},e.prototype.maximum=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.maximum(t,e);var r=ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new us("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new is("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",t.shape,e.shape);return this.compileAndRun(r,[t,e])},e.prototype.all=function(t,e){po("all",e,t.rank);var r=lo(t.shape,e),n=r[0],o=Te(r[1]),a=t.as2D(-1,o);return this.reduce(a,"all",a.dtype).reshape(n)},e.prototype.any=function(t,e){po("any",e,t.rank);var r=lo(t.shape,e),n=r[0],o=Te(r[1]),a=t.as2D(-1,o);return this.reduce(a,"any",a.dtype).reshape(n)},e.prototype.squaredDifference=function(t,e){var r=ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new us("return (a - b) * (a - b);",t.shape,e.shape):new is("return (a - b) * (a - b);",t.shape,e.shape);return this.compileAndRun(r,[t,e])},e.prototype.realDivide=function(t,e){if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n","float32",!0);var r=new is("\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",t.shape,e.shape);return this.compileAndRun(r,[t,e],"float32")},e.prototype.floorDiv=function(t,e){if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n","int32");var r=new is("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",t.shape,e.shape);return this.compileAndRun(r,[t,e],"int32")},e.prototype.add=function(t,e){if("complex64"===t.dtype&&"complex64"===e.dtype)return this.complexSeparableBinaryOp(t,e,rs);if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.add(t,e);var r=Dr(t.dtype,e.dtype);if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,rs,r);var n=new is(rs,t.shape,e.shape);return this.compileAndRun(n,[t,e],r)},e.prototype.packedUnaryOp=function(t,e,r){var n=new ll(t.shape,e);return this.compileAndRun(n,[t],r)},e.prototype.packedBinaryOp=function(t,e,r,n,o){void 0===o&&(o=!1);var a=new us(r,t.shape,e.shape,o);return this.compileAndRun(a,[t,e],n)},e.prototype.complexSeparableBinaryOp=function(t,e,r){var n=this,o=this.texData.get(t.dataId),a=this.texData.get(e.dataId),i=[[o.complexTensors.real,a.complexTensors.real],[o.complexTensors.imag,a.complexTensors.imag]].map(function(o){var a=o[0],i=o[1],s=n.makeComplexComponentTensorInfo(t,a),u=n.makeComplexComponentTensorInfo(e,i),l=new is(r,t.shape,e.shape);return n.compileAndRun(l,[s,u],Dr(a.dtype,i.dtype))}),s=i[0],u=i[1],l=this.complex(s,u);return s.dispose(),u.dispose(),l},e.prototype.makeComplexComponentTensorInfo=function(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}},e.prototype.addN=function(t){if(1===t.length)return t[0];if(t.length>ge().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var e=Math.floor(t.length/2),r=this.addN(t.slice(0,e)),n=this.addN(t.slice(e));return this.addN([r,n])}var o=t.map(function(t){return t.dtype}).reduce(function(t,e){return Dr(t,e)}),a=t.map(function(t){return t.shape}),i=ge().getBool("WEBGL_PACK")?new Di(t[0].shape,a):new Ti(t[0].shape,a);return this.compileAndRun(i,t,o)},e.prototype.subtract=function(t,e){if("complex64"===t.dtype&&"complex64"===e.dtype)return this.complexSeparableBinaryOp(t,e,ns);if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.subtract(t,e);var r=Dr(t.dtype,e.dtype);if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,ns,t.dtype);var n=new is(ns,t.shape,e.shape);return this.compileAndRun(n,[t,e],r)},e.prototype.pow=function(t,e){var r=ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new us("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new is("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",t.shape,e.shape),n=Dr(t.dtype,e.dtype);return this.compileAndRun(r,[t,e],n)},e.prototype.ceil=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.ceil(t);if(ge().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,tl,t.dtype);var e=new Gu(t.shape,tl);return this.compileAndRun(e,[t])},e.prototype.floor=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.floor(t);if(ge().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,el,t.dtype);var e=new Gu(t.shape,el);return this.compileAndRun(e,[t])},e.prototype.sign=function(t){var e=new Gu(t.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(e,[t])},e.prototype.isNaN=function(t){var e=new Gu(t.shape,"return float(isnan(x));");return this.compileAndRun(e,[t],"bool")},e.prototype.isInf=function(t){var e=new Gu(t.shape,"return float(isinf(x));");return this.compileAndRun(e,[t],"bool")},e.prototype.isFinite=function(t){var e=new Gu(t.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(e,[t],"bool")},e.prototype.round=function(t){var e=new Gu(t.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(e,[t])},e.prototype.exp=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.exp(t);if(ge().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,rl,t.dtype);var e=new Gu(t.shape,rl);return this.compileAndRun(e,[t])},e.prototype.expm1=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.expm1(t);if(ge().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,nl,t.dtype);var e=new Gu(t.shape,nl);return this.compileAndRun(e,[t])},e.prototype.log=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.log(t);if(ge().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",t.dtype);var e=new Gu(t.shape,"if (x < 0.0) return NAN;\n  return log(x);");return this.compileAndRun(e,[t])},e.prototype.log1p=function(t){var e=new Gu(t.shape,"return log(1.0 + x);");return this.compileAndRun(e,[t])},e.prototype.sqrt=function(t){var e=new Gu(t.shape,"return sqrt(x);");return this.compileAndRun(e,[t])},e.prototype.rsqrt=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.rsqrt(t);var e=new Gu(t.shape,"return inversesqrt(x);");return this.compileAndRun(e,[t])},e.prototype.reciprocal=function(t){var e=new Gu(t.shape,"return 1.0 / x;");return this.compileAndRun(e,[t])},e.prototype.relu=function(t){var e;return e=ge().getBool("WEBGL_PACK")?new ll(t.shape,il):new Gu(t.shape,Yu),this.compileAndRun(e,[t])},e.prototype.relu6=function(t){var e;return e=ge().getBool("WEBGL_PACK")?new ll(t.shape,sl):new Gu(t.shape,Ju),this.compileAndRun(e,[t])},e.prototype.prelu=function(t,e){var r=ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new us(ss,t.shape,e.shape):new is(as,t.shape,e.shape);return this.compileAndRun(r,[t,e])},e.prototype.elu=function(t){if(ge().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,ul,t.dtype);var e=new Gu(t.shape,Zu);return this.compileAndRun(e,[t])},e.prototype.eluDer=function(t,e){var r=ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new us("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",t.shape,e.shape):new is("return (b >= 1.0) ? a : a * (b + 1.0);",t.shape,e.shape);return this.compileAndRun(r,[t,e])},e.prototype.selu=function(t){var e=new Gu(t.shape,"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = 1.7580993408473768;\n  float scale = 1.0507009873554805;\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n");return this.compileAndRun(e,[t])},e.prototype.int=function(t){var e=new Gu(t.shape,"return float(int(x));");return this.compileAndRun(e,[t],"int32")},e.prototype.clip=function(t,e,r){var n,o=(n=ge().getBool("WEBGL_PACK_CLIP")?new cs(t.shape):new ls(t.shape)).getCustomSetupFunc(e,r);return this.compileAndRun(n,[t],null,o)},e.prototype.abs=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.abs(t);if(ge().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,Xu,t.dtype);var e=new Gu(t.shape,Xu);return this.compileAndRun(e,[t])},e.prototype.complexAbs=function(t){var e=this.texData.get(t.dataId),r=new ps(t.shape),n=[this.makeComplexComponentTensorInfo(t,e.complexTensors.real),this.makeComplexComponentTensorInfo(t,e.complexTensors.imag)];return this.compileAndRun(r,n)},e.prototype.sigmoid=function(t){var e=new Gu(t.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(e,[t])},e.prototype.softplus=function(t){var e=new Gu(t.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(e,[t])},e.prototype.sin=function(t){var e=new Gu(t.shape,"if (isnan(x)) return x;\n  return sin(x);\n");return this.compileAndRun(e,[t])},e.prototype.cos=function(t){var e=new Gu(t.shape,"if (isnan(x)) return x;\n  return cos(x);\n");return this.compileAndRun(e,[t])},e.prototype.tan=function(t){var e=new Gu(t.shape,"return tan(x);");return this.compileAndRun(e,[t])},e.prototype.asin=function(t){var e=new Gu(t.shape,"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n");return this.compileAndRun(e,[t])},e.prototype.acos=function(t){var e=new Gu(t.shape,"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n");return this.compileAndRun(e,[t])},e.prototype.atan=function(t){var e=new Gu(t.shape,"if (isnan(x)) return x;\n  return atan(x);\n");return this.compileAndRun(e,[t])},e.prototype.atan2=function(t,e){var r=ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new us("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new is("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",t.shape,e.shape);return this.compileAndRun(r,[t,e])},e.prototype.sinh=function(t){var e=new Gu(t.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(e,[t])},e.prototype.cosh=function(t){var e=new Gu(t.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(e,[t])},e.prototype.tanh=function(t){var e=new Gu(t.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(e,[t])},e.prototype.asinh=function(t){var e=new Gu(t.shape,"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(e,[t])},e.prototype.acosh=function(t){var e=new Gu(t.shape,"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));");return this.compileAndRun(e,[t])},e.prototype.atanh=function(t){var e=new Gu(t.shape,"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;");return this.compileAndRun(e,[t])},e.prototype.erf=function(t){var e=new Gu(t.shape,'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n');return this.compileAndRun(e,[t])},e.prototype.step=function(t,e){var r=new Gu(t.shape,function(t){return void 0===t&&(t=0),$u+"\n    return x > 0.0 ? 1.0 : float("+t+");\n  "}(e));return this.compileAndRun(r,[t])},e.prototype.conv2dByMatMul=function(t,e,r,n,o,a){var i=t.shape,s=this.texData.get(t.dataId),u=r.inChannels,l=i[0]*i[1]*i[2],c=r.outChannels,p="channelsLast"===r.dataFormat,d=(1===l||1===c)&&u>1e3,h=i[2]%2!=0&&!!s.isPacked;if(d||!ge().getBool("WEBGL_LAZILY_UNPACK")||!ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!h){var f=p?i[0]*i[1]*i[2]:i[0]*i[2]*i[3],m=this.reshape(t,[1,f,r.inChannels]),g=this.reshape(e,[1,r.inChannels,r.outChannels]);return this.reshape(this.fusedBatchMatMul({a:m,b:g,transposeA:!1,transposeB:!1,bias:n,activation:o,preluActivationWeights:a}),r.outShape)}var v=p?i[0]*i[1]*(i[2]+1):i[0]*i[2]*(i[3]+1),b={dataId:t.dataId,shape:[1,v,r.inChannels],dtype:t.dtype},y=s.shape;s.shape=s.shape.slice(),s.shape[s.shape.length-2]++,Ie(Pn(s.shape,b.shape),function(){return"packed reshape "+s.shape+" to "+b.shape+" isn't free"});var x=this.reshape(e,[1,r.inChannels,r.outChannels]),w=this.fusedBatchMatMul({a:b,b:x,transposeA:!1,transposeB:!1,bias:n,activation:o,preluActivationWeights:a}),k=this.texData.get(w.dataId);return Ie(k.isPacked,function(){return"batchMatMul result is expected to be packed"}),s.shape=y,k.shape=r.outShape,Vr.makeTensorFromDataId(w.dataId,r.outShape,w.dtype)},e.prototype.conv2dWithIm2Row=function(t,e,r,n,o,a){var i=r.filterWidth,s=r.filterHeight,u=r.inChannels,l=r.outWidth,c=r.outHeight,p="channelsLast"===r.dataFormat,d=i*s*u,h=c*l,f=[d,h],m=t.squeeze([0]),g=e.reshape([1,d,-1]),v=new uu(f,m.shape,r),b=this.compileAndRun(v,[m]).reshape([1,f[0],f[1]]),y=null!=n,x=null!=a,w=o?dl(o,!0):null,k=new fu(b.shape,[1,h,r.outChannels],!0,!1,y,w,x),C=[b,g];n&&C.push(n),x&&C.push(a);var S=this.compileAndRun(k,C);return p?S.reshape([1,c,l,r.outChannels]):S.reshape([1,r.outChannels,c,l])},e.prototype.fusedConv2d=function(t){var e=t.input,r=t.filter,n=t.convInfo,o=t.bias,a=t.activation,i=t.preluActivationWeights;if(1===n.filterHeight&&1===n.filterWidth&&1===n.dilationHeight&&1===n.dilationWidth&&1===n.strideHeight&&1===n.strideWidth&&("SAME"===n.padInfo.type||"VALID"===n.padInfo.type))return this.conv2dByMatMul(e,r,n,o,a,i);if(ge().getBool("WEBGL_CONV_IM2COL")&&1===e.shape[0])return this.conv2dWithIm2Row(e,r,n,o,a,i);var s=null!=o,u=null!=i,l=a?dl(a,!1):null,c=new ws(n,s,l,u),p=[e,r];return o&&p.push(o),i&&p.push(i),this.compileAndRun(c,p)},e.prototype.conv2d=function(t,e,r){if(1===r.filterHeight&&1===r.filterWidth&&1===r.dilationHeight&&1===r.dilationWidth&&1===r.strideHeight&&1===r.strideWidth&&("SAME"===r.padInfo.type||"VALID"===r.padInfo.type))return this.conv2dByMatMul(t,e,r);if(ge().getBool("WEBGL_CONV_IM2COL")&&1===t.shape[0])return this.conv2dWithIm2Row(t,e,r);var n=new ws(r);return this.compileAndRun(n,[t,e])},e.prototype.conv2dDerInput=function(t,e,r){var n=new gs(r);return this.compileAndRun(n,[t,e])},e.prototype.conv2dDerFilter=function(t,e,r){var n=new ms(r);return this.compileAndRun(n,[t,e])},e.prototype.fusedDepthwiseConv2D=function(t){var e,r=t.input,n=t.filter,o=t.convInfo,a=t.bias,i=t.activation,s=t.preluActivationWeights,u=ge().getBool("WEBGL_PACK_DEPTHWISECONV")&&o.strideWidth<=2&&o.outChannels/o.inChannels==1,l=i?dl(i,u):null,c=[r,n],p=null!=a,d=null!=s;return p&&c.push(a),d&&c.push(s),u?(e=new Ss(o,p,l,d),this.compileAndRun(e,c)):(e=new Cs(o,p,l,d),this.compileAndRun(e,c))},e.prototype.depthwiseConv2D=function(t,e,r){var n;return ge().getBool("WEBGL_PACK_DEPTHWISECONV")&&r.strideWidth<=2&&r.outChannels/r.inChannels==1?(n=new Ss(r),this.compileAndRun(n,[t,e])):(n=new Cs(r),this.compileAndRun(n,[t,e]))},e.prototype.depthwiseConv2DDerInput=function(t,e,r){var n=new xs(r);return this.compileAndRun(n,[t,e])},e.prototype.depthwiseConv2DDerFilter=function(t,e,r){var n=new ys(r);return this.compileAndRun(n,[t,e])},e.prototype.conv3d=function(t,e,r){var n=new ks(r);return this.compileAndRun(n,[t,e])},e.prototype.conv3dDerInput=function(t,e,r){var n=new bs(r);return this.compileAndRun(n,[t,e])},e.prototype.conv3dDerFilter=function(t,e,r){var n=new vs(r);return this.compileAndRun(n,[t,e])},e.prototype.maxPool=function(t,e){var r=new xu(e,"max",!1);return this.compileAndRun(r,[t])},e.prototype.avgPool=function(t,e){var r=new xu(e,"avg",!1);return this.compileAndRun(r,[t],"float32")},e.prototype.maxPoolBackprop=function(t,e,r,n){var o=new xu(n,"max",!0),a=this.compileAndRun(o,[e]),i=new du(n),s=this.compileAndRun(i,[t,a],e.dtype);return a.dispose(),s},e.prototype.avgPoolBackprop=function(t,e,r){var n=new Ji(r);return this.compileAndRun(n,[t],e.dtype)},e.prototype.cast=function(t,e){return vi(t,e,this)},e.prototype.unstack=function(t,e){for(var r=t.shape[e],n=new Array(t.rank-1),o=0,a=0;a<t.rank;a++)a!==e&&(n[o++]=t.shape[a]);var i=new Array(t.rank).fill(0),s=t.shape.slice();s[e]=1;var u=new Array(r);for(a=0;a<u.length;a++)i[e]=a,u[a]=this.slice(t,i,s).reshape(n);return u},e.prototype.avgPool3d=function(t,e){var r=new wu(e,"avg",!1);return this.compileAndRun(r,[t],"float32")},e.prototype.avgPool3dBackprop=function(t,e,r){var n=new Zi(r);return this.compileAndRun(n,[t],e.dtype)},e.prototype.maxPool3d=function(t,e){var r=new wu(e,"max",!1);return this.compileAndRun(r,[t],"float32")},e.prototype.maxPool3dBackprop=function(t,e,r,n){var o=new wu(n,"max",!0),a=this.compileAndRun(o,[e]),i=new hu(n),s=this.compileAndRun(i,[t,a],e.dtype);return a.dispose(),s},e.prototype.reshape=function(t,e){var r=this.texData.get(t.dataId);if(r.isPacked&&!Pn(t.shape,e)&&(null===r.texture||!Pn(r.shape,e))){var n=this.packedReshape(t,e);return Vr.makeTensorFromDataId(n.dataId,n.shape,n.dtype)}return bi(t,e)},e.prototype.resizeBilinear=function(t,e,r,n){var o=ge().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new zu(t.shape,e,r,n):new Eu(t.shape,e,r,n);return this.compileAndRun(o,[t])},e.prototype.resizeBilinearBackprop=function(t,e,r){var n=new Su(t,e,r);return this.compileAndRun(n,[t])},e.prototype.resizeNearestNeighbor=function(t,e,r,n){var o=new Au(t.shape,e,r,n);return this.compileAndRun(o,[t])},e.prototype.resizeNearestNeighborBackprop=function(t,e,r){var n=new Iu(t,e,r);return this.compileAndRun(n,[t])},e.prototype.multinomial=function(t,e,r,n){var o=e?t:Ja(t),a=o.shape[0],i=o.shape[1],s=new mu(a,i,r),u=s.getCustomSetupFunc(n);return this.compileAndRun(s,[o],"int32",u)},e.prototype.oneHot=function(t,e,r,n){var o=new gu(t.size,e,r,n);return this.compileAndRun(o,[t])},e.prototype.diag=function(t){var e=new Ts(t.size);return this.compileAndRun(e,[t])},e.prototype.nonMaxSuppression=function(t,e,r,n,o){return ro("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),Ei(t.dataSync(),e.dataSync(),r,n,o)},e.prototype.cropAndResize=function(t,e,r,n,o,a){var i=new Es(t.shape,e.shape,n,o,a);return this.compileAndRun(i,[t,e,r])},e.prototype.depthToSpace=function(t,e,r){Ie(e>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+e});var n=t.shape[0],o="NHWC"===r?t.shape[1]:t.shape[2],a="NHWC"===r?t.shape[2]:t.shape[3],i="NHWC"===r?t.shape[3]:t.shape[1],s=o*e,u=a*e,l=i/(e*e),c=new Rs("NHWC"===r?[n,s,u,l]:[n,l,s,u],e,r);return this.compileAndRun(c,[t])},e.prototype.split=function(t,e,r){return Ii(t,e,r)},e.prototype.scatterND=function(t,e,r){var n=Ba(0,t,r),o=n.sliceRank,a=n.numUpdates,i=n.sliceSize,s=n.strides,u=n.outputSize,l=[u/i,i],c=t.reshape([a,o]),p=e.reshape([a,i]);if(0===u)return bi(ko([]),r);var d=So(0),h=new Tu(a,o,c.rank,p.rank,s,l);return this.compileAndRun(h,[p,c,d]).reshape(r)},e.prototype.sparseToDense=function(t,e,r,n){var o=Ba(0,t,r),a=o.sliceRank,i=o.numUpdates,s=o.strides,u=o.outputSize,l=new Tu(i,a,t.rank,e.rank,s,[u,1],!1);return this.compileAndRun(l,[e,t,n]).reshape(r)},e.prototype.fft=function(t){return this.fftImpl(t,!1)},e.prototype.ifft=function(t){return this.fftImpl(t,!0)},e.prototype.fftImpl=function(t,e){var r=this.texData.get(t.dataId),n=new Ms("return real * expR - imag * expI;",t.shape,e),o=new Ms("return real * expI + imag * expR;",t.shape,e),a=[this.makeComplexComponentTensorInfo(t,r.complexTensors.real),this.makeComplexComponentTensorInfo(t,r.complexTensors.imag)],i=this.compileAndRun(n,a),s=this.compileAndRun(o,a),u=this.complex(i,s).as2D(t.shape[0],t.shape[1]);return i.dispose(),s.dispose(),u},e.prototype.gatherND=function(t,e){var r=e.shape,n=r[r.length-1],o=Ma(t,e),a=o[0],i=o[1],s=o[2],u=o[3],l=e.reshape([i,n]),c=t.reshape([t.size/s,s]),p=new Vs(n,u,[i,s]);return this.compileAndRun(p,[c,l]).reshape(a)},e.prototype.fill=function(t,e,r){if("string"===(r=r||Ze(e))){var n=We(r,Te(t));return n.fill(e),Vr.makeTensor(n,t,r,this)}var o=new Ls(t,e),a=o.getCustomSetupFunc(e);return this.compileAndRun(o,[],r,a)},e.prototype.onesLike=function(t){if("string"===t.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){return this.fill(t.shape,"string"===t.dtype?"":0,t.dtype)},e.prototype.linspace=function(t,e,r){return yi(t,e,r)},e.prototype.makeTensorInfo=function(t,e){var r=this.write(null,t,e);return this.texData.get(r).usage=null,{dataId:r,shape:t,dtype:e}},e.prototype.makeOutput=function(t,e){var r=this.makeTensorInfo(t,e).dataId;return Vr.makeTensorFromDataId(r,t,e,this)},e.prototype.unpackTensor=function(t){var e=new cl(t.shape);return this.runWebGLProgram(e,[t],t.dtype)},e.prototype.packTensor=function(t){var e=new vu(t.shape);return this.runWebGLProgram(e,[t],t.dtype,null,!0)},e.prototype.packedReshape=function(t,e){var r=[_n(t.shape)].concat(On(t.shape)),n={dtype:t.dtype,shape:r,dataId:t.dataId},o=[_n(e)].concat(On(e)),a=new Cu(o,r),i=this.runWebGLProgram(a,[n],t.dtype,null,!0);return{dataId:i.dataId,shape:e,dtype:i.dtype}},e.prototype.decode=function(t){var e,r=this.texData.get(t),n=r.isPacked,o=r.shape,a=r.dtype,i=Fn(o);return e=n?new Ns(i):new As(i),{dtype:a,shape:o,dataId:this.runWebGLProgram(e,[{shape:i,dtype:a,dataId:t}],a,null,!0).dataId}},e.prototype.runWebGLProgram=function(t,e,r,n,o){var a=this;void 0===o&&(o=!1);var i=this.makeTensorInfo(t.outputShape,r),s=this.texData.get(i.dataId);if(t.packedOutput&&(s.isPacked=!0),t.outPackingScheme===jr.DENSE){var u=Qr(t.outputShape);s.texShape=u.map(function(t){return 2*t})}if(null!=t.outTexUsage&&(s.usage=t.outTexUsage),0===Te(i.shape))return s.values=Ve(i.dtype,0),i;var l=[],c=e.map(function(e){if("complex64"===e.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var r=a.texData.get(e.dataId);if(null==r.texture){if(!t.packedInputs&&Te(e.shape)<=ge().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:e.shape,texData:null,isUniform:!0,uniformValues:r.values};t.packedInputs&&(r.isPacked=!0,r.shape=e.shape)}else if(!!r.isPacked!=!!t.packedInputs)e=r.isPacked?a.unpackTensor(e):a.packTensor(e),l.push(e),r=a.texData.get(e.dataId);else if(r.isPacked&&!Pn(r.shape,e.shape)){var n=e,o=e.shape;e.shape=r.shape,e=a.packedReshape(e,o),l.push(e),r=a.texData.get(e.dataId),n.shape=o}return a.uploadToGPU(e.dataId),{shape:e.shape,texData:r,isUniform:!1}});this.uploadToGPU(i.dataId);var p,d={shape:i.shape,texData:s,isUniform:!1},h=function(t,e,r){var n="";c.concat(r).forEach(function(t){var e=null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0,r=t.isUniform?"uniform":t.texData.texShape;n+=t.shape+"_"+r+"_"+e});var o=t.userCode;return t.constructor.name+"_"+n+"_"+o}(t,0,d),f=this.getAndSaveBinary(h,function(){return function(t,e,r,n){var o=e.userCode,a=r.map(function(t,r){var n={logicalShape:t.shape,texShape:t.isUniform?null:t.texData.texShape,isUniform:t.isUniform,isPacked:!t.isUniform&&t.texData.isPacked,flatOffset:null};return null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0&&(n.flatOffset=t.texData.slice.flatOffset),{name:e.variableNames[r],shapeInfo:n}}),i=a.map(function(t){return t.shapeInfo}),s={logicalShape:n.shape,texShape:n.texData.texShape,isUniform:!1,isPacked:n.texData.isPacked,flatOffset:null},u=qi(a,s,o,e.packedInputs),l=t.createProgram(u),c=null,p=t.getUniformLocation(l,"NAN",!1);1===ge().getNumber("WEBGL_VERSION")&&(c=t.getUniformLocation(l,"INFINITY",!1));for(var d={},h=0;h<e.variableNames.length;h++){var f=e.variableNames[h];d[f]=t.getUniformLocation(l,f,!1),d["offset"+f]=t.getUniformLocation(l,"offset"+f,!1)}return{program:e,source:u,webGLProgram:l,uniformLocations:d,inShapeInfos:i,outShapeInfo:s,infLoc:c,nanLoc:p}}(a.gpgpu,t,c,d)}),m=null!=this.activeTimers;if(m&&(p=this.startTimer()),function(t,e,r,n,o){su(e.inShapeInfos,r),su([e.outShapeInfo],[n]);var a=n.texData.texture,i=n.texData.texShape;n.texData.isPacked?t.setOutputPackedMatrixTexture(a,i[0],i[1]):t.setOutputMatrixTexture(a,i[0],i[1]),t.setProgram(e.webGLProgram),1===ge().getNumber("WEBGL_VERSION")&&null!==e.infLoc&&t.gl.uniform1f(e.infLoc,1/0),null!==e.nanLoc&&t.gl.uniform1f(e.nanLoc,NaN),r.forEach(function(r,n){var o=e.program.variableNames[n],a=e.uniformLocations[o],i=e.uniformLocations["offset"+o];if(null!=a)if(r.isUniform)if(Te(r.shape)<2)t.gl.uniform1f(a,r.uniformValues[0]);else{var s=r.uniformValues;s instanceof Float32Array||(s=new Float32Array(s)),t.gl.uniform1fv(a,s)}else null!=r.texData.slice&&null!=i&&t.gl.uniform1i(i,r.texData.slice.flatOffset),t.setInputMatrixTexture(r.texData.texture,a,n)}),null!=o&&o(t,e.webGLProgram),t.executeProgram()}(this.gpgpu,f,c,d,n),l.forEach(function(t){return a.disposeData(t.dataId)}),m&&(p=this.endTimer(p),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(p)})),!ge().getBool("WEBGL_LAZILY_UNPACK")&&s.isPacked&&!1===o){var g=this.unpackTensor(i);return this.disposeData(i.dataId),g}return i},e.prototype.compileAndRun=function(t,e,r,n,o){void 0===o&&(o=!1),r=r||e[0].dtype;var a=this.runWebGLProgram(t,e,r,n,o);return Vr.makeTensorFromDataId(a.dataId,a.shape,a.dtype)},e.prototype.getAndSaveBinary=function(t,e){return t in this.binaryCache||(this.binaryCache[t]=e()),this.binaryCache[t]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){this.disposed||(this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,null!=this.fromPixels2DContext&&this.fromPixels2DContext.canvas.remove&&this.fromPixels2DContext.canvas.remove(),this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},e.prototype.floatPrecision=function(){var t=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=Zn(function(){if(!ge().get("WEBGL_RENDER_FLOAT32_ENABLED")){var e=ge().getBool("DEBUG");ge().set("DEBUG",!1);var r=t.abs(So(1e-8)).dataSync()[0];if(ge().set("DEBUG",e),r>0)return 32}return 16})),this.floatPrecisionValue},e.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},e.prototype.uploadToGPU=function(t){var e,r=this.texData.get(t),n=r.shape,o=r.dtype,a=r.values,i=r.texture,s=r.usage,u=r.isPacked;if(null==i){var l,c=null!=this.activeTimers;c&&(l=ir());var p=r.texShape;if(null==p&&(p=Mn(n,u),r.texShape=p),null!=a){var d=Fn(n),h=void 0,f=p[1],m=p[0],g=a instanceof Uint8Array;u?(f=(e=tn(p[0],p[1]))[0],m=e[1],h=new Fs(d,[m,f],g)):h=new Os(d,[m,f],g);var v=this.makeTensorInfo([m,f],o);this.texData.get(v.dataId).usage=g?Hr.PIXELS:Hr.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(v.dataId),f,m,a);var b=this.runWebGLProgram(h,[v],o,null,!0),y=this.texData.get(b.dataId);r.texture=y.texture,r.texShape=y.texShape,r.isPacked=y.isPacked,r.usage=y.usage,this.disposeData(v.dataId),this.texData.delete(b.dataId),r.values=null,c&&(this.uploadWaitMs+=ir()-l)}else{var x=this.acquireTexture(p,s,o,u);r.texture=x}}},e.prototype.convertAndCacheOnCPU=function(t,e){var r=this.texData.get(t),n=r.dtype;return this.releaseGPUData(t),null!=e&&(r.values=function(t,e){if("float32"===e||"complex64"===e)return t;if("int32"===e||"bool"===e){for(var r="int32"===e?new Int32Array(t.length):new Uint8Array(t.length),n=0;n<r.length;++n)r[n]=Math.round(t[n]);return r}throw new Error("Unknown dtype "+e)}(e,n)),r.values},e.prototype.acquireTexture=function(t,e,r,n){if(this.numBytesInGPU+=this.computeBytes(t,r),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+o+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(t,e,n)},e.prototype.computeBytes=function(t,e){return t[0]*t[1]*$e(e)},e}(ti);Wr()&&Vr.registerBackend("webgl",function(){return new fl},2);var ml=bo({square_:function(t){var e=ao(t,"x","square"),r=[e];return Vr.runKernelFunc(function(t,r){return r([e]),t.square(e)},{x:e},function(t,e){var r=e[0];return{x:function(){return t.mul(r.toFloat().mul(2))}}},"Square",{},r,[])}}),gl=bo({abs_:function(t){var e=ao(t,"x","abs");return"complex64"===e.dtype?Vr.runKernelFunc(function(t){return t.complexAbs(e)},{$x:e}):Vr.runKernelFunc(function(t,r){var n=t.abs(e);return r([e]),n},{x:e},function(t,e){var r=e[0];return{x:function(){return t.mul(r.toFloat().step(-1))}}},"Abs")}}),vl=bo({acos_:function(t){var e=ao(t,"x","acos");return Vr.runKernelFunc(function(t,r){var n=t.acos(e);return r([e]),n},{$x:e},function(t,e){var r=e[0];return{$x:function(){return t.divStrict(So(1).sub(r.toFloat().square()).sqrt()).neg()}}})}}),bl=bo({acosh_:function(t){var e=ao(t,"x","acosh");return Vr.runKernelFunc(function(t,r){var n=t.acosh(e);return r([e]),n},{$x:e},function(t,e){var r=e[0];return{$x:function(){return t.divStrict(r.toFloat().square().sub(1).sqrt())}}})}}),yl=bo({asin_:function(t){var e=ao(t,"x","asin");return Vr.runKernelFunc(function(t,r){var n=t.asin(e);return r([e]),n},{$x:e},function(t,e){var r=e[0];return{$x:function(){return t.divStrict(So(1).sub(r.toFloat().square()).sqrt())}}})}}),xl=bo({asinh_:function(t){var e=ao(t,"x","asinh");return Vr.runKernelFunc(function(t,r){var n=t.asinh(e);return r([e]),n},{$x:e},function(t,e){var r=e[0];return{$x:function(){return t.divStrict(So(1).add(r.toFloat().square()).sqrt())}}})}}),wl=bo({atan_:function(t){var e=ao(t,"x","atan");return Vr.runKernelFunc(function(t,r){var n=t.atan(e);return r([e]),n},{$x:e},function(t,e){var r=e[0];return{$x:function(){return t.div(r.toFloat().square().add(1))}}})}}),kl=bo({atanh_:function(t){var e=ao(t,"x","atanh");return Vr.runKernelFunc(function(t,r){var n=t.atanh(e);return r([e]),n},{$x:e},function(t,e){var r=e[0];return{$x:function(){return t.div(So(1).sub(r.toFloat().square()))}}})}}),Cl=bo({ceil_:function(t){var e=ao(t,"x","ceil");return Vr.runKernelFunc(function(t){return t.ceil(e)},{$x:e},function(t){return{$x:function(){return Po(t)}}})}}),Sl=bo({clipByValue_:function(t,e,r){var n=ao(t,"x","clipByValue");return Ie(e<=r,function(){return"Error in clip: min ("+e+") must be less than or equal to max ("+r+")."}),Vr.runKernelFunc(function(t,o){var a=t.clip(n,e,r);return o([n]),a},{$x:n},function(t,n){var o=n[0];return{$x:function(){return t.where(o.greaterEqual(e).logicalAnd(o.lessEqual(r)),Po(t))}}})}}),El=bo({cos_:function(t){var e=ao(t,"x","cos");return Vr.runKernelFunc(function(t,r){var n=t.cos(e);return r([e]),n},{$x:e},function(t,e){var r=e[0];return{$x:function(){return r.toFloat().sin().neg().mul(t)}}})}}),zl=bo({cosh_:function(t){var e=ao(t,"x","cosh");return Vr.runKernelFunc(function(t,r){var n=t.cosh(e);return r([e]),n},{$x:e},function(t,e){var r=e[0];return{$x:function(){return r.toFloat().sinh().mulStrict(t)}}})}}),Il=bo({erf_:function(t){var e=ao(t,"x","erf");return Ie("int32"===e.dtype||"float32"===e.dtype,function(){return"Input dtype must be `int32` or `float32`."}),"int32"===e.dtype&&(e=e.toFloat()),Vr.runKernelFunc(function(t,r){var n=t.erf(e);return r([e]),n},{$x:e},function(t,e){var r=e[0];return{$x:function(){return t.mul(r.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),Al=bo({exp_:function(t){var e=ao(t,"x","exp");return Vr.runKernelFunc(function(t,r){var n=t.exp(e);return r([n]),n},{$x:e},function(t,e){return{$x:function(){return t.mulStrict(e[0])}}})}}),Nl=bo({expm1_:function(t){var e=ao(t,"x","expm1");return Vr.runKernelFunc(function(t,r){var n=t.expm1(e);return r([e]),n},{$x:e},function(t,e){var r=e[0];return{$x:function(){return t.mul(r.exp())}}})}}),Rl=bo({floor_:function(t){var e=ao(t,"x","floor");return Vr.runKernelFunc(function(t){return t.floor(e)},{$x:e},function(t){return{$x:function(){return Po(t)}}})}}),Tl=bo({log_:function(t){var e=ao(t,"x","log");return Vr.runKernelFunc(function(t,r){var n=t.log(e);return r([e]),n},{$x:e},function(t,e){var r=e[0];return{$x:function(){return t.div(r.toFloat())}}})}}),Dl=bo({log1p_:function(t){var e=ao(t,"x","log1p");return Vr.runKernelFunc(function(t,r){var n=t.log1p(e);return r([e]),n},{$x:e},function(t,e){var r=e[0];return{$x:function(){return t.div(r.add(1))}}})}}),_l=bo({logSigmoid_:function(t){var e=ao(t,"x","logSigmoid");return Vr.runKernelFunc(function(t,r){var n=t.softplus(e.neg()).neg();return r([e]),n},{$x:e},function(t,e){var r=e[0];return{$x:function(){return t.mul(r.neg().sigmoid())}}})}}),Ol=bo({neg_:function(t){var e=ao(t,"x","neg");return Vr.runKernelFunc(function(t){return t.neg(e)},{$x:e},function(t){return{$x:function(){return t.neg()}}})}}),Fl=bo({reciprocal_:function(t){var e=ao(t,"x","reciprocal");return Vr.runKernelFunc(function(t,r){var n=t.reciprocal(e);return r([e]),n},{$x:e},function(t,e){var r=e[0];return{$x:function(){return t.div(r.square().neg())}}})}}),Ml=bo({round_:function(t){var e=ao(t,"x","round");return Vr.runKernelFunc(function(t){return t.round(e)},{$x:e},function(t){return{$x:function(){return Po(t)}}})}}),Ll=bo({rsqrt_:function(t){var e=ao(t,"x","rsqrt");return Vr.runKernelFunc(function(t,r){var n=t.rsqrt(e);return r([e]),n},{$x:e},function(t,e){var r=e[0];return{$x:function(){return t.div(r.pow(1.5).mul(2)).neg()}}})}}),Pl=bo({sigmoid_:function(t){var e=ao(t,"x","sigmoid");return Vr.runKernelFunc(function(t,r){var n=t.sigmoid(e);return r([n]),n},{x:e},function(t,e){var r=e[0];return{x:function(){return t.mul(r.mul(So(1).sub(r)))}}},"Sigmoid")}}),Bl=bo({sign_:function(t){var e=ao(t,"x","sign");return Vr.runKernelFunc(function(t){return t.sign(e)},{$x:e},function(t){return{$x:function(){return Po(t)}}})}}),ql=bo({isNaN_:function(t){var e=ao(t,"x","isNaN");return Vr.runKernelFunc(function(t){return t.isNaN(e)},{$x:e},function(t){return{$x:function(){return Po(t)}}})}}),Vl=bo({isInf_:function(t){var e=ao(t,"x","isInf");return Vr.runKernelFunc(function(t){return t.isInf(e)},{$x:e},function(t){return{$x:function(){return Po(t)}}})}}),Wl=bo({isFinite_:function(t){var e=ao(t,"x","isFinite");return Vr.runKernelFunc(function(t){return t.isFinite(e)},{$x:e},function(t){return{$x:function(){return Po(t)}}})}}),Ul=bo({sin_:function(t){var e=ao(t,"x","sin");return Vr.runKernelFunc(function(t,r){var n=t.sin(e);return r([e]),n},{$x:e},function(t,e){var r=e[0];return{$x:function(){return r.toFloat().cos().mul(t)}}})}}),jl=bo({sinh_:function(t){var e=ao(t,"x","sinh");return Vr.runKernelFunc(function(t,r){var n=t.sinh(e);return r([e]),n},{$x:e},function(t,e){var r=e[0];return{$x:function(){return r.toFloat().cosh().mulStrict(t)}}})}}),Hl=bo({softplus_:function(t){var e=ao(t,"x","softplus");return Vr.runKernelFunc(function(t,r){var n=t.softplus(e);return r([e]),n},{$x:e},function(t,e){var r=e[0];return{$x:function(){return t.mul(r.sigmoid())}}})}}),Gl=bo({sqrt_:function(t){var e=ao(t,"x","sqrt");return Vr.runKernelFunc(function(t,r){var n=t.sqrt(e);return r([e]),n},{$x:e},function(t,e){var r=e[0];return{$x:function(){return t.div(r.toFloat().sqrt().mul(2))}}})}}),$l=bo({step_:function(t,e){void 0===e&&(e=0);var r=ao(t,"x","step");return Vr.runKernelFunc(function(t){return t.step(r,e)},{$x:r},function(t){return{$x:function(){return Po(t)}}})}}),Kl=bo({tan_:function(t){var e=ao(t,"x","tan");return Vr.runKernelFunc(function(t,r){var n=t.tan(e);return r([e]),n},{$x:e},function(t,e){var r=e[0];return{$x:function(){return t.div(r.cos().square())}}})}}),Xl=bo({tanh_:function(t){var e=ao(t,"x","tanh");return Vr.runKernelFunc(function(t,r){var n=t.tanh(e);return r([n]),n},{$x:e},function(t,e){var r=e[0];return{$x:function(){return So(1).sub(r.square()).mulStrict(t)}}})}});function Yl(t,e,r,n,o,a){var i,s,u=ao(t,"x","batchNorm"),l=ao(e,"mean","batchNorm"),c=ao(r,"variance","batchNorm");return null!=o&&(i=ao(o,"scale","batchNorm")),null!=n&&(s=ao(n,"offset","batchNorm")),Ie(2===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),Ie(2===l.rank||1===l.rank,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+l.rank+"."}),Ie(2===c.rank||1===c.rank,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+c.rank+"."}),null!=i&&Ie(2===i.rank||1===i.rank,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+i.rank+"."}),null!=s&&Ie(2===s.rank||1===s.rank,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."}),Ql(u,l,c,s,i,a)}function Jl(t,e,r,n,o,a){var i,s,u=ao(t,"x","batchNorm"),l=ao(e,"mean","batchNorm"),c=ao(r,"variance","batchNorm");return null!=o&&(i=ao(o,"scale","batchNorm")),null!=n&&(s=ao(n,"offset","batchNorm")),Ie(3===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),Ie(3===l.rank||1===l.rank,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+l.rank+"."}),Ie(3===c.rank||1===c.rank,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+c.rank+"."}),null!=i&&Ie(3===i.rank||1===i.rank,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+i.rank+"."}),null!=s&&Ie(3===s.rank||1===s.rank,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."}),Ql(u,l,c,s,i,a)}function Zl(t,e,r,n,o,a){var i,s,u=ao(t,"x","batchNorm"),l=ao(e,"mean","batchNorm"),c=ao(r,"variance","batchNorm");return null!=o&&(i=ao(o,"scale","batchNorm")),null!=n&&(s=ao(n,"offset","batchNorm")),Ie(4===u.rank,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),Ie(4===l.rank||1===l.rank,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+l.rank+"."}),Ie(4===c.rank||1===c.rank,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+c.rank+"."}),null!=i&&Ie(4===i.rank||1===i.rank,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+i.rank+"."}),null!=s&&Ie(4===s.rank||1===s.rank,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."}),Ql(u,l,c,s,i,a)}function Ql(t,e,r,n,o,a){null==a&&(a=.001);var i,s,u,l=ao(t,"x","batchNorm"),c=ao(e,"mean","batchNorm"),p=ao(r,"variance","batchNorm");null!=o&&(i=ao(o,"scale","batchNorm")),null!=n&&(s=ao(n,"offset","batchNorm")),Ie(c.rank===p.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),Ie(null==s||c.rank===s.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),Ie(null==i||c.rank===i.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),u=0===l.rank||1===l.rank?l.as4D(1,1,1,l.size):2===l.rank?l.as4D(1,1,l.shape[0],l.shape[1]):3===l.rank?l.as4D(1,l.shape[0],l.shape[1],l.shape[2]):l;var d=[l,c,p,i];return Vr.runKernelFunc(function(t,e){var r=t.batchNormalization(u,tc(c),tc(p),a,tc(i),tc(s));return e([l,c,p,i]),r},{x:l,mean:c,variance:p,scale:i,offset:s},function(t,e){var r=e,n=r[0],o=r[1],i=r[2],s=r[3],l=null==s?So(1):s,c=ni(o.shape,u.shape),p=[];if(1===o.rank){for(var d=0;d<u.shape.length-1;++d)p.push(u.shape[d]);p.push(1)}var h=n.sub(o),f=t.mul(l),m=Ll(i.add(So(a))),g=m.mul(m).mul(m).mul(So(-.5));return{x:function(){return 1===o.rank?t.mul(Ia(m.as4D(1,1,1,o.shape[0]),p)).mul(l).reshape(n.shape):t.mul(m).mul(l).reshape(n.shape)},mean:function(){var t=m.mul(So(-1)).mul(f);return 1===o.rank&&(t=t.sum(c)),t.reshape(o.shape)},variance:function(){var t=g.mul(h).mul(f);return 1===o.rank&&(t=t.sum(c)),t.reshape(o.shape)},scale:function(){var e=h.mul(m),r=t.mul(e);return 1===o.rank&&(r=r.sum(c)),r.reshape(o.shape)},offset:function(){var e=t;return 1===o.rank&&(e=e.sum(c)),e.reshape(o.shape)}}},"BatchNormalization",{varianceEpsilon:a},d).reshape(l.shape)}function tc(t){return null==t?null:0===t.rank?t.as1D():1===t.rank?t:2===t.rank?t.as4D(1,1,t.shape[0],t.shape[1]):3===t.rank?t.as4D(1,t.shape[0],t.shape[1],t.shape[2]):t}function ec(){Yn("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var rc=bo({batchNormalization2d_:function(t,e,r,n,o,a){return void 0===n&&(n=.001),ec(),Yl(t,e,r,a,o,n)}}),nc=bo({batchNormalization3d_:function(t,e,r,n,o,a){return void 0===n&&(n=.001),ec(),Jl(t,e,r,a,o,n)}}),oc=bo({batchNormalization4d_:function(t,e,r,n,o,a){return void 0===n&&(n=.001),ec(),Zl(t,e,r,a,o,n)}}),ac=bo({batchNormalization_:function(t,e,r,n,o,a){return void 0===n&&(n=.001),ec(),Ql(t,e,r,a,o,n)}}),ic=bo({batchNorm_:Ql}),sc=bo({batchNorm2d_:Yl}),uc=bo({batchNorm3d_:Jl}),lc=bo({batchNorm4d_:Zl}),cc=bo({logicalAnd_:function(t,e){var r=ao(t,"a","logicalAnd","bool"),n=ao(e,"b","logicalAnd","bool");return oi(r.shape,n.shape),Vr.runKernelFunc(function(t){return t.logicalAnd(r,n)},{$a:r,$b:n})}}),pc=bo({logicalNot_:function(t){var e=ao(t,"x","logicalNot","bool");return Vr.runKernelFunc(function(t){return t.logicalNot(e)},{$x:e})}}),dc=bo({logicalOr_:function(t,e){var r=ao(t,"a","logicalOr","bool"),n=ao(e,"b","logicalOr","bool");return oi(r.shape,n.shape),Vr.runKernelFunc(function(t){return t.logicalOr(r,n)},{$a:r,$b:n})}}),hc=bo({logicalXor_:function(t,e){var r=ao(t,"a","logicalXor","bool"),n=ao(e,"b","logicalXor","bool");return oi(r.shape,n.shape),dc(t,e).logicalAnd(cc(t,e).logicalNot())}}),fc=bo({where_:function(t,e,r){var n=ao(e,"a","where"),o=ao(r,"b","where"),a=ao(t,"condition","where","bool");return Ae(n.shape,o.shape,"Error in where: "),1===a.rank?Ie(a.shape[0]===n.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):Ae(a.shape,o.shape,"Error in where: "),Vr.runKernelFunc(function(t,e){var r=t.select(a,n,o);return e([a]),r},{$condition:a,$a:n,$b:o},function(t,e){var r=e[0];return{$condition:function(){return Po(r).toFloat()},$a:function(){return t.mul(r.cast(t.dtype))},$b:function(){return t.mul(r.logicalNot().cast(t.dtype))}}})}}),mc=function(t){return he(this,void 0,void 0,function(){var e,r,n;return fe(this,function(o){switch(o.label){case 0:return[4,(e=ao(t,"condition","whereAsync","bool")).data()];case 1:return r=o.sent(),n=Ri(e.shape,r),t!==e&&e.dispose(),[2,n]}})})},gc=bo({add_:function(t,e){var r,n=ao(t,"a","add"),o=ao(e,"b","add");r=Or(n,o),n=r[0],o=r[1];var a=oi(n.shape,o.shape);return Vr.runKernelFunc(function(t){return t.add(n,o)},{a:n,b:o},function(t){return{a:function(){var e=t,r=ni(n.shape,a);return r.length>0&&(e=e.sum(r)),e.reshape(n.shape)},b:function(){var e=t,r=ni(o.shape,a);return r.length>0&&(e=e.sum(r)),e.reshape(o.shape)}}},"Add")}}),vc=bo({addN_:function(t){Ie(Array.isArray(t),function(){return"The argument passed to tf.addN() must be a list of tensors"}),Ie(t.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+t.length});var e=t.map(function(t,e){return ao(t,"tensors"+e,"addN")}),r=e[0];e.forEach(function(t){if(t.dtype!==r.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(t){if(!De(t.shape,r.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var n=e;return Vr.runKernelFunc(function(t){return t.addN(e)},n,function(t){var r={};return e.forEach(function(e,n){r[n]=function(){return t.clone()}}),r})}}),bc=bo({addStrict_:function(t,e){var r=ao(t,"a","addStrict"),n=ao(e,"b","addStrict");return Ae(r.shape,n.shape,"Error in addStrict: "),r.add(n)}}),yc=bo({atan2_:function(t,e){var r,n=ao(t,"a","atan2"),o=ao(e,"b","atan2");r=Or(n,o),n=r[0],o=r[1];var a=oi(n.shape,o.shape);return Vr.runKernelFunc(function(t,e){var r=t.atan2(n,o);return e([n,o]),r},{$a:n,$b:o},function(t,e){var r=e[0],n=e[1];return{$a:function(){var e=gc(r.square(),n.square()),o=t.mul(n.div(e)),i=ni(r.shape,a);return i.length>0&&(o=o.sum(i)),o.reshape(r.shape)},$b:function(){var e=gc(r.square(),n.square()),o=Ol(t.mul(r.div(e))),i=ni(n.shape,a);return i.length>0&&(o=o.sum(i)),o.reshape(n.shape)}}})}}),xc=bo({div_:function(t,e){var r,n=ao(t,"a","div"),o=ao(e,"b","div");if(r=Or(n,o),n=r[0],o=r[1],"int32"===n.dtype&&"int32"===o.dtype)return Cc(n,o);var a=oi(n.shape,o.shape);return Vr.runKernelFunc(function(t,e){var r=t.realDivide(n,o);return e([n,o]),r},{a:n,b:o},function(t,e){var r=e[0],n=e[1];return{a:function(){var e=t.div(n.toFloat()),o=ni(r.shape,a);return o.length>0?e.sum(o).reshape(r.shape):e},b:function(){var e=t.mul(r.toFloat()),o=ni(n.shape,a);o.length>0&&(e=e.sum(o).reshape(n.shape));var i=n.square();return e.div(i.toFloat()).neg()}}},"Div")}}),wc=bo({divNoNan_:function(t,e){var r,n=ao(t,"a","div"),o=ao(e,"b","div");n=(r=Or(n,o))[0],o=r[1];var a=xc(n,o),i=Po(a),s=o.equal(i);return fc(s,i,a)}}),kc=bo({divStrict_:function(t,e){var r=ao(t,"a","div"),n=ao(e,"b","div");return Ae(r.shape,n.shape,"Error in divideStrict: "),r.div(n)}}),Cc=bo({floorDiv_:function(t,e){var r,n=ao(t,"a","floorDiv"),o=ao(e,"b","floorDiv");r=Or(n,o),n=r[0],o=r[1];var a=oi(n.shape,o.shape);return Vr.runKernelFunc(function(t,e){var r=t.floorDiv(n,o);return e([n,o]),r},{$a:n,$b:o},function(t,e){var r=e[0],n=e[1];return{$a:function(){var e=t.div(n.toFloat()),o=ni(r.shape,a);return o.length>0?e.sum(o).reshape(r.shape):e},$b:function(){var e=t.mul(r.toFloat()),o=ni(n.shape,a);o.length>0&&(e=e.sum(o).reshape(n.shape));var i=n.square();return e.div(i.toFloat()).neg()}}})}}),Sc=bo({maximum_:function(t,e){var r,n=ao(t,"a","maximum"),o=ao(e,"b","maximum");return r=Or(n,o),n=r[0],o=r[1],"bool"===n.dtype&&(n=n.toInt(),o=o.toInt()),oi(n.shape,o.shape),Vr.runKernelFunc(function(t,e){var r=t.maximum(n,o);return e([n,o]),r},{$a:n,$b:o},function(t,e){var r=e[0],n=e[1];return{$a:function(){return t.mul(r.greaterEqual(n).toFloat())},$b:function(){return t.mul(r.less(n).toFloat())}}})}}),Ec=bo({maximumStrict_:function(t,e){var r=ao(t,"a","maximumStrict"),n=ao(e,"b","maximumStrict");return Ae(r.shape,n.shape,"Error in maximumStrict: "),r.maximum(n)}}),zc=bo({minimum_:function(t,e){var r,n=ao(t,"a","minimum"),o=ao(e,"b","minimum");return r=Or(n,o),n=r[0],o=r[1],"bool"===n.dtype&&(n=n.toInt(),o=o.toInt()),oi(n.shape,o.shape),Vr.runKernelFunc(function(t,e){var r=t.minimum(n,o);return e([n,o]),r},{$a:n,$b:o},function(t,e){var r=e[0],n=e[1];return{$a:function(){return t.mul(r.lessEqual(n).toFloat())},$b:function(){return t.mul(r.greater(n).toFloat())}}})}}),Ic=bo({minimumStrict_:function(t,e){var r=ao(t,"a","minimumStrict"),n=ao(e,"b","minimumStrict");return Ae(r.shape,n.shape,"Error in minimumStrict: "),r.minimum(n)}}),Ac=bo({mod_:function(t,e){var r,n=ao(t,"a","mod"),o=ao(e,"b","mod");r=Or(n,o),n=r[0],o=r[1];var a=oi(n.shape,o.shape);return Vr.runKernelFunc(function(t,e){var r=t.mod(n,o);return e([n,o]),r},{$a:n,$b:o},function(t,e){var r=e[0],n=e[1];return{$a:function(){var e=ni(r.shape,a);return e.length>0?t.sum(e).reshape(r.shape):t},$b:function(){var e=t.mul(r.div(n).floor().neg()),o=ni(n.shape,a);return o.length>0?e.sum(o).reshape(n.shape):e}}})}}),Nc=bo({modStrict_:function(t,e){var r=ao(t,"a","modStrict"),n=ao(e,"b","modStrict");return Ae(r.shape,n.shape,"Error in modStrict: "),r.mod(n)}}),Rc=bo({mul_:function(t,e){var r,n=ao(t,"a","mul"),o=ao(e,"b","mul");r=Or(n,o),n=r[0],o=r[1];var a=oi(n.shape,o.shape);return Vr.runKernelFunc(function(t,e){var r=t.multiply(n,o);return e([n,o]),r},{a:n,b:o},function(t,e){var r=e[0],n=e[1];return{a:function(){var e=t.mul(n.toFloat()),o=ni(r.shape,a);return o.length>0?e.sum(o).reshape(r.shape):e},b:function(){var e=t.mul(r.toFloat()),o=ni(n.shape,a);return o.length>0?e.sum(o).reshape(n.shape):e}}},"Mul")}}),Tc=bo({mulStrict_:function(t,e){var r=ao(t,"a","mul"),n=ao(e,"b","mul");return Ae(r.shape,n.shape,"Error in multiplyStrict: "),r.mul(n)}}),Dc=bo({pow_:function(t,e){var r=ao(t,"base","pow"),n=ao(e,"exp","pow"),o=oi(r.shape,n.shape);return t=r.cast(Dr(r.dtype,n.dtype)),e=n.cast(Dr(r.dtype,n.dtype)),Vr.runKernelFunc(function(t,e){var o=t.pow(r,n);return e([r,n,o]),o},{$base:r,$exp:n},function(t,e){var r=e[0],n=e[1],a=e[2];return{$base:function(){var e=n.toFloat(),a=t.mul(e.mul(r.pow(e.sub(So(1))))),i=ni(r.shape,o);return i.length>0&&(a=a.sum(i)),a.reshape(r.shape)},$exp:function(){var e=r.greater(0),i=r.log().where(e,Po(r)),s=t.mul(a.mul(i)),u=ni(n.shape,o);return u.length>0&&(s=s.sum(u)),s.reshape(n.shape)}}})}}),_c=bo({powStrict_:function(t,e){return Ae(t.shape,e.shape,"Error in powStrict: "),t.pow(e)}}),Oc=bo({squaredDifference_:function(t,e){var r,n=ao(t,"a","squaredDifference"),o=ao(e,"b","squaredDifference");return r=Or(n,o),n=r[0],o=r[1],oi(n.shape,o.shape),Vr.runKernelFunc(function(t,e){var r=t.squaredDifference(n,o);return e([n,o]),r},{$a:n,$b:o},function(t,e){var r=e[0],n=e[1],o=So(2);return{$a:function(){return t.mul(r.sub(n).mul(o))},$b:function(){return t.mul(n.sub(r).mul(o))}}})}}),Fc=bo({squaredDifferenceStrict_:function(t,e){var r=ao(t,"a","squaredDifferenceStrict"),n=ao(e,"b","squaredDifferenceStrict");return Ae(r.shape,n.shape,"Error in squaredDifferenceStrict: "),r.squaredDifference(n)}}),Mc=bo({sub_:function(t,e){var r,n=ao(t,"a","sub"),o=ao(e,"b","sub");r=Or(n,o),n=r[0],o=r[1];var a=oi(n.shape,o.shape);return Vr.runKernelFunc(function(t){return t.subtract(n,o)},{a:n,b:o},function(t){return{a:function(){var e=t,r=ni(n.shape,a);return r.length>0&&(e=e.sum(r)),e.reshape(n.shape)},b:function(){var e=t,r=ni(o.shape,a);return r.length>0&&(e=e.sum(r)),e.neg().reshape(o.shape)}}},"Sub")}}),Lc=bo({subStrict_:function(t,e){var r=ao(t,"a","subStrict"),n=ao(e,"b","subStrict");return Ae(r.shape,n.shape,"Error in subStrict: "),r.sub(n)}}),Pc=bo({equal_:function(t,e){var r,n=ao(t,"a","equal"),o=ao(e,"b","equal");return r=Or(n,o),n=r[0],o=r[1],oi(n.shape,o.shape),Vr.runKernelFunc(function(t){return t.equal(n,o)},{$a:n,$b:o})}}),Bc=bo({equalStrict_:function(t,e){var r=ao(t,"a","equalStrict"),n=ao(e,"b","equalStrict");return Ae(r.shape,n.shape,"Error in equalStrict: "),r.equal(n)}}),qc=bo({greater_:function(t,e){var r,n=ao(t,"a","greater"),o=ao(e,"b","greater");return r=Or(n,o),n=r[0],o=r[1],oi(n.shape,o.shape),Vr.runKernelFunc(function(t){return t.greater(n,o)},{$a:n,$b:o})}}),Vc=bo({greaterEqual_:function(t,e){var r,n=ao(t,"a","greaterEqual"),o=ao(e,"b","greaterEqual");return r=Or(n,o),n=r[0],o=r[1],oi(n.shape,o.shape),Vr.runKernelFunc(function(t,e){var r=t.greaterEqual(n,o);return e([n,o]),r},{$a:n,$b:o},function(t,e){var r=e[0],n=e[1];return{$a:function(){return Po(r)},$b:function(){return Po(n)}}})}}),Wc=bo({greaterEqualStrict_:function(t,e){var r=ao(t,"a","greaterEqualStrict"),n=ao(e,"b","greaterEqualStrict");return Ae(r.shape,n.shape,"Error in greaterEqualStrict: "),r.greaterEqual(n)}}),Uc=bo({greaterStrict_:function(t,e){var r=ao(t,"a","greaterStrict"),n=ao(e,"b","greaterStrict");return Ae(r.shape,n.shape,"Error in greaterStrict: "),r.greater(n)}}),jc=bo({less_:function(t,e){var r,n=ao(t,"a","less"),o=ao(e,"b","less");return r=Or(n,o),n=r[0],o=r[1],oi(n.shape,o.shape),Vr.runKernelFunc(function(t){return t.less(n,o)},{$a:n,$b:o})}}),Hc=bo({lessEqual_:function(t,e){var r,n=ao(t,"a","lessEqual"),o=ao(e,"b","lessEqual");return r=Or(n,o),n=r[0],o=r[1],oi(n.shape,o.shape),Vr.runKernelFunc(function(t){return t.lessEqual(n,o)},{$a:n,$b:o})}}),Gc=bo({lessEqualStrict_:function(t,e){var r=ao(t,"a","lessEqualStrict"),n=ao(e,"b","lessEqualStrict");return Ae(r.shape,n.shape,"Error in lessEqualStrict: "),r.lessEqual(n)}}),$c=bo({lessStrict_:function(t,e){var r=ao(t,"a","lessStrict"),n=ao(e,"b","lessStrict");return Ae(r.shape,n.shape,"Error in lessStrict: "),r.less(n)}}),Kc=bo({notEqual_:function(t,e){var r,n=ao(t,"a","notEqual"),o=ao(e,"b","notEqual");return r=Or(n,o),n=r[0],o=r[1],oi(n.shape,o.shape),Vr.runKernelFunc(function(t){return t.notEqual(n,o)},{$a:n,$b:o})}}),Xc=bo({notEqualStrict_:function(t,e){var r=ao(t,"a","notEqualStrict"),n=ao(e,"b","notEqualStrict");return Ae(r.shape,n.shape,"Error in notEqualStrict: "),r.notEqual(n)}});function Yc(t,e){for(var r=[],n=t;n<e;++n)r.push(n);return r}function Jc(t){for(var e=[],r=0;r<t.length;++r)for(var n=0;n<t[r].length;++n)e.push(t[r][n]);return e}var Zc=bo({gather_:function(t,e,r){void 0===r&&(r=0);var n=ao(t,"x","gather"),o=ao(e,"indices","gather","int32");r=Be(r,n.shape)[0];var a=function(t,e,r){for(var n=t.shape[r],o=[],a=1,i=1,s=0;s<r;s++)o.push(t.shape[s]),a*=t.shape[s];for(s=0;s<e.rank;s++)o.push(e.shape[s]);for(s=r+1;s<t.rank;s++)o.push(t.shape[s]),i*=t.shape[s];return{batchSize:a,sliceSize:i,dimSize:n,outputShape:o}}(n,o,r);return Vr.runKernelFunc(function(t,e){var a=t.gather(n,o.flatten(),r);return e([o]),a},{$x:n},function(t,e){var o=e[0];return{$x:function(){var e=n.shape,a=o.size,i=e.slice(0,r),s=i.length,u=e.slice(r,e.length).slice(1),l=u.length,c=Yc(0,s),p=Yc(s+1,s+1+l),d=Jc([i,[a],u]),h=t.reshape(d),f=o.reshape([a]),m=Jc([[s],c,p]),g=h.transpose(m),v=Qc(g,f,n.shape[r]),b=fo(m);return v.transpose(b)}}}).reshape(a.outputShape)}}),Qc=bo({unsortedSegmentSum_:function(t,e,r){var n=ao(t,"x","unsortedSegmentSum"),o=ao(e,"segmentIds","unsortedSegmentSum","int32");return Ie(_e(r),function(){return"numSegments must be of dtype int"}),Vr.runKernelFunc(function(t,e){var a=t.unsortedSegmentSum(n,o,r);return e([o]),a},{$x:n},function(t,e){var r=e[0];return{$x:function(){return function(t,e){for(var r=Sc(e,Po(e)),n=Zc(t,r),o=Vc(e,So(0,"int32")),a=n.rank-o.rank,i=0;i<a;++i)o=ca(o,i+1);o=cc(o,Do(n.shape,"bool"));var s=Po(n);return fc(o,n,s)}(t,r)}}})}}),tp=function(t,e,r){return he(this,void 0,void 0,function(){var n,o,a,i,s,u,l,c,p,d,h,f,m;return fe(this,function(g){switch(g.label){case 0:for(n=ao(t,"tensor","boolMask"),o=ao(e,"mask","boolMask","bool"),a=null==r?0:r,i=o.rank,s=n.shape,Ie(i>0,function(){return"mask cannot be scalar"}),Ae(s.slice(a,a+i),o.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,l=a;l<a+i;l++)u*=s[l];return c=s.slice(0,a).concat([u],s.slice(a+i)),p=n.reshape(c),d=o.reshape([-1]),[4,mc(d)];case 1:return h=g.sent(),f=h.squeeze([1]),m=Zc(p,f,a),t!==n&&n.dispose(),e!==o&&o.dispose(),f.dispose(),p.dispose(),d.dispose(),h.dispose(),[2,m]}})})};function ep(t,e,r,n,o,a,i){void 0===a&&(a="NHWC"),Ie(t.length===e.rank,function(){return"Length of inShape ("+t.length+") and rank of dy ("+e.rank+") must match"});var s=t,u=e,l=!1;3===e.rank&&(l=!0,u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),s=[1,t[0],t[1],t[2]]),Ie(4===s.length,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."}),Ie(4===u.rank,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank}),Ie(4===r.rank,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+r.rank});var c="NHWC"===a?s[3]:s[1],p="NHWC"===a?u.shape[3]:u.shape[1];Ie(c===r.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+c+") must match input depth for filter "+r.shape[2]+"."}),Ie(p===r.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+p+") must match output depth for filter "+r.shape[3]+"."}),null!=i&&Ie(_e(o),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var d=gi(a),h=si(s,r.shape,n,1,o,i,!1,d),f=Vr.runKernelFunc(function(t,e){var n=t.conv2dDerInput(u,r,h);return e([r,u]),n},{dy4D:u,filter:r},function(t,e){var r=e[0],s=e[1];return{dy4D:function(){return ap(t,r,n,o,a,1,i)},filter:function(){return sp(t,s,r.shape,n,o,a,i)}}});return l?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}function rp(t){var e=function(t){return"number"==typeof t?[t,t,t]:2===t.length?[t[0],t[1],1]:t}(t),r=e[0],n=e[1],o=e[2];return 1===r&&1===n&&1===o}function np(t,e,r,n,o){Ie(t.length===e.rank,function(){return"Length of inShape ("+t.length+") and rank of dy ("+e.rank+") must match"});var a=t,i=e,s=!1;4===e.rank&&(s=!0,i=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]),a=[1,t[0],t[1],t[2],t[3]]);var u=a[4],l=i.shape[4];Ie(5===a.length,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+a.length+"."}),Ie(5===i.rank,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+i.rank}),Ie(5===r.rank,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+r.rank}),Ie(u===r.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+r.shape[3]+"."}),Ie(l===r.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+l+") must match output depth for filter "+r.shape[4]+"."});var c=ui(a,r.shape,n,1,o),p=Vr.runKernelFunc(function(t){return t.conv3dDerInput(i,r,c)},{dy5D:i});return s?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}var op=bo({conv1d_:function(t,e,r,n,o,a,i){void 0===o&&(o="NWC"),void 0===a&&(a=1);var s=ao(t,"x","conv1d"),u=ao(e,"filter","conv1d"),l=s,c=!1;2===s.rank&&(c=!0,l=s.as3D(1,s.shape[0],s.shape[1])),Ie(3===l.rank,function(){return"Error in conv1d: input must be rank 3, but got rank "+l.rank+"."}),Ie(3===u.rank,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),null!=i&&Ie(_e(n),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+n+"."}),Ie(l.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+l.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),Ie(mi(r,a),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+r+" and dilation '"+a+"'"}),Ie("NWC"===o,function(){return"Error in conv1d: got dataFormat of "+o+" but only NWC is currently supported."});var p=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),d=l.as4D(l.shape[0],1,l.shape[1],l.shape[2]),h=ap(d,p,[1,r],n,"NHWC",[1,a],i);return c?h.as2D(h.shape[2],h.shape[3]):h.as3D(h.shape[0],h.shape[2],h.shape[3])}}),ap=bo({conv2d_:function(t,e,r,n,o,a,i){void 0===o&&(o="NHWC"),void 0===a&&(a=[1,1]);var s=ao(t,"x","conv2d"),u=ao(e,"filter","conv2d"),l=s,c=!1;3===s.rank&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),Ie(4===l.rank,function(){return"Error in conv2d: input must be rank 4, but got rank "+l.rank+"."}),Ie(4===u.rank,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),null!=i&&Ie(_e(n),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+n+"."});var p="NHWC"===o?l.shape[3]:l.shape[1];Ie(p===u.shape[2],function(){return"Error in conv2d: depth of input ("+p+") must match input depth for filter "+u.shape[2]+"."}),Ie(mi(r,a),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+a+"'"});var d=gi(o),h=si(l.shape,u.shape,r,a,n,i,!1,d),f=[u,l],m=Vr.runKernelFunc(function(t,e){var r=t.conv2d(l,u,h);return e([u,l]),r},{x:l,filter:u},function(t,e){var i=e,s=i[0],u=i[1];return Ie(fi(a),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"}),{x:function(){return up(u.shape,t,s,r,n,o)},filter:function(){return sp(u,t,s.shape,r,n,o)}}},"Conv2D",h,f);return c?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),ip=bo({conv3d_:function(t,e,r,n,o,a){void 0===o&&(o="NDHWC"),void 0===a&&(a=[1,1,1]);var i=ao(t,"x","conv3d"),s=ao(e,"filter","conv3d"),u=i,l=!1;4===i.rank&&(l=!0,u=i.as5D(1,i.shape[0],i.shape[1],i.shape[2],i.shape[3])),Ie(5===u.rank,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),Ie(5===s.rank,function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."}),Ie(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."}),Ie(function(t,e){return rp(r)||rp(e)}(0,a),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+a+"'"}),Ie("NDHWC"===o,function(){return"Error in conv3d: got dataFormat of "+o+" but only NDHWC is currently supported."});var c=ui(u.shape,s.shape,r,a,n),p=Vr.runKernelFunc(function(t,e){var r=t.conv3d(u,s,c);return e([u,s]),r},{x:u,$filter:s},function(t,e){Ie(rp(a),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"});var o=e[0],i=e[1];return{x:function(){return np(o.shape,t,i,r,n)},$filter:function(){return function(t,e,r,n,o){var a=t;4===t.rank&&(a=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]));var i=e;4===i.rank&&(i=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3])),Ie(5===a.rank,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+a.shape+"."}),Ie(5===i.rank,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+i.shape+"."}),Ie(5===r.length,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+r+"."}),Ie(a.shape[4]===r[3],function(){return"Error in conv3dDerFilter: depth of input "+a.shape[4]+") must match input depth in filter ("+r[3]+"."}),Ie(i.shape[4]===r[4],function(){return"Error in conv3dDerFilter: depth of dy ("+i.shape[4]+") must match output depth for filter ("+r[4]+")."});var s=ui(a.shape,r,n,1,o);return Vr.runKernelFunc(function(t){return t.conv3dDerFilter(a,i,s)},{x5D:a,dy5D:i})}(o,t,i.shape,r,n)}}});return l?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}}),sp=bo({conv2dDerFilter_:function(t,e,r,n,o,a,i){void 0===a&&(a="NHWC");var s=t;3===t.rank&&(s=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var u=e;3===u.rank&&(u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),Ie(4===s.rank,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."}),Ie(4===u.rank,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."}),Ie(4===r.length,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+r+"."});var l="NHWC"===a?s.shape[3]:s.shape[1],c="NHWC"===a?u.shape[3]:u.shape[1];Ie(l===r[2],function(){return"Error in conv2dDerFilter: depth of input "+l+") must match input depth in filter ("+r[2]+"."}),Ie(c===r[3],function(){return"Error in conv2dDerFilter: depth of dy ("+c+") must match output depth for filter ("+r[3]+")."}),null!=i&&Ie(_e(o),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var p=gi(a),d=si(s.shape,r,n,1,o,i,!1,p);return Vr.runKernelFunc(function(t){return t.conv2dDerFilter(s,u,d)},{x4D:s,dy4D:u})}}),up=bo({conv2dDerInput_:ep}),lp=bo({depthwiseConv2d_:function(t,e,r,n,o,a,i){void 0===a&&(a=[1,1]);var s=ao(t,"x","depthwiseConv2d"),u=ao(e,"filter","depthwiseConv2d"),l=s,c=!1;3===s.rank&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),Ie(4===l.rank,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+l.rank+"."}),Ie(4===u.rank,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),Ie(l.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+l.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),null==a&&(a=[1,1]),Ie(mi(r,a),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+a+"'"}),null!=i&&Ie(_e(n),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+n+"."});var p=si(l.shape,u.shape,r,a,n,i,!0),d=Vr.runKernelFunc(function(t,e){var r=t.depthwiseConv2D(l,u,p);return e([l,u]),r},{x:l,$filter:u},function(t,e){Ie(fi(a),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+a+"'"});var r=e[0],n=e[1];return{x:function(){return cp(r.shape,t,n,p)},$filter:function(){return pp(r,t,n.shape,p)}}});return c?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}}),cp=bo({depthwiseConv2dDerInput_:function(t,e,r,n){var o=e,a=!1;3===e.rank&&(a=!0,o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var i=Vr.runKernelFunc(function(t){return t.depthwiseConv2DDerInput(o,r,n)},{dy4D:o});return a?i.as3D(i.shape[1],i.shape[2],i.shape[3]):i}}),pp=bo({depthwiseConv2dDerFilter_:function(t,e,r,n){var o=t;3===t.rank&&(o=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var a=e;return 3===a.rank&&(a=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),Vr.runKernelFunc(function(t){return t.depthwiseConv2DDerFilter(o,a,n)},{x4D:o,dy4D:a})}}),dp=bo({separableConv2d_:function(t,e,r,n,o,a,i){void 0===a&&(a=[1,1]),void 0===i&&(i="NHWC");var s=ao(t,"x","separableConv2d"),u=ao(e,"depthwiseFilter","separableConv2d"),l=ao(r,"pointwiseFilter","separableConv2d"),c=s,p=!1;if(3===s.rank&&(p=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),"NCHW"===i)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");Ie(4===c.rank,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+c.rank+"."}),Ie(4===u.rank,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),Ie(4===l.rank,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),Ie(1===l.shape[0],function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+l.shape[0]+"."}),Ie(1===l.shape[1],function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+l.shape[1]+"."});var d=u.shape[2],h=u.shape[3];Ie(l.shape[2]===d*h,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+d*h+", but got "+l.shape[2]+"."});var f=lp(c,u,n,o,i,a),m=ap(f,l,1,"valid",i);return p?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),hp=bo({conv2dTranspose_:function(t,e,r,n,o,a){return ep(r,ao(t,"x","conv2dTranspose"),ao(e,"filter","conv2dTranspose"),n,o,"NHWC",a)}}),fp=bo({conv3dTranspose_:function(t,e,r,n,o){return np(r,ao(t,"x","conv3dTranspose"),ao(e,"filter","conv3dTranspose"),n,o)}}),mp=bo({matMul_:function(t,e,r,n){var o;void 0===r&&(r=!1),void 0===n&&(n=!1);var a=ao(t,"a","matMul"),i=ao(e,"b","matMul");o=Or(a,i),a=o[0],i=o[1];var s=r?a.shape[a.rank-2]:a.shape[a.rank-1],u=n?i.shape[i.rank-1]:i.shape[i.rank-2],l=r?a.shape[a.rank-1]:a.shape[a.rank-2],c=n?i.shape[i.rank-2]:i.shape[i.rank-1],p=a.shape.slice(0,-2),d=i.shape.slice(0,-2),h=Te(p),f=Te(d);Ie(a.rank>=2&&i.rank>=2&&a.rank===i.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+a.rank+" and "+i.rank+"."}),Ie(De(p,d),function(){return"Error in matMul: outer dimensions ("+p+") and ("+d+") of Tensors with shapes "+a.shape+" and "+i.shape+" must match."}),Ie(s===u,function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+a.shape+" and "+i.shape+" and transposeA="+r+" and transposeB="+n+" must match."});var m=a.shape.slice(0,-2).concat([l,c]),g=r?a.as3D(h,s,l):a.as3D(h,l,s),v=n?i.as3D(f,c,u):i.as3D(f,u,c),b={transposeA:r,transposeB:n};return Vr.runKernelFunc(function(t,e){var o=t.batchMatMul(g,v,r,n);return e([g,v]),o},{a:g,b:v},function(t,e){var o=e,a=o[0],i=o[1];return r||n?!r&&n?{a:function(){return t.matMul(i,!1,!1)},b:function(){return t.matMul(a,!0,!1)}}:r&&!n?{a:function(){return i.matMul(t,!1,!0)},b:function(){return a.matMul(t,!1,!1)}}:{a:function(){return i.matMul(t,!0,!0)},b:function(){return t.matMul(a,!0,!0)}}:{a:function(){return t.matMul(i,!1,!0)},b:function(){return a.matMul(t,!0,!1)}}},"BatchMatMul",b).reshape(m)}}),gp=bo({dot_:function(t,e){var r=ao(t,"t1","dot"),n=ao(e,"t2","dot");Ie(!(1!==r.rank&&2!==r.rank||1!==n.rank&&2!==n.rank),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+r.rank+" and "+n.rank+"."});var o=1===r.rank?r.size:r.shape[1],a=1===n.rank?n.size:n.shape[0];return Ie(o===a,function(){return"Error in dot: inner dimensions of inputs must match, but got "+o+" and "+a+"."}),1===r.rank&&1===n.rank?r.as2D(1,-1).matMul(n.as2D(-1,1)).asScalar():1===r.rank&&2===n.rank?r.as2D(1,-1).matMul(n.as2D(n.shape[0],n.shape[1])).as1D():2===r.rank&&1===n.rank?r.matMul(n.as2D(-1,1)).as1D():r.matMul(n.as2D(n.shape[0],n.shape[1]))}}),vp=bo({outerProduct_:function(t,e){var r=ao(t,"v1","outerProduct"),n=ao(e,"v2","outerProduct");return Ie(1===r.rank&&1===n.rank,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+r.rank+" and "+n.rank+"."}),r.as2D(-1,1).matMul(n.as2D(1,-1))}}),bp=bo({reverse_:function(t,e){var r=ao(t,"x","reverse");if(0===r.rank)return r.clone();var n=Be(e,r.shape);return Vr.runKernelFunc(function(t){return t.reverse(r,n)},{$x:r},function(t){return{$x:function(){return t.reverse(n)}}}).reshapeAs(r)}}),yp=bo({reverse1d_:function(t){var e=ao(t,"x","reverse");return Ie(1===e.rank,function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."}),bp(e,0)}}),xp=bo({reverse2d_:function(t,e){var r=ao(t,"x","reverse");return Ie(2===r.rank,function(){return"Error in reverse2D: x must be rank 2 but got rank "+r.rank+"."}),bp(r,e)}}),wp=bo({reverse3d_:function(t,e){var r=ao(t,"x","reverse");return Ie(3===r.rank,function(){return"Error in reverse3D: x must be rank 3 but got rank "+r.rank+"."}),bp(r,e)}}),kp=bo({reverse4d_:function(t,e){var r=ao(t,"x","reverse");return Ie(4===r.rank,function(){return"Error in reverse4D: x must be rank 4 but got rank "+r.rank+"."}),bp(r,e)}});function Cp(t,e,r,n,o,a){var i=ao(t,"x","maxPool"),s=i,u=!1;3===i.rank&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),null==n&&(n=[1,1]),Ie(4===s.rank,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),Ie(mi(r,n),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+n+"'"}),null!=a&&Ie(_e(o),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var l=ai(s.shape,e,r,n,o,a),c=Vr.runKernelFunc(function(t,e){var r=t.maxPool(s,l);return e([s,r]),r},{x:s},function(t,a){var i=a[0],s=a[1];return{x:function(){return function(t,e,r,n,o,a,i,s){var u=ao(t,"dy","maxPoolBackprop"),l=ao(e,"input","maxPoolBackprop"),c=ao(r,"output","maxPoolBackprop");Ie(l.rank===u.rank,function(){return"Rank of input ("+l.rank+") does not match rank of dy ("+u.rank+")"}),null==a&&(a=[1,1]),Ie(mi(o,a),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+a+"'"}),Ie(4===u.rank,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+u.rank+"."}),Ie(4===l.rank,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+l.rank+"."});var p=ai(l.shape,n,o,a,i,s);return Vr.runKernelFunc(function(t){return t.maxPoolBackprop(u,l,c,p)},{$dy:u,$input:l})}(t,i,s,e,r,n,o)}}});return u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}function Sp(t,e,r,n,o,a){var i=ao(t,"x","avgPool","float32");null==n&&(n=[1,1]),Ie(mi(r,n),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+n+"'"});var s=i,u=!1;3===i.rank&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),Ie(4===s.rank,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),null!=a&&Ie(_e(o),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var l=ai(s.shape,e,r,n,o,a),c=Vr.runKernelFunc(function(t){return t.avgPool(s,l)},{x:s},function(t){return{x:function(){return function(t,e,r,n,o,a){var i=ao(t,"dy","avgPoolBackprop"),s=ao(e,"input","avgPoolBackprop");Ie(s.rank===i.rank,function(){return"Rank of input ("+s.rank+") does not match rank of dy ("+i.rank+")"}),null==o&&(o=[1,1]),Ie(mi(n,o),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"});var u=s,l=i,c=!1;3===s.rank&&(c=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]),l=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),Ie(4===l.rank,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+l.rank+"."}),Ie(4===u.rank,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+u.rank+"."});var p=ai(u.shape,r,n,o,a),d=Vr.runKernelFunc(function(t){return t.avgPoolBackprop(l,u,p)},{dy4D:l,input4D:u});return c?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}(t,s,e,r,n,o)}}});return c=c.cast(i.dtype),u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}var Ep=bo({maxPool_:function(t,e,r,n,o){return Cp(t,e,r,1,n,o)}}),zp=bo({avgPool_:function(t,e,r,n,o){return Sp(t,e,r,1,n,o)}}),Ip=bo({pool_:function(t,e,r,n,o,a){null==o&&(o=[1,1]),null==a&&(a=1),0===n&&(n="valid");var i=ao(t,"x","maxPool"),s=i,u=!1;3===i.rank&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),Ie(mi(a,o),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+o+"'"});var l,c=ai(s.shape,e,a,o,n),p=[c.dilationHeight,c.dilationWidth];l="same"===n?function(t,e){var r=t.map(function(t,r){return t+(t-1)*(e[r]-1)}).map(function(t){return t-1}),n=r.map(function(t){return Math.floor(t/2)}),o=r.map(function(t,e){return t-n[e]});return r.map(function(t,e){return[n[e],o[e]]})}([c.filterHeight,c.filterWidth],p):[[0,0],[0,0]];var d=1===p[0]&&1===p[1],h=function(t,e,r){var n=r.map(function(t){return t[0]}),o=r.map(function(t){return t[1]}),a=t.concat(n,o),i=e.map(function(t,e){return(t-a[e]%t)%t}),s=o.map(function(t,e){return t+i[e]});return[e.map(function(t,e){return[n[e],s[e]]}),e.map(function(t,e){return[0,i[e]]})]}([c.inHeight,c.inWidth],p,l),f=h[0],m=h[1],g=d?n:"valid",v=d?s:Sa(s,p,f),b=("avg"===r?function(){return Sp(v,e,a,1,g)}:function(){return Cp(v,e,a,1,g)})(),y=d?b:aa(b,p,m);return u?y.as3D(y.shape[1],y.shape[2],y.shape[3]):y}}),Ap=bo({maxPool3d_:function(t,e,r,n,o,a,i){void 0===a&&(a="NDHWC");var s=ao(t,"x","maxPool3d"),u=s,l=!1;4===s.rank&&(l=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==i&&(i=[1,1,1]),Ie(5===u.rank,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."}),Ie("NDHWC"===a,function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+a}),Ie(mi(r,i),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+i+"'"}),null!=o&&Ie(_e(n),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+n+"."});var c=ii(u.shape,e,r,i,n,o,a),p=Vr.runKernelFunc(function(t,e){var r=t.maxPool3d(u,c);return e([u,r]),r},{x:u},function(t,a){var s=a[0],u=a[1];return{x:function(){return function(t,e,r,n,o,a,i,s){var u=ao(t,"dy","maxPool3dBackprop"),l=ao(e,"input","maxPool3dBackprop"),c=ao(r,"output","maxPool3dBackprop"),p=u,d=l,h=c,f=!1;4===l.rank&&(f=!0,p=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]),d=l.as5D(1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]),h=c.as5D(1,c.shape[0],c.shape[1],c.shape[2],c.shape[3])),Ie(5===p.rank,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+p.rank+"."}),Ie(5===d.rank,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+d.rank+"."}),Ie(5===h.rank,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+h.rank+"."}),null==a&&(a=[1,1,1]),Ie(mi(o,a),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+a+"'"}),null!=s&&Ie(_e(i),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+i+"."});var m=ii(d.shape,n,o,a,i,s),g=Vr.runKernelFunc(function(t){return t.maxPool3dBackprop(p,d,h,m)},{dy5D:p,input5D:d});return f?g.as4D(g.shape[1],g.shape[2],g.shape[3],g.shape[4]):g}(t,s,u,e,r,i,n,o)}}});return l?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}}),Np=bo({avgPool3d_:function(t,e,r,n,o,a,i){void 0===a&&(a="NDHWC");var s=ao(t,"x","avgPool3d","float32"),u=s,l=!1;4===s.rank&&(l=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==i&&(i=[1,1,1]),Ie(5===u.rank,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."}),Ie("NDHWC"===a,function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+a}),Ie(mi(r,i),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+i+"'"}),null!=o&&Ie(_e(n),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+n+"."});var c=ii(u.shape,e,r,i,n,o,a),p=Vr.runKernelFunc(function(t){return t.avgPool3d(u,c)},{x:u},function(t){return{x:function(){return function(t,e,r,n,o,a,i){var s=ao(t,"dy","avgPool3dBackprop"),u=ao(e,"input","avgPool3dBackprop"),l=s,c=u,p=!1;4===u.rank&&(p=!0,l=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]),c=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3])),Ie(5===l.rank,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+l.rank+"."}),Ie(5===c.rank,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+c.rank+"."}),null==o&&(o=[1,1,1]),Ie(mi(n,o),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"}),null!=i&&Ie(_e(a),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+a+"."});var d=ii(c.shape,r,n,o,a,i),h=Vr.runKernelFunc(function(t){return t.avgPool3dBackprop(l,c,d)},{dy5D:l,input5D:c});return p?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}(t,u,e,r,i,n,o)}}});return p=p.cast(u.dtype),l?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}}),Rp=bo({slice_:function(t,e,r){var n,o,a=ao(t,"x","slice");if(0===a.rank)throw new Error("Slicing scalar is not possible");(n="number"==typeof e?[e].concat(new Array(a.rank-1).fill(0)):e.length<a.rank?e.concat(new Array(a.rank-e.length).fill(0)):e.slice()).forEach(function(t){Ie(-1!==t,function(){return"slice() does not support negative begin indexing."})}),o=(o=null==r?new Array(a.rank).fill(-1):"number"==typeof r?[r].concat(new Array(a.rank-1).fill(-1)):r.length<a.rank?r.concat(new Array(a.rank-r.length).fill(-1)):r).map(function(t,e){return t>=0?t:(Ie(-1===t,function(){return"Negative size values should be exactly -1 but got "+t+" for the slice() size at index "+e+"."}),a.shape[e]-n[e])}),qa(a,n,o);var i=a.shape,s={begin:n,size:o};return Vr.runKernelFunc(function(t){return t.slice(a,n,o)},{x:a},function(t){for(var e=[],r=0;r<t.rank;r++)e.push([n[r],i[r]-n[r]-o[r]]);return{x:function(){return t.pad(e)}}},"Slice",s)}}),Tp=bo({slice1d_:function(t,e,r){var n=ao(t,"x","slice1d");return Ie(1===n.rank,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+n.rank+" tensor"}),Rp(n,[e],[r])}}),Dp=bo({slice2d_:function(t,e,r){var n=ao(t,"x","slice2d");return Ie(2===n.rank,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+n.rank+" tensor"}),Rp(n,e,r)}}),_p=bo({slice3d_:function(t,e,r){var n=ao(t,"x","slice3d");return Ie(3===n.rank,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+n.rank+" tensor"}),Rp(n,e,r)}}),Op=bo({slice4d_:function(t,e,r){var n=ao(t,"x","slice4d");return Ie(4===n.rank,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+n.rank+" tensor"}),Rp(n,e,r)}});function Fp(t,e,r,n,o){return e.rank<r.rank&&(e=e.reshape(co(e.shape,n))),t.rank<r.rank&&(t=t.reshape(co(t.shape,n))),{x:function(){var n=t.mul(r.equal(e).cast(t.dtype));return null==o?n:n.transpose(o)}}}var Mp=bo({all_:function(t,e,r){void 0===e&&(e=null),void 0===r&&(r=!1);var n=ao(t,"x","all","bool"),o=Be(e,n.shape),a=o,i=ho(a,n.rank);null!=i&&(n=n.transpose(i),a=mo(a.length,n.rank));var s=Vr.runKernelFunc(function(t){return t.all(n,a)},{$x:n});if(r){var u=co(s.shape,o);return s.reshape(u)}return s}}),Lp=bo({any_:function(t,e,r){void 0===e&&(e=null),void 0===r&&(r=!1);var n=ao(t,"x","any","bool"),o=Be(e,n.shape),a=o,i=ho(a,n.rank);null!=i&&(n=n.transpose(i),a=mo(a.length,n.rank));var s=Vr.runKernelFunc(function(t){return t.any(n,a)},{$x:n});if(r){var u=co(s.shape,o);return s.reshape(u)}return s}}),Pp=bo({argMax_:function(t,e){void 0===e&&(e=0);var r=ao(t,"x","argMax");null==e&&(e=0);var n=Be(e,r.shape),o=ho(n,r.rank);return null!=o&&(r=r.transpose(o),n=mo(n.length,r.rank)),Vr.runKernelFunc(function(t,e){var o=t.argMax(r,n[0]);return e([r]),o},{$x:r},function(t,e){var r=e[0];return{$x:function(){return Po(r)}}})}}),Bp=bo({argMin_:function(t,e){void 0===e&&(e=0);var r=ao(t,"x","argMin");null==e&&(e=0);var n=Be(e,r.shape),o=ho(n,r.rank);return null!=o&&(r=r.transpose(o),n=mo(n.length,r.rank)),Vr.runKernelFunc(function(t,e){var o=t.argMin(r,n[0]);return e([r]),o},{$x:r},function(t,e){var r=e[0];return{$x:function(){return Po(r)}}})}}),qp=bo({logSumExp_:function(t,e,r){void 0===e&&(e=null),void 0===r&&(r=!1);var n=ao(t,"x","logSumExp"),o=Be(e,n.shape),a=n.max(o,!0),i=n.sub(a).exp().sum(o).log(),s=a.reshape(i.shape).add(i);if(r){var u=co(s.shape,o);return s.reshape(u)}return s}}),Vp=bo({max_:function(t,e,r){void 0===e&&(e=null),void 0===r&&(r=!1);var n=ao(t,"x","max"),o=n,a=Be(e,n.shape),i=a,s=ho(i,n.rank);null!=s&&(n=n.transpose(s),i=mo(i.length,n.rank));var u=[n],l=Vr.runKernelFunc(function(t,e){var r=t.max(n,i);return e([o,r]),r},{x:n},function(t,e){return Fp(t,e[1],e[0],a,s)},"Max",{axes:i},u,[!0]);if(r){var c=co(l.shape,a);l=l.reshape(c)}return l}}),Wp=bo({mean_:function(t,e,r){void 0===e&&(e=null),void 0===r&&(r=!1);var n=ao(t,"x","mean"),o=Be(e,n.shape),a=Te(lo(n.shape,o)[1]);return Xa(function(t){var n=So(a);return{value:(n.dtype===t.dtype?t:t.cast(n.dtype)).div(n).sum(e,r),gradFunc:function(e){var r=t.shape.slice();return o.forEach(function(t){r[t]=1}),e.reshape(r).mul(Do(t.shape,"float32")).div(a)}}})(n)}}),Up=bo({min_:function(t,e,r){void 0===e&&(e=null),void 0===r&&(r=!1);var n=ao(t,"x","min"),o=n,a=Be(e,n.shape),i=a,s=ho(i,n.rank);null!=s&&(n=n.transpose(s),i=mo(i.length,n.rank));var u=[n],l=Vr.runKernelFunc(function(t,e){var r=t.min(n,i);return e([o,r]),r},{x:n},function(t,e){return Fp(t,e[1],e[0],a,s)},"Min",{axes:i},u,[!0]);if(r){var c=co(l.shape,a);l=l.reshape(c)}return l}}),jp=bo({moments_:function(t,e,r){void 0===e&&(e=null),void 0===r&&(r=!1);var n=Be(e,(t=ao(t,"x","moments")).shape),o=t.mean(n,r),a=o.shape;r||(a=co(o.shape,n));var i=t.toFloat().sub(o.reshape(a)).square();return{mean:o,variance:i.mean(n,r)}}}),Hp=bo({sum_:function(t,e,r){void 0===e&&(e=null),void 0===r&&(r=!1);var n=ao(t,"x","sum");"bool"===n.dtype&&(n=n.toInt());var o=Be(e,n.shape);return Xa(function(t){var e=ho(o,t.rank),n=o,a=t;null!=e&&(a=t.transpose(e),n=mo(n.length,t.rank));var i=Vr.runKernelFunc(function(t){return t.sum(a,n)},{permutedX:a});if(r){var s=co(i.shape,o);i=i.reshape(s)}return{value:i,gradFunc:function(e){var r=t.shape.slice();return o.forEach(function(t){r[t]=1}),e.reshape(r).mul(Do(t.shape,"float32"))}}})(n)}}),Gp=bo({prod_:function(t,e,r){void 0===e&&(e=null),void 0===r&&(r=!1);var n=ao(t,"x","prod");"bool"===n.dtype&&(n=n.toInt());var o=Be(e,n.shape),a=ho(o,n.rank),i=o,s=n;null!=a&&(s=n.transpose(a),i=mo(i.length,n.rank));var u=Vr.runKernelFunc(function(t){return t.prod(s,i)},{permutedX:s});if(r){var l=co(u.shape,o);u=u.reshape(l)}return u}}),$p=bo({elu_:function(t){var e=ao(t,"x","elu");return Vr.runKernelFunc(function(t,r){var n=t.elu(e);return r([n]),n},{$x:e},function(t,e){var r=e[0];return{$x:function(){return Vr.runKernelFunc(function(e){return e.eluDer(t,r)},{dy:t,y:r})}}})}}),Kp=bo({leakyRelu_:function(t,e){void 0===e&&(e=.2);var r=ao(t,"x","leakyRelu");return Sc(So(e).mul(r),r)}}),Xp=bo({prelu_:function(t,e){var r=ao(t,"x","prelu"),n=ao(e,"alpha","prelu");return Vr.runKernelFunc(function(t,e){var o=t.prelu(r,n);return e([r,n]),o},{x:r,alpha:n},function(t,e){var r=e[0],n=e[1],o=r.greater(0);return{x:function(){return fc(o,t,t.mul(n))},alpha:function(){var e=fc(o,Po(t),t.mul(r)),a=ni(n.shape,t.shape);return a.length>0&&(e=e.sum(a)),e.reshape(n.shape)}}},"Prelu")}}),Yp=bo({relu_:function(t){var e=ao(t,"x","relu");return"bool"===e.dtype?e.toInt():Vr.runKernelFunc(function(t,r){var n=t.relu(e);return r([e]),n},{$x:e},function(t,e){var r=e[0];return{$x:function(){return t.mulStrict(r.step().toFloat())}}})}}),Jp=bo({relu6_:function(t){var e=ao(t,"x","relu6");return"bool"===e.dtype?e.toInt():Vr.runKernelFunc(function(t,r){var n=t.relu6(e);return r([e]),n},{$x:e},function(t,e){var r=e[0],n=r.lessEqual(6).mul(r.step());return{$x:function(){return t.mulStrict(n.toFloat())}}})}}),Zp=bo({selu_:function(t){var e=ao(t,"x","selu");return Vr.runKernelFunc(function(t,r){var n=t.selu(e);return r([e]),n},{$x:e},function(t,e){var r=e[0];return{$x:function(){var e=r.greater(So(0)),n=So(ju),o=So(Hu),a=t.mul(o),i=t.mul(n).mul(r.toFloat().exp());return fc(e,a,i)}}})}}),Qp=bo({transpose_:function(t,e){var r=ao(t,"x","transpose");if(null==e&&(e=r.shape.map(function(t,e){return e}).reverse()),Ie(r.rank===e.length,function(){return"Error in transpose: rank of input "+r.rank+" must match length of perm "+e+"."}),e.forEach(function(t){Ie(t>=0&&t<r.rank,function(){return"All entries in 'perm' must be between 0 and "+(r.rank-1)+" but got "+e})}),r.rank<=1)return r.clone();var n={perm:e};return Vr.runKernelFunc(function(t){return t.transpose(r,e)},{x:r},function(t){var r=fo(e);return{x:function(){return t.transpose(r)}}},"Transpose",n)}}),td=bo({localResponseNormalization_:function(t,e,r,n,o){void 0===e&&(e=5),void 0===r&&(r=1),void 0===n&&(n=1),void 0===o&&(o=.5);var a=ao(t,"x","localResponseNormalization");Ie(4===a.rank||3===a.rank,function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+a.rank+"."}),Ie(_e(e),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+e+"."});var i=a,s=!1;3===a.rank&&(s=!0,i=a.as4D(1,a.shape[0],a.shape[1],a.shape[2]));var u=Vr.runKernelFunc(function(t,a){var s=t.localResponseNormalization4D(i,e,r,n,o);return a([i,s]),s},{x4D:i},function(t,a){var i=a[0],s=a[1];return{x4D:function(){return Vr.runKernelFunc(function(a){return a.LRNGrad(t,i,s,e,r,n,o)},{})}}});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),ed=bo({norm_:function(t,e,r,n){void 0===e&&(e="euclidean"),void 0===r&&(r=null),void 0===n&&(n=!1);var o=function t(e,r,n){if(void 0===n&&(n=null),0===e.rank)return e.abs();if(1!==e.rank&&null===n)return t(e.reshape([-1]),r,n);if(1===e.rank||"number"==typeof n||Array.isArray(n)&&1===n.length){if(1===r)return e.abs().sum(n);if(r===1/0)return e.abs().max(n);if(r===-1/0)return e.abs().min(n);if("euclidean"===r||2===r)return e.abs().pow(So(2,"int32")).sum(n).sqrt();throw new Error("Error in norm: invalid ord value: "+r)}if(Array.isArray(n)&&2===n.length){if(1===r)return e.abs().sum(n[0]).max(n[1]-1);if(r===1/0)return e.abs().sum(n[1]).max(n[0]);if(r===-1/0)return e.abs().sum(n[1]).min(n[0]);if("fro"===r||"euclidean"===r)return e.square().sum(n).sqrt();throw new Error("Error in norm: invalid ord value: "+r)}throw new Error("Error in norm: invalid axis: "+n)}(t=ao(t,"x","norm"),e,r),a=o.shape;if(n){var i=Be(r,t.shape);a=co(o.shape,i)}return o.reshape(a)}}),rd=bo({basicLSTMCell_:function(t,e,r,n,o,a){var i=ao(t,"forgetBias","basicLSTMCell"),s=ao(e,"lstmKernel","basicLSTMCell"),u=ao(r,"lstmBias","basicLSTMCell"),l=ao(n,"data","basicLSTMCell"),c=ao(o,"c","basicLSTMCell"),p=ao(a,"h","basicLSTMCell"),d=l.concat(p,1).matMul(s).add(u),h=d.shape[0],f=d.shape[1]/4,m=[h,f],g=d.slice([0,0],m),v=d.slice([0,f],m),b=d.slice([0,2*f],m),y=d.slice([0,3*f],m),x=g.sigmoid().mulStrict(v.tanh()).addStrict(c.mulStrict(i.add(b).sigmoid())),w=x.tanh().mulStrict(y.sigmoid());return[x,w]}}),nd=bo({multiRNNCell_:function(t,e,r,n){for(var o=ao(e,"data","multiRNNCell"),a=io(r,"c","multiRNNCell"),i=io(n,"h","multiRNNCell"),s=o,u=[],l=0;l<t.length;l++){var c=t[l](s,a[l],i[l]);u.push(c[0]),u.push(c[1]),s=c[1]}var p=[],d=[];for(l=0;l<u.length;l+=2)p.push(u[l]),d.push(u[l+1]);return[p,d]}}),od=bo({movingAverage_:function(t,e,r,n,o){void 0===o&&(o=!0);var a=ao(t,"v","movingAverage"),i=ao(e,"x","movingAverage"),s=ao(r,"decay","movingAverage");Fr(a,i),Ie(De(a.shape,i.shape),function(){return"Shape mismatch in v and x"});var u=So(1),l=u.sub(s),c=i.sub(a).mul(l);if(o){Ie(null!=n,function(){return"When using zeroDebias: true, step is required."});var p=ao(n,"step","movingAverage");c=c.div(u.sub(Dc(s,p)))}return a.add(c)}}),ad=bo({stridedSlice_:function(t,e,r,n,o,a,i,s,u){if(void 0===o&&(o=0),void 0===a&&(a=0),void 0===i&&(i=0),void 0===s&&(s=0),void 0===u&&(u=0),null==n&&(n=new Array(e.length)),0!==i)throw new Error("ellipsis mask is not yet supported");var l=ao(t,"x","stridedSlice"),c=Va(s),p=l.shape.slice();c.forEach(function(t){e[t]=0,r[t]=1,p.splice(t,0,1)}),l=l.reshape(p);for(var d=0;d<l.rank;d++)e[d]=Ua(o,e,n,l.shape,d),r[d]=ja(a,r,n,l.shape,d),n[d]=n[d]||1;var h=Va(u);h.forEach(function(t){r[t]=e[t]+1,n[t]=1});var f=Wa(e,r,n),m=f.filter(function(t,e){return-1===h.indexOf(e)});return n.every(function(t){return 1===t})?Rp(l,e,f).reshape(m):Vr.runKernelFunc(function(t){return t.stridedSlice(l,e,r,n)},{$x:l}).reshape(m)}}),id=bo({topk_:function(t,e,r){void 0===e&&(e=1),void 0===r&&(r=!0);var n=ao(t,"x","topk");if(0===n.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var o=n.shape[n.shape.length-1];if(e>o)throw new Error("'k' passed to topk() must be <= the last dimension ("+o+") but got "+e);var a=Vr.runKernelFunc(function(t){return t.topk(n,e,r)},{$x:n});return{values:a[0],indices:a[1]}}}),sd=bo({scatterND_:function(t,e,r){var n=ao(t,"indices","scatterND","int32"),o=ao(e,"updates","scatterND");return function(t,e,r){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(t.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+t.rank+".");if("int32"!==e.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(r.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+r);if(0===r.length){if(0===e.size)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(0===t.size)throw new Error("Updates specified for empty output. updates shape: "+t.shape)}!function(t,e,r){var n=e.rank>1?e.shape[e.rank-1]:1,o=e.rank>1?e.rank-1:1,a="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+r.shape+", indices.shape: "+e.shape+", shape: "+t+", sliceDim: "+n+", and batchDim: "+o+".";if(r.rank<o)throw new Error(a+" update.rank < "+o+". ");if(t.length<n+(r.rank-o))throw new Error(a+" Output shape length < "+(n+(r.rank-o)));if(r.rank!==o+t.length-n)throw new Error(a+" update.rank != "+(o+t.length-n));for(var i=0;i<o;++i)if(r.shape[i]!==e.shape[i])throw new Error(a+" updates.shape["+i+"] ("+r.shape[i]+") != indices.shape["+i+"] ("+e.shape[i]+").");for(i=0;i<r.rank-o;++i)if(r.shape[i+o]!==t[i+n])throw new Error(a+" updates.shape["+(i+o)+"] ("+r.shape[i+o]+") != shape["+(i+o)+"] ("+t[i+o]+")")}(r,e,t)}(o,n,r),Vr.runKernelFunc(function(t){return t.scatterND(n,o,r)},{$indices:n,$updates:o})}}),ud=bo({fft_:function(t){Ie("complex64"===t.dtype,function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+t.dtype+"."});var e=t.shape[t.shape.length-1],r=t.size/e,n=t.as2D(r,e);return Vr.runKernelFunc(function(t){return t.fft(n)},{input:t}).reshape(t.shape)}}),ld=bo({ifft_:function(t){Ie("complex64"===t.dtype,function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+t.dtype+"."});var e=t.shape[t.shape.length-1],r=t.size/e,n=t.as2D(r,e);return Vr.runKernelFunc(function(t){return t.ifft(n)},{input:t}).reshape(t.shape)}}),cd=bo({rfft_:function(t,e){Ie("float32"===t.dtype,function(){return"The dtype for rfft() must be real value but got "+t.dtype});var r,n=t.shape[t.shape.length-1],o=t.size/n;if(null!=e&&e<n){var a=t.shape.map(function(t){return 0}),i=t.shape.map(function(t){return t});i[t.shape.length-1]=e,r=t.slice(a,i),n=e}else if(null!=e&&e>n){var s=t.shape.map(function(t){return t});s[t.shape.length-1]=e-n,r=t.concat(_o(s),t.shape.length-1),n=e}else r=t;var u=r.zerosLike(),l=yo(r,u).as2D(o,n),c=ud(l),p=Math.floor(n/2)+1,d=xo(c),h=wo(c),f=d.split([p,n-p],d.shape.length-1),m=h.split([p,n-p],h.shape.length-1),g=r.shape.slice();return g[r.shape.length-1]=p,yo(f[0],m[0]).reshape(g)}}),pd=bo({irfft_:function(t){var e=t.shape[t.shape.length-1],r=t.size/e;if(e<=2){var n=t.as2D(r,e),o=ld(n);return xo(o)}var a=[r,2*(e-1)],i=xo(t).as2D(r,e),s=wo(t).as2D(r,e),u=i.slice([0,1],[r,e-2]).reverse(1),l=s.slice([0,1],[r,e-2]).reverse(1).mul(So(-1)),c=i.concat(u,1),p=s.concat(l,1);return n=yo(c,p).as2D(a[0],a[1]),o=ld(n),xo(o)}}),dd=Object.freeze({fft:ud,ifft:ld,rfft:cd,irfft:pd}),hd=bo({sparseToDense_:function(t,e,r,n){void 0===n&&(n=0);var o=ao(t,"sparseIndices","sparseToDense","int32"),a=ao(e,"sparseValues","sparseToDense"),i=ao(n,"defaultValue","sparseToDense",a.dtype);return function(t,e,r,n){if("int32"!==t.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+t.shape+".");var o=t.rank>0?t.shape[0]:1,a=t.rank>1?t.shape[1]:1;if(r.length!==a)throw new Error("outputShape has incorrect number of elements:, "+r.length+", should be: "+a+".");var i=e.size;if(0!==e.rank&&(1!==e.rank||i!==o))throw new Error("sparseValues has incorrect shape "+e.shape+", should be [] or ["+o+"]");if(e.dtype!==n.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(o,a,r,i),Vr.runKernelFunc(function(t){return t.sparseToDense(o,a,r,i)},{$sparseIndices:o,$sparseValues:a,$defaultValue:i})}}),fd=bo({gatherND_:function(t,e){var r=ao(e,"indices","gatherND","int32"),n=ao(t,"x","gatherND");return Vr.runKernelFunc(function(t){return t.gatherND(n,r)},{$x:n,$indices:r})}}),md=bo({diag_:function(t){var e=ao(t,"x","diag").flatten(),r=t.shape.concat(t.shape);return Vr.runKernelFunc(function(t){return t.diag(e)},{$x:e}).reshape(r)}}),gd=bo({dropout_:function(t,e,r,n){var o=ao(t,"x","dropout");if(Ie("float32"===o.dtype,function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+o.dtype+" tensor instead."}),Ie(e>=0&&e<1,function(){return"rate must be a float in the range [0, 1), but got "+e+"."}),0===e)return t instanceof Cr?o.clone():o;var a=function(t,e){if(null==e)return t.shape.slice();if(De(t.shape,e))return e;if(t.shape.length===e.length){for(var r=[],n=0;n<t.shape.length;n++)null==e[n]&&null!=t.shape[n]?r.push(t.shape[n]):r.push(e[n]);return r}return e}(o,r),i=1-e,s=ka(a,0,1,"float32",n).add(i).floor().div(i);return o.mul(s)}});function vd(t,e,r){for(var n=1-t%2,o=new Float32Array(t),a=0;a<t;++a){var i=2*Math.PI*a/(t+n-1);o[a]=e-r*Math.cos(i)}return Eo(o,"float32")}var bd,yd=bo({hannWindow_:function(t){return vd(t,.5,.5)}}),xd=bo({hammingWindow_:function(t){return vd(t,.54,.46)}}),wd=bo({frame_:function(t,e,r,n,o){void 0===n&&(n=!1),void 0===o&&(o=0);for(var a=0,i=[];a+e<=t.size;)i.push(Rp(t,a,e)),a+=r;if(n)for(;a<t.size;){var s=a+e-t.size,u=Bo([Rp(t,a,e-s),Oo([s],o)]);i.push(u),a+=r}return 0===i.length?zo([],[0,e]):Bo(i).as2D(i.length,e)}}),kd=bo({stft_:function(t,e,r,n,o){var a;void 0===o&&(o=yd),null==n&&(a=e,n=Math.floor(Math.pow(2,Math.ceil(Math.log(a)/Math.log(2)))));for(var i=wd(t,e,r),s=Rc(i,o(e)),u=[],l=0;l<i.shape[0];l++)u.push(cd(s.slice([l,0],[1,e]),n));return Bo(u)}}),Cd=Object.freeze({hannWindow:yd,hammingWindow:xd,frame:wd,stft:kd}),Sd=function(t,e,r){return void 0===r&&(r=1),he(this,void 0,void 0,function(){var n,o,a,i,s,u,l,c,p,d,h,f,m,g;return fe(this,function(v){switch(v.label){case 0:return n=ao(t,"predictions","inTopK"),o=ao(e,"targets","inTopK"),Ie(n.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+n.rank}),Ie(n.rank-1===o.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+n.rank+" and targets rank "+o.rank}),Ae(n.shape.slice(0,n.shape.length-1),o.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),a=n.shape[n.shape.length-1],Ie(r>0&&r<=a,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+a+"), but got "+r}),[4,n.data()];case 1:return i=v.sent(),[4,o.data()];case 2:for(s=v.sent(),u=[i.length/a,a],c=u[1],p=Ve("bool",l=u[0]),d=0;d<l;d++){for(h=d*c,f=i.subarray(h,h+c),m=[],g=0;g<f.length;g++)m.push({value:f[g],index:g});for(m.sort(function(t,e){return e.value-t.value}),p[d]=0,g=0;g<r;g++)if(m[g].index===s[d]){p[d]=1;break}}return t!==n&&n.dispose(),e!==o&&o.dispose(),[2,ko(p,o.shape,"bool")]}})})};!function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(bd||(bd={}));var Ed=bo({absoluteDifference_:function(t,e,r,n){void 0===n&&(n=bd.SUM_BY_NONZERO_WEIGHTS);var o=ao(t,"labels","absoluteDifference"),a=ao(e,"predictions","absoluteDifference"),i=null;null!=r&&(i=ao(r,"weights","absoluteDifference")),Ae(o.shape,a.shape,"Error in absoluteDifference: ");var s=o.sub(a).abs();return zd(s,i,n)}}),zd=bo({computeWeightedLoss_:function(t,e,r){void 0===r&&(r=bd.SUM_BY_NONZERO_WEIGHTS);var n=ao(t,"losses","computeWeightedLoss"),o=null;null!=e&&(o=ao(e,"weights","computeWeightedLoss"));var a=null==o?n:n.mul(o);if(r===bd.NONE)return a;if(r===bd.SUM)return a.sum();if(r===bd.MEAN){if(null==o)return a.mean();var i=n.size/o.size,s=a.sum().div(o.sum());return i>1?s.div(So(i)):s}if(r===bd.SUM_BY_NONZERO_WEIGHTS){if(null==o)return a.sum().div(So(n.size));var u=o.mul(Do(n.shape)).notEqual(So(0)).sum().toFloat();return a.sum().div(u)}throw Error("Unknown reduction: "+r)}}),Id=bo({cosineDistance_:function(t,e,r,n,o){void 0===o&&(o=bd.SUM_BY_NONZERO_WEIGHTS);var a=ao(t,"labels","cosineDistance"),i=ao(e,"predictions","cosineDistance"),s=null;null!=n&&(s=ao(n,"weights","cosineDistance")),Ae(a.shape,i.shape,"Error in cosineDistance: ");var u=So(1).sub(a.mul(i).sum(r,!0));return zd(u,s,o)}}),Ad=bo({hingeLoss_:function(t,e,r,n){void 0===n&&(n=bd.SUM_BY_NONZERO_WEIGHTS);var o=ao(t,"labels","hingeLoss"),a=ao(e,"predictions","hingeLoss"),i=null;null!=r&&(i=ao(r,"weights","hingeLoss")),Ae(o.shape,a.shape,"Error in hingeLoss: ");var s=So(1);o=So(2).mul(o).sub(s);var u=s.sub(o.mul(a)).relu();return zd(u,i,n)}}),Nd=bo({huberLoss_:function(t,e,r,n,o){void 0===n&&(n=1),void 0===o&&(o=bd.SUM_BY_NONZERO_WEIGHTS);var a=ao(t,"labels","huberLoss"),i=ao(e,"predictions","huberLoss"),s=null;null!=r&&(s=ao(r,"weights","huberLoss")),Ae(a.shape,i.shape,"Error in huberLoss: ");var u=So(n),l=i.sub(a).abs(),c=zc(l,u),p=l.sub(c),d=So(.5).mul(c.square()).add(u.mul(p));return zd(d,s,o)}}),Rd=bo({logLoss_:function(t,e,r,n,o){void 0===n&&(n=1e-7),void 0===o&&(o=bd.SUM_BY_NONZERO_WEIGHTS);var a=ao(t,"labels","logLoss"),i=ao(e,"predictions","logLoss"),s=null;null!=r&&(s=ao(r,"weights","logLoss")),Ae(a.shape,i.shape,"Error in logLoss: ");var u=So(1),l=So(n),c=a.mul(i.add(l).log()).neg().sub(u.sub(a).mul(u.sub(i).add(l).log()));return zd(c,s,o)}}),Td=bo({meanSquaredError_:function(t,e,r,n){void 0===n&&(n=bd.SUM_BY_NONZERO_WEIGHTS);var o=ao(t,"labels","meanSquaredError"),a=ao(e,"predictions","meanSquaredError"),i=null;null!=r&&(i=ao(r,"weights","meanSquaredError")),Ae(o.shape,a.shape,"Error in meanSquaredError: ");var s=o.squaredDifference(a);return zd(s,i,n)}}),Dd=bo({sigmoidCrossEntropy_:function(t,e,r,n,o){void 0===n&&(n=0),void 0===o&&(o=bd.SUM_BY_NONZERO_WEIGHTS);var a=ao(t,"multiClassLabels","sigmoidCrossEntropy"),i=ao(e,"logits","sigmoidCrossEntropy"),s=null;if(null!=r&&(s=ao(r,"weights","sigmoidCrossEntropy")),Ae(a.shape,i.shape,"Error in sigmoidCrossEntropy: "),n>0){var u=So(n),l=So(1),c=So(.5);a=a.mul(l.sub(u)).add(c.mul(u))}var p=function(t,e){var r=ao(t,"labels","sigmoidCrossEntropyWithLogits"),n=ao(e,"logits","sigmoidCrossEntropyWithLogits");Ae(r.shape,n.shape,"Error in sigmoidCrossEntropyWithLogits: ");var o=n.relu(),a=n.mul(r),i=n.abs().neg().exp().log1p();return o.sub(a).add(i)}(a,i);return zd(p,s,o)}}),_d=bo({softmaxCrossEntropy_:function(t,e,r,n,o){void 0===n&&(n=0),void 0===o&&(o=bd.SUM_BY_NONZERO_WEIGHTS);var a=ao(t,"onehotLabels","softmaxCrossEntropy"),i=ao(e,"logits","softmaxCrossEntropy"),s=null;if(null!=r&&(s=ao(r,"weights","softmaxCrossEntropy")),Ae(a.shape,i.shape,"Error in softmaxCrossEntropy: "),n>0){var u=So(n),l=So(1),c=So(a.shape[1]);a=a.mul(l.sub(u)).add(u.div(c))}var p=function(t,e,r){if(void 0===r&&(r=-1),-1===r&&(r=e.rank-1),r!==e.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+e.rank+" and dim was "+r);return Xa(function(t,e,n){var o=e.logSumExp([r],!0),a=e.toFloat().sub(o);return n([t,a]),{value:a.mul(t).neg().sum([r]),gradFunc:function(t,e){var n=e[0],o=e[1],a=co(t.shape,[r]);return[t.reshape(a).mul(n.toFloat().sub(o.exp())),t.reshape(a).mul(o.exp().sub(n.toFloat()))]}}})(t,e)}(a,i);return zd(p,s,o)}}),Od=Object.freeze({get Reduction(){return bd},absoluteDifference:Ed,computeWeightedLoss:zd,cosineDistance:Id,hingeLoss:Ad,huberLoss:Nd,logLoss:Rd,meanSquaredError:Td,sigmoidCrossEntropy:Dd,softmaxCrossEntropy:_d});function Fd(t,e){return void 0===e&&(e=!1),Vr.tidy(function(){if(2!==t.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+t.shape.length+"D Tensor.");for(var r=t.shape[0],n=t.shape[1],o=pa(r),a=t.clone(),i=zo([[1]],[1,1]),s=i.clone(),u=r>=n?n:r,l=function(t){var e,u=a,l=s,c=o;e=Vr.tidy(function(){var e=a.slice([t,t],[r-t,1]),u=e.norm(),l=a.slice([t,t],[1,1]),c=zo([[-1]]).where(l.greater(0),zo([[1]])),p=l.sub(c.mul(u)),d=e.div(p);s=1===d.shape[0]?i.clone():i.concat(d.slice([1,0],[d.shape[0]-1,d.shape[1]]),0);var h=c.matMul(p).div(u).neg(),f=a.slice([t,0],[r-t,n]),m=h.mul(s);if(0===t)a=f.sub(m.matMul(s.transpose().matMul(f)));else{var g=f.sub(m.matMul(s.transpose().matMul(f)));a=a.slice([0,0],[t,n]).concat(g,0)}var v=o.slice([0,t],[r,o.shape[1]-t]);if(0===t)o=v.sub(v.matMul(s).matMul(m.transpose()));else{var b=v.sub(v.matMul(s).matMul(m.transpose()));o=o.slice([0,0],[r,t]).concat(b,1)}return[s,a,o]}),s=e[0],a=e[1],o=e[2],Qn([u,l,c])},c=0;c<u;++c)l(c);return!e&&r>n&&(o=o.slice([0,0],[r,n]),a=a.slice([0,0],[n,n])),[o,a]})}var Md=bo({gramSchmidt_:function(t){var e;if(Array.isArray(t)){e=!1,Ie(null!=t&&t.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var r=t[0].shape[0],n=function(e){Ie(t[e].shape[0]===r,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+t[e].shape[0]+" vs. "+r+")"})},o=1;o<t.length;++o)n(o)}else e=!0,t=jo(t,t.shape[0],0).map(function(t){return Ea(t,[0])});Ie(t.length<=t[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+t.length+") exceeds number of dimensions ("+t[0].shape[0]+")."});var a=[],i=t,s=function(t){a.push(Vr.tidy(function(){var e=i[t];if(t>0)for(var r=0;r<t;++r){var n=Hp(a[r].mulStrict(e)).mul(a[r]);e=e.sub(n)}return e.div(ed(e,"euclidean"))}))};for(o=0;o<t.length;++o)s(o);return e?za(a,0):a}}),Ld=bo({qr_:function(t,e){if(void 0===e&&(e=!1),t.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+t.rank);if(2===t.rank)return Fd(t,e);var r=t.shape.slice(0,t.shape.length-2).reduce(function(t,e){return t*e}),n=Na(t.reshape([r,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),o=[],a=[];return n.forEach(function(t){var r=Fd(t,e),n=r[0],i=r[1];o.push(n),a.push(i)}),[za(o,0).reshape(t.shape),za(a,0).reshape(t.shape)]}}),Pd=Object.freeze({gramSchmidt:Md,qr:Ld});function Bd(t,e,r,n,o){null==n&&(n=.5),null==o&&(o=Number.NEGATIVE_INFINITY);var a=t.shape[0];return r=Math.min(r,a),Ie(0<=n&&n<=1,function(){return"iouThreshold must be in [0, 1], but was '"+n+"'"}),Ie(2===t.rank,function(){return"boxes must be a 2D tensor, but was of rank '"+t.rank+"'"}),Ie(4===t.shape[1],function(){return"boxes must have 4 columns, but 2nd dimension was "+t.shape[1]}),Ie(1===e.rank,function(){return"scores must be a 1D tensor"}),Ie(e.shape[0]===a,function(){return"scores has incompatible shape with boxes. Expected "+a+", but was "+e.shape[0]}),{maxOutputSize:r,iouThreshold:n,scoreThreshold:o}}var qd=bo({resizeBilinear_:function(t,e,r){void 0===r&&(r=!1);var n=ao(t,"images","resizeBilinear");Ie(3===n.rank||4===n.rank,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+n.rank+"."}),Ie(2===e.length,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+e+"."});var o=n,a=!1;3===n.rank&&(a=!0,o=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var i=e[0],s=e[1],u=Vr.runKernelFunc(function(t,e){return e([o]),t.resizeBilinear(o,i,s,r)},{batchImages:o},function(t,e){return{batchImages:function(){return Vr.runKernelFunc(function(n){return n.resizeBilinearBackprop(t,e[0],r)},{})}}});return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Vd=bo({resizeNearestNeighbor_:function(t,e,r){void 0===r&&(r=!1);var n=ao(t,"images","resizeNearestNeighbor");Ie(3===n.rank||4===n.rank,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+n.rank+"."}),Ie(2===e.length,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+e+"."}),Ie("float32"===n.dtype||"int32"===n.dtype,function(){return"`images` must have `int32` or `float32` as dtype"});var o=n,a=!1;3===n.rank&&(a=!0,o=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var i=e[0],s=e[1],u=Vr.runKernelFunc(function(t,e){return e([o]),t.resizeNearestNeighbor(o,i,s,r)},{batchImages:o},function(t,e){return{batchImages:function(){return Vr.runKernelFunc(function(n){return n.resizeNearestNeighborBackprop(t,e[0],r)},{})}}});return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Wd=bo({nonMaxSuppression_:function(t,e,r,n,o){void 0===n&&(n=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY);var a=ao(t,"boxes","nonMaxSuppression"),i=ao(e,"scores","nonMaxSuppression"),s=Bd(a,i,r,n,o);return r=s.maxOutputSize,n=s.iouThreshold,o=s.scoreThreshold,Vr.runKernelFunc(function(t){return t.nonMaxSuppression(a,i,r,n,o)},{$boxes:a})}}),Ud=bo({cropAndResize_:function(t,e,r,n,o,a){var i=ao(t,"image","cropAndResize","float32"),s=ao(e,"boxes","cropAndResize","float32"),u=ao(r,"boxInd","cropAndResize","int32");o=o||"bilinear",a=a||0;var l=s.shape[0];return Ie(4===i.rank,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+i.rank+"."}),Ie(2===s.rank&&4===s.shape[1],function(){return"Error in cropAndResize: boxes must be have size ["+l+",4] but had shape "+s.shape+"."}),Ie(1===u.rank&&u.shape[0]===l,function(){return"Error in cropAndResize: boxInd must be have size ["+l+"] but had shape "+s.shape+"."}),Ie(2===n.length,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+n.length+"."}),Ie(n[0]>=1&&n[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+n}),Ie("bilinear"===o||"nearest"===o,function(){return"method must be bilinear or nearest, but was "+o}),Vr.runKernelFunc(function(t,e){return t.cropAndResize(i,s,u,n,o,a)},{images:i,boxes:s,boxInd:u},null,"CropAndResize",{method:o,extrapolationValue:a,cropSize:n})}}),jd=Object.freeze({resizeBilinear:qd,resizeNearestNeighbor:Vd,nonMaxSuppression:Wd,nonMaxSuppressionAsync:function(t,e,r,n,o){return void 0===n&&(n=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),he(this,void 0,void 0,function(){var a,i,s,u,l,c,p;return fe(this,function(d){switch(d.label){case 0:return a=ao(t,"boxes","nonMaxSuppressionAsync"),i=ao(e,"scores","nonMaxSuppressionAsync"),s=Bd(a,i,r,n,o),r=s.maxOutputSize,n=s.iouThreshold,o=s.scoreThreshold,[4,Promise.all([a.data(),i.data()])];case 1:return u=d.sent(),l=u[0],c=u[1],p=Ei(l,c,r,n,o),a!==t&&a.dispose(),i!==e&&i.dispose(),[2,p]}})})},cropAndResize:Ud}),Hd=function(t,e){return!(t>0||"linear"!==e&&"relu"!==e)},Gd=function(t,e,r){if(null==r||"linear"===r)return t;if("relu"===r)return t.mul(e.step());throw new Error("Gradient for activation "+r+" has not been implemented yet.")},$d=function(t,e){var r=e,n=ni(t.shape,e.shape);return n.length>0&&(r=r.sum(n)),r.reshape(t.shape)},Kd=function(t,e,r){if("linear"===e)return t;if("relu"===e)return Yp(t);if("elu"===e)return $p(t);if("relu6"===e)return Jp(t);if("prelu"===e)return Xp(t,r);throw new Error("Unknown fused activation "+e+".")},Xd=bo({matMul_:function(t){var e,r=t.a,n=t.b,o=t.transposeA,a=void 0!==o&&o,i=t.transposeB,s=void 0!==i&&i,u=t.bias,l=t.activation,c=void 0===l?"linear":l,p=t.preluActivationWeights;if(!1===Hd(Vr.state.gradientDepth,c)){var d=mp(r,n,a,s);return null!=u&&(d=gc(d,u)),Kd(d,c,p)}var h=ao(r,"a","fused matMul"),f=ao(n,"b","fused matMul");e=Or(h,f),h=e[0],f=e[1];var m=a?h.shape[h.rank-2]:h.shape[h.rank-1],g=s?f.shape[f.rank-1]:f.shape[f.rank-2],v=a?h.shape[h.rank-1]:h.shape[h.rank-2],b=s?f.shape[f.rank-2]:f.shape[f.rank-1],y=h.shape.slice(0,-2),x=f.shape.slice(0,-2),w=Te(y),k=Te(x);Ie(h.rank>=2&&f.rank>=2&&h.rank===f.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+h.rank+" and "+f.rank+"."}),Ie(De(y,x),function(){return"Error in fused matMul: outer dimensions ("+y+") and ("+x+") of Tensors with shapes "+h.shape+" and "+f.shape+" must match."}),Ie(m===g,function(){return"Error in fused matMul: inner shapes ("+m+") and ("+g+") of Tensors with shapes "+h.shape+" and "+f.shape+" and transposeA="+a+" and transposeB="+s+" must match."});var C,S,E=h.shape.slice(0,-2).concat([v,b]),z=a?h.as3D(w,m,v):h.as3D(w,v,m),I=s?f.as3D(k,b,g):f.as3D(k,g,b);null!=u&&oi(E,(C=Or(C=ao(u,"bias","fused matMul"),h)[0]).shape),null!=p&&(S=ao(p,"prelu weights","fused matMul"));var A={$a:z,$b:I};return null!=u&&(A.$bias=C),null!=p&&(A.$preluActivationWeights=S),Vr.runKernelFunc(function(t,e){var r=t.fusedBatchMatMul({a:z,b:I,transposeA:a,transposeB:s,bias:C,activation:c,preluActivationWeights:S});return e([z,I,r]),r},A,function(t,e){var r=e[0],n=e[1],o=e[2],i=Gd(t,o,c),l={};return null!=u&&(l={$bias:function(){return $d(C,i)}}),a||s?!a&&s?Object.assign({$a:function(){return i.matMul(n,!1,!1)},$b:function(){return i.matMul(r,!0,!1)}},l):a&&!s?Object.assign({$a:function(){return n.matMul(i,!1,!0)},$b:function(){return r.matMul(i,!1,!1)}},l):Object.assign({$a:function(){return n.matMul(i,!0,!0)},$b:function(){return i.matMul(r,!0,!0)}},l):Object.assign({$a:function(){return i.matMul(n,!1,!0)},$b:function(){return r.matMul(i,!0,!1)}},l)}).reshape(E)}}),Yd=bo({conv2d_:function(t){var e=t.x,r=t.filter,n=t.strides,o=t.pad,a=t.dataFormat,i=void 0===a?"NHWC":a,s=t.dilations,u=void 0===s?[1,1]:s,l=t.dimRoundingMode,c=t.bias,p=t.activation,d=void 0===p?"linear":p,h=t.preluActivationWeights;if(d=d||"linear",!1===Hd(Vr.state.gradientDepth,d)){var f=ap(e,r,n,o,i,u,l);return null!=c&&(f=gc(f,c)),Kd(f,d,h)}var m=ao(e,"x","conv2d"),g=ao(r,"filter","conv2d"),v=m,b=!1;3===m.rank&&(b=!0,v=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),Ie(4===v.rank,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+v.rank+"."}),Ie(4===g.rank,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+g.rank+"."}),null!=l&&Ie(_e(o),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+l+" but got pad "+o+"."}),Ie(v.shape[3]===g.shape[2],function(){return"Error in conv2d: depth of input ("+v.shape[3]+") must match input depth for filter "+g.shape[2]+"."}),Ie(mi(n,u),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+u+"'"}),Ie("NHWC"===i,function(){return"Error in conv2d: got dataFormat of "+i+" but only NHWC is currently supported."});var y,x,w=si(v.shape,g.shape,n,u,o,l);null!=c&&(y=Or(y=ao(c,"bias","fused conv2d"),m)[0],oi(w.outShape,y.shape)),null!=h&&(x=ao(h,"prelu weights","fused conv2d"));var k={x:v,filter:g};null!=c&&(k.bias=y),null!=h&&(k.preluActivationWeights=x);var C=[g,v],S=Vr.runKernelFunc(function(t,e){var r=t.fusedConv2d({input:v,filter:g,convInfo:w,bias:y,activation:d,preluActivationWeights:x});return e([g,v,r]),r},k,function(t,e){var r=e,a=r[0],i=r[1],s=r[2],l=Gd(t,s,d);Ie(fi(u),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"});var p={};return null!=c&&(p={$bias:function(){return $d(y,l)}}),Object.assign({x:function(){return up(i.shape,l,a,n,o)},filter:function(){return sp(i,l,a.shape,n,o)}},p)},"FusedConv2D",{convInfo:w,activation:d},C,[!0]);return b?S.as3D(S.shape[1],S.shape[2],S.shape[3]):S}}),Jd=bo({depthwiseConv2d_:function(t){var e=t.x,r=t.filter,n=t.strides,o=t.pad,a=t.dataFormat,i=void 0===a?"NHWC":a,s=t.dilations,u=void 0===s?[1,1]:s,l=t.dimRoundingMode,c=t.bias,p=t.activation,d=void 0===p?"linear":p,h=t.preluActivationWeights;if(!1===Hd(Vr.state.gradientDepth,d)){var f=lp(e,r,n,o,i,u,l);return null!=c&&(f=gc(f,c)),Kd(f,d,h)}var m=ao(e,"x","depthwiseConv2d"),g=ao(r,"filter","depthwiseConv2d"),v=m,b=!1;3===m.rank&&(b=!0,v=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),Ie(4===v.rank,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+v.rank+"."}),Ie(4===g.rank,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+g.rank+"."}),Ie(v.shape[3]===g.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+v.shape[3]+") must match the inChannels dimension in filter "+g.shape[2]+"."}),null==u&&(u=[1,1]),Ie(mi(n,u),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+u+"'"}),null!=l&&Ie(_e(o),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+l+" but got pad "+o+"."});var y,x,w=si(v.shape,g.shape,n,u,o,l,!0);null!=c&&(y=Or(y=ao(c,"bias","fused conv2d"),m)[0],oi(w.outShape,y.shape)),null!=h&&(x=ao(h,"prelu weights","fused depthwiseConv2d"));var k={x:v,$filter:g};null!=c&&(k.$bias=y),null!=h&&(k.$preluActivationWeights=x);var C=Vr.runKernelFunc(function(t,e){var r=t.fusedDepthwiseConv2D({input:v,filter:g,convInfo:w,bias:y,activation:d,preluActivationWeights:x});return e([v,g,r]),r},k,function(t,e){Ie(fi(u),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"});var r=e[0],n=e[1],o=e[2],a=Gd(t,o,d),i={};return null!=c&&(i={$bias:function(){return $d(y,a)}}),Object.assign({x:function(){return cp(r.shape,a,n,w)},$filter:function(){return pp(r,a,n.shape,w)}},i)});return b?C.as3D(C.shape[1],C.shape[2],C.shape[3]):C}}),Zd=Object.freeze({matMul:Xd,conv2d:Yd,depthwiseConv2d:Jd}),Qd=Object.freeze({image:jd,linalg:Pd,losses:Od,spectral:dd,fused:Zd,signal:Cd,square:ml,conv1d:op,conv2d:ap,conv3d:ip,depthwiseConv2d:lp,separableConv2d:dp,conv2dTranspose:hp,conv3dTranspose:fp,op:bo,batchNormalization2d:rc,batchNormalization3d:nc,batchNormalization4d:oc,batchNormalization:ac,batchNorm:ic,batchNorm2d:sc,batchNorm3d:uc,batchNorm4d:lc,booleanMaskAsync:tp,complex:yo,real:xo,imag:wo,concat:Bo,concat1d:qo,concat2d:Vo,concat3d:Wo,concat4d:Uo,split:jo,matMul:mp,dot:gp,outerProduct:vp,reverse:bp,reverse1d:yp,reverse2d:xp,reverse3d:wp,reverse4d:kp,maxPool:Ep,avgPool:zp,pool:Ip,maxPool3d:Ap,avgPool3d:Np,slice:Rp,slice1d:Tp,slice2d:Dp,slice3d:_p,slice4d:Op,abs:gl,acos:vl,acosh:bl,asin:yl,asinh:xl,atan:wl,atanh:kl,ceil:Cl,clipByValue:Sl,cos:El,cosh:zl,erf:Il,exp:Al,expm1:Nl,floor:Rl,log:Tl,log1p:Dl,logSigmoid:_l,neg:Ol,reciprocal:Fl,round:Ml,rsqrt:Ll,sigmoid:Pl,sign:Bl,isNaN:ql,isInf:Vl,isFinite:Wl,sin:Ul,sinh:jl,softplus:Hl,sqrt:Gl,step:$l,tan:Kl,tanh:Xl,all:Mp,any:Lp,argMax:Pp,argMin:Bp,logSumExp:qp,max:Vp,mean:Wp,min:Up,moments:jp,sum:Hp,prod:Gp,equal:Pc,equalStrict:Bc,greater:qc,greaterEqual:Vc,greaterEqualStrict:Wc,greaterStrict:Uc,less:jc,lessEqual:Hc,lessEqualStrict:Gc,lessStrict:$c,notEqual:Kc,notEqualStrict:Xc,add:gc,addN:vc,addStrict:bc,atan2:yc,div:xc,divNoNan:wc,divStrict:kc,floorDiv:Cc,maximum:Sc,maximumStrict:Ec,minimum:zc,minimumStrict:Ic,mod:Ac,modStrict:Nc,mul:Rc,mulStrict:Tc,pow:Dc,powStrict:_c,squaredDifference:Oc,squaredDifferenceStrict:Fc,sub:Mc,subStrict:Lc,elu:$p,leakyRelu:Kp,prelu:Xp,relu:Yp,relu6:Jp,selu:Zp,logicalAnd:cc,logicalNot:pc,logicalOr:dc,logicalXor:hc,where:fc,whereAsync:mc,buffer:na,print:oa,batchToSpaceND:aa,cast:ia,clone:sa,cumsum:ua,depthToSpace:la,expandDims:ca,eye:pa,multinomial:da,oneHot:ha,pad:fa,pad1d:ma,pad2d:ga,pad3d:va,pad4d:ba,rand:ya,randomNormal:xa,randomGamma:wa,randomUniform:ka,reshape:Ca,spaceToBatchND:Sa,squeeze:Ea,stack:za,tile:Ia,truncatedNormal:Aa,unstack:Na,setdiff1dAsync:Ra,fill:Oo,linspace:Fo,ones:Do,range:Mo,scalar:So,tensor:ko,tensor1d:Eo,tensor2d:zo,tensor3d:Io,tensor4d:Ao,tensor5d:No,tensor6d:Ro,variable:To,zeros:_o,onesLike:Lo,zerosLike:Po,transpose:Qp,softmax:Ja,logSoftmax:Za,localResponseNormalization:td,norm:ed,gather:Zc,unsortedSegmentSum:Qc,basicLSTMCell:rd,multiRNNCell:nd,movingAverage:od,stridedSlice:ad,topk:id,scatterND:sd,fft:ud,ifft:ld,rfft:cd,irfft:pd,sparseToDense:hd,gatherND:fd,diag:md,dropout:gd,hannWindow:yd,hammingWindow:xd,frame:wd,stft:kd,inTopKAsync:Sd});function th(t,e){Array.isArray(t)||(t=[t]),t.forEach(function(t){null!=t&&Ie("complex64"!==t.dtype,function(){return e+" does not support complex64 tensors."})})}function eh(t,e,r,n){if("linear"===r)return t.linear(e);if("relu"===r)return t.relu(e);if("elu"===r)return t.elu(e);if("relu6"===r)return t.relu6(e);if("prelu"===r)return t.prelu(e,n);throw new Error("Activation "+r+" has not been implemented for the CPU backend.")}var rh=function(t){function e(){var e=t.call(this)||this;if(e.blockSize=48,e.firstUse=!0,ge().get("IS_BROWSER")){var r="undefined"!=typeof OffscreenCanvas?new OffscreenCanvas(300,150):"undefined"!=typeof document?document.createElement("canvas"):null;null!==r&&(e.fromPixels2DContext=r.getContext("2d"))}return e.data=new Qa(e,Vr),e}return de(e,t),e.prototype.write=function(t,e,r){this.firstUse&&(this.firstUse=!1,ge().get("IS_NODE")&&ro("\n============================\nHi there 👋. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================\n"));var n={};return this.data.set(n,{values:t,dtype:r}),n},e.prototype.move=function(t,e,r,n){this.data.set(t,{values:e,dtype:n})},e.prototype.numDataIds=function(){return this.data.numDataIds()},e.prototype.fromPixels=function(t,e){if(null==t)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var r,n,o=t.data instanceof Uint8Array,a="undefined"!=typeof ImageData&&t instanceof ImageData,i="undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement,s="undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement,u=i?[t.videoWidth,t.videoHeight]:[t.width,t.height],l=u[0],c=u[1];if(ge().get("IS_NODE")&&null==t.getContext)throw new Error("When running in node, pixels must be an HTMLCanvasElement like the one returned by the `canvas` npm package");if(null!=t.getContext)r=t.getContext("2d").getImageData(0,0,l,c).data;else if(a||o)r=t.data;else{if(!s&&!i)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData or {data: Uint32Array, width: number, height: number}, but was "+t.constructor.name);if(null==this.fromPixels2DContext)throw new Error("Can't read pixels from HTMLImageElement outside the browser.");this.fromPixels2DContext.canvas.width=l,this.fromPixels2DContext.canvas.height=c,this.fromPixels2DContext.drawImage(t,0,0,l,c),r=this.fromPixels2DContext.getImageData(0,0,l,c).data}if(4===e)n=new Int32Array(r);else{var p=l*c;n=new Int32Array(p*e);for(var d=0;d<p;d++)for(var h=0;h<e;++h)n[d*e+h]=r[4*d+h]}return Io(n,[c,l,e],"int32")},e.prototype.read=function(t){return he(this,void 0,void 0,function(){return fe(this,function(e){return[2,this.readSync(t)]})})},e.prototype.readSync=function(t){var e=this.data.get(t),r=e.dtype,n=e.complexTensors;return"complex64"===r?wi(this.readSync(n.real.dataId),this.readSync(n.imag.dataId)):this.data.get(t).values},e.prototype.bufferSync=function(t){var e=this.readSync(t.dataId),r=e;if("string"===t.dtype)try{r=e.map(function(t){return lr(t)})}catch(t){throw new Error("Failed to decode encoded string bytes into utf-8")}return na(t.shape,t.dtype,r)},e.prototype.makeOutput=function(t,e,r){var n=this.write(t,e,r);return Vr.makeTensorFromDataId(n,e,r,this)},e.prototype.disposeData=function(t){if(this.data.has(t)){var e=this.data.get(t).complexTensors;null!=e&&(e.real.dispose(),e.imag.dispose()),this.data.delete(t)}},e.prototype.time=function(t){return he(this,void 0,void 0,function(){var e;return fe(this,function(r){return e=ir(),t(),[2,{kernelMs:ir()-e}]})})},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.complex=function(t,e){var r=this.makeOutput(null,t.shape,"complex64");return this.data.get(r.dataId).complexTensors={real:Vr.keep(t.clone()),imag:Vr.keep(e.clone())},r},e.prototype.real=function(t){return this.data.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.data.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,e,r){if(th(t,"slice"),Ha(t.shape,e,r)){var n=Ga(e,t.strides),o=Te(r);return ko(this.readSync(t.dataId).subarray(n,n+o),r,t.dtype)}for(var a=na(r,t.dtype),i=this.bufferSync(t),s=0;s<a.size;++s){var u=a.indexToLoc(s).map(function(t,r){return t+e[r]});a.values[s]=i.get.apply(i,u)}return a.toTensor()},e.prototype.stridedSlice=function(t,e,r,n){th(t,"stridedSlice");var o=Wa(e,r,n);if(o.some(function(t){return 0===t}))return ko([],o);for(var a=na(o,t.dtype),i=this.bufferSync(t),s=0;s<a.size;s++){for(var u=a.indexToLoc(s),l=new Array(u.length),c=0;c<l.length;c++)l[c]=u[c]*n[c]+e[c];a.set.apply(a,[i.get.apply(i,l)].concat(u))}return a.toTensor()},e.prototype.diag=function(t){for(var e=this.readSync(t.dataId),r=na([t.size,t.size],t.dtype),n=r.values,o=0;o<e.length;o++)n[o*t.size+o]=e[o];return r.toTensor()},e.prototype.unstack=function(t,e){for(var r=t.shape[e],n=new Array(t.rank-1),o=0,a=0;a<t.rank;a++)a!==e&&(n[o++]=t.shape[a]);var i=new Array(t.rank).fill(0),s=t.shape.slice();s[e]=1;var u=new Array(r);for(a=0;a<u.length;a++)i[e]=a,u[a]=this.slice(t,i,s).reshape(n);return u},e.prototype.reverse=function(t,e){th(t,"reverse");for(var r=na(t.shape,t.dtype),n=this.bufferSync(t),o=function(o){var a=r.indexToLoc(o),i=a.slice();e.forEach(function(e){return i[e]=t.shape[e]-1-i[e]}),r.set.apply(r,[n.get.apply(n,i)].concat(a))},a=0;a<r.size;a++)o(a);return r.toTensor()},e.prototype.concat=function(t,e){var r=this;if("complex64"===t[0].dtype){var n=t.map(function(t){return xo(t)}),o=t.map(function(t){return wo(t)});return yo(this.concat(n,e),this.concat(o,e))}var a=t.map(function(t){var r=Te(t.shape.slice(e));return t.as2D(-1,r)}),i=vo(a.map(function(t){return t.shape}),1),s=na(i,t[0].dtype).values;if(1===a[0].shape[0]){var u=0;a.forEach(function(t){s.set(r.readSync(t.dataId),u),u+=t.size})}else{var l=0;a.forEach(function(t){for(var e=r.readSync(t.dataId),n=0,o=0;o<t.shape[0];++o)for(var a=o*i[1]+l,u=0;u<t.shape[1];++u)s[a+u]=e[n++];l+=t.shape[1]})}var c=vo(t.map(function(t){return t.shape}),e);return ko(s,c,t[0].dtype)},e.prototype.neg=function(t){return th(t,"neg"),this.multiply(So(-1),t)},e.prototype.add=function(t,e){return"complex64"===t.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),function(t,e,r,n){return{real:t+r,imag:e+n}}):this.broadcastedBinaryOp(t,e,Dr(t.dtype,e.dtype),function(t,e){return t+e})},e.prototype.addN=function(t){var e=this;th(t,"addN");for(var r=t.map(function(t){return e.readSync(t.dataId)}),n=na(t[0].shape,t[0].dtype),o=n.values,a=0;a<t.length;a++)for(var i=r[a],s=0;s<o.length;s++)o[s]+=i[s];return n.toTensor()},e.prototype.subtract=function(t,e){return"complex64"===t.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),function(t,e,r,n){return{real:t-r,imag:e-n}}):this.broadcastedBinaryOp(t,e,Dr(t.dtype,e.dtype),function(t,e){return t-e})},e.prototype.pow=function(t,e){return th([t,e],"pow"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.pow(t,e)})},e.prototype.batchMatMul=function(t,e,r,n){th([t,e],"matMul");for(var o=r?t.shape[1]:t.shape[2],a=r?t.shape[2]:t.shape[1],i=n?e.shape[1]:e.shape[2],s=t.shape[0],u=this.readSync(t.dataId),l=this.readSync(e.dataId),c=r?[t.strides[0],1,t.strides[1]]:[t.strides[0],t.strides[1],1],p=c[0],d=c[1],h=c[2],f=n?[1,e.strides[1],e.strides[0]]:[e.strides[1],1,e.strides[0]],m=f[0],g=f[1],v=f[2],b=a*i,y=na([s,a,i],t.dtype),x=y.values,w=this.blockSize,k=0;k<s;k++)for(var C=0;C<a;C+=w)for(var S=0;S<i;S+=w)for(var E=0;E<o;E+=w)for(var z=Math.min(C+w,a),I=Math.min(S+w,i),A=Math.min(E+w,o),N=C;N<z;N++)for(var R=S;R<I;R++){for(var T=0,D=E;D<A;D++)T+=u[k*p+N*d+D*h]*l[D*m+R*g+k*v];x[k*b+(N*i+R)]+=T}return y.toTensor()},e.prototype.fusedBatchMatMul=function(t){var e=t.a,r=t.b,n=t.transposeA,o=t.transposeB,a=t.bias,i=t.activation,s=t.preluActivationWeights,u=this.batchMatMul(e,r,n,o);return a&&(u=this.add(u,a)),i&&(u=eh(this,u,i,s)),u},e.prototype.multiply=function(t,e){return"complex64"===t.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),function(t,e,r,n){return{real:t*r-e*n,imag:t*n+e*r}}):this.broadcastedBinaryOp(t,e,Dr(t.dtype,e.dtype),function(t,e){return t*e})},e.prototype.realDivide=function(t,e){return th([t,e],"realDivide"),this.broadcastedBinaryOp(t,e,"float32",function(t,e){return t/e})},e.prototype.floorDiv=function(t,e){return th([t,e],"floorDiv"),this.broadcastedBinaryOp(t,e,"int32",function(t,e){return Math.floor(t/e)})},e.prototype.sum=function(t,e){th(t,"sum"),po("sum",e,t.rank);for(var r=lo(t.shape,e),n=r[0],o=r[1],a=_o(n,Dr(t.dtype,"int32")),i=Te(o),s=this.readSync(a.dataId),u=this.readSync(t.dataId),l=0;l<s.length;++l){for(var c=l*i,p=0,d=0;d<i;++d)p+=u[c+d];s[l]=p}return a},e.prototype.prod=function(t,e){th(t,"sum");for(var r=lo(t.shape,e),n=r[0],o=r[1],a=_o(n,Dr(t.dtype,"int32")),i=Te(o),s=this.readSync(a.dataId),u=this.readSync(t.dataId),l=0;l<s.length;++l){for(var c=l*i,p=1,d=0;d<i;++d)p*=u[c+d];s[l]=p}return a},e.prototype.unsortedSegmentSum=function(t,e,r){th(t,"unsortedSegmentSum");for(var n=[],o=t.rank-e.rank,a=0;a<o;++a)e=e.expandDims(a+1);for(a=0;a<r;++a){var i=So(a,"int32"),s=Pc(i,e).asType("float32").mul(t).sum(0);n.push(s)}return za(n)},e.prototype.argMin=function(t,e){th(t,"argMin");var r=[e];po("argMin",r,t.rank);for(var n=lo(t.shape,r),o=n[0],a=n[1],i=_o(o,"int32"),s=Te(a),u=this.readSync(i.dataId),l=this.readSync(t.dataId),c=0;c<u.length;++c){for(var p=c*s,d=l[p],h=0,f=0;f<s;++f){var m=l[p+f];m<d&&(d=m,h=f)}u[c]=h}return i},e.prototype.argMax=function(t,e){th(t,"argMax");var r=[e];po("argMax",r,t.rank);for(var n=lo(t.shape,r),o=n[0],a=n[1],i=_o(o,"int32"),s=Te(a),u=this.readSync(i.dataId),l=this.readSync(t.dataId),c=0;c<u.length;++c){for(var p=c*s,d=l[p],h=0,f=0;f<s;++f){var m=l[p+f];m>d&&(d=m,h=f)}u[c]=h}return i},e.prototype.cumsum=function(t,e,r,n){if(th(t,"cumsum"),e!==t.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(t.rank-1)+" but got axis="+e);for(var o=Dr(t.dtype,"int32"),a=_o(t.shape,o),i=this.readSync(a.dataId),s=this.readSync(t.dataId),u=t.shape[t.rank-1],l=n?function(t,e){return t+u-e-1}:function(t,e){return t+e},c=0;c<s.length;c+=u)for(var p=0;p<u;p++){var d=l(c,p);if(0===p)i[d]=r?0:s[d];else{var h=l(c,p-1);i[d]=r?s[h]+i[h]:s[d]+i[h]}}return a},e.prototype.equal=function(t,e){return th([t,e],"equal"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t===e?1:0})},e.prototype.notEqual=function(t,e){return th([t,e],"notEqual"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t!==e?1:0})},e.prototype.less=function(t,e){return th([t,e],"less"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t<e?1:0})},e.prototype.lessEqual=function(t,e){return th([t,e],"lessEqual"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t<=e?1:0})},e.prototype.greater=function(t,e){return th([t,e],"greater"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t>e?1:0})},e.prototype.greaterEqual=function(t,e){return th([t,e],"greaterEqual"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t>=e?1:0})},e.prototype.logicalNot=function(t){th(t,"logicalNot");for(var e=this.readSync(t.dataId),r=new Uint8Array(e.length),n=0;n<e.length;++n)r[n]=e[n]?0:1;return this.makeOutput(r,t.shape,"bool")},e.prototype.logicalAnd=function(t,e){return th([t,e],"logicalAnd"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t&&e})},e.prototype.logicalOr=function(t,e){return th([t,e],"logicalOr"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t||e})},e.prototype.select=function(t,e,r){th([t,e,r],"select");for(var n=this.readSync(t.dataId),o=this.readSync(e.dataId),a=this.readSync(r.dataId),i=_o(e.shape,Dr(e.dtype,r.dtype)),s=this.readSync(i.dataId),u=0,l=0===t.rank||t.rank>1||1===e.rank?1:Te(e.shape.slice(1)),c=0;c<n.length;c++)for(var p=0;p<l;p++)1===n[c]?s[u++]=o[c]:s[u++]=a[c];return i},e.prototype.where=function(t){th([t],"where");var e=this.readSync(t.dataId);return Ri(t.shape,e)},e.prototype.topk=function(t,e,r){return th(t,"topk"),Ni(this.readSync(t.dataId),t.shape,t.dtype,e)},e.prototype.min=function(t,e){th(t,"min"),po("min",e,t.rank);for(var r=lo(t.shape,e),n=r[0],o=r[1],a=_o(n,t.dtype),i=Te(o),s=this.readSync(a.dataId),u=this.readSync(t.dataId),l=0;l<s.length;++l){for(var c=l*i,p=u[c],d=0;d<i;++d){var h=u[c+d];h<p&&(p=h)}s[l]=p}return a},e.prototype.minimum=function(t,e){return th([t,e],"minimum"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.min(t,e)})},e.prototype.mod=function(t,e){return th([t,e],"mod"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){var r=t%e;return t<0&&e<0||t>=0&&e>=0?r:(r+e)%e})},e.prototype.max=function(t,e){th(t,"max"),po("max",e,t.rank);for(var r=lo(t.shape,e),n=r[0],o=r[1],a=_o(n,t.dtype),i=Te(o),s=this.readSync(a.dataId),u=this.readSync(t.dataId),l=0;l<s.length;++l){for(var c=l*i,p=u[c],d=0;d<i;++d){var h=u[c+d];h>p&&(p=h)}s[l]=p}return a},e.prototype.maximum=function(t,e){return th([t,e],"maximum"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.max(t,e)})},e.prototype.all=function(t,e){th(t,"all"),po("all",e,t.rank);for(var r=lo(t.shape,e),n=r[0],o=r[1],a=_o(n,t.dtype),i=Te(o),s=this.readSync(a.dataId),u=this.readSync(t.dataId),l=0;l<s.length;++l){for(var c=l*i,p=u[c],d=0;d<i;++d){var h=u[c+d];p=p&&h}s[l]=p}return a},e.prototype.any=function(t,e){th(t,"any"),po("any",e,t.rank);for(var r=lo(t.shape,e),n=r[0],o=r[1],a=_o(n,t.dtype),i=Te(o),s=this.readSync(a.dataId),u=this.readSync(t.dataId),l=0;l<s.length;++l){for(var c=l*i,p=u[c],d=0;d<i;++d){var h=u[c+d];p=p||h}s[l]=p}return a},e.prototype.squaredDifference=function(t,e){return th([t,e],"squaredDifference"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){var r=t-e;return r*r})},e.prototype.ceil=function(t){th(t,"ceil");for(var e=this.readSync(t.dataId),r=new Float32Array(e.length),n=0;n<e.length;++n)r[n]=Math.ceil(e[n]);return this.makeOutput(r,t.shape,"float32")},e.prototype.floor=function(t){th(t,"floor");for(var e=this.readSync(t.dataId),r=new Float32Array(e.length),n=0;n<e.length;++n)r[n]=Math.floor(e[n]);return this.makeOutput(r,t.shape,"float32")},e.prototype.sign=function(t){th(t,"x");for(var e=this.readSync(t.dataId),r=new Float32Array(e.length),n=0;n<e.length;++n)e[n]<0?r[n]=-1:e[n]>0?r[n]=1:r[n]=0;return this.makeOutput(r,t.shape,"float32")},e.prototype.isNaN=function(t){th(t,"x");for(var e=this.readSync(t.dataId),r=new Uint8Array(e.length),n=0;n<e.length;++n)Number.isNaN(e[n])&&(r[n]=1);return this.makeOutput(r,t.shape,"bool")},e.prototype.isInf=function(t){th(t,"x");for(var e=this.readSync(t.dataId),r=new Uint8Array(e.length),n=0;n<e.length;++n)Math.abs(e[n])===1/0&&(r[n]=1);return this.makeOutput(r,t.shape,"bool")},e.prototype.isFinite=function(t){th(t,"x");for(var e=this.readSync(t.dataId),r=new Uint8Array(e.length),n=0;n<e.length;++n)Number.isFinite(e[n])&&(r[n]=1);return this.makeOutput(r,t.shape,"bool")},e.prototype.round=function(t){th(t,"round");for(var e=this.readSync(t.dataId),r=new Float32Array(e.length),n=0;n<e.length;++n){var o=Math.floor(e[n]);e[n]-o<.5?r[n]=Math.floor(e[n]):e[n]-o>.5?r[n]=Math.ceil(e[n]):r[n]=o%2==0?o:o+1}return this.makeOutput(r,t.shape,"float32")},e.prototype.exp=function(t){th(t,"exp");for(var e=this.readSync(t.dataId),r=new Float32Array(e.length),n=0;n<e.length;++n)r[n]=Math.exp(e[n]);return this.makeOutput(r,t.shape,"float32")},e.prototype.expm1=function(t){th(t,"expm1");for(var e=this.readSync(t.dataId),r=new Float32Array(e.length),n=0;n<e.length;++n)r[n]=Math.expm1(e[n]);return this.makeOutput(r,t.shape,"float32")},e.prototype.log=function(t){th(t,"log");for(var e=this.readSync(t.dataId),r=new Float32Array(e.length),n=0;n<e.length;++n){var o=e[n];r[n]=Math.log(o)}return this.makeOutput(r,t.shape,"float32")},e.prototype.log1p=function(t){th(t,"log1p");for(var e=this.readSync(t.dataId),r=new Float32Array(e.length),n=0;n<e.length;++n){var o=e[n];r[n]=Math.log1p(o)}return this.makeOutput(r,t.shape,"float32")},e.prototype.sqrt=function(t){th(t,"sqrt");for(var e=this.readSync(t.dataId),r=new Float32Array(e.length),n=0;n<e.length;++n){var o=e[n];r[n]=Math.sqrt(o)}return this.makeOutput(r,t.shape,"float32")},e.prototype.rsqrt=function(t){th(t,"rsqrt");for(var e=this.readSync(t.dataId),r=new Float32Array(e.length),n=0;n<e.length;++n){var o=e[n];r[n]=1/Math.sqrt(o)}return this.makeOutput(r,t.shape,"float32")},e.prototype.reciprocal=function(t){th(t,"reciprocal");for(var e=this.readSync(t.dataId),r=new Float32Array(e.length),n=0;n<e.length;++n)r[n]=1/e[n];return this.makeOutput(r,t.shape,"float32")},e.prototype.linear=function(t){return t},e.prototype.relu=function(t){th(t,"relu");for(var e=_o(t.shape,t.dtype),r=this.readSync(e.dataId),n=this.readSync(t.dataId),o=0;o<n.length;++o)r[o]=Math.max(0,n[o]);return e},e.prototype.relu6=function(t){th(t,"relu");for(var e=_o(t.shape,t.dtype),r=this.readSync(e.dataId),n=this.readSync(t.dataId),o=0;o<n.length;++o)r[o]=Math.min(Math.max(0,n[o]),6);return e},e.prototype.prelu=function(t,e){return th([t,e],"prelu"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return t<0?e*t:t})},e.prototype.elu=function(t){th(t,"elu");for(var e=new Float32Array(t.size),r=this.readSync(t.dataId),n=0;n<r.length;++n){var o=r[n];e[n]=o>=0?o:Math.exp(o)-1}return this.makeOutput(e,t.shape,"float32")},e.prototype.eluDer=function(t,e){th([t,e],"eluDer");for(var r=new Float32Array(e.size),n=this.readSync(e.dataId),o=this.readSync(t.dataId),a=0;a<n.length;++a){var i=n[a];r[a]=i>=1?o[a]:o[a]*(i+1)}return this.makeOutput(r,e.shape,"float32")},e.prototype.selu=function(t){th(t,"selu");for(var e=new Float32Array(t.size),r=this.readSync(t.dataId),n=0;n<r.length;++n){var o=r[n];e[n]=o>=0?1.0507009873554805*o:1.7580993408473768*(Math.exp(o)-1)}return this.makeOutput(e,t.shape,"float32")},e.prototype.clip=function(t,e,r){th(t,"clip");for(var n=new Float32Array(t.size),o=this.readSync(t.dataId),a=0;a<o.length;++a){var i=o[a];n[a]=i>r?r:i<e?e:i}return this.makeOutput(n,t.shape,"float32")},e.prototype.abs=function(t){for(var e=new Float32Array(t.size),r=this.readSync(t.dataId),n=0;n<r.length;++n)e[n]=Math.abs(r[n]);return this.makeOutput(e,t.shape,"float32")},e.prototype.complexAbs=function(t){for(var e=new Float32Array(t.size),r=this.readSync(t.dataId),n=0;n<t.size;++n){var o=r[2*n],a=r[2*n+1];e[n]=Math.hypot(o,a)}return this.makeOutput(e,t.shape,"float32")},e.prototype.int=function(t){th(t,"int");for(var e=new Int32Array(t.size),r=this.readSync(t.dataId),n=0;n<r.length;++n)e[n]=r[n];return this.makeOutput(e,t.shape,"int32")},e.prototype.sigmoid=function(t){th(t,"sigmoid");for(var e=new Float32Array(t.size),r=this.readSync(t.dataId),n=0;n<r.length;++n)e[n]=1/(1+Math.exp(-r[n]));return this.makeOutput(e,t.shape,"float32")},e.prototype.softplus=function(t){th(t,"softplus");for(var e=Math.log(1.1920928955078125e-7)+2,r=new Float32Array(t.size),n=this.readSync(t.dataId),o=0;o<n.length;++o){var a,i=n[o]>-e,s=n[o]<e,u=Math.exp(n[o]);a=s?u:i?n[o]:Math.log(1+u),r[o]=a}return this.makeOutput(r,t.shape,"float32")},e.prototype.sin=function(t){th(t,"sin");for(var e=new Float32Array(t.size),r=this.readSync(t.dataId),n=0;n<r.length;++n)e[n]=Math.sin(r[n]);return this.makeOutput(e,t.shape,"float32")},e.prototype.cos=function(t){th(t,"cos");for(var e=new Float32Array(t.size),r=this.readSync(t.dataId),n=0;n<r.length;++n)e[n]=Math.cos(r[n]);return this.makeOutput(e,t.shape,"float32")},e.prototype.tan=function(t){th(t,"tan");for(var e=new Float32Array(t.size),r=this.readSync(t.dataId),n=0;n<r.length;++n)e[n]=Math.tan(r[n]);return this.makeOutput(e,t.shape,"float32")},e.prototype.asin=function(t){th(t,"asin");for(var e=new Float32Array(t.size),r=this.readSync(t.dataId),n=0;n<r.length;++n)e[n]=Math.asin(r[n]);return this.makeOutput(e,t.shape,"float32")},e.prototype.acos=function(t){th(t,"acos");for(var e=new Float32Array(t.size),r=this.readSync(t.dataId),n=0;n<r.length;++n)e[n]=Math.acos(r[n]);return this.makeOutput(e,t.shape,"float32")},e.prototype.atan=function(t){th(t,"atan");for(var e=new Float32Array(t.size),r=this.readSync(t.dataId),n=0;n<r.length;++n)e[n]=Math.atan(r[n]);return this.makeOutput(e,t.shape,"float32")},e.prototype.atan2=function(t,e){return th([t,e],"atan2"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.atan2(t,e)})},e.prototype.sinh=function(t){th(t,"sinh");for(var e=new Float32Array(t.size),r=this.readSync(t.dataId),n=0;n<r.length;++n)e[n]=Math.sinh(r[n]);return this.makeOutput(e,t.shape,"float32")},e.prototype.cosh=function(t){th(t,"cosh");for(var e=new Float32Array(t.size),r=this.readSync(t.dataId),n=0;n<r.length;++n)e[n]=Math.cosh(r[n]);return this.makeOutput(e,t.shape,"float32")},e.prototype.tanh=function(t){th(t,"tanh");for(var e=new Float32Array(t.size),r=this.readSync(t.dataId),n=0;n<r.length;++n)e[n]=Oe(r[n]);return this.makeOutput(e,t.shape,"float32")},e.prototype.asinh=function(t){th(t,"asinh");for(var e=new Float32Array(t.size),r=this.readSync(t.dataId),n=0;n<r.length;++n)e[n]=Math.asinh(r[n]);return this.makeOutput(e,t.shape,"float32")},e.prototype.acosh=function(t){th(t,"acosh");for(var e=new Float32Array(t.size),r=this.readSync(t.dataId),n=0;n<r.length;++n)e[n]=Math.acosh(r[n]);return this.makeOutput(e,t.shape,"float32")},e.prototype.atanh=function(t){th(t,"atanh");for(var e=new Float32Array(t.size),r=this.readSync(t.dataId),n=0;n<r.length;++n)e[n]=Math.atanh(r[n]);return this.makeOutput(e,t.shape,"float32")},e.prototype.erf=function(t){th(t,"erf");for(var e=new Float32Array(t.size),r=this.readSync(t.dataId),n=0;n<r.length;++n){var o=Math.sign(r[n]),a=Math.abs(r[n]),i=1/(1+.3275911*a);e[n]=o*(1-((((1.061405429*i-1.453152027)*i+1.421413741)*i-.284496736)*i+.254829592)*i*Math.exp(-a*a))}return this.makeOutput(e,t.shape,"float32")},e.prototype.step=function(t,e){void 0===e&&(e=0),th(t,"step");for(var r=new Float32Array(t.size),n=this.readSync(t.dataId),o=0;o<n.length;++o){var a=n[o];isNaN(a)?r[o]=NaN:r[o]=a>0?1:e}return this.makeOutput(r,t.shape,"float32")},e.prototype.fusedConv2d=function(t){var e=t.input,r=t.filter,n=t.convInfo,o=t.bias,a=t.activation,i=t.preluActivationWeights,s=this.conv2d(e,r,n);return o&&(s=this.add(s,o)),a&&(s=eh(this,s,a,i)),s},e.prototype.conv2d=function(t,e,r){th([t,e],"conv2d");for(var n=r.filterHeight,o=r.filterWidth,a=r.dilationHeight,i=r.dilationWidth,s=r.padInfo.left,u=r.padInfo.top,l="channelsLast"===r.dataFormat,c=na(r.outShape,t.dtype),p=t.strides[0],d=l?t.strides[1]:t.strides[2],h=l?t.strides[2]:1,f=l?1:t.strides[1],m=c.strides[0],g=l?c.strides[1]:c.strides[2],v=l?c.strides[2]:1,b=l?1:c.strides[1],y=this.readSync(t.dataId),x=this.readSync(e.dataId),w=c.values,k=0;k<r.batchSize;++k)for(var C=k*p,S=k*m,E=0;E<r.outHeight;++E)for(var z=S+E*g,I=E*r.strideHeight-u,A=0;A<n;A++){var N=I+A*a;if(!(N<0||N>=r.inHeight))for(var R=A*e.strides[0],T=C+N*d,D=0;D<r.outWidth;++D)for(var _=z+D*v,O=D*r.strideWidth-s,F=0;F<o;F++){var M=O+F*i;if(!(M<0||M>=r.inWidth))for(var L=T+M*h,P=R+F*e.strides[1],B=0;B<r.inChannels;++B){for(var q=y[L+B*f],V=0;V<r.outChannels;++V)w[_+V*b]+=q*x[P+V];P+=r.outChannels}}}return c.toTensor()},e.prototype.conv3d=function(t,e,r){for(var n=r.filterDepth,o=r.filterHeight,a=r.filterWidth,i=r.dilationDepth,s=r.dilationHeight,u=r.dilationWidth,l=r.padInfo.front,c=r.padInfo.left,p=r.padInfo.top,d=na(r.outShape,t.dtype),h=this.readSync(t.dataId),f=this.readSync(e.dataId),m=d.values,g=0;g<r.batchSize;++g)for(var v=g*t.strides[0],b=g*d.strides[0],y=0;y<r.outDepth;++y)for(var x=b+y*d.strides[1],w=y*r.strideDepth-l,k=0;k<n;k++){var C=w+k*i;if(!(C<0||C>=r.inDepth))for(var S=k*e.strides[0],E=v+C*t.strides[1],z=0;z<r.outHeight;++z)for(var I=x+z*d.strides[2],A=z*r.strideHeight-p,N=0;N<o;N++){var R=A+N*s;if(!(R<0||R>=r.inHeight))for(var T=S+N*e.strides[1],D=E+R*t.strides[2],_=0;_<r.outWidth;++_)for(var O=I+_*r.outChannels,F=_*r.strideWidth-c,M=0;M<a;M++){var L=F+M*u;if(!(L<0||L>=r.inWidth))for(var P=T+M*e.strides[2],B=D+L*r.inChannels,q=P,V=0;V<r.inChannels;++V){for(var W=h[B+V],U=0;U<r.outChannels;++U)m[O+U]+=W*f[q+U];q+=r.outChannels}}}}return d.toTensor()},e.prototype.conv2dDerInput=function(t,e,r){th([t,e],"conv2dDerInput");for(var n=na(r.inShape,"float32"),o=n.values,a=this.readSync(t.dataId),i=this.readSync(e.dataId),s=e.strides,u=s[0],l=s[1],c=s[2],p=r.batchSize,d=r.filterHeight,h=r.filterWidth,f=r.inChannels,m=r.inHeight,g=r.inWidth,v=r.outChannels,b=r.outHeight,y=r.outWidth,x=r.strideHeight,w=r.strideWidth,k=r.dataFormat,C=d-1-r.padInfo.top,S=h-1-r.padInfo.left,E="channelsLast"===k,z=n.strides[0],I=E?n.strides[1]:n.strides[2],A=E?n.strides[2]:1,N=E?1:n.strides[1],R=t.strides[0],T=E?t.strides[1]:t.strides[2],D=E?t.strides[2]:1,_=E?1:t.strides[1],O=0;O<p;++O)for(var F=0;F<f;++F)for(var M=0;M<m;++M)for(var L=M-C,P=Math.max(0,Math.ceil(L/x)),B=Math.min(b,(d+L)/x),q=0;q<g;++q){for(var V=q-S,W=Math.max(0,Math.ceil(V/w)),U=Math.min(y,(h+V)/w),j=0,H=P;H<B;++H)for(var G=H*x-L,$=W;$<U;++$)for(var K=R*O+T*H+D*$,X=u*(d-1-G)+l*(h-1-($*w-V))+c*F,Y=0;Y<v;++Y)j+=a[K+_*Y]*i[X+Y];o[z*O+I*M+A*q+N*F]=j}return n.toTensor()},e.prototype.conv3dDerInput=function(t,e,r){for(var n=na(r.inShape,"float32"),o=n.values,a=n.strides,i=a[0],s=a[1],u=a[2],l=a[3],c=this.readSync(t.dataId),p=t.strides,d=p[0],h=p[1],f=p[2],m=p[3],g=this.readSync(e.dataId),v=e.strides,b=v[0],y=v[1],x=v[2],w=v[3],k=r.batchSize,C=r.filterDepth,S=r.filterHeight,E=r.filterWidth,z=r.inChannels,I=r.inDepth,A=r.inHeight,N=r.inWidth,R=r.outChannels,T=r.outDepth,D=r.outHeight,_=r.outWidth,O=r.strideDepth,F=r.strideHeight,M=r.strideWidth,L=C-1-r.padInfo.front,P=S-1-r.padInfo.top,B=E-1-r.padInfo.left,q=0;q<k;++q)for(var V=0;V<z;++V)for(var W=0;W<I;++W)for(var U=W-L,j=Math.max(0,Math.ceil(U/O)),H=Math.min(T,(C+U)/O),G=0;G<A;++G)for(var $=G-P,K=Math.max(0,Math.ceil($/F)),X=Math.min(D,(S+$)/F),Y=0;Y<N;++Y){for(var J=Y-B,Z=Math.max(0,Math.ceil(J/M)),Q=Math.min(_,(E+J)/M),tt=0,et=j;et<H;++et)for(var rt=et*O-U,nt=K;nt<X;++nt)for(var ot=nt*F-$,at=Z;at<Q;++at)for(var it=d*q+h*et+f*nt+m*at,st=b*(C-1-rt)+y*(S-1-ot)+x*(E-1-(at*M-J))+w*V,ut=0;ut<R;++ut)tt+=c[it+ut]*g[st+ut];o[i*q+s*W+u*G+l*Y+V]=tt}return n.toTensor()},e.prototype.conv2dDerFilter=function(t,e,r){th([t,e],"conv2dDerFilter");for(var n=r.strideHeight,o=r.strideWidth,a=r.filterHeight,i=r.filterWidth,s="channelsLast"===r.dataFormat,u=na(r.filterShape,"float32"),l=r.padInfo.left,c=r.padInfo.top,p=this.bufferSync(t),d=this.bufferSync(e),h=0;h<a;++h)for(var f=Math.max(0,Math.ceil((c-h)/n)),m=Math.min(r.outHeight,(r.inHeight+c-h)/n),g=0;g<i;++g)for(var v=Math.max(0,Math.ceil((l-g)/o)),b=Math.min(r.outWidth,(r.inWidth+l-g)/o),y=0;y<r.inChannels;++y)for(var x=0;x<r.outChannels;++x){for(var w=0,k=0;k<r.batchSize;++k)for(var C=f;C<m;++C)for(var S=h+C*n-c,E=v;E<b;++E){var z=g+E*o-l;w+=s?p.get(k,S,z,y)*d.get(k,C,E,x):p.get(k,y,S,z)*d.get(k,x,C,E)}u.set(w,h,g,y,x)}return u.toTensor()},e.prototype.conv3dDerFilter=function(t,e,r){for(var n=r.strideDepth,o=r.strideHeight,a=r.strideWidth,i=r.filterDepth,s=r.filterHeight,u=r.filterWidth,l=na(r.filterShape,"float32"),c=l.values,p=l.strides,d=p[0],h=p[1],f=p[2],m=p[3],g=this.readSync(e.dataId),v=e.strides,b=v[0],y=v[1],x=v[2],w=v[3],k=this.readSync(t.dataId),C=t.strides,S=C[0],E=C[1],z=C[2],I=C[3],A=r.padInfo.front,N=r.padInfo.left,R=r.padInfo.top,T=0;T<i;++T)for(var D=Math.max(0,Math.ceil((A-T)/n)),_=Math.min(r.outDepth,(r.inDepth+A-T)/n),O=T*d,F=0;F<s;++F)for(var M=Math.max(0,Math.ceil((R-F)/o)),L=Math.min(r.outHeight,(r.inHeight+R-F)/o),P=F*h+O,B=0;B<u;++B)for(var q=Math.max(0,Math.ceil((N-B)/a)),V=Math.min(r.outWidth,(r.inWidth+N-B)/a),W=B*f+P,U=0;U<r.inChannels;++U)for(var j=U*m+W,H=0;H<r.outChannels;++H){for(var G=0,$=0;$<r.batchSize;++$)for(var K=$*S,X=$*b,Y=D;Y<_;++Y)for(var J=(T+Y*n-A)*E+K,Z=Y*y+X,Q=M;Q<L;++Q)for(var tt=(F+Q*o-R)*z+J,et=Q*x+Z,rt=q;rt<V;++rt){var nt=rt*w+et;G+=k[(B+rt*a-N)*I+tt+U]*g[nt+H]}c[j+H]=G}return l.toTensor()},e.prototype.fusedDepthwiseConv2D=function(t){var e=t.input,r=t.filter,n=t.convInfo,o=t.bias,a=t.activation,i=t.preluActivationWeights,s=this.depthwiseConv2D(e,r,n);return o&&(s=this.add(s,o)),a&&(s=eh(this,s,a,i)),s},e.prototype.depthwiseConv2D=function(t,e,r){th([t,e],"depthwiseConv2D");for(var n=r.filterHeight,o=r.filterWidth,a=r.dilationHeight,i=r.dilationWidth,s=r.padInfo.left,u=r.padInfo.top,l=r.outChannels/r.inChannels,c=na(r.outShape,t.dtype),p=this.readSync(t.dataId),d=this.readSync(e.dataId),h=c.values,f=0;f<r.batchSize;++f)for(var m=f*t.strides[0],g=f*c.strides[0],v=0;v<r.outHeight;++v)for(var b=g+v*c.strides[1],y=v*r.strideHeight-s,x=0;x<n;++x){var w=y+x*a;if(!(w<0||w>=r.inHeight))for(var k=x*e.strides[0],C=m+w*t.strides[1],S=0;S<r.outWidth;++S)for(var E=b+S*c.strides[2],z=S*r.strideWidth-u,I=0;I<o;++I){var A=z+I*i;if(!(A<0||A>=r.inWidth))for(var N=k+I*e.strides[1],R=C+A*r.inChannels,T=E,D=N,_=0;_<r.inChannels;++_){for(var O=p[R+_],F=0;F<l;++F)h[T+F]+=O*d[D+F];T+=l,D+=l}}}return c.toTensor()},e.prototype.depthwiseConv2DDerInput=function(t,e,r){th([t,e],"depthwiseConv2DDerInput");for(var n=na(r.inShape,"float32"),o=n.values,a=n.strides,i=a[0],s=a[1],u=a[2],l=this.readSync(t.dataId),c=t.strides,p=c[0],d=c[1],h=c[2],f=this.readSync(e.dataId),m=e.strides,g=m[0],v=m[1],b=m[2],y=r.batchSize,x=r.filterHeight,w=r.filterWidth,k=r.inChannels,C=r.inHeight,S=r.inWidth,E=r.outChannels,z=r.outHeight,I=r.outWidth,A=r.strideHeight,N=r.strideWidth,R=x-1-r.padInfo.top,T=w-1-r.padInfo.left,D=E/k,_=0;_<y;++_)for(var O=0;O<k;++O)for(var F=0;F<C;++F)for(var M=F-R,L=Math.max(0,Math.ceil(M/A)),P=Math.min(z,(x+M)/A),B=0;B<S;++B){for(var q=B-T,V=Math.max(0,Math.ceil(q/N)),W=Math.min(I,(w+q)/N),U=0,j=L;j<P;++j)for(var H=j*A-M,G=V;G<W;++G)for(var $=p*_+d*j+h*G,K=g*(x-1-H)+v*(w-1-(G*N-q))+b*O,X=0;X<D;++X)U+=l[$+(O*D+X)]*f[K+X];o[i*_+s*F+u*B+O]=U}return n.toTensor()},e.prototype.depthwiseConv2DDerFilter=function(t,e,r){th([t,e],"depthwiseConv2DDerFilter");for(var n=r.strideHeight,o=r.strideWidth,a=r.filterHeight,i=r.filterWidth,s=na(r.filterShape,"float32"),u=r.padInfo.left,l=r.padInfo.top,c=r.outChannels/r.inChannels,p=this.bufferSync(t),d=this.bufferSync(e),h=0;h<a;++h)for(var f=Math.max(0,Math.ceil((l-h)/n)),m=Math.min(r.outHeight,(r.inHeight+l-h)/n),g=0;g<i;++g)for(var v=Math.max(0,Math.ceil((u-g)/o)),b=Math.min(r.outWidth,(r.inWidth+u-g)/o),y=0;y<r.outChannels;++y){for(var x=Math.trunc(y/c),w=y%c,k=0,C=0;C<r.batchSize;++C)for(var S=f;S<m;++S)for(var E=h+S*n-l,z=v;z<b;++z){var I=g+z*o-u;k+=p.get(C,E,I,x)*d.get(C,S,z,y)}s.set(k,h,g,x,w)}return s.toTensor()},e.prototype.tile=function(t,e){return th(t,"tile"),Ai(this.bufferSync(t),e)},e.prototype.pad=function(t,e,r){th(t,"pad");var n=e.map(function(e,r){return e[0]+t.shape[r]+e[1]}),o=e.map(function(t){return t[0]}),a=this.bufferSync(t),i=na(n,t.dtype);0!==r&&i.values.fill(r);for(var s=0;s<t.size;s++){var u=a.indexToLoc(s),l=u.map(function(t,e){return t+o[e]});i.set.apply(i,[a.get.apply(a,u)].concat(l))}return i.toTensor()},e.prototype.transpose=function(t,e){th(t,"transpose");for(var r=new Array(t.rank),n=0;n<r.length;n++)r[n]=t.shape[e[n]];var o=this.readSync(t.dataId),a=na(r,t.dtype),i=this.bufferSync(t);for(n=0;n<t.size;++n){for(var s=i.indexToLoc(n),u=new Array(s.length),l=0;l<u.length;l++)u[l]=s[e[l]];var c=a.locToIndex(u);a.values[c]=o[n]}return a.toTensor()},e.prototype.gather=function(t,e,r){th([t,e],"gather");var n=t.shape.slice(),o=this.readSync(e.dataId);n[r]=o.length;for(var a=na(n,t.dtype),i=this.bufferSync(t),s=0;s<a.size;++s){var u=a.indexToLoc(s),l=u.slice();l[r]=o[u[r]];var c=i.locToIndex(l);a.values[s]=i.values[c]}return a.toTensor()},e.prototype.batchToSpaceND=function(t,e,r){th([t],"batchToSpaceND");var n=e.reduce(function(t,e){return t*e}),o=Ta(t.shape,e,n),a=Da(o.length,e.length),i=_a(t.shape,e,n),s=Oa(r,e.length),u=Fa(i,r,e.length);return t.reshape(o).transpose(a).reshape(i).slice(s,u)},e.prototype.spaceToBatchND=function(t,e,r){th([t],"spaceToBatchND");var n=e.reduce(function(t,e){return t*e}),o=[[0,0]];o.push.apply(o,r);for(var a=1+e.length;a<t.shape.length;++a)o.push([0,0]);var i=t.pad(o),s=Ta(i.shape,e,n,!1),u=Da(s.length,e.length,!1),l=_a(i.shape,e,n,!1);return i.reshape(s).transpose(u).reshape(l)},e.prototype.pool=function(t,e,r){th(t,"pool");for(var n=e.strideHeight,o=e.strideWidth,a=e.dilationHeight,i=e.dilationWidth,s=e.effectiveFilterHeight,u=e.effectiveFilterWidth,l=e.padInfo.top,c=e.padInfo.left,p="max"===r?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,d=this.readSync(t.dataId),h=na(e.outShape,t.dtype),f=h.values,m=e.outShape[1]*e.outShape[2]*e.outShape[3],g=e.outShape[2]*e.outShape[3],v=e.outShape[3],b=0;b<e.batchSize;++b)for(var y=b*m,x=b*t.strides[0],w=0;w<e.inChannels;++w)for(var k=0;k<e.outHeight;++k)for(var C=k*n-l,S=Math.max(0,C),E=Math.min(e.inHeight,s+C),z=y+k*g,I=0;I<e.outWidth;++I){for(var A=I*o-c,N=Math.max(0,A),R=Math.min(e.inWidth,u+A),T=p,D=0,_=0,O=S;O<E;O+=a){for(var F=x+O*t.strides[1],M=N;M<R;M+=i){var L=d[F+M*t.strides[2]+w];"max"===r&&L>T?T=L:"avg"===r&&(D+=L,_++)}if(isNaN(T))break}f[z+I*v+w]="avg"===r?D/_:T}return h.toTensor()},e.prototype.maxPool=function(t,e){return this.pool(t,e,"max")},e.prototype.maxPoolPositions=function(t,e){for(var r=na(e.outShape,"int32"),n=e.strideHeight,o=e.strideWidth,a=e.dilationHeight,i=e.dilationWidth,s=e.effectiveFilterHeight,u=e.effectiveFilterWidth,l=e.padInfo.top,c=e.padInfo.left,p=this.bufferSync(t),d=0;d<e.batchSize;++d)for(var h=0;h<e.inChannels;++h)for(var f=0;f<e.outHeight;++f){for(var m=f*n-l,g=m;g<0;)g+=a;for(var v=Math.min(e.inHeight,s+m),b=0;b<e.outWidth;++b){for(var y=b*o-c,x=y;x<0;)x+=i;for(var w=Math.min(e.inWidth,u+y),k=Number.NEGATIVE_INFINITY,C=-1,S=g;S<v;S+=a)for(var E=S-m,z=x;z<w;z+=i){var I=z-y,A=p.get(d,S,z,h);A>k&&(k=A,C=E*u+I)}r.set(C,d,f,b,h)}}return r.toTensor()},e.prototype.maxPoolBackprop=function(t,e,r,n){th([e,r],"maxPoolBackprop");for(var o=this.maxPoolPositions(e,n),a=n.strideHeight,i=n.strideWidth,s=n.dilationHeight,u=n.dilationWidth,l=n.effectiveFilterHeight,c=n.effectiveFilterWidth,p=c-1-n.padInfo.left,d=l-1-n.padInfo.top,h=na(e.shape,"float32"),f=this.bufferSync(o),m=this.bufferSync(t),g=0;g<n.batchSize;++g)for(var v=0;v<n.inChannels;++v)for(var b=0;b<n.inHeight;++b)for(var y=0;y<n.inWidth;++y){for(var x=b-d,w=y-p,k=0,C=0;C<l;C+=s){var S=(x+C)/a;if(!(S<0||S>=n.outHeight||Math.floor(S)!==S))for(var E=0;E<c;E+=u){var z=(w+E)/i;if(!(z<0||z>=n.outWidth||Math.floor(z)!==z)){var I=l*c-1-f.get(g,S,z,v)===C*c+E?1:0;0!==I&&(k+=m.get(g,S,z,v)*I)}}}h.set(k,g,b,y,v)}return h.toTensor()},e.prototype.avgPoolBackprop=function(t,e,r){th([t,e],"avgPoolBackprop");for(var n=r.strideHeight,o=r.strideWidth,a=r.filterHeight,i=r.filterWidth,s=r.dilationHeight,u=r.dilationWidth,l=r.effectiveFilterHeight,c=r.effectiveFilterWidth,p=c-1-r.padInfo.left,d=l-1-r.padInfo.top,h=na(e.shape,"float32"),f=1/(a*i),m=this.bufferSync(t),g=0;g<r.batchSize;++g)for(var v=0;v<r.inChannels;++v)for(var b=0;b<r.inHeight;++b)for(var y=0;y<r.inWidth;++y){for(var x=b-d,w=y-p,k=0,C=0;C<l;C+=s){var S=(x+C)/n;if(!(S<0||S>=r.outHeight||Math.floor(S)!==S))for(var E=0;E<c;E+=u){var z=(w+E)/o;z<0||z>=r.outWidth||Math.floor(z)!==z||(k+=m.get(g,S,z,v))}}h.set(k*f,g,b,y,v)}return h.toTensor()},e.prototype.pool3d=function(t,e,r){th(t,"pool3d");for(var n=e.strideDepth,o=e.strideHeight,a=e.strideWidth,i=e.dilationDepth,s=e.dilationHeight,u=e.dilationWidth,l=e.effectiveFilterDepth,c=e.effectiveFilterHeight,p=e.effectiveFilterWidth,d=e.padInfo.front,h=e.padInfo.top,f=e.padInfo.left,m="max"===r?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,g=this.readSync(t.dataId),v=na(e.outShape,t.dtype),b=v.values,y=e.outShape[1]*e.outShape[2]*e.outShape[3]*e.outShape[4],x=e.outShape[2]*e.outShape[3]*e.outShape[4],w=e.outShape[3]*e.outShape[4],k=e.outShape[4],C=0;C<e.batchSize;++C)for(var S=C*y,E=C*t.strides[0],z=0;z<e.inChannels;++z)for(var I=0;I<e.outDepth;++I){for(var A=I*n-d,N=A;N<0;)N+=i;for(var R=Math.min(e.inDepth,l+A),T=S+I*x,D=0;D<e.outHeight;++D){for(var _=D*o-h,O=_;O<0;)O+=s;for(var F=Math.min(e.inHeight,c+_),M=T+D*w,L=0;L<e.outWidth;++L){for(var P=L*a-f,B=P;B<0;)B+=u;for(var q=Math.min(e.inWidth,p+P),V=M+L*k,W=m,U=0,j=0,H=N;H<R;H+=i){for(var G=E+H*t.strides[1],$=O;$<F;$+=s){for(var K=G+$*t.strides[2],X=B;X<q;X+=u){var Y=g[K+X*t.strides[3]+z];if("max"===r&&Y>W?W=Y:"avg"===r&&(U+=Y,j++),isNaN(W))break}if(isNaN(W))break}if(isNaN(W))break}b[V+z]="avg"===r?U/j:W}}}return v.toTensor()},e.prototype.avgPool3d=function(t,e){return th(t,"avgPool3d"),this.pool3d(t,e,"avg").toFloat()},e.prototype.avgPool3dBackprop=function(t,e,r){th([t,e],"avgPool3dBackprop");for(var n=r.strideDepth,o=r.strideHeight,a=r.strideWidth,i=r.filterDepth,s=r.filterHeight,u=r.filterWidth,l=r.dilationDepth,c=r.dilationHeight,p=r.dilationWidth,d=r.effectiveFilterDepth,h=r.effectiveFilterHeight,f=r.effectiveFilterWidth,m=d-1-r.padInfo.front,g=f-1-r.padInfo.left,v=h-1-r.padInfo.top,b=na(e.shape,"float32"),y=1/(i*s*u),x=this.bufferSync(t),w=0;w<r.batchSize;++w)for(var k=0;k<r.inChannels;++k)for(var C=0;C<r.inDepth;++C)for(var S=0;S<r.inHeight;++S)for(var E=0;E<r.inWidth;++E){for(var z=C-m,I=S-v,A=E-g,N=0,R=0;R<d;R+=l){var T=(z+R)/n;if(!(T<0||T>=r.outDepth||Math.floor(T)!==T))for(var D=0;D<h;D+=c){var _=(I+D)/o;if(!(_<0||_>=r.outHeight||Math.floor(_)!==_))for(var O=0;O<f;O+=p){var F=(A+O)/a;F<0||F>=r.outWidth||Math.floor(F)!==F||(N+=x.get(w,T,_,F,k))}}}b.set(N*y,w,C,S,E,k)}return b.toTensor()},e.prototype.maxPool3d=function(t,e){return th(t,"maxPool3d"),this.pool3d(t,e,"max").toFloat()},e.prototype.maxPool3dPositions=function(t,e){for(var r=na(e.outShape,"int32"),n=e.strideDepth,o=e.strideHeight,a=e.strideWidth,i=e.dilationDepth,s=e.dilationHeight,u=e.dilationWidth,l=e.effectiveFilterDepth,c=e.effectiveFilterHeight,p=e.effectiveFilterWidth,d=e.padInfo.front,h=e.padInfo.top,f=e.padInfo.left,m=this.bufferSync(t),g=0;g<e.batchSize;++g)for(var v=0;v<e.inChannels;++v)for(var b=0;b<e.outDepth;++b){for(var y=b*n-d,x=y;x<0;)x+=i;for(var w=Math.min(e.inDepth,l+y),k=0;k<e.outHeight;++k){for(var C=k*o-h,S=C;S<0;)S+=s;for(var E=Math.min(e.inHeight,c+C),z=0;z<e.outWidth;++z){for(var I=z*a-f,A=I;A<0;)A+=u;for(var N=Math.min(e.inWidth,p+I),R=Number.NEGATIVE_INFINITY,T=-1,D=x;D<w;D+=i)for(var _=D-y,O=S;O<E;O+=s)for(var F=O-C,M=A;M<N;M+=u){var L=M-I,P=m.get(g,D,O,M,v);P>=R&&(R=P,T=_*c*p+F*c+L)}r.set(T,g,b,k,z,v)}}}return r.toTensor()},e.prototype.maxPool3dBackprop=function(t,e,r,n){th([e,r],"maxPool3dBackprop");for(var o=this.maxPool3dPositions(e,n),a=n.strideDepth,i=n.strideHeight,s=n.strideWidth,u=n.dilationDepth,l=n.dilationHeight,c=n.dilationWidth,p=n.effectiveFilterDepth,d=n.effectiveFilterHeight,h=n.effectiveFilterWidth,f=p-1-n.padInfo.front,m=h-1-n.padInfo.left,g=d-1-n.padInfo.top,v=na(e.shape,"float32"),b=this.bufferSync(o),y=this.bufferSync(t),x=0;x<n.batchSize;++x)for(var w=0;w<n.inChannels;++w)for(var k=0;k<n.inDepth;++k)for(var C=0;C<n.inHeight;++C)for(var S=0;S<n.inWidth;++S){for(var E=k-f,z=C-g,I=S-m,A=0,N=0;N<p;N+=u){var R=(E+N)/a;if(!(R<0||R>=n.outDepth||Math.floor(R)!==R))for(var T=0;T<d;T+=l){var D=(z+T)/i;if(!(D<0||D>=n.outHeight||Math.floor(D)!==D))for(var _=0;_<h;_+=c){var O=(I+_)/s;if(!(O<0||O>=n.outWidth||Math.floor(O)!==O)){var F=p*d*h-1-b.get(x,R,D,O,w)===N*d*h+T*h+_?1:0;0!==F&&(A+=y.get(x,R,D,O,w)*F)}}}}v.set(A,x,k,C,S,w)}return v.toTensor()},e.prototype.cast=function(t,e){return vi(t,e,this)},e.prototype.reshape=function(t,e){return bi(t,e)},e.prototype.avgPool=function(t,e){return th(t,"avgPool"),this.pool(t,e,"avg").toFloat()},e.prototype.resizeBilinear=function(t,e,r,n){th(t,"resizeBilinear");for(var o=t.shape,a=o[0],i=o[1],s=o[2],u=o[3],l=this.readSync(t.dataId),c=new Float32Array(Te([a,e,r,u])),p=[n&&e>1?i-1:i,n&&r>1?s-1:s],d=[n&&e>1?e-1:e,n&&r>1?r-1:r],h=0,f=p[0]/d[0],m=p[1]/d[1],g=0;g<a;g++)for(var v=0;v<e;v++)for(var b=f*v,y=Math.floor(b),x=b-y,w=Math.min(i-1,Math.ceil(b)),k=g*t.strides[0]+y*t.strides[1],C=g*t.strides[0]+w*t.strides[1],S=0;S<r;S++)for(var E=m*S,z=Math.floor(E),I=E-z,A=Math.min(s-1,Math.ceil(E)),N=k+z*t.strides[2],R=C+z*t.strides[2],T=k+ +A*t.strides[2],D=C+A*t.strides[2],_=0;_<u;_++){var O=l[N+_],F=l[R+_],M=O+(l[T+_]-O)*I,L=M+(F+(l[D+_]-F)*I-M)*x;c[h++]=L}return ko(c,[a,e,r,u])},e.prototype.resizeBilinearBackprop=function(t,e,r){th([t,e],"resizeBilinearBackprop");for(var n=e.shape,o=n[0],a=n[1],i=n[2],s=n[3],u=t.shape,l=u[1],c=u[2],p=new Float32Array(o*a*i*s),d=[r&&l>1?a-1:a,r&&c>1?i-1:i],h=[r&&l>1?l-1:l,r&&c>1?c-1:c],f=d[0]/h[0],m=d[1]/h[1],g=this.readSync(t.dataId),v=0,b=0;b<o;b++)for(var y=b*e.strides[0],x=0;x<l;x++)for(var w=x*f,k=Math.floor(w),C=Math.min(Math.ceil(w),a-1),S=y+k*e.strides[1],E=y+C*e.strides[1],z=w-k,I=1-z,A=0;A<c;A++)for(var N=A*m,R=Math.floor(N),T=Math.min(Math.ceil(N),i-1),D=N-R,_=1-D,O=S+R*e.strides[2],F=S+T*e.strides[2],M=E+R*e.strides[2],L=E+T*e.strides[2],P=I*_,B=I*D,q=z*_,V=z*D,W=0;W<s;W++){var U=g[v++];p[O+W]+=U*P,p[F+W]+=U*B,p[M+W]+=U*q,p[L+W]+=U*V}return Ao(p,[o,i,a,s],e.dtype)},e.prototype.resizeNearestNeighbor=function(t,e,r,n){th(t,"resizeNearestNeighbor");for(var o=t.shape,a=o[0],i=o[1],s=o[2],u=o[3],l=this.readSync(t.dataId),c=new Float32Array(a*e*r*u),p=[n&&e>1?i-1:i,n&&r>1?s-1:s],d=[n&&e>1?e-1:e,n&&r>1?r-1:r],h=p[0]/d[0],f=p[1]/d[1],m=0,g=0;g<a;g++)for(var v=g*t.strides[0],b=0;b<e;b++)for(var y=h*b,x=v+Math.min(i-1,n?Math.round(y):Math.floor(y))*t.strides[1],w=0;w<r;w++)for(var k=f*w,C=x+Math.min(s-1,n?Math.round(k):Math.floor(k))*t.strides[2],S=0;S<u;S++){var E=l[C+S];c[m++]=E}return ko(c,[a,e,r,u],t.dtype)},e.prototype.resizeNearestNeighborBackprop=function(t,e,r){th([t,e],"resizeNearestNeighborBackprop");for(var n=e.shape,o=n[0],a=n[1],i=n[2],s=n[3],u=t.shape,l=u[1],c=u[2],p=new Float32Array(o*a*i*s),d=this.readSync(t.dataId),h=[r&&l>1?a-1:a,r&&c>1?i-1:i],f=[r&&l>1?l-1:l,r&&c>1?c-1:c],m=h[0]/f[0],g=h[1]/f[1],v=1/m,b=1/g,y=2*Math.ceil(v)+2,x=2*Math.ceil(b)+2,w=0;w<o;w++)for(var k=w*e.strides[0],C=0;C<a;C++)for(var S=k+C*e.strides[1],E=Math.floor(C*v),z=Math.floor(E-y/2),I=0;I<i;I++)for(var A=S+I*e.strides[2],N=Math.floor(I*b),R=Math.floor(N-x/2),T=0;T<s;T++){for(var D=0,_=0;_<y;_++){var O=_+z;if(!(O<0||O>=l)){var F=k+O*t.strides[1],M=O*m;if(C===Math.min(a-1,r?Math.round(M):Math.floor(M)))for(var L=0;L<x;L++){var P=L+R;if(!(P<0||P>=c)){var B=F+P*t.strides[2],q=P*g;I===Math.min(i-1,r?Math.round(q):Math.floor(q))&&(D+=d[B+T])}}}}p[A+T]=D}return Ao(p,e.shape,e.dtype)},e.prototype.batchNormalization=function(t,e,r,n,o,a){th([t,e,r,o,a],"batchNorm");for(var i=this.readSync(t.dataId),s=this.readSync(e.dataId),u=this.readSync(r.dataId),l=o?this.readSync(o.dataId):new Float32Array([1]),c=a?this.readSync(a.dataId):new Float32Array([0]),p=new Float32Array(i.length),d=c.length,h=l.length,f=u.length,m=s.length,g=0,v=0,b=0,y=0,x=0;x<i.length;++x)p[x]=c[g++]+(i[x]-s[v++])*l[b++]/Math.sqrt(u[y++]+n),g>=d&&(g=0),v>=m&&(v=0),b>=h&&(b=0),y>=f&&(y=0);return Ao(p,t.shape)},e.prototype.localResponseNormalization4D=function(t,e,r,n,o){th(t,"localResponseNormalization4D");var a=t.shape[3],i=a-1,s=this.readSync(t.dataId),u=t.size,l=new Float32Array(u);function c(t){for(var r=t%a,n=t-r+Math.max(0,r-e),o=t-r+Math.min(r+e,i),u=0;n<=o;n++){var l=s[n];u+=l*l}return u}for(var p=0;p<u;p++){var d=c(p),h=s[p]*Math.pow(r+n*d,-o);l[p]=h}return Ao(l,t.shape)},e.prototype.LRNGrad=function(t,e,r,n,o,a,i){th(t,"LRNGrad");for(var s=t.shape[3],u=this.readSync(t.dataId),l=this.readSync(e.dataId),c=this.readSync(r.dataId),p=new Float32Array(t.size),d=t.size,h=0;h<d;h++){for(var f=h%s,m=h-f+Math.max(0,f-n),g=h-f+Math.min(s,f+n+1),v=0,b=m;b<g;b++)v+=Math.pow(l[b],2);for(v=a*v+o,b=m;b<g;b++){var y=-2*a*i*l[b]*c[h]/v;h===b&&(y+=Math.pow(v,-i)),y*=u[h],p[b]+=y}}return Ao(p,t.shape)},e.prototype.multinomial=function(t,e,r,n){th(t,"multinomial");for(var o=e?t:Ja(t),a=o.shape[0],i=o.shape[1],s=_o([a,r],"int32"),u=this.readSync(s.dataId),l=this.readSync(o.dataId),c=0;c<a;++c){var p=c*i,d=new Float32Array(i-1);d[0]=l[p];for(var h=1;h<d.length;++h)d[h]=d[h-1]+l[p+h];for(var f=Qo(n.toString()),m=c*r,g=0;g<r;++g){var v=f();u[m+g]=d.length;for(var b=0;b<d.length;b++)if(v<d[b]){u[m+g]=b;break}}}return s},e.prototype.oneHot=function(t,e,r,n){th(t,"oneHot");var o=new Float32Array(t.size*e);o.fill(n);for(var a=this.readSync(t.dataId),i=0;i<t.size;++i)a[i]>=0&&a[i]<e&&(o[i*e+a[i]]=r);return zo(o,[t.size,e],"int32")},e.prototype.nonMaxSuppression=function(t,e,r,n,o){return th(t,"nonMaxSuppression"),Ei(this.readSync(t.dataId),this.readSync(e.dataId),r,n,o)},e.prototype.fft=function(t){return this.fftBatch(t,!1)},e.prototype.ifft=function(t){return this.fftBatch(t,!0)},e.prototype.fftBatch=function(t,e){for(var r=t.shape[0],n=t.shape[1],o=na(t.shape,"float32"),a=na(t.shape,"float32"),i=xo(t).as2D(r,n),s=wo(t).as2D(r,n),u=0;u<r;u++)for(var l=i.slice([u,0],[1,n]),c=s.slice([u,0],[1,n]),p=yo(l,c),d=this.readSync(this.fftImpl(p,e).dataId),h=0;h<n;h++){var f=ki(d,h);o.values[u*n+h]=f.real,a.values[u*n+h]=f.imag}return yo(o.toTensor(),a.toTensor()).as2D(r,n)},e.prototype.fftImpl=function(t,e){var r=t.as1D(),n=r.size;if(this.isExponentOf2(n)){var o=this.fftRadix2(r,n,e).as2D(t.shape[0],t.shape[1]);return e&&(o=yo(xo(o).div(So(n)),wo(o).div(So(n)))),o}var a=this.readSync(t.dataId),i=function(t){for(var e=new Float32Array(t.length/2),r=new Float32Array(t.length/2),n=0;n<t.length;n+=2)e[n/2]=t[n],r[n/2]=t[n+1];return{real:e,imag:r}}(this.fourierTransformByMatmul(a,n,e));return yo(i.real,i.imag).as2D(t.shape[0],t.shape[1])},e.prototype.isExponentOf2=function(t){return 0==(t&t-1)},e.prototype.fftRadix2=function(t,e,r){if(1===e)return t;var n=this.readSync(t.dataId),o=e/2,a=function(t){for(var e=Math.ceil(t.length/4),r=new Float32Array(e),n=new Float32Array(e),o=0;o<t.length;o+=4)r[Math.floor(o/4)]=t[o],n[Math.floor(o/4)]=t[o+1];return{real:r,imag:n}}(n),i=yo(a.real,a.imag).as1D(),s=function(t){for(var e=Math.floor(t.length/4),r=new Float32Array(e),n=new Float32Array(e),o=2;o<t.length;o+=4)r[Math.floor(o/4)]=t[o],n[Math.floor(o/4)]=t[o+1];return{real:r,imag:n}}(n),u=yo(s.real,s.imag).as1D();i=this.fftRadix2(i,o,r),u=this.fftRadix2(u,o,r);var l=function(t,e){for(var r=new Float32Array(t/2),n=new Float32Array(t/2),o=0;o<Math.ceil(t/2);o++){var a=(e?2:-2)*Math.PI*(o/t);r[o]=Math.cos(a),n[o]=Math.sin(a)}return{real:r,imag:n}}(e,r),c=yo(l.real,l.imag).mul(u),p=i.add(c),d=i.sub(c),h=xo(p).concat(xo(d)),f=wo(p).concat(wo(d));return yo(h,f).as1D()},e.prototype.fourierTransformByMatmul=function(t,e,r){for(var n=new Float32Array(2*e),o=0;o<e;o++){for(var a=0,i=0,s=0;s<e;s++){var u=Si(o*s,e,r),l=ki(t,s);a+=l.real*u.real-l.imag*u.imag,i+=l.real*u.imag+l.imag*u.real}r&&(a/=e,i/=e),Ci(n,a,i,o)}return n},e.prototype.depthToSpace=function(t,e,r){Ie("NHWC"===r,function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+r}),Ie(e>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+e});for(var n=t.shape[0],o=t.shape[1],a=t.shape[2],i=t.shape[3],s=o*e,u=a*e,l=i/(e*e),c=this.readSync(t.dataId),p=new Float32Array(n*s*u*l),d=0,h=0;h<n;++h)for(var f=0;f<s;++f)for(var m=Math.floor(f/e),g=f%e,v=0;v<u;++v)for(var b=Math.floor(v/e),y=(g*e+v%e)*l,x=0;x<l;++x){var w=x+y+i*(b+a*(m+o*h));p[d++]=c[w]}return Ao(p,[n,s,u,l])},e.prototype.broadcastedBinaryOp=function(t,e,r,n){var o=oi(t.shape,e.shape),a=na(o,r),i=this.readSync(t.dataId),s=this.readSync(e.dataId),u=ri(t.shape,o),l=ri(e.shape,o),c=a.values;if(u.length+l.length===0)for(var p=0;p<c.length;++p)c[p]=n(i[p%i.length],s[p%s.length]);else{var d=this.bufferSync(t),h=this.bufferSync(e),f=function(r){var o=a.indexToLoc(r),p=o.slice(-t.rank);u.forEach(function(t){return p[t]=0});var f=d.locToIndex(p),m=o.slice(-e.rank);l.forEach(function(t){return m[t]=0});var g=h.locToIndex(m);c[r]=n(i[f],s[g])};for(p=0;p<c.length;++p)f(p)}return a.toTensor()},e.prototype.broadcastedBinaryComplexOp=function(t,e,r){var n=oi(t.shape,e.shape),o=na(n,"float32"),a=na(n,"float32"),i=this.readSync(t.dataId),s=this.readSync(e.dataId),u=ri(t.shape,n),l=ri(e.shape,n),c=o.values,p=a.values;if(u.length+l.length===0)for(var d=0;d<c.length;d++){var h=d%i.length,f=d%s.length,m=r(i[2*h],i[2*h+1],s[2*f],s[2*f+1]);c[d]=m.real,p[d]=m.imag}else{var g=this.bufferSync(this.data.get(t.dataId).complexTensors.real),v=this.bufferSync(this.data.get(e.dataId).complexTensors.real),b=function(n){var a=o.indexToLoc(n),d=a.slice(-t.rank);u.forEach(function(t){return d[t]=0});var h=g.locToIndex(d),f=a.slice(-e.rank);l.forEach(function(t){return f[t]=0});var m=v.locToIndex(f),b=r(i[2*h],i[2*h+1],s[2*m],s[2*m+1]);c[n]=b.real,p[n]=b.imag};for(d=0;d<c.length;d++)b(d)}return this.complex(o.toTensor(),a.toTensor())},e.prototype.split=function(t,e,r){return Ii(t,e,r)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.epsilon=function(){return 1e-7},e.prototype.cropAndResize=function(t,e,r,n,o,a){for(var i=t.shape,s=i[0],u=i[1],l=i[2],c=i[3],p=e.shape[0],d=n[0],h=n[1],f=na([p,d,h,c],t.dtype),m=this.readSync(e.dataId),g=this.readSync(r.dataId),v=this.readSync(t.dataId),b=t.strides,y=f.strides,x=0;x<p;x++){var w=4*x,k=m[w],C=m[w+1],S=m[w+2],E=m[w+3],z=g[x];if(!(z>=s))for(var I=d>1?(S-k)*(u-1)/(d-1):0,A=h>1?(E-C)*(l-1)/(h-1):0,N=0;N<d;N++){var R=d>1?k*(u-1)+N*I:.5*(k+S)*(u-1);if(R<0||R>u-1)for(var T=0;T<h;T++)for(var D=0;D<c;D++){var _=D+T*y[2]+N*y[1]+x*y[0];f.values[_]=a}else if("bilinear"===o){var O=Math.floor(R),F=Math.ceil(R),M=R-O;for(T=0;T<h;T++)if((H=h>1?C*(l-1)+T*A:.5*(C+E)*(l-1))<0||H>l-1)for(D=0;D<c;D++)_=D+T*y[2]+N*y[1]+x*y[0],f.values[_]=a;else{var L=Math.floor(H),P=Math.ceil(H),B=H-L;for(D=0;D<c;D++){var q=v[_=D+L*b[2]+O*b[1]+z*b[0]],V=v[_=D+P*b[2]+O*b[1]+z*b[0]],W=v[_=D+L*b[2]+F*b[1]+z*b[0]],U=q+(V-q)*B,j=W+(v[_=D+P*b[2]+F*b[1]+z*b[0]]-W)*B;_=D+T*y[2]+N*y[1]+x*y[0],f.values[_]=U+(j-U)*M}}}else for(T=0;T<h;++T){var H;if((H=h>1?C*(l-1)+T*A:.5*(C+E)*(l-1))<0||H>l-1)for(D=0;D<c;D++)_=D+T*y[2]+N*y[1]+x*y[0],f.values[_]=a;else{var G=Math.round(H),$=Math.round(R);for(D=0;D<c;D++){var K=D+G*b[2]+$*b[1]+z*b[0],X=D+T*y[2]+N*y[1]+x*y[0];f.values[X]=v[K]}}}}}return f.toTensor()},e.prototype.sparseToDense=function(t,e,r,n){var o=Ba(0,t,r),a=o.sliceRank,i=o.numUpdates,s=o.sliceSize,u=o.strides,l=o.outputSize;return this.scatter(t,e,r,l,s,i,a,u,n,!1)},e.prototype.gatherND=function(t,e){var r=e.shape,n=r[r.length-1],o=Ma(t,e),a=o[0],i=o[1],s=o[2],u=o[3];if(0===i)return ko([],a,t.dtype);for(var l=new yr([i,s],t.dtype),c=this.readSync(e.dataId),p=this.readSync(t.dataId),d=0;d<i;d++){for(var h=[],f=0,m=0;m<n;m++){var g=c[d*n+m];f+=g*u[m],h.push(g)}if(f<0||f>=t.size/s)throw new Error("Invalid indices: "+h+" does not index into "+t.shape);for(var v=0;v<s;v++)l.values[d*s+v]=p[f*s+v]}return l.toTensor().reshape(a)},e.prototype.scatterND=function(t,e,r){var n=Ba(0,t,r),o=n.sliceRank,a=n.numUpdates,i=n.sliceSize,s=n.strides,u=n.outputSize,l=So(0);return this.scatter(t,e,r,u,i,a,o,s,l,!0)},e.prototype.fill=function(t,e,r){var n=We(r=r||Ze(e),Te(t));return n.fill(e),Vr.makeTensor(n,t,r,this)},e.prototype.onesLike=function(t){if("string"===t.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){var e=We(t.dtype,Te(t.shape));return this.makeOutput(e,t.shape,t.dtype)},e.prototype.linspace=function(t,e,r){return yi(t,e,r)},e.prototype.scatter=function(t,e,r,n,o,a,i,s,u,l){var c=[n/o,o],p=this.readSync(t.dataId),d=this.readSync(e.dataId);if(0===n)return ko([],r,e.dtype);var h=new yr(c,e.dtype);h.values.fill(this.readSync(u.dataId)[0]);for(var f=0;f<a;f++){for(var m=[],g=0,v=0;v<i;v++){var b=p[f*i+v];m.push(b),g+=b*s[v]}if(g<0||g>=n/o)throw new Error("Invalid indices: "+m+" does not index into "+r);for(var y=0;y<o;y++)l?h.values[g*o+y]+=d[f*o+y]:h.values[g*o+y]=0===e.rank?d[0]:d[f*o+y]}return h.toTensor().reshape(r)},e}(ti);Vr.registerBackend("cpu",function(){return new rh},1),we({kernelName:"Square",backendName:"cpu",kernelFunc:function(t){var e=t.inputs,r=t.backend,n=e.x,o=r;th(n,"square");for(var a=o.data.get(n.dataId).values,i=new Float32Array(a.length),s=0;s<a.length;++s){var u=a[s];i[s]=u*u}return{dataId:o.write(i,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}}),we({kernelName:"Square",backendName:"webgl",kernelFunc:function(t){var e=t.inputs,r=t.backend,n=e.x,o=r,a=new Gu(n.shape,"return x * x;");return o.runWebGLProgram(a,[n],n.dtype)}});var nh=function(){function t(){}return t.prototype.fetch=function(t,e){return fetch(t,e)},t.prototype.now=function(){return performance.now()},t.prototype.encode=function(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error("Browser's encoder only supports utf-8, but got "+e);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)},t.prototype.decode=function(t,e){return new TextDecoder(e).decode(t)},t}();ge().get("IS_BROWSER")&&ge().setPlatform("browser",new nh);var oh,ah=function(){function t(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}return t.prototype.fetch=function(t,e){return null!=ge().global.fetch?ge().global.fetch(t,e):(null==oh&&(oh=require("node-fetch")),oh(t,e))},t.prototype.now=function(){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6},t.prototype.encode=function(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error("Node built-in encoder only supports utf-8, but got "+e);return this.textEncoder.encode(t)},t.prototype.decode=function(t,e){return 0===t.length?"":new this.util.TextDecoder(e).decode(t)},t}();ge().get("IS_NODE")&&ge().setPlatform("node",new ah);var ih={float32:4,int32:4,uint16:2,uint8:1,bool:1},sh=4;function uh(t,e){for(var r={},n=0,o=function(e){var o=e.name,a=e.dtype,i=e.shape,s=Te(i),u=void 0;if("quantization"in e){var l=e.quantization;if("uint8"!==l.dtype&&"uint16"!==l.dtype)throw new Error("Weight "+e.name+" has unknown quantization dtype "+l.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var c=ih[l.dtype],p=t.slice(n,n+s*c),d="uint8"===l.dtype?new Uint8Array(p):new Uint16Array(p);if("float32"===a)u=Float32Array.from(d,function(t){return t*l.scale+l.min});else{if("int32"!==a)throw new Error("Unsupported dtype in weight '"+o+"': "+a);u=Int32Array.from(d,function(t){return Math.round(t*l.scale+l.min)})}n+=s*c}else if("string"===a){var h=Te(e.shape);u=[];for(var f=0;f<h;f++){var m=new Uint32Array(t.slice(n,n+sh))[0];n+=sh;var g=new Uint8Array(t.slice(n,n+m));u.push(g),n+=m}}else{var v=ih[a];if(p=t.slice(n,n+s*v),"float32"===a)u=new Float32Array(p);else if("int32"===a)u=new Int32Array(p);else{if("bool"!==a)throw new Error("Unsupported dtype in weight '"+o+"': "+a);u=new Uint8Array(p)}n+=s*v}r[o]=ko(u,i,a)},a=0,i=e;a<i.length;a++)o(i[a]);return r}function lh(t){if(null===t)throw new Error("Invalid input value: "+JSON.stringify(t));var e=0,r=[];t.forEach(function(t){if(e+=t.byteLength,r.push(t.byteLength===t.buffer.byteLength?t:new t.constructor(t)),!(t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+t.constructor.name)});var n=new Uint8Array(e),o=0;return r.forEach(function(t){n.set(new Uint8Array(t.buffer),o),o+=t.byteLength}),n.buffer}var ch="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function ph(t){return ch?Buffer.byteLength(t):new Blob([t]).size}function dh(t){var e=0;t.forEach(function(t){e+=t.byteLength});var r=new Uint8Array(e),n=0;return t.forEach(function(t){r.set(new Uint8Array(t),n),n+=t.byteLength}),r.buffer}function hh(t){for(t=t.trim();t.endsWith("/");)t=t.slice(0,t.length-1);var e=t.split("/");return e[e.length-1]}function fh(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==t.modelTopology?0:ph(JSON.stringify(t.modelTopology)),weightSpecsBytes:null==t.weightSpecs?0:ph(JSON.stringify(t.weightSpecs)),weightDataBytes:null==t.weightData?0:t.weightData.byteLength}}var mh=function(){function t(){this.saveRouters=[],this.loadRouters=[]}return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.registerSaveRouter=function(e){t.getInstance().saveRouters.push(e)},t.registerLoadRouter=function(e){t.getInstance().loadRouters.push(e)},t.getSaveHandlers=function(e){return t.getHandlers(e,"save")},t.getLoadHandlers=function(e,r){return t.getHandlers(e,"load",r)},t.getHandlers=function(e,r,n){var o=[];return("load"===r?t.getInstance().loadRouters:t.getInstance().saveRouters).forEach(function(t){var r=t(e,n);null!==r&&o.push(r)}),o},t}(),gh="://",vh=function(){function t(){this.managers={}}return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.registerManager=function(e,r){Ie(null!=e,function(){return"scheme must not be undefined or null."}),e.endsWith(gh)&&(e=e.slice(0,e.indexOf(gh))),Ie(e.length>0,function(){return"scheme must not be an empty string."});var n=t.getInstance();Ie(null==n.managers[e],function(){return"A model store manager is already registered for scheme '"+e+"'."}),n.managers[e]=r},t.getManager=function(t){var e=this.getInstance().managers[t];if(null==e)throw new Error("Cannot find model manager for scheme '"+t+"'");return e},t.getSchemes=function(){return Object.keys(this.getInstance().managers)},t}();function bh(t){if(-1===t.indexOf(gh))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+vh.getSchemes().join(","));return{scheme:t.split(gh)[0],path:t.split(gh)[1]}}function yh(t,e,r){return void 0===r&&(r=!1),he(this,void 0,void 0,function(){var n,o,a,i,s,u,l,c,p;return fe(this,function(d){switch(d.label){case 0:return Ie(t!==e,function(){return"Old path and new path are the same: '"+t+"'"}),Ie((n=mh.getLoadHandlers(t)).length>0,function(){return"Copying failed because no load handler is found for source URL "+t+"."}),Ie(n.length<2,function(){return"Copying failed because more than one ("+n.length+") load handlers for source URL "+t+"."}),o=n[0],Ie((a=mh.getSaveHandlers(e)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+e+"."}),Ie(a.length<2,function(){return"Copying failed because more than one ("+n.length+") save handlers for destination URL "+e+"."}),i=a[0],s=bh(t).scheme,u=bh(t).path,l=s===bh(t).scheme,[4,o.load()];case 1:return c=d.sent(),r&&l?[4,vh.getManager(s).removeModel(u)]:[3,3];case 2:d.sent(),d.label=3;case 3:return[4,i.save(c)];case 4:return p=d.sent(),!r||l?[3,6]:[4,vh.getManager(s).removeModel(u)];case 5:d.sent(),d.label=6;case 6:return[2,p.modelArtifactsInfo]}})})}var xh="models_store",wh="model_info_store";function kh(){if(!ge().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var t=window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(null==e)throw new Error("The current browser does not appear to support IndexedDB.");return e}function Ch(t){var e=t.result;e.createObjectStore(xh,{keyPath:"modelPath"}),e.createObjectStore(wh,{keyPath:"modelPath"})}var Sh=function(){function t(t){if(this.indexedDB=kh(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return t.prototype.save=function(t){return he(this,void 0,void 0,function(){return fe(this,function(e){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,t)]})})},t.prototype.load=function(){return he(this,void 0,void 0,function(){return fe(this,function(t){return[2,this.databaseAction(this.modelPath)]})})},t.prototype.databaseAction=function(t,e){var r=this;return new Promise(function(t,n){var o=r.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return Ch(o)},o.onsuccess=function(){var a=o.result;if(null==e){var i=a.transaction(xh,"readonly"),s=i.objectStore(xh).get(r.modelPath);s.onsuccess=function(){if(null==s.result)return a.close(),n(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));t(s.result.modelArtifacts)},s.onerror=function(t){return a.close(),n(s.error)},i.oncomplete=function(){return a.close()}}else{var u,l=fh(e),c=a.transaction(wh,"readwrite"),p=c.objectStore(wh),d=p.put({modelPath:r.modelPath,modelArtifactsInfo:l});d.onsuccess=function(){var o=(u=a.transaction(xh,"readwrite")).objectStore(xh).put({modelPath:r.modelPath,modelArtifacts:e,modelArtifactsInfo:l});o.onsuccess=function(){return t({modelArtifactsInfo:l})},o.onerror=function(t){var e=(p=c.objectStore(wh)).delete(r.modelPath);e.onsuccess=function(){return a.close(),n(o.error)},e.onerror=function(t){return a.close(),n(o.error)}}},d.onerror=function(t){return a.close(),n(d.error)},c.oncomplete=function(){null==u?a.close():u.oncomplete=function(){return a.close()}}}},o.onerror=function(t){return n(o.error)}})},t.URL_SCHEME="indexeddb://",t}(),Eh=function(t){return ge().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Sh.URL_SCHEME)?(e=t.slice(Sh.URL_SCHEME.length),new Sh(e)):null;var e};mh.registerSaveRouter(Eh),mh.registerLoadRouter(Eh);var zh=function(){function t(){this.indexedDB=kh()}return t.prototype.listModels=function(){return he(this,void 0,void 0,function(){var t=this;return fe(this,function(e){return[2,new Promise(function(e,r){var n=t.indexedDB.open("tensorflowjs",1);n.onupgradeneeded=function(){return Ch(n)},n.onsuccess=function(){var t=n.result,o=t.transaction(wh,"readonly"),a=o.objectStore(wh).getAll();a.onsuccess=function(){for(var t={},r=0,n=a.result;r<n.length;r++){var o=n[r];t[o.modelPath]=o.modelArtifactsInfo}e(t)},a.onerror=function(e){return t.close(),r(a.error)},o.oncomplete=function(){return t.close()}},n.onerror=function(t){return r(n.error)}})]})})},t.prototype.removeModel=function(t){return he(this,void 0,void 0,function(){var e=this;return fe(this,function(r){var n;return t=(n=t).startsWith(Sh.URL_SCHEME)?n.slice(Sh.URL_SCHEME.length):n,[2,new Promise(function(r,n){var o=e.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return Ch(o)},o.onsuccess=function(){var e,a=o.result,i=a.transaction(wh,"readwrite"),s=i.objectStore(wh),u=s.get(t);u.onsuccess=function(){if(null==u.result)return a.close(),n(new Error("Cannot find model with path '"+t+"' in IndexedDB."));var o=s.delete(t),i=function(){var o=(e=a.transaction(xh,"readwrite")).objectStore(xh).delete(t);o.onsuccess=function(){return r(u.result.modelArtifactsInfo)},o.onerror=function(t){return n(u.error)}};o.onsuccess=i,o.onerror=function(t){return i(),a.close(),n(u.error)}},u.onerror=function(t){return a.close(),n(u.error)},i.oncomplete=function(){null==e?a.close():e.oncomplete=function(){return a.close()}}},o.onerror=function(t){return n(o.error)}})]})})},t}();if(ge().getBool("IS_BROWSER"))try{vh.registerManager(Sh.URL_SCHEME,new zh)}catch(Nr){}var Ih="/",Ah="tensorflowjs_models",Nh="info",Rh="model_topology",Th="weight_specs",Dh="weight_data",_h="model_metadata";function Oh(t){return{info:[Ah,t,Nh].join(Ih),topology:[Ah,t,Rh].join(Ih),weightSpecs:[Ah,t,Th].join(Ih),weightData:[Ah,t,Dh].join(Ih),modelMetadata:[Ah,t,_h].join(Ih)}}function Fh(t){var e=t.split(Ih);if(e.length<3)throw new Error("Invalid key format: "+t);return e.slice(1,e.length-1).join(Ih)}var Mh=function(){function t(t){if(!ge().getBool("IS_BROWSER")||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=Oh(this.modelPath)}return t.prototype.save=function(t){return he(this,void 0,void 0,function(){var e,r,n;return fe(this,function(o){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");e=JSON.stringify(t.modelTopology),r=JSON.stringify(t.weightSpecs),n=fh(t);try{return this.LS.setItem(this.keys.info,JSON.stringify(n)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,(a=t.weightData,ch?Buffer.from(a).toString("base64"):btoa(String.fromCharCode.apply(null,new Uint8Array(a))))),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy})),[2,{modelArtifactsInfo:n}]}catch(t){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+n.modelTopologyBytes+", weightSpecsBytes="+n.weightSpecsBytes+", weightDataBytes="+n.weightDataBytes+".")}var a;return[2]})})},t.prototype.load=function(){return he(this,void 0,void 0,function(){var t,e,r,n,o,a,i;return fe(this,function(s){if(null==(t=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==t.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(e={},null==(r=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(e.modelTopology=r,null==(n=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(e.weightSpecs=n,null!=(o=this.LS.getItem(this.keys.modelMetadata))&&(a=JSON.parse(o),e.format=a.format,e.generatedBy=a.generatedBy,e.convertedBy=a.convertedBy),null==(i=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return e.weightData=function(t){if(ch){var e=Buffer.from(t,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}for(var r=atob(t),n=new Uint8Array(r.length),o=0;o<r.length;++o)n.set([r.charCodeAt(o)],o);return n.buffer}(i),[2,e]})})},t.URL_SCHEME="localstorage://",t}(),Lh=function(t){return ge().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Mh.URL_SCHEME)?(e=t.slice(Mh.URL_SCHEME.length),new Mh(e)):null;var e};mh.registerSaveRouter(Lh),mh.registerLoadRouter(Lh);var Ph=function(){function t(){Ie(ge().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),Ie(void 0!==window.localStorage,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return t.prototype.listModels=function(){return he(this,void 0,void 0,function(){var t,e,r,n,o,a;return fe(this,function(i){for(t={},e=Ah+Ih,r=Ih+Nh,n=0;n<this.LS.length;++n)(o=this.LS.key(n)).startsWith(e)&&o.endsWith(r)&&(a=Fh(o),t[a]=JSON.parse(this.LS.getItem(o)));return[2,t]})})},t.prototype.removeModel=function(t){return he(this,void 0,void 0,function(){var e,r;return fe(this,function(n){var o;if(t=(o=t).startsWith(Mh.URL_SCHEME)?o.slice(Mh.URL_SCHEME.length):o,e=Oh(t),null==this.LS.getItem(e.info))throw new Error("Cannot find model at path '"+t+"'");return r=JSON.parse(this.LS.getItem(e.info)),this.LS.removeItem(e.info),this.LS.removeItem(e.topology),this.LS.removeItem(e.weightSpecs),this.LS.removeItem(e.weightData),[2,r]})})},t}();if(ge().getBool("IS_BROWSER"))try{vh.registerManager(Mh.URL_SCHEME,new Ph)}catch(Nr){}var Bh="model",qh=".json",Vh=".weights.bin";function Wh(t){return new Promise(function(t){return setTimeout(t)}).then(t)}var Uh=function(){function t(e){if(!ge().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(t.URL_SCHEME)&&(e=e.slice(t.URL_SCHEME.length)),null!=e&&0!==e.length||(e=Bh),this.modelTopologyFileName=e+qh,this.weightDataFileName=e+Vh}return t.prototype.save=function(t){return he(this,void 0,void 0,function(){var e,r,n,o,a,i;return fe(this,function(s){switch(s.label){case 0:if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(e=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return r=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:r},o=window.URL.createObjectURL(new Blob([JSON.stringify(n)],{type:"application/json"})),(a=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,a.href=o,[4,Wh(function(){return a.dispatchEvent(new MouseEvent("click"))})];case 2:return s.sent(),null==t.weightData?[3,4]:((i=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,i.href=e,[4,Wh(function(){return i.dispatchEvent(new MouseEvent("click"))})]);case 3:s.sent(),s.label=4;case 4:return[2,{modelArtifactsInfo:fh(t)}]}})})},t.URL_SCHEME="downloads://",t}(),jh=function(){function t(t){if(null==t||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+t);this.files=t}return t.prototype.load=function(){return he(this,void 0,void 0,function(){var t,e,r=this;return fe(this,function(n){return t=this.files[0],e=this.files.slice(1),[2,new Promise(function(n,o){var a=new FileReader;a.onload=function(a){var i=JSON.parse(a.target.result),s=i.modelTopology;if(null!=s){0===e.length&&n({modelTopology:s});var u=i.weightsManifest;if(null!=u){var l;try{l=r.checkManifestAndWeightFiles(u,e)}catch(t){return void o(t)}var c=[],p=[],d=[];u.forEach(function(t){t.paths.forEach(function(t){p.push(t),d.push(null)}),c.push.apply(c,t.weights)}),u.forEach(function(t){t.paths.forEach(function(t){var e=new FileReader;e.onload=function(e){var r=e.target.result,o=p.indexOf(t);d[o]=r,-1===d.indexOf(null)&&n({modelTopology:s,weightSpecs:c,weightData:dh(d)})},e.onerror=function(e){return o("Failed to weights data from file of path '"+t+"'.")},e.readAsArrayBuffer(l[t])})})}else o(new Error("weightManifest field is missing from file "+t.name))}else o(new Error("modelTopology field is missing from file "+t.name))},a.onerror=function(e){return o("Failed to read model topology and weights manifest JSON from file '"+t.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},a.readAsText(t)})]})})},t.prototype.checkManifestAndWeightFiles=function(t,e){for(var r=[],n=e.map(function(t){return hh(t.name)}),o={},a=0,i=t;a<i.length;a++)i[a].paths.forEach(function(t){var a=hh(t);if(-1!==r.indexOf(a))throw new Error("Duplicate file basename found in weights manifest: '"+a+"'");if(r.push(a),-1===n.indexOf(a))throw new Error("Weight file with basename '"+a+"' is not provided.");o[t]=e[n.indexOf(a)]});if(r.length!==e.length)throw new Error("Mismatch in the number of files in weights manifest ("+r.length+") and the number of weight files provided ("+e.length+").");return o},t}();function Hh(t,e,r,n){!function(t){Ie(null!=t&&Array.isArray(t)&&t.length>0,function(){return"promises must be a none empty array"})}(t),function(t,e){Ie(t>=0&&t<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+t}),Ie(e>=0&&e<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+e}),Ie(e>=t,function(){return"startFraction must be no more than endFraction, but got startFraction "+t+" and endFraction "+e})}(r=null==r?0:r,n=null==n?1:n);var o=0;return Promise.all(t.map(function(a){return a.then(function(a){var i=r+ ++o/t.length*(n-r);return e(i),a}),a}))}function Gh(t,e){return he(this,void 0,void 0,function(){var r,n,o,a,i,s,u,l,c;return fe(this,function(p){switch(p.label){case 0:return null==e&&(e={}),r=null==e.fetchFunc?ge().platform.fetch:e.fetchFunc,n=t.map(function(t){return r(t,e.requestInit,{isBinary:!0})}),o=0,a=.5,null!=e.onProgress?[3,2]:[4,Promise.all(n)];case 1:return i=p.sent(),[3,4];case 2:return[4,Hh(n,e.onProgress,o,a)];case 3:i=p.sent(),p.label=4;case 4:return s=i.map(function(t){return t.arrayBuffer()}),u=.5,l=1,null!=e.onProgress?[3,6]:[4,Promise.all(s)];case 5:return c=p.sent(),[3,8];case 6:return[4,Hh(s,e.onProgress,u,l)];case 7:c=p.sent(),p.label=8;case 8:return[2,c]}})})}function $h(t){var e=this;return function(r,n,o){return void 0===n&&(n=""),he(e,void 0,void 0,function(){var e,a,i,s,u,l,c,p,d,h;return fe(this,function(f){switch(f.label){case 0:if(e=r.map(function(){return!1}),a={},i=null!=o?o.map(function(){return!1}):[],s=[],r.forEach(function(t,r){var n=0;t.weights.forEach(function(t){var u="quantization"in t?t.quantization.dtype:t.dtype,l=ih[u]*Te(t.shape),c=function(){e[r]=!0,null==a[r]&&(a[r]=[]),a[r].push({manifestEntry:t,groupOffset:n,sizeBytes:l})};null!=o?o.forEach(function(e,r){e===t.name&&(c(),i[r]=!0)}):c(),s.push(t.name),n+=l})}),!i.every(function(t){return t}))throw u=o.filter(function(t,e){return!i[e]}),new Error("Could not find weights in manifest with names: "+u.join(", ")+". \nManifest JSON has weights with names: "+s.join(", ")+".");return l=e.reduce(function(t,e,r){return e&&t.push(r),t},[]),c=[],l.forEach(function(t){r[t].paths.forEach(function(t){var e=n+(n.endsWith("/")?"":"/")+t;c.push(e)})}),[4,t(c)];case 1:return p=f.sent(),d={},h=0,l.forEach(function(t){for(var e=r[t].paths.length,n=0,o=0;o<e;o++)n+=p[h+o].byteLength;for(var i=new ArrayBuffer(n),s=new Uint8Array(i),u=0,l=0;l<e;l++){var c=new Uint8Array(p[h+l]);s.set(c,u),u+=c.byteLength}a[t].forEach(function(t){var e=uh(i.slice(t.groupOffset,t.groupOffset+t.sizeBytes),[t.manifestEntry]);for(var r in e)d[r]=e[r]}),h+=e}),[2,d]}})})}}mh.registerSaveRouter(function(t){return ge().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Uh.URL_SCHEME)?(void 0===(e=t.slice(Uh.URL_SCHEME.length))&&(e="model"),new Uh(e)):null;var e});var Kh=function(){function t(t,e){if(this.DEFAULT_METHOD="POST",null==e&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,null!=e.fetchFunc?(Ie("function"==typeof e.fetchFunc,function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=e.fetchFunc):this.fetch=ge().platform.fetch,Ie(null!=t&&t.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(t)&&Ie(2===t.length,function(){return"URL paths for http must have a length of 2, (actual length is "+t.length+")."}),this.path=t,null!=e.requestInit&&null!=e.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}return t.prototype.save=function(t){return he(this,void 0,void 0,function(){var e,r,n,o;return fe(this,function(a){switch(a.label){case 0:if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata,weightsManifest:r},e.body.append("model.json",new Blob([JSON.stringify(n)],{type:"application/json"}),"model.json"),null!=t.weightData&&e.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,e)];case 1:if((o=a.sent()).ok)return[2,{modelArtifactsInfo:fh(t),responses:[o]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+o.status+".")}})})},t.prototype.load=function(){return he(this,void 0,void 0,function(){var t,e,r,n,o,a,i,s;return fe(this,function(u){switch(u.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(t=u.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+t.status+". Please verify this URL points to the model JSON of the model to load.");u.label=2;case 2:return u.trys.push([2,4,,5]),[4,t.json()];case 3:return e=u.sent(),[3,5];case 4:throw u.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(n=e.modelTopology,o=e.weightsManifest,null==n&&null==o)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==o?[3,7]:[4,this.loadWeights(o)];case 6:s=u.sent(),a=s[0],i=s[1],u.label=7;case 7:return[2,{modelTopology:n,weightSpecs:a,weightData:i}]}})})},t.prototype.loadWeights=function(t){return he(this,void 0,void 0,function(){var e,r,n,o,a,i,s,u,l,c,p;return fe(this,function(d){switch(d.label){case 0:for(e=Array.isArray(this.path)?this.path[1]:this.path,r=function(t){var e=t.lastIndexOf("/"),r=t.lastIndexOf("?");return[t.substring(0,e)+"/",r>e?t.substring(r):""]}(e),n=r[0],o=r[1],a=this.weightPathPrefix||n,i=[],s=0,u=t;s<u.length;s++)l=u[s],i.push.apply(i,l.weights);return c=[],t.forEach(function(t){t.paths.forEach(function(t){c.push(a+t+o)})}),[4,Gh(c,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return p=d.sent(),[2,[i,dh(p)]]}})})},t.URL_SCHEME_REGEX=/^https?:\/\//,t}();function Xh(t){return null!=t.match(Kh.URL_SCHEME_REGEX)}var Yh=function(t,e){return"undefined"==typeof fetch?null:(Array.isArray(t)?t.every(function(t){return Xh(t)}):Xh(t))?Jh(t,{onProgress:e}):null};function Jh(t,e){return new Kh(t,e)}mh.registerSaveRouter(Yh),mh.registerLoadRouter(Yh);var Zh=function(){function t(t){this.modelArtifacts=t}return t.prototype.load=function(){return he(this,void 0,void 0,function(){return fe(this,function(t){return[2,this.modelArtifacts]})})},t}(),Qh=function(){function t(t){this.saveHandler=t}return t.prototype.save=function(t){return he(this,void 0,void 0,function(){return fe(this,function(e){return[2,this.saveHandler(t)]})})},t}(),tf=Object.freeze({browserFiles:function(t){return new jh(t)},browserHTTPRequest:function(t,e){return Jh(t,e)},concatenateArrayBuffers:dh,decodeWeights:uh,encodeWeights:function(t,e){return he(this,void 0,void 0,function(){var r,n,o,a,i,s=this;return fe(this,function(u){switch(u.label){case 0:for(r=[],n=[],o=Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t),a=function(a){var i=o[a],u=Array.isArray(t)?t[a].tensor:t[i];if("float32"!==u.dtype&&"int32"!==u.dtype&&"bool"!==u.dtype&&"string"!==u.dtype)throw new Error("Unsupported dtype in weight '"+i+"': "+u.dtype);var l={name:i,shape:u.shape,dtype:u.dtype};if("string"===u.dtype){var c=new Promise(function(t){return he(s,void 0,void 0,function(){var e,r,n,o,a,i,s;return fe(this,function(l){switch(l.label){case 0:return[4,u.bytes()];case 1:for(e=l.sent(),r=e.reduce(function(t,e){return t+e.length},0)+sh*e.length,n=new Uint8Array(r),o=0,a=0;a<e.length;a++)i=e[a],s=new Uint8Array(new Uint32Array([i.length]).buffer),n.set(s,o),o+=sh,n.set(i,o),o+=i.length;return t(n),[2]}})})});n.push(c)}else n.push(u.data());null!=e&&(l.group=e),r.push(l)},i=0;i<o.length;++i)a(i);return[4,Promise.all(n)];case 1:return[2,{data:lh(u.sent()),specs:r}]}})})},fromMemory:function(t,e,r,n){return 1===arguments.length?null!=t.modelTopology||null!=t.weightSpecs?new Zh(t):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Zh({modelTopology:t})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Zh({modelTopology:t,weightSpecs:e,weightData:r,trainingConfig:n}))},getLoadHandlers:function(t,e){return mh.getLoadHandlers(t,e)},getModelArtifactsInfoForJSON:fh,getSaveHandlers:function(t){return mh.getSaveHandlers(t)},http:Jh,isHTTPScheme:Xh,loadWeights:function(t,e,r,n){return void 0===e&&(e=""),he(this,void 0,void 0,function(){return fe(this,function(o){return[2,$h(function(t){return Gh(t,{requestInit:n})})(t,e,r)]})})},registerLoadRouter:function(t){return mh.registerLoadRouter(t)},registerSaveRouter:function(t){return mh.registerSaveRouter(t)},weightsLoaderFactory:$h,withSaveHandler:function(t){return new Qh(t)},copyModel:function(t,e){return he(this,void 0,void 0,function(){return fe(this,function(r){return[2,yh(t,e,!1)]})})},listModels:function(){return he(this,void 0,void 0,function(){var t,e,r,n,o,a,i;return fe(this,function(s){switch(s.label){case 0:t=vh.getSchemes(),e={},r=0,n=t,s.label=1;case 1:return r<n.length?(o=n[r],[4,vh.getManager(o).listModels()]):[3,4];case 2:for(i in a=s.sent())e[o+gh+i]=a[i];s.label=3;case 3:return r++,[3,1];case 4:return[2,e]}})})},moveModel:function(t,e){return he(this,void 0,void 0,function(){return fe(this,function(r){return[2,yh(t,e,!0)]})})},removeModel:function(t){return he(this,void 0,void 0,function(){var e;return fe(this,function(r){return e=bh(t),[2,vh.getManager(e.scheme).removeModel(e.path)]})})}}),ef=bo({confusionMatrix_:function(t,e,r){var n=ao(t,"labels","confusionMatrix"),o=ao(e,"predictions","confusionMatrix");Ie(null==r||r>0&&Number.isInteger(r),function(){return"If provided, numClasses must be a positive integer, but got "+r}),Ie(1===n.rank,function(){return"Expected the rank of labels to be 1, but got "+n.rank}),Ie(1===o.rank,function(){return"Expected the rank of predictions to be 1, but got "+o.rank}),Ie(n.shape[0]===o.shape[0],function(){return"Mismatch in the number of examples: "+n.shape[0]+" vs. "+o.shape[0]+". Labels and predictions should have the same number of elements."}),Ie(r>0&&Number.isInteger(r),function(){return"numClasses is required to be a positive integer, but got "+r});var a=ha(n.asType("int32"),r),i=ha(o.asType("int32"),r);return a.transpose().matMul(i).asType("int32")}}),rf=Object.freeze({confusionMatrix:ef}),nf=bo({fromPixels_:function(t,e){if(void 0===e&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");var r="undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement;if(r&&r&&t.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");return Vr.fromPixels(t,e)}}),of=Object.freeze({toPixels:function(t,e){return he(this,void 0,void 0,function(){var r,n,o,a,i,s,u,l,c,p,d,h,f,m,g,v,b,y,x,w,k,C,S;return fe(this,function(E){switch(E.label){case 0:if(r=ao(t,"img","toPixels"),t instanceof Cr||(r=r.toInt()),2!==r.rank&&3!==r.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+r.rank+".");if(n=r.shape.slice(0,2),o=n[0],a=n[1],(i=2===r.rank?1:r.shape[2])>4||2===i)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+i);return[4,r.data()];case 1:return s=E.sent(),u=r.min(),l=r.max(),[4,Promise.all([u.data(),l.data()])];case 2:if(c=E.sent(),p=c[0],d=c[1],h=p[0],f=d[0],u.dispose(),l.dispose(),"float32"===r.dtype){if(h<0||f>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+h+" - "+f+"].")}else{if("int32"!==r.dtype)throw new Error("Unsupported type for toPixels: "+r.dtype+". Please use float32 or int32 tensors.");if(h<0||f>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+h+" - "+f+"].")}for(m="float32"===r.dtype?255:1,g=new Uint8ClampedArray(a*o*4),v=0;v<o*a;++v)b=void 0,y=void 0,x=void 0,w=void 0,1===i?(b=s[v]*m,y=s[v]*m,x=s[v]*m,w=255):3===i?(b=s[3*v]*m,y=s[3*v+1]*m,x=s[3*v+2]*m,w=255):4===i&&(b=s[4*v]*m,y=s[4*v+1]*m,x=s[4*v+2]*m,w=s[4*v+3]*m),g[0+(k=4*v)]=Math.round(b),g[k+1]=Math.round(y),g[k+2]=Math.round(x),g[k+3]=Math.round(w);return null!=e&&(e.width=a,e.height=o,C=e.getContext("2d"),S=new ImageData(g,a,o),C.putImageData(S,0,0)),r!==t&&r.dispose(),[2,g]}})})},fromPixels:nf}),af=function(){function t(){}return t.prototype.getClassName=function(){return this.constructor.className},t.fromConfig=function(t,e){return new t(e)},t}(),sf=function(){function t(){this.classNameMap={}}return t.getMap=function(){return null==t.instance&&(t.instance=new t),t.instance},t.register=function(e){t.getMap().classNameMap[e.className]=[e,e.fromConfig]},t}();function uf(t){Ie(null!=t.className,function(){return"Class being registered does not have the static className property defined."}),Ie("string"==typeof t.className,function(){return"className is required to be a string, but got type "+typeof t.className}),Ie(t.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),sf.register(t)}var lf=Object.freeze({Serializable:af,SerializationMap:sf,registerClass:uf}),cf=.001,pf=.1;function df(){return 32===Vr.backend.floatPrecision()?cf:pf}function hf(t,e,r){var n=!0;if((Ge(t)||Ge(e))&&(n=!1),Ge(t)&&Ge(e)&&(n=!0),n){var o=t.constructor.name,a=e.constructor.name;if(o!==a)throw new Error("Arrays are of different type. Actual: "+o+". Expected: "+a)}if(Array.isArray(t)&&Array.isArray(e)){var i=no(t),s=no(e);if(!De(i,s))throw new Error("Arrays have different shapes. Actual: ["+i+"]. Expected: ["+s+"]")}var u=Ge(t)?t:Re(t),l=Ge(e)?e:Re(e);if(u.length!==l.length)throw new Error("Arrays have different lengths actual: "+u.length+" vs expected: "+l.length+".\nActual:   "+u+".\nExpected: "+l+".");for(var c=0;c<l.length;++c){var p=u[c],d=l[c];if(!r(p,d))throw new Error("Arrays differ: actual["+c+"] = "+p+", expected["+c+"] = "+d+".\nActual:   "+u+".\nExpected: "+l+".")}}function ff(t,e,r){return!isFinite(t)&&!isFinite(e)||!(isNaN(t)||isNaN(e)||Math.abs(t-e)>r)}var mf=Object.freeze({TEST_EPSILON_FLOAT16:pf,expectArraysClose:function(t,e,r){return null==r&&(r=df()),hf(t,e,function(t,e){return ff(t,e,r)})},testEpsilon:df,expectPromiseToFail:function(t,e){t().then(function(){return e.fail()},function(){return e()})},expectArraysEqual:function(t,e){var r="string"==typeof e||"number"==typeof e||"boolean"==typeof e?[e]:e;return Xe(t)||Xe(t[0])||Xe(e)||Xe(e[0])?hf(t,r,function(t,e){return t==e}):hf(t,e,function(t,e){return ff(t,e,0)})},expectNumbersClose:function(t,e,r){if(null==r&&(r=df()),!ff(t,e,r))throw new Error("Numbers differ: actual === "+t+", expected === "+e)},expectValuesInRange:function(t,e,r){for(var n=0;n<t.length;n++)if(t[n]<e||t[n]>r)throw new Error("Value out of range:"+t[n]+" low: "+e+", high: "+r)},expectArrayBuffersEqual:function(t,e){expect(new Float32Array(t)).toEqual(new Float32Array(e))}}),gf=Object.freeze({gpgpu_util:au,webgl_util:Kn,forceHalfFloat:function(){ge().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:fl,setWebGLContext:Xr,GPGPUContext:iu}),vf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return de(e,t),e.prototype.minimize=function(t,e,r){void 0===e&&(e=!1);var n=this.computeGradients(t,r),o=n.value,a=n.grads;if(null!=r){var i=r.map(function(t){return{name:t.name,tensor:a[t.name]}});this.applyGradients(i)}else this.applyGradients(a);return Qn(a),e?o:(o.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,e){return Ka(t,e)},e.prototype.dispose=function(){null!=this.iterations_&&Qn(this.iterations_)},e.prototype.saveIterations=function(){return he(this,void 0,void 0,function(){return fe(this,function(t){return null==this.iterations_&&(this.iterations_=0),[2,{name:"iter",tensor:So(this.iterations_,"int32")}]})})},e.prototype.getWeights=function(){return he(this,void 0,void 0,function(){return fe(this,function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},e.prototype.setWeights=function(t){return he(this,void 0,void 0,function(){return fe(this,function(t){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},e.prototype.extractIterations=function(t){return he(this,void 0,void 0,function(){var e;return fe(this,function(r){switch(r.label){case 0:return e=this,[4,t[0].tensor.data()];case 1:return e.iterations_=r.sent()[0],[2,t.slice(1)]}})})},e}(af);Object.defineProperty(vf,Symbol.hasInstance,{value:function(t){return null!=t.minimize&&null!=t.computeGradients&&null!=t.applyGradients}});var bf=function(t){function e(e,r,n){void 0===n&&(n=null);var o=t.call(this)||this;return o.learningRate=e,o.rho=r,o.epsilon=n,o.accumulatedGrads=[],o.accumulatedUpdates=[],null==n&&(o.epsilon=Vr.backend.epsilon()),o}return de(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t)).forEach(function(r,n){var o=Vr.registeredVariables[r];null==e.accumulatedGrads[n]&&(e.accumulatedGrads[n]={originalName:r+"/accum_grad",variable:Zn(function(){return Po(o).variable(!1)})}),null==e.accumulatedUpdates[n]&&(e.accumulatedUpdates[n]={originalName:r+"/accum_var",variable:Zn(function(){return Po(o).variable(!1)})});var a=Array.isArray(t)?t[n].tensor:t[r];if(null!=a){var i=e.accumulatedGrads[n].variable,s=e.accumulatedUpdates[n].variable;Zn(function(){var t=i.mul(e.rho).add(a.square().mul(1-e.rho)),r=s.add(e.epsilon).sqrt().div(i.add(e.epsilon).sqrt()).mul(a),n=s.mul(e.rho).add(r.square().mul(1-e.rho));i.assign(t),s.assign(n);var u=r.mul(-e.learningRate).add(o);o.assign(u)})}}),this.incrementIterations()},e.prototype.dispose=function(){null!=this.accumulatedUpdates&&(Qn(this.accumulatedGrads.map(function(t){return t.variable})),Qn(this.accumulatedUpdates.map(function(t){return t.variable})))},e.prototype.getWeights=function(){return he(this,void 0,void 0,function(){var t;return fe(this,function(e){switch(e.label){case 0:return t=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(t.map(function(t){return{name:t.originalName,tensor:t.variable}}))]}})})},e.prototype.setWeights=function(t){return he(this,void 0,void 0,function(){var e;return fe(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),e=t.length/2,this.accumulatedGrads=t.slice(0,e).map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),this.accumulatedUpdates=t.slice(e,2*e).map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,e){return new t(e.learningRate,e.rho,e.epsilon)},e.className="Adadelta",e}(vf);uf(bf);var yf=function(t){function e(e,r){void 0===r&&(r=.1);var n=t.call(this)||this;return n.learningRate=e,n.initialAccumulatorValue=r,n.accumulatedGrads=[],n}return de(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t)).forEach(function(r,n){var o=Vr.registeredVariables[r];null==e.accumulatedGrads[n]&&(e.accumulatedGrads[n]={originalName:r+"/accumulator",variable:Zn(function(){return Oo(o.shape,e.initialAccumulatorValue).variable(!1)})});var a=Array.isArray(t)?t[n].tensor:t[r];if(null!=a){var i=e.accumulatedGrads[n].variable;Zn(function(){var t=i.add(a.square());i.assign(t);var r=a.div(t.add(Vr.backend.epsilon()).sqrt()).mul(-e.learningRate).add(o);o.assign(r)})}}),this.incrementIterations()},e.prototype.dispose=function(){null!=this.accumulatedGrads&&Qn(this.accumulatedGrads.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return he(this,void 0,void 0,function(){return fe(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map(function(t){return{name:t.originalName,tensor:t.variable}}))]}})})},e.prototype.setWeights=function(t){return he(this,void 0,void 0,function(){return fe(this,function(e){switch(e.label){case 0:return[4,this.extractIterations(t)];case 1:return t=e.sent(),this.accumulatedGrads=t.map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,e){return new t(e.learningRate,e.initialAccumulatorValue)},e.className="Adagrad",e}(vf);uf(yf);var xf=function(t){function e(e,r,n,o){void 0===o&&(o=null);var a=t.call(this)||this;return a.learningRate=e,a.beta1=r,a.beta2=n,a.epsilon=o,a.accumulatedFirstMoment=[],a.accumulatedSecondMoment=[],Zn(function(){a.accBeta1=So(r).variable(),a.accBeta2=So(n).variable()}),null==o&&(a.epsilon=Vr.backend.epsilon()),a}return de(e,t),e.prototype.applyGradients=function(t){var e=this,r=Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t);Zn(function(){var n=Mc(1,e.accBeta1),o=Mc(1,e.accBeta2);r.forEach(function(r,a){var i=Vr.registeredVariables[r];null==e.accumulatedFirstMoment[a]&&(e.accumulatedFirstMoment[a]={originalName:r+"/m",variable:Zn(function(){return Po(i).variable(!1)})}),null==e.accumulatedSecondMoment[a]&&(e.accumulatedSecondMoment[a]={originalName:r+"/v",variable:Zn(function(){return Po(i).variable(!1)})});var s=Array.isArray(t)?t[a].tensor:t[r];if(null!=s){var u=e.accumulatedFirstMoment[a].variable,l=e.accumulatedSecondMoment[a].variable,c=u.mul(e.beta1).add(s.mul(1-e.beta1)),p=l.mul(e.beta2).add(s.square().mul(1-e.beta2)),d=c.div(n),h=p.div(o);u.assign(c),l.assign(p);var f=d.div(h.sqrt().add(e.epsilon)).mul(-e.learningRate).add(i);i.assign(f)}}),e.accBeta1.assign(e.accBeta1.mul(e.beta1)),e.accBeta2.assign(e.accBeta2.mul(e.beta2))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&Qn(this.accumulatedFirstMoment.map(function(t){return t.variable})),null!=this.accumulatedSecondMoment&&Qn(this.accumulatedSecondMoment.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return he(this,void 0,void 0,function(){var t;return fe(this,function(e){switch(e.label){case 0:return t=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(t.map(function(t){return{name:t.originalName,tensor:t.variable}}))]}})})},e.prototype.setWeights=function(t){return he(this,void 0,void 0,function(){var e,r=this;return fe(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:return t=n.sent(),Zn(function(){r.accBeta1.assign(Dc(r.beta1,r.iterations_+1)),r.accBeta2.assign(Dc(r.beta2,r.iterations_+1))}),e=t.length/2,this.accumulatedFirstMoment=t.slice(0,e).map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),this.accumulatedSecondMoment=t.slice(e,2*e).map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon)},e.className="Adam",e}(vf);uf(xf);var wf=function(t){function e(e,r,n,o,a){void 0===o&&(o=null),void 0===a&&(a=0);var i=t.call(this)||this;return i.learningRate=e,i.beta1=r,i.beta2=n,i.epsilon=o,i.decay=a,i.accumulatedFirstMoment=[],i.accumulatedWeightedInfNorm=[],Zn(function(){i.iteration=So(0).variable(),i.accBeta1=So(r).variable()}),null==o&&(i.epsilon=Vr.backend.epsilon()),i}return de(e,t),e.prototype.applyGradients=function(t){var e=this,r=Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t);Zn(function(){var n=Mc(1,e.accBeta1),o=xc(-e.learningRate,e.iteration.mul(e.decay).add(1));r.forEach(function(r,a){var i=Vr.registeredVariables[r];null==e.accumulatedFirstMoment[a]&&(e.accumulatedFirstMoment[a]={originalName:r+"/m",variable:Po(i).variable(!1)}),null==e.accumulatedWeightedInfNorm[a]&&(e.accumulatedWeightedInfNorm[a]={originalName:r+"/v",variable:Po(i).variable(!1)});var s=Array.isArray(t)?t[a].tensor:t[r];if(null!=s){var u=e.accumulatedFirstMoment[a].variable,l=e.accumulatedWeightedInfNorm[a].variable,c=u.mul(e.beta1).add(s.mul(1-e.beta1)),p=l.mul(e.beta2),d=s.abs(),h=p.maximum(d);u.assign(c),l.assign(h);var f=o.div(n).mul(c.div(h.add(e.epsilon))).add(i);i.assign(f)}}),e.iteration.assign(e.iteration.add(1)),e.accBeta1.assign(e.accBeta1.mul(e.beta1))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&Qn(this.accumulatedFirstMoment.map(function(t){return t.variable})),null!=this.accumulatedWeightedInfNorm&&Qn(this.accumulatedWeightedInfNorm.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return he(this,void 0,void 0,function(){return fe(this,function(t){throw new Error("getWeights() is not implemented for Adamax yet.")})})},e.prototype.setWeights=function(t){return he(this,void 0,void 0,function(){return fe(this,function(t){throw new Error("setWeights() is not implemented for Adamax yet.")})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon,e.decay)},e.className="Adamax",e}(vf);uf(wf);var kf=function(t){function e(e){var r=t.call(this)||this;return r.learningRate=e,r.setLearningRate(e),r}return de(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t)).forEach(function(r,n){var o=Array.isArray(t)?t[n].tensor:t[r];if(null!=o){var a=Vr.registeredVariables[r];Zn(function(){var t=e.c.mul(o).add(a);a.assign(t)})}}),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,null!=this.c&&this.c.dispose(),this.c=to(So(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return he(this,void 0,void 0,function(){return fe(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}})})},e.prototype.setWeights=function(t){return he(this,void 0,void 0,function(){return fe(this,function(e){switch(e.label){case 0:return[4,this.extractIterations(t)];case 1:if(0!==(t=e.sent()).length)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,e){return new t(e.learningRate)},e.className="SGD",e}(vf);uf(kf);var Cf=function(t){function e(e,r,n){void 0===n&&(n=!1);var o=t.call(this,e)||this;return o.learningRate=e,o.momentum=r,o.useNesterov=n,o.accumulations=[],o.m=So(o.momentum),o}return de(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t)).forEach(function(r,n){var o=Vr.registeredVariables[r];null==e.accumulations[n]&&(e.accumulations[n]={originalName:r+"/momentum",variable:Zn(function(){return Po(o).variable(!1)})});var a=e.accumulations[n].variable,i=Array.isArray(t)?t[n].tensor:t[r];null!=i&&Zn(function(){var t,r=e.m.mul(a).add(i);t=e.useNesterov?e.c.mul(i.add(r.mul(e.m))).add(o):e.c.mul(r).add(o),a.assign(r),o.assign(t)})}),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),null!=this.accumulations&&Qn(this.accumulations.map(function(t){return t.variable}))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return he(this,void 0,void 0,function(){return fe(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map(function(t){return{name:t.originalName,tensor:t.variable}}))]}})})},e.prototype.setWeights=function(t){return he(this,void 0,void 0,function(){return fe(this,function(e){switch(e.label){case 0:return[4,this.extractIterations(t)];case 1:return t=e.sent(),this.accumulations=t.map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,e){return new t(e.learningRate,e.momentum,e.useNesterov)},e.className="Momentum",e}(kf);uf(Cf);var Sf=function(t){function e(e,r,n,o,a){void 0===r&&(r=.9),void 0===n&&(n=0),void 0===o&&(o=null),void 0===a&&(a=!1);var i=t.call(this)||this;return i.learningRate=e,i.decay=r,i.momentum=n,i.epsilon=o,i.accumulatedMeanSquares=[],i.accumulatedMoments=[],i.accumulatedMeanGrads=[],i.centered=a,null==o&&(i.epsilon=Vr.backend.epsilon()),i}return de(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t)).forEach(function(r,n){var o=Vr.registeredVariables[r];null==e.accumulatedMeanSquares[n]&&(e.accumulatedMeanSquares[n]={originalName:r+"/rms",variable:Zn(function(){return Po(o).variable(!1)})}),null==e.accumulatedMoments[n]&&(e.accumulatedMoments[n]={originalName:r+"/momentum",variable:Zn(function(){return Po(o).variable(!1)})}),null==e.accumulatedMeanGrads[n]&&e.centered&&(e.accumulatedMeanGrads[n]={originalName:r+"/mg",variable:Zn(function(){return Po(o).variable(!1)})});var a=Array.isArray(t)?t[n].tensor:t[r];if(null!=a){var i=e.accumulatedMeanSquares[n].variable,s=e.accumulatedMoments[n].variable;Zn(function(){var t=i.mul(e.decay).add(a.square().mul(1-e.decay));if(e.centered){var r=e.accumulatedMeanGrads[n].variable,u=r.mul(e.decay).add(a.mul(1-e.decay)),l=s.mul(e.momentum).add(a.mul(e.learningRate).div(t.sub(u.square().add(e.epsilon)).sqrt()));i.assign(t),r.assign(u),s.assign(l);var c=o.sub(l);o.assign(c)}else{var p=i.mul(e.decay).add(a.square().mul(1-e.decay));l=s.mul(e.momentum).add(a.mul(e.learningRate).div(p.add(e.epsilon).sqrt())),i.assign(p),s.assign(l),c=o.sub(l),o.assign(c)}})}}),this.incrementIterations()},e.prototype.dispose=function(){null!=this.accumulatedMeanSquares&&Qn(this.accumulatedMeanSquares.map(function(t){return t.variable})),null!=this.accumulatedMeanGrads&&this.centered&&Qn(this.accumulatedMeanGrads.map(function(t){return t.variable})),null!=this.accumulatedMoments&&Qn(this.accumulatedMoments.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return he(this,void 0,void 0,function(){var t;return fe(this,function(e){switch(e.label){case 0:return t=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&t.push.apply(t,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(t.map(function(t){return{name:t.originalName,tensor:t.variable}}))]}})})},e.prototype.setWeights=function(t){return he(this,void 0,void 0,function(){var e;return fe(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),e=this.centered?t.length/3:t.length/2,this.accumulatedMeanSquares=t.slice(0,e).map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),this.accumulatedMoments=t.slice(e,2*e).map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=t.slice(2*e,3*e).map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}})),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,e){return new t(e.learningRate,e.decay,e.momentum,e.epsilon,e.centered)},e.className="RMSProp",e}(vf);uf(Sf);var Ef=function(){function t(){}return t.sgd=function(t){return new kf(t)},t.momentum=function(t,e,r){return void 0===r&&(r=!1),new Cf(t,e,r)},t.rmsprop=function(t,e,r,n,o){return void 0===e&&(e=.9),void 0===r&&(r=0),void 0===n&&(n=null),void 0===o&&(o=!1),new Sf(t,e,r,n,o)},t.adam=function(t,e,r,n){return void 0===t&&(t=.001),void 0===e&&(e=.9),void 0===r&&(r=.999),void 0===n&&(n=null),new xf(t,e,r,n)},t.adadelta=function(t,e,r){return void 0===t&&(t=.001),void 0===e&&(e=.95),void 0===r&&(r=null),new bf(t,e,r)},t.adamax=function(t,e,r,n,o){return void 0===t&&(t=.002),void 0===e&&(e=.9),void 0===r&&(r=.999),void 0===n&&(n=null),void 0===o&&(o=0),new wf(t,e,r,n,o)},t.adagrad=function(t,e){return void 0===e&&(e=.1),new yf(t,e)},t}(),zf={sgd:Ef.sgd,momentum:Ef.momentum,adadelta:Ef.adadelta,adagrad:Ef.adagrad,rmsprop:Ef.rmsprop,adamax:Ef.adamax,adam:Ef.adam},If="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate?setImmediate:function(t){return t()};function Af(){return new Promise(function(t){return If(function(){return t()})})}wr=Qd;var Nf,Rf,Tf=Object.freeze({__proto__:null,AdadeltaOptimizer:bf,AdagradOptimizer:yf,AdamOptimizer:xf,AdamaxOptimizer:wf,DataStorage:Qa,get ENV(){return ve},Environment:me,KernelBackend:ti,MomentumOptimizer:Cf,Optimizer:vf,RMSPropOptimizer:Sf,get Rank(){return Sr},get Reduction(){return bd},SGDOptimizer:kf,Tensor:Cr,TensorBuffer:yr,Variable:Rr,abs:gl,acos:vl,acosh:bl,add:gc,addN:vc,addStrict:bc,all:Mp,any:Lp,argMax:Pp,argMin:Bp,asin:yl,asinh:xl,atan:wl,atan2:yc,atanh:kl,avgPool:zp,avgPool3d:Np,backend:eo,backend_util:xi,basicLSTMCell:rd,batchNorm:ic,batchNorm2d:sc,batchNorm3d:uc,batchNorm4d:lc,batchNormalization:ac,batchNormalization2d:rc,batchNormalization3d:nc,batchNormalization4d:oc,batchToSpaceND:aa,booleanMaskAsync:tp,browser:of,buffer:na,cast:ia,ceil:Cl,clipByValue:Sl,clone:sa,complex:yo,concat:Bo,concat1d:qo,concat2d:Vo,concat3d:Wo,concat4d:Uo,conv1d:op,conv2d:ap,conv2dTranspose:hp,conv3d:ip,conv3dTranspose:fp,cos:El,cosh:zl,cumsum:ua,customGrad:Xa,deprecationWarn:Yn,depthToSpace:la,depthwiseConv2d:lp,diag:md,disableDeprecationWarnings:function(){ge().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")},dispose:Qn,disposeVariables:function(){Vr.disposeVariables()},div:xc,divNoNan:wc,divStrict:kc,dot:gp,dropout:gd,elu:$p,enableDebugMode:function(){ge().set("DEBUG",!0)},enableProdMode:function(){ge().set("PROD",!0)},engine:function(){return Vr},env:ge,equal:Pc,equalStrict:Bc,erf:Il,exp:Al,expandDims:ca,expm1:Nl,eye:pa,fft:ud,fill:Oo,findBackend:function(t){return Vr.findBackend(t)},findBackendFactory:function(t){return Vr.findBackendFactory(t)},floor:Rl,floorDiv:Cc,frame:wd,fused:Zd,gather:Zc,gatherND:fd,getBackend:function(){return Vr.backendName},getKernel:ye,getKernelsForBackend:xe,grad:function(t){return Ie(Qe(t),function(){return"The f passed in grad(f) must be a function"}),function(e,r){var n=ao(e,"x","tf.grad",null),o=null!=r?ao(r,"dy","tf.grad"):null;return Vr.tidy(function(){var e=Vr.gradients(function(){return t(n)},[n],o),r=e.value,a=e.grads;return null!=o&&Ae(r.shape,o.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),Ya(a),a[0]})}},grads:function(t){return Ie(Qe(t),function(){return"The f passed in grads(f) must be a function"}),function(e,r){Ie(Array.isArray(e),function(){return"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"});var n=io(e,"args","tf.grads",null),o=null!=r?ao(r,"dy","tf.grads"):null;return Vr.tidy(function(){var e=Vr.gradients(function(){return t.apply(void 0,n)},n,o),r=e.value,a=e.grads;return null!=o&&Ae(r.shape,o.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Ya(a),a})}},greater:qc,greaterEqual:Vc,greaterEqualStrict:Wc,greaterStrict:Uc,hammingWindow:xd,hannWindow:yd,ifft:ld,imag:wo,image:jd,inTopKAsync:Sd,io:tf,irfft:pd,isFinite:Wl,isInf:Vl,isNaN:ql,keep:to,leakyRelu:Kp,less:jc,lessEqual:Hc,lessEqualStrict:Gc,lessStrict:$c,linalg:Pd,linspace:Fo,localResponseNormalization:td,log:Tl,log1p:Dl,logSigmoid:_l,logSoftmax:Za,logSumExp:qp,logicalAnd:cc,logicalNot:pc,logicalOr:dc,logicalXor:hc,losses:Od,matMul:mp,math:rf,max:Vp,maxPool:Ep,maxPool3d:Ap,maximum:Sc,maximumStrict:Ec,mean:Wp,memory:Jn,min:Up,minimum:zc,minimumStrict:Ic,mod:Ac,modStrict:Nc,moments:jp,movingAverage:od,mul:Rc,mulStrict:Tc,multiRNNCell:nd,multinomial:da,neg:Ol,nextFrame:Af,norm:ed,notEqual:Kc,notEqualStrict:Xc,oneHot:ha,ones:Do,onesLike:Lo,op:bo,outerProduct:vp,pad:fa,pad1d:ma,pad2d:ga,pad3d:va,pad4d:ba,pool:Ip,pow:Dc,powStrict:_c,prelu:Xp,print:oa,prod:Gp,profile:function(t){return Vr.profile(t)},rand:ya,randomGamma:wa,randomNormal:xa,randomUniform:ka,range:Mo,ready:function(){return Vr.ready()},real:xo,reciprocal:Fl,registerBackend:function(t,e,r){return void 0===r&&(r=1),Vr.registerBackend(t,e,r)},registerKernel:we,relu:Yp,relu6:Jp,removeBackend:function(t){Vr.removeBackend(t)},reshape:Ca,reverse:bp,reverse1d:yp,reverse2d:xp,reverse3d:wp,reverse4d:kp,rfft:cd,round:Ml,rsqrt:Ll,scalar:So,scatterND:sd,selu:Zp,separableConv2d:dp,serialization:lf,setBackend:function(t){return Vr.setBackend(t)},setPlatform:function(t,e){ge().setPlatform(t,e)},setdiff1dAsync:Ra,sigmoid:Pl,sign:Bl,signal:Cd,sin:Ul,sinh:jl,slice:Rp,slice1d:Tp,slice2d:Dp,slice3d:_p,slice4d:Op,slice_util:$a,softmax:Ja,softplus:Hl,spaceToBatchND:Sa,sparseToDense:hd,spectral:dd,split:jo,sqrt:Gl,square:ml,squaredDifference:Oc,squaredDifferenceStrict:Fc,squeeze:Ea,stack:za,step:$l,stft:kd,stridedSlice:ad,sub:Mc,subStrict:Lc,sum:Hp,tan:Kl,tanh:Xl,tensor:ko,tensor1d:Eo,tensor2d:zo,tensor3d:Io,tensor4d:Ao,tensor5d:No,tensor6d:Ro,tensor_util:Pr,test_util:mf,tidy:Zn,tile:Ia,time:function(t){return Vr.time(t)},topk:id,train:zf,transpose:Qp,truncatedNormal:Aa,unregisterKernel:function(t,e){var r=ke(t,e);if(!be.has(r))throw new Error("The kernel '"+t+"' for backend '"+e+"' is not registered");be.delete(r)},unsortedSegmentSum:Qc,unstack:Na,util:cr,valueAndGrad:function(t){return Ie(Qe(t),function(){return"The f passed in valueAndGrad(f) must be a function"}),function(e,r){Ie(e instanceof Cr,function(){return"The x passed in valueAndGrad(f)(x) must be a tensor"}),Ie(null==r||r instanceof Cr,function(){return"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"});var n=Vr.gradients(function(){return t(e)},[e],r),o=n.grads,a=n.value;return Ya(o),{grad:o[0],value:a}}},valueAndGrads:function(t){return Ie(Qe(t),function(){return"The f passed in valueAndGrads(f) must be a function"}),function(e,r){Ie(Array.isArray(e)&&e.every(function(t){return t instanceof Cr}),function(){return"The args passed in valueAndGrads(f)(args) must be array of tensors"}),Ie(null==r||r instanceof Cr,function(){return"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"});var n=Vr.gradients(function(){return t.apply(void 0,e)},e,r);return null!=r&&Ae(n.value.shape,r.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Ya(n.grads),n}},variable:To,variableGrads:Ka,version_core:"1.3.2",webgl:gf,where:fc,whereAsync:mc,zeros:_o,zerosLike:Po}),Df=function(){return(Df=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function _f(t,e,r,n){return new(r||(r=Promise))(function(o,a){function i(t){try{u(n.next(t))}catch(t){a(t)}}function s(t){try{u(n.throw(t))}catch(t){a(t)}}function u(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(i,s)}u((n=n.apply(t,e||[])).next())})}function Of(t,e){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(t,i)}catch(t){a=[6,t],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}!function(t){t[t.DT_INVALID=0]="DT_INVALID",t[t.DT_FLOAT=1]="DT_FLOAT",t[t.DT_DOUBLE=2]="DT_DOUBLE",t[t.DT_INT32=3]="DT_INT32",t[t.DT_UINT8=4]="DT_UINT8",t[t.DT_INT16=5]="DT_INT16",t[t.DT_INT8=6]="DT_INT8",t[t.DT_STRING=7]="DT_STRING",t[t.DT_COMPLEX64=8]="DT_COMPLEX64",t[t.DT_INT64=9]="DT_INT64",t[t.DT_BOOL=10]="DT_BOOL",t[t.DT_QINT8=11]="DT_QINT8",t[t.DT_QUINT8=12]="DT_QUINT8",t[t.DT_QINT32=13]="DT_QINT32",t[t.DT_BFLOAT16=14]="DT_BFLOAT16",t[t.DT_FLOAT_REF=101]="DT_FLOAT_REF",t[t.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",t[t.DT_INT32_REF=103]="DT_INT32_REF",t[t.DT_UINT8_REF=104]="DT_UINT8_REF",t[t.DT_INT16_REF=105]="DT_INT16_REF",t[t.DT_INT8_REF=106]="DT_INT8_REF",t[t.DT_STRING_REF=107]="DT_STRING_REF",t[t.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",t[t.DT_INT64_REF=109]="DT_INT64_REF",t[t.DT_BOOL_REF=110]="DT_BOOL_REF",t[t.DT_QINT8_REF=111]="DT_QINT8_REF",t[t.DT_QUINT8_REF=112]="DT_QUINT8_REF",t[t.DT_QINT32_REF=113]="DT_QINT32_REF",t[t.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF"}(Nf||(Nf={})),function(t){!function(t){t[t.LEGACY=0]="LEGACY",t[t.V1=1]="V1",t[t.V2=2]="V2"}(t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))}(Rf||(Rf={}));var Ff={};function Mf(t){return Ff[t]}function Lf(t,e,r,n){var o=e.inputParams[t];if(o&&void 0!==o.inputIndexStart){var a=o.inputIndexStart,i=0===o.inputIndexEnd?void 0:void 0===o.inputIndexEnd?a+1:o.inputIndexEnd;if("tensor"===o.type)return Pf(e.inputNames[o.inputIndexStart],r,n);if("tensors"===o.type)return e.inputNames.slice(a,i).map(function(t){return Pf(t,r,n)});var s=Array.prototype.slice.call(Pf(e.inputNames.slice(a)[0],r,n).dataSync());return"number"===o.type?s[0]:s}var u=e.attrParams[t];return u&&u.value}function Pf(t,e,r){var n=Vf(t),o=n[0],a=n[1],i=r.currentContextIds.find(function(t){return!!e[qf(o,t)]});return void 0!==i?e[qf(o,i)][a]:void 0}function Bf(t,e){var r=Vf(t),n=r[0],o=r[1];return[qf(n,e&&e.currentContextId),o]}function qf(t,e){return e?t+"-"+e:t}function Vf(t){var e=t.lastIndexOf(":");return-1===e?[t,0]:[t.substring(0,e),Number(t.substring(e+1))]}function Wf(t,e){for(var r=[],n=0;n<t.length;n+=e)r.push(t.slice(n,n+e));return r}var Uf=Object.freeze({json:[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),jf=Object.freeze({json:[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"clip_value_min",name:"clipValueMin",type:"number"},{tfName:"clip_value_max",name:"clipValueMax",type:"number"}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"clipValueMin",name:"clipValueMin",type:"number",defaultValue:0},{tfName:"clipValueMax",name:"clipValueMax",type:"number",defaultValue:6}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),Hf=Object.freeze({json:[{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"}]}]}),Gf=Object.freeze({json:[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]}]}),$f=Object.freeze({json:[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}]}),Kf=Object.freeze({json:[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),Xf=Object.freeze({json:[{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]}]}),Yf=Object.freeze({json:[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}]}),Jf=Object.freeze({json:[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]}]}),Zf=Object.freeze({json:[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),Qf=Object.freeze({json:[{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),tm=Object.freeze({json:[{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}]}),em=Object.freeze({json:[{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]}]}),rm=Object.freeze({json:[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool",notSupported:!0}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}]}),nm=Object.freeze({json:[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}]}),om=Object.freeze({json:[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]}]}),am=function(){function t(){var t=[Uf,jf,Hf,Gf,$f,Kf,Xf,Zf,Jf,Yf,Qf,tm,em,rm,nm,om],e=[].concat.apply([],t.map(function(t){return t.json}));this.opMappers=e.reduce(function(t,e){return t[e.tfOpName]=e,t},{})}return Object.defineProperty(t,"Instance",{get:function(){return this._instance||(this._instance=new this)},enumerable:!0,configurable:!0}),t.prototype.transformGraph=function(t){var e=this,r=[],n=[],o=t.node.reduce(function(t,o){return t[o.name]=e.mapNode(o),"Placeholder"===o.op&&r.push(t[o.name]),"Const"===o.op&&n.push(t[o.name]),t},{}),a=[],i=[],s=Object.keys(o);return s.forEach(function(t){var e=o[t];e.inputNames.forEach(function(t){var r=Bf(t)[0];e.inputs.push(o[r]),o[r].children.push(e)}),0===e.inputs.length&&a.push(e)}),s.forEach(function(t){var e=o[t];0===e.children.length&&i.push(e)}),{nodes:o,inputs:a,outputs:i,weights:n,placeholders:r}},t.prototype.mapNode=function(t){var e=Mf(t.op)||this.opMappers[t.op]||{};null==t.attr&&(t.attr={});var r={name:t.name,op:t.op,category:e.category,inputNames:(t.input||[]).map(function(t){return t.startsWith("^")?t.substr(1):t}),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:t.attr};return null!=e.inputs&&(r.inputParams=e.inputs.reduce(function(t,e){return t[e.name]={type:e.type,inputIndexStart:e.start,inputIndexEnd:e.end},t},{})),null!=e.attrs&&(r.attrParams=e.attrs.reduce(function(e,r){var n=r.type,o=void 0;switch(r.type){case"string":void 0===(o=um(t.attr,r.tfName,r.defaultValue))&&r.tfDeprecatedName&&(o=um(t.attr,r.tfDeprecatedName,r.defaultValue));break;case"string[]":void 0===(o=vm(t.attr,r.tfName,r.defaultValue))&&r.tfDeprecatedName&&(o=vm(t.attr,r.tfDeprecatedName,r.defaultValue));break;case"number":void 0===(o=cm(t.attr,r.tfName,r.defaultValue||0))&&r.tfDeprecatedName&&(o=cm(t.attr,r.tfDeprecatedName,r.defaultValue));break;case"number[]":void 0===(o=gm(t.attr,r.tfName,r.defaultValue))&&r.tfDeprecatedName&&(o=gm(t.attr,r.tfDeprecatedName,r.defaultValue));break;case"bool":void 0===(o=lm(t.attr,r.tfName,r.defaultValue))&&r.tfDeprecatedName&&(o=lm(t.attr,r.tfDeprecatedName,r.defaultValue));break;case"bool[]":void 0===(o=ym(t.attr,r.tfName,r.defaultValue))&&r.tfDeprecatedName&&(o=ym(t.attr,r.tfDeprecatedName,r.defaultValue));break;case"shape":void 0===(o=mm(t.attr,r.tfName,r.defaultValue))&&r.tfDeprecatedName&&(o=mm(t.attr,r.tfDeprecatedName,r.defaultValue));break;case"shape[]":void 0===(o=bm(t.attr,r.tfName,r.defaultValue))&&r.tfDeprecatedName&&(o=bm(t.attr,r.tfDeprecatedName,r.defaultValue));break;case"dtype":void 0===(o=dm(t.attr,r.tfName,r.defaultValue))&&r.tfDeprecatedName&&(o=dm(t.attr,r.tfDeprecatedName,r.defaultValue));break;case"dtype[]":void 0===(o=hm(t.attr,r.tfName,r.defaultValue))&&r.tfDeprecatedName&&(o=hm(t.attr,r.tfDeprecatedName,r.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: "+r.type+" for op: "+t.op)}return e[r.name]={value:o,type:n},e},{})),r},t}();function im(t){var e=ge().global;if(void 0!==e.atob)return e.atob(t);if("undefined"!=typeof Buffer)return new Buffer(t,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}function sm(t,e){var r=Array.isArray(t)?String.fromCharCode.apply(null,t):im(t);return e?r:r.toLowerCase()}function um(t,e,r,n){void 0===n&&(n=!1);var o=t[e];return null!=o?sm(o.s,n):r}function lm(t,e,r){var n=t[e];return n?n.b:r}function cm(t,e,r){var n=t[e]||{},o=null!=n.i?n.i:null!=n.f?n.f:r;return"number"==typeof o?o:parseInt(o,10)}function pm(t){switch("string"==typeof t&&(t=Nf[t]),t){case Nf.DT_FLOAT:return"float32";case Nf.DT_INT32:case Nf.DT_INT64:return"int32";case Nf.DT_BOOL:return"bool";case Nf.DT_DOUBLE:return"float32";case Nf.DT_STRING:return"string";default:return null}}function dm(t,e,r){var n=t[e];return n&&n.type?pm(n.type):r}function hm(t,e,r){var n=t[e];return n&&n.list&&n.list.type?n.list.type.map(function(t){return pm(t)}):r}function fm(t){if(!t.unknownRank)return null!=t.dim?t.dim.map(function(t){return"number"==typeof t.size?t.size:parseInt(t.size,10)}):[]}function mm(t,e,r){var n=t[e];return n&&n.shape?fm(n.shape):r}function gm(t,e,r){var n=t[e];return n?((n.list.f&&n.list.f.length?n.list.f:n.list.i)||[]).map(function(t){return"number"==typeof t?t:parseInt(t,10)}):r}function vm(t,e,r,n){void 0===n&&(n=!1);var o=t[e];return o&&o.list&&o.list.s?o.list.s.map(function(t){return sm(t,n)}):r}function bm(t,e,r){var n=t[e];return n&&n.list&&n.list.shape?n.list.shape.map(function(t){return fm(t)}):r}function ym(t,e,r){var n=t[e];return n&&n.list&&n.list.b?n.list.b:r}var xm=function(){function t(t,e,r){var n=this;this.node=t,this.tensorMap=e,this.context=r,this.inputs=[],this.attrs={},this.inputs=t.inputNames.map(function(t){return n.getInput(t)}),null!=t.rawAttrs&&(this.attrs=Object.keys(t.rawAttrs).reduce(function(t,e){return t[e]=n.getAttr(e),t},{}))}return t.prototype.getInput=function(t){return Pf(t,this.tensorMap,this.context)},t.prototype.getAttr=function(t,e){var r=this.node.rawAttrs[t];if(null!=r.tensor)return Pf(t,this.tensorMap,this.context);if(null!=r.i||null!=r.f)return cm(this.node.rawAttrs,t,e);if(null!=r.s)return um(this.node.rawAttrs,t,e);if(null!=r.b)return lm(this.node.rawAttrs,t,e);if(null!=r.shape)return mm(this.node.rawAttrs,t,e);if(null!=r.type)return dm(this.node.rawAttrs,t,e);if(null!=r.list){if(null!=r.list.i||null!=r.list.f)return gm(this.node.rawAttrs,t,e);if(null!=r.list.s)return vm(this.node.rawAttrs,t,e);if(null!=r.list.shape)return bm(this.node.rawAttrs,t,e);if(null!=r.list.b)return ym(this.node.rawAttrs,t,e);if(null!=r.list.type)return hm(this.node.rawAttrs,t,e)}return e},t}(),wm=function(t,e,r){switch(t.op){case"BiasAdd":case"AddV2":case"Add":return[gc(Lf("a",t,e,r),Lf("b",t,e,r))];case"AddN":return[vc(Lf("tensors",t,e,r))];case"FloorMod":case"Mod":return[Ac(Lf("a",t,e,r),Lf("b",t,e,r))];case"Mul":return[Rc(Lf("a",t,e,r),Lf("b",t,e,r))];case"RealDiv":case"Div":return[xc(Lf("a",t,e,r),Lf("b",t,e,r))];case"DivNoNan":return[wc(Lf("a",t,e,r),Lf("b",t,e,r))];case"FloorDiv":return[Cc(Lf("a",t,e,r),Lf("b",t,e,r))];case"Sub":return[Mc(Lf("a",t,e,r),Lf("b",t,e,r))];case"Minimum":return[zc(Lf("a",t,e,r),Lf("b",t,e,r))];case"Maximum":return[Sc(Lf("a",t,e,r),Lf("b",t,e,r))];case"Pow":return[Dc(Lf("a",t,e,r),Lf("b",t,e,r))];case"SquaredDifference":return[Oc(Lf("a",t,e,r),Lf("b",t,e,r))];default:throw TypeError("Node type "+t.op+" is not implemented")}},km=function(t,e,r){switch(t.op){case"Abs":case"ComplexAbs":return[gl(Lf("x",t,e,r))];case"Acos":return[vl(Lf("x",t,e,r))];case"Acosh":return[bl(Lf("x",t,e,r))];case"Asin":return[yl(Lf("x",t,e,r))];case"Asinh":return[xl(Lf("x",t,e,r))];case"Atan":return[wl(Lf("x",t,e,r))];case"Atan2":return[yc(Lf("x",t,e,r),Lf("y",t,e,r))];case"Atanh":return[kl(Lf("x",t,e,r))];case"Ceil":return[Cl(Lf("x",t,e,r))];case"Complex":return[yo(Lf("real",t,e,r),Lf("imag",t,e,r))];case"Cos":return[El(Lf("x",t,e,r))];case"Cosh":return[zl(Lf("x",t,e,r))];case"Elu":return[$p(Lf("x",t,e,r))];case"Erf":return[Il(Lf("x",t,e,r))];case"Exp":return[Al(Lf("x",t,e,r))];case"Expm1":return[Nl(Lf("x",t,e,r))];case"Floor":return[Rl(Lf("x",t,e,r))];case"Log":return[Tl(Lf("x",t,e,r))];case"Log1p":return[Dl(Lf("x",t,e,r))];case"Imag":return[wo(Lf("x",t,e,r))];case"Neg":return[Ol(Lf("x",t,e,r))];case"Reciprocal":return[Fl(Lf("x",t,e,r))];case"Real":return[xo(Lf("x",t,e,r))];case"Relu":return[Yp(Lf("x",t,e,r))];case"Round":return[Ml(Lf("x",t,e,r))];case"Selu":return[Zp(Lf("x",t,e,r))];case"Sigmoid":return[Pl(Lf("x",t,e,r))];case"Sin":return[Ul(Lf("x",t,e,r))];case"Sign":return[Bl(Lf("x",t,e,r))];case"Sinh":return[jl(Lf("x",t,e,r))];case"Softplus":return[Hl(Lf("x",t,e,r))];case"Sqrt":return[Gl(Lf("x",t,e,r))];case"Square":return[ml(Lf("x",t,e,r))];case"Tanh":return[Xl(Lf("x",t,e,r))];case"Tan":return[Kl(Lf("x",t,e,r))];case"Relu6":case"ClipByValue":return[Sl(Lf("x",t,e,r),Lf("clipValueMin",t,e,r),Lf("clipValueMax",t,e,r))];case"Rsqrt":return[Ll(Pf(t.inputNames[0],e,r))];case"Prod":return[Gp(Lf("x",t,e,r),Lf("axes",t,e,r))];case"LeakyRelu":return[Kp(Lf("x",t,e,r),Lf("alpha",t,e,r))];case"Prelu":return[Xp(Lf("x",t,e,r),Lf("alpha",t,e,r))];default:throw TypeError("Node type "+t.op+" is not implemented")}},Cm=function(){function t(e,r,n,o,a,i,s){this.name=e,this.dtype=r,this.maxSize=n,this.elementShape=o,this.identicalElementShapes=a,this.dynamicSize=i,this.clearAfterRead=s,this.tensors=[],this.closed_=!1,this.id=t.nextId++}return Object.defineProperty(t.prototype,"closed",{get:function(){return this.closed_},enumerable:!0,configurable:!0}),t.prototype.clearAndClose=function(){this.tensors.forEach(function(t){return t.tensor.dispose()}),this.tensors=[],this.closed_=!0},t.prototype.size=function(){return this.tensors.length},t.prototype.read=function(t){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(t<0||t>=this.tensors.length)throw new Error("Tried to read from index "+t+", but array size is: "+this.tensors.length);var e=this.tensors[t];if(e.cleared)throw new Error("TensorArray "+this.name+": Could not read index "+t+" twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).");return this.clearAfterRead&&(e.cleared=!0),e.read=!0,e.tensor},t.prototype.readMany=function(t){var e=this;return t.map(function(t){return e.read(t)})},t.prototype.write=function(t,e){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(t<0||!this.dynamicSize&&t>=this.maxSize)throw new Error("Tried to write to index "+t+", but array is not resizeable and size is: "+this.maxSize);var r=this.tensors[t]||{};if(e.dtype!==this.dtype)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+t+",\n          because the value dtype is "+e.dtype+", but TensorArray dtype is "+this.dtype+".");if(0!==this.size()||null!=this.elementShape&&0!==this.elementShape.length||(this.elementShape=e.shape),this.assertShapesMatchAllowUndefinedSize(this.elementShape,e.shape,"TensorArray "+this.name+": Could not write to TensorArray index "+t+"."),r&&r.read)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+t+", because it has already been read.");if(r&&r.written)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+t+", because it has already been written.");r.tensor=e,r.written=!0,this.tensors[t]=r},t.prototype.writeMany=function(t,e){var r=this;if(t.length!==e.length)throw new Error("TensorArray "+this.name+": could not write multiple tensors,because the index size: "+t.length+" is not the same as tensors size: "+e.length+".");t.forEach(function(t,n){return r.write(t,e[n])})},t.prototype.gather=function(t,e){if(e&&e!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but gather requested dtype "+e);if(!t){t=[];for(var r=0;r<this.size();r++)t.push(r)}if(0===t.length)return ko([],[0].concat(this.elementShape));var n=this.readMany(t);return this.assertShapesMatchAllowUndefinedSize(this.elementShape,n[0].shape,"TensorArray shape mismatch: "),za(n,0)},t.prototype.concat=function(t){if(t&&t!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but concat requested dtype "+t);if(0===this.size())return ko([],[0].concat(this.elementShape));for(var e=[],r=0;r<this.size();r++)e.push(r);var n=this.readMany(e);return this.assertShapesMatchAllowUndefinedSize(this.elementShape,n[0].shape,"TensorArray shape mismatch: tensor array shape ("+this.elementShape+") vs first tensor shape ("+n[0].shape+")"),Bo(n,0)},t.prototype.scatter=function(t,e){if(e.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+e.dtype);if(t.length!==e.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: "+t.length+" vs. "+e.shape[0]);var r=Math.max.apply(Math,t);if(!this.dynamicSize&&r>=this.maxSize)throw new Error("Max index must be < array size ("+r+"  vs. "+this.maxSize+")");this.writeMany(t,Na(e,0))},t.prototype.split=function(t,e){var r=this;if(e.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+e.dtype);var n=0,o=t.map(function(t){return n+=t});if(n!==e.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        "+n+", and tensor's shape is: "+e.shape);if(!this.dynamicSize&&t.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths ("+this.maxSize+" vs. "+t.length+"), and the TensorArray is not marked as dynamically resizeable");var a=0===n?0:e.size/n,i=[];Zn(function(){e=e.reshape([1,n,a]);for(var s=0;s<t.length;++s){var u=[0,0===s?0:o[s-1],0],l=[1,t[s],a];i[s]=Rp(e,u,l).reshape(r.elementShape)}return i});for(var s=[],u=0;u<t.length;u++)s[u]=u;this.writeMany(s,i)},t.prototype.assertShapesMatchAllowUndefinedSize=function(t,e,r){void 0===r&&(r=""),cr.assert(this.shapesEqualAllowUndefinedSize(t,e),function(){return r+" Shapes "+t+" and "+e+" must match"})},t.prototype.shapesEqualAllowUndefinedSize=function(t,e){if(t.length!==e.length)return!1;for(var r=0;r<t.length;r++)if(-1!==t[r]&&-1!==e[r]&&t[r]!==e[r])return!1;return!0},t.nextId=0,t}();var Sm=function(t,e,r){var n,o;switch(t.op){case"Conv1D":var a=Lf("stride",t,e,r),i=Lf("pad",t,e,r),s=Lf("dataFormat",t,e,r).toUpperCase(),u=Lf("dilation",t,e,r);return[op(Lf("x",t,e,r),Lf("filter",t,e,r),a,i,s,u)];case"Conv2D":a=Lf("strides",t,e,r),i=Lf("pad",t,e,r),s=Lf("dataFormat",t,e,r).toUpperCase();var l=Lf("dilations",t,e,r);return[ap(Lf("x",t,e,r),Lf("filter",t,e,r),[a[1],a[2]],i,s,[l[1],l[2]])];case"_FusedConv2D":var c=(n=Lf("fusedOps",t,e,r))[0],p=n[1],d="biasadd"===c,h="prelu"===p,f="fusedbatchnorm"===c,m=Lf("numArgs",t,e,r);if(d){if(h&&2!==m)throw new Error("Fused Conv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!h&&1!==m)throw new Error("Fused Conv2d with BiasAdd must have one extra argument: bias.")}if(f)throw new Error("Fused Conv2d with FusedBatchNorm is not supported.");a=Lf("strides",t,e,r),i=Lf("pad",t,e,r),s=Lf("dataFormat",t,e,r).toUpperCase(),l=Lf("dilations",t,e,r);var g=(o=Lf("args",t,e,r))[0],v=o[1];return[Zd.conv2d({x:Lf("x",t,e,r),filter:Lf("filter",t,e,r),strides:[a[1],a[2]],pad:i,dataFormat:s,dilations:[l[1],l[2]],bias:g,activation:p,preluActivationWeights:v})];case"Conv2DBackpropInput":case"Conv2dTranspose":var b=Lf("outputShape",t,e,r);return a=Lf("strides",t,e,r),i=Lf("pad",t,e,r),[hp(Lf("x",t,e,r),Lf("filter",t,e,r),b,[a[1],a[2]],i)];case"DepthwiseConv2dNative":case"DepthwiseConv2d":return a=Lf("strides",t,e,r),i=Lf("pad",t,e,r),l=Lf("dilations",t,e,r),s=Lf("dataFormat",t,e,r).toUpperCase(),[lp(Lf("input",t,e,r),Lf("filter",t,e,r),[a[1],a[2]],i,s,[l[1],l[2]])];case"Conv3D":return a=Lf("strides",t,e,r),i=Lf("pad",t,e,r),s=Lf("dataFormat",t,e,r).toUpperCase(),l=Lf("dilations",t,e,r),[ip(Lf("x",t,e,r),Lf("filter",t,e,r),[a[1],a[2],a[3]],i,s,[l[1],l[2],l[3]])];case"AvgPool":a=Lf("strides",t,e,r),i=Lf("pad",t,e,r);var y=Lf("kernelSize",t,e,r);return[zp(Lf("x",t,e,r),[y[1],y[2]],[a[1],a[2]],i)];case"MaxPool":return a=Lf("strides",t,e,r),i=Lf("pad",t,e,r),y=Lf("kernelSize",t,e,r),[Ep(Lf("x",t,e,r),[y[1],y[2]],[a[1],a[2]],i)];case"AvgPool3D":return a=Lf("strides",t,e,r),i=Lf("pad",t,e,r),y=Lf("kernelSize",t,e,r),[Np(Lf("x",t,e,r),[y[1],y[2],y[3]],[a[1],a[2],a[3]],i)];case"MaxPool3D":return a=Lf("strides",t,e,r),i=Lf("pad",t,e,r),y=Lf("kernelSize",t,e,r),[Ap(Lf("x",t,e,r),[y[1],y[2],y[3]],[a[1],a[2],a[3]],i)];default:throw TypeError("Node type "+t.op+" is not implemented")}},Em=function(t,e,r){switch(t.op){case"Fill":var n=Lf("shape",t,e,r),o=Lf("dtype",t,e,r);return[Oo(n,Lf("value",t,e,r),o)];case"LinSpace":var a=Lf("start",t,e,r);return[Fo(a,Lf("stop",t,e,r),Lf("num",t,e,r))];case"Multinomial":var i=Lf("logits",t,e,r),s=Lf("numSamples",t,e,r),u=Lf("seed",t,e,r);return[da(i,s,u)];case"OneHot":var l=Lf("indices",t,e,r),c=Lf("depth",t,e,r),p=Lf("onValue",t,e,r),d=Lf("offValue",t,e,r);return[ha(l,c,p,d)];case"Ones":return[Do(Lf("shape",t,e,r),Lf("dtype",t,e,r))];case"OnesLike":return[Lo(Lf("x",t,e,r))];case"RandomUniform":return[ka(Lf("shape",t,e,r),Lf("minval",t,e,r),Lf("maxval",t,e,r),Lf("dtype",t,e,r))];case"Range":return[Mo(a=Lf("start",t,e,r),Lf("stop",t,e,r),Lf("step",t,e,r),Lf("dtype",t,e,r))];case"TruncatedNormal":n=Lf("shape",t,e,r);var h=Lf("mean",t,e,r),f=Lf("stdDev",t,e,r);return u=Lf("seed",t,e,r),[Aa(n,h,f,Lf("dtype",t,e,r),u)];case"Zeros":return[_o(Lf("shape",t,e,r),Lf("dtype",t,e,r))];case"ZerosLike":return[Po(Lf("x",t,e,r))];default:throw TypeError("Node type "+t.op+" is not implemented")}};var zm=function(t,e,r){switch(t.op){case"TopKV2":var n=Lf("x",t,e,r),o=Lf("k",t,e,r),a=Lf("sorted",t,e,r),i=id(n,o,a);return[i.values,i.indices];default:throw TypeError("Node type "+t.op+" is not implemented")}},Im=function(t,e,r){switch(t.op){case"Const":return e[t.name];case"PlaceholderWithDefault":var n=Lf("default",t,e,r);return[Pf(t.name,e,r)||n];case"Placeholder":return[Pf(t.name,e,r)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":return[Lf("x",t,e,r).clone()];case"IdentityN":return Lf("x",t,e,r).map(function(t){return t.clone()});case"Snapshot":return[Lf("x",t,e,r).clone()];case"Shape":return[Eo(Lf("x",t,e,r).shape,"int32")];case"ShapeN":return Lf("x",t,e,r).map(function(t){return Eo(t.shape)});case"Size":return[So(Lf("x",t,e,r).size,"int32")];case"Rank":return[So(Lf("x",t,e,r).rank,"int32")];case"NoOp":return[So(1)];case"Print":var o=Lf("x",t,e,r),a=Lf("data",t,e,r),i=Lf("message",t,e,r),s=Lf("summarize",t,e,r);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(i);for(var u=0;u<a.length;u++)console.log(Array.prototype.slice.call(a[u].dataSync()).slice(0,s));return[o];default:throw TypeError("Node type "+t.op+" is not implemented")}},Am=function(t,e,r){switch(t.op){case"ResizeBilinear":var n=Lf("images",t,e,r),o=Lf("size",t,e,r),a=Lf("alignCorners",t,e,r);return[jd.resizeBilinear(n,[o[0],o[1]],a)];case"ResizeNearestNeighbor":return n=Lf("images",t,e,r),o=Lf("size",t,e,r),a=Lf("alignCorners",t,e,r),[jd.resizeNearestNeighbor(n,[o[0],o[1]],a)];case"CropAndResize":var i=Lf("image",t,e,r),s=Lf("boxes",t,e,r),u=Lf("boxInd",t,e,r),l=Lf("cropSize",t,e,r),c=Lf("method",t,e,r),p=Lf("extrapolationValue",t,e,r);return[jd.cropAndResize(i,s,u,l,c,p)];default:throw TypeError("Node type "+t.op+" is not implemented")}},Nm=function(t,e,r){switch(t.op){case"Equal":return[Pc(Lf("a",t,e,r),Lf("b",t,e,r))];case"NotEqual":return[Kc(Lf("a",t,e,r),Lf("b",t,e,r))];case"Greater":return[qc(Lf("a",t,e,r),Lf("b",t,e,r))];case"GreaterEqual":return[Vc(Lf("a",t,e,r),Lf("b",t,e,r))];case"Less":return[jc(Lf("a",t,e,r),Lf("b",t,e,r))];case"LessEqual":return[Hc(Lf("a",t,e,r),Lf("b",t,e,r))];case"LogicalAnd":return[cc(Lf("a",t,e,r),Lf("b",t,e,r))];case"LogicalNot":return[pc(Lf("a",t,e,r))];case"LogicalOr":return[dc(Lf("a",t,e,r),Lf("b",t,e,r))];case"Select":return[fc(Lf("condition",t,e,r),Lf("a",t,e,r),Lf("b",t,e,r))];default:throw TypeError("Node type "+t.op+" is not implemented")}},Rm=function(t,e,r){switch(t.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[mp(Lf("a",t,e,r),Lf("b",t,e,r),Lf("transposeA",t,e,r),Lf("transposeB",t,e,r))];case"Transpose":return[Qp(Lf("x",t,e,r),Lf("perm",t,e,r))];default:throw TypeError("Node type "+t.op+" is not implemented")}},Tm=function(t,e,r){switch(t.op){case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[ic(Lf("x",t,e,r),Lf("mean",t,e,r),Lf("variance",t,e,r),Lf("offset",t,e,r),Lf("scale",t,e,r),Lf("epsilon",t,e,r))];case"LRN":return[td(Lf("x",t,e,r),Lf("radius",t,e,r),Lf("bias",t,e,r),Lf("alpha",t,e,r),Lf("beta",t,e,r))];case"Softmax":return[Ja(Lf("x",t,e,r))];case"LogSoftmax":return[Za(Lf("x",t,e,r))];case"SparseToDense":return[hd(Lf("sparseIndices",t,e,r),Lf("outputShape",t,e,r),Lf("sparseValues",t,e,r),Lf("defaultValue",t,e,r))];default:throw TypeError("Node type "+t.op+" is not implemented")}},Dm=function(t,e,r){switch(t.op){case"Max":var n=Lf("axis",t,e,r),o=Lf("keepDims",t,e,r);return[Vp(Lf("x",t,e,r),n,o)];case"Mean":return n=Lf("axis",t,e,r),o=Lf("keepDims",t,e,r),[Wp(Lf("x",t,e,r),n,o)];case"Min":return n=Lf("axis",t,e,r),o=Lf("keepDims",t,e,r),[Up(Lf("x",t,e,r),n,o)];case"Sum":return n=Lf("axis",t,e,r),o=Lf("keepDims",t,e,r),[Hp(Lf("x",t,e,r),n,o)];case"All":return n=Lf("axis",t,e,r),o=Lf("keepDims",t,e,r),[Mp(Lf("x",t,e,r),n,o)];case"Any":return n=Lf("axis",t,e,r),o=Lf("keepDims",t,e,r),[Lp(Lf("x",t,e,r),n,o)];case"ArgMax":return n=Lf("axis",t,e,r),[Pp(Lf("x",t,e,r),n)];case"ArgMin":return n=Lf("axis",t,e,r),[Bp(Lf("x",t,e,r),n)];case"Prod":return n=Lf("axis",t,e,r),o=Lf("keepDims",t,e,r),[Gp(Lf("x",t,e,r),n,o)];default:throw TypeError("Node type "+t.op+" is not implemented")}},_m=function(t,e,r){switch(t.op){case"ConcatV2":case"Concat":var n=Lf("n",t,e,r),o=Lf("axis",t,e,r),a=Lf("tensors",t,e,r);return a=a.slice(0,n),[Bo(a,o)];case"GatherV2":case"Gather":o=Lf("axis",t,e,r);var i=Lf("x",t,e,r),s=Lf("indices",t,e,r);return[Zc(i,s.asType("int32"),o)];case"ReverseV2":case"Reverse":return o=Lf("axis",t,e,r),i=Lf("x",t,e,r),[bp(i,o)];case"Slice":var u=Lf("begin",t,e,r),l=Lf("size",t,e,r);return[Rp(Lf("x",t,e,r),u,l)];case"StridedSlice":u=Lf("begin",t,e,r);var c=Lf("end",t,e,r),p=Lf("strides",t,e,r),d=Lf("beginMask",t,e,r),h=Lf("endMask",t,e,r),f=Lf("ellipsisMask",t,e,r),m=Lf("newAxisMask",t,e,r),g=Lf("shrinkAxisMask",t,e,r),v=Lf("x",t,e,r);if(1===u.length&&v.shape.length>1)for(var b=1;b<v.shape.length;b++)u.push(0),c.push(v.shape[b]),p.push(p[0]);return[ad(v,u,c,p,d,h,f,m,g)];case"Pack":return Zn(function(){var n=Lf("axis",t,e,r),o=Lf("tensors",t,e,r),a=o[0].shape,i=o[0].squeeze().shape,s=o.map(function(t){var e=cr.arraysEqual(t.shape,a);if(!e&&!cr.arraysEqual(t.squeeze().shape,i))throw new Error("the input tensors shape does not match");return e?t:t.reshape(a)});return[za(s,n)]});case"Unpack":return Zn(function(){var n=Lf("axis",t,e,r),o=Lf("tensor",t,e,r);return Na(o,n)});case"Tile":var y=Lf("reps",t,e,r);return[Ia(Lf("x",t,e,r),y)];case"Split":case"SplitV":o=Lf("axis",t,e,r);var x=Lf("numOrSizeSplits",t,e,r);return jo(Lf("x",t,e,r),x,o);case"ScatterNd":s=Lf("indices",t,e,r);var w=Lf("values",t,e,r),k=Lf("shape",t,e,r);return[sd(s,w,k)];case"GatherNd":var C=Lf("x",t,e,r);return s=Lf("indices",t,e,r),[fd(C,s)];case"SparseToDense":s=Lf("sparseIndices",t,e,r),k=Lf("outputShape",t,e,r);var S=Lf("sparseValues",t,e,r),E=Lf("defaultValue",t,e,r);return[hd(s,S,k,S.dtype===E.dtype?E:E.asType(S.dtype))];default:throw TypeError("Node type "+t.op+" is not implemented")}},Om=function(t,e,r){switch(t.op){case"FFT":return[ud(Lf("x",t,e,r))];case"IFFT":return[ld(Lf("x",t,e,r))];case"RFFT":return[cd(Lf("x",t,e,r))];case"IRFFT":return[pd(Lf("x",t,e,r))];default:throw TypeError("Node type "+t.op+" is not implemented")}},Fm=function(t,e,r){switch(t.op){case"Cast":return[ia(Lf("x",t,e,r),Lf("dtype",t,e,r))];case"ExpandDims":var n=Lf("axis",t,e,r);return[ca(Lf("x",t,e,r),n)];case"Squeeze":return n=Lf("axis",t,e,r),[Ea(Lf("x",t,e,r),n)];case"Reshape":return[Ca(Lf("x",t,e,r),Lf("shape",t,e,r))];case"PadV2":case"Pad":return[fa(Lf("x",t,e,r),Wf(Lf("padding",t,e,r),2),Lf("constantValue",t,e,r))];case"SpaceToBatchND":var o=Lf("blockShape",t,e,r),a=Wf(Lf("paddings",t,e,r),2);return[Sa(Lf("x",t,e,r),o,a)];case"BatchToSpaceND":o=Lf("blockShape",t,e,r);var i=Wf(Lf("crops",t,e,r),2);return[aa(Lf("x",t,e,r),o,i)];case"DepthToSpace":var s=Lf("blockSize",t,e,r),u=Lf("dataFormat",t,e,r).toUpperCase();return[la(Lf("x",t,e,r),s,u)];default:throw TypeError("Node type "+t.op+" is not implemented")}};function Mm(t,e,r){var n=function(t,e,r){switch(t.category){case"arithmetic":return wm(t,e,r);case"basic_math":return km(t,e,r);case"control":return function(t,e,r){return _f(this,void 0,void 0,function(){var n,o,a,i,s,u,l,c,p,d,h,f,m,g,v,b,y,x,w,k,C,S,E,z,I,A,N,R,T,D,_,O,F,M;return Of(this,function(L){switch(L.label){case 0:switch(t.op){case"LoopCond":return[3,1];case"Switch":return[3,2];case"Merge":return[3,4];case"Enter":return[3,5];case"Exit":return[3,6];case"NextIteration":return[3,7];case"TensorArrayV3":return[3,8];case"TensorArrayWriteV3":return[3,9];case"TensorArrayReadV3":return[3,10];case"TensorArrayGatherV3":return[3,11];case"TensorArrayScatterV3":return[3,12];case"TensorArrayConcatV3":return[3,13];case"TensorArraySplitV3":return[3,14];case"TensorArraySizeV3":return[3,15];case"TensorArrayCloseV3":return[3,16]}return[3,17];case 1:return[2,[Lf("pred",t,e,r).clone()]];case 2:return n=Lf("pred",t,e,r),o=Lf("data",t,e,r),[4,n.data()];case 3:return[2,L.sent()[0]?[void 0,o.clone()]:[o.clone(),void 0]];case 4:return[2,(a=t.inputNames.find(function(t){return void 0!==Pf(t,e,r)}))?[Pf(a,e,r).clone()]:void 0];case 5:return i=Lf("frameName",t,e,r),s=Lf("tensor",t,e,r),r.enterFrame(i),[2,[s.clone()]];case 6:return u=Lf("tensor",t,e,r),r.exitFrame(),[2,[u.clone()]];case 7:return l=Lf("tensor",t,e,r),r.nextIteration(),[2,[l.clone()]];case 8:return c=Lf("size",t,e,r),p=Lf("dtype",t,e,r),d=Lf("elementShape",t,e,r),h=Lf("dynamicSize",t,e,r),f=Lf("clearAfterRead",t,e,r),m=Lf("identicalElementShapes",t,e,r),g=Lf("name",t,e,r),v=new Cm(g,p,c,d,m,h,f),r.addTensorArray(v),[2,[So(v.id),So(1)]];case 9:return b=Lf("tensorArrayId",t,e,r),y=Lf("index",t,e,r),x=Lf("tensor",t,e,r),r.getTensorArray(b).write(y,x),[2,[So(1)]];case 10:return w=Lf("tensorArrayId",t,e,r),k=Lf("index",t,e,r),[2,[r.getTensorArray(w).read(k)]];case 11:return C=Lf("tensorArrayId",t,e,r),S=Lf("indices",t,e,r),E=Lf("dtype",t,e,r),[2,[r.getTensorArray(C).gather(S,E)]];case 12:return z=Lf("tensorArrayId",t,e,r),I=Lf("indices",t,e,r),A=Lf("tensor",t,e,r),r.getTensorArray(z).scatter(I,A),[2,[So(1)]];case 13:return N=Lf("tensorArrayId",t,e,r),R=r.getTensorArray(N),T=Lf("dtype",t,e,r),[2,[R.concat(T)]];case 14:return D=Lf("tensorArrayId",t,e,r),_=Lf("tensor",t,e,r),O=Lf("lengths",t,e,r),r.getTensorArray(D).split(O,_),[2,[So(1)]];case 15:return F=Lf("tensorArrayId",t,e,r),[2,[So(r.getTensorArray(F).size(),"int32")]];case 16:return M=Lf("tensorArrayId",t,e,r),r.getTensorArray(M).clearAndClose(),[2,[So(0)]];case 17:throw TypeError("Node type "+t.op+" is not implemented")}})})}(t,e,r);case"convolution":return Sm(t,e,r);case"creation":return Em(t,e,r);case"dynamic":return function(t,e,r){return _f(this,void 0,void 0,function(){var n,o,a,i,s;return Of(this,function(u){switch(u.label){case 0:switch(t.op){case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":return[3,1];case"Where":return[3,3];case"ListDiff":return[3,5]}return[3,6];case 1:return n=Lf("boxes",t,e,r),o=Lf("scores",t,e,r),a=Lf("maxOutputSize",t,e,r),i=Lf("iouThreshold",t,e,r),s=Lf("scoreThreshold",t,e,r),[4,jd.nonMaxSuppressionAsync(n,o,a,i,s)];case 2:return[2,[u.sent()]];case 3:return[4,mc(Lf("condition",t,e,r).asType("bool"))];case 4:return[2,[u.sent()]];case 5:return[2,Ra(Lf("x",t,e,r),Lf("y",t,e,r))];case 6:throw TypeError("Node type "+t.op+" is not implemented")}})})}(t,e,r);case"evaluation":return zm(t,e,r);case"image":return Am(t,e,r);case"graph":return Im(t,e,r);case"logical":return Nm(t,e,r);case"matrices":return Rm(t,e,r);case"normalization":return Tm(t,e,r);case"reduction":return Dm(t,e,r);case"slice_join":return _m(t,e,r);case"spectral":return Om(t,e,r);case"transformation":return Fm(t,e,r);case"custom":var n=Mf(t.op);if(n&&n.customExecutor)return n.customExecutor(new xm(t,e,r));throw TypeError("Custom op "+t.op+" is not registered.");default:throw TypeError("Unknown op '"+t.op+"'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()")}}(t,e,r);return n instanceof Promise?n.then(function(t){return[].concat(t)}):[].concat(n)}var Lm=function(){function t(t,e){this.weightMap=t,this.tensorArrayMap=e,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}return t.prototype.newFrame=function(t,e){return{id:t,frameName:e,iterationId:0}},Object.defineProperty(t.prototype,"currentContext",{get:function(){return this.contexts},set:function(t){this.contexts!==t&&(this.contexts=t,this.generateCurrentContextIds())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentContextId",{get:function(){return this._currentContextIds[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentContextIds",{get:function(){return this._currentContextIds},enumerable:!0,configurable:!0}),t.prototype.generateCurrentContextIds=function(){for(var t=[],e=0;e<this.contexts.length-1;e++){var r=this.contexts.slice(0,this.contexts.length-e);t.push(this.contextIdforContexts(r))}t.push(""),this._currentContextIds=t},t.prototype.contextIdforContexts=function(t){return t?t.map(function(t){return 0===t.id&&0===t.iterationId?"":t.frameName+"-"+t.iterationId}).join("/"):""},t.prototype.enterFrame=function(t){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,t)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))},t.prototype.exitFrame=function(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()},t.prototype.nextIteration=function(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");this.contexts=this.contexts.slice(),this.lastId++;var t=Object.assign({},this.contexts[this.contexts.length-1]);t.iterationId+=1,t.id=this.lastId,this.contexts.splice(-1,1,t),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))},t.prototype.getWeight=function(t){return this.weightMap[t]},t.prototype.addTensorArray=function(t){this.tensorArrayMap[t.id]=t},t.prototype.getTensorArray=function(t){return this.tensorArrayMap[t]},t}();function Pm(t,e,r){for(var n=new Set,o=[],a=null,i=null,s=new Set,u=e.slice();u.length>0;){var l=u.pop();(Vm(l)||Wm(l))&&null==a&&(i=(a=l).children.map(function(t){return t.name}).filter(function(t){return n.has(t)})),n.add(l.name),null==r[l.name]&&null==t[l.name]&&(0!==l.inputs.length?l.inputs.forEach(function(t){s.has(t.name)||(s.add(t.name),u.push(t))}):o.push(l.name))}return{inputs:t,outputs:e,usedNodes:n,missingInputs:o,dynamicNode:a,syncInputs:i}}var Bm=["Switch","Merge","Enter","Exit","NextIteration"],qm=["NonMaxSuppressionV2","NonMaxSuppressionV3","Where"];function Vm(t){return Bm.indexOf(t.op)>=0}function Wm(t){return qm.indexOf(t.op)>=0}var Um=function(){function t(t){this.graph=t,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this.placeholders=t.placeholders,this._outputs=t.outputs}return Object.defineProperty(t.prototype,"weightMap",{get:function(){return this._weightMap},set:function(t){var e=Object.keys(t).map(function(e){return t[e].map(function(t){return t.id})});this.weightIds=[].concat.apply([],e),this._weightMap=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputs",{get:function(){return this.placeholders.map(function(t){return{name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0}})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outputs",{get:function(){return this._outputs.map(function(t){return{name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0}})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputNodes",{get:function(){return this.placeholders.map(function(t){return t.name})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outputNodes",{get:function(){return this.outputs.map(function(t){return t.name})},enumerable:!0,configurable:!0}),t.prototype.getCompilationKey=function(t,e){var r=t.map(function(t){return t.name}).sort(),n=e.map(function(t){return t.name}).sort();return r.join(this.SEPERATOR)+"--"+n.join(this.SEPERATOR)},t.prototype.compile=function(t,e){var r=Pm(t,e,this.weightMap),n=r.missingInputs,o=r.dynamicNode,a=r.syncInputs;if(null!=o)throw new Error("This execution contains the node '"+o.name+"', which has the dynamic op '"+o.op+"'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs ["+a+"]");if(n.length>0){var i=e.map(function(t){return t.name}),s=Object.keys(t);throw new Error("Cannot compute the outputs ["+i+"] from the provided inputs ["+s+"]. Missing the following inputs: ["+n+"]")}return function(t,e,r){var n=r.usedNodes,o=r.inputs,a=[];Object.keys(o).map(function(e){return t.nodes[e]}).forEach(function(t){n.has(t.name)&&a.push(t)}),t.weights.forEach(function(t){n.has(t.name)&&a.push(t)});for(var i=new Set,s=[];a.length>0;){var u=a.pop();i.add(u.name),e[u.name]||s.push(u),u.children.forEach(function(t){!i.has(t.name)&&n.has(t.name)&&t.inputs.every(function(t){return i.has(t.name)})&&a.push(t)})}return s}(this.graph,this.weightMap,r)},t.prototype.execute=function(t,e){var r=this,n=Object.keys(t).sort();this.checkInputs(t),this.checkInputShapeAndType(t),this.checkOutputs(e);var o=n.map(function(t){return r.graph.nodes[t]}),a=e.map(function(t){return r.graph.nodes[Vf(t)[0]]}),i=this.getCompilationKey(o,a),s=this.compiledMap.get(i);null==s&&(s=this.compile(t,a),this.compiledMap.set(i,s));var u={};return Zn(function(){var n=new Lm(r._weightMap,u),o=Df({},r.weightMap);Object.keys(t).forEach(function(e){o[e]=[t[e]]});for(var a=r.getFrozenTensorIds(o),i={},l=0;l<s.length;l++){var c=s[l];if(!o[c.name]){var p=Mm(c,o,n);if(p instanceof Promise)throw new Error("The execution of the op '"+c.op+"' returned a promise. Please use model.executeAsync() instead.");o[c.name]=p,r.checkTensorForDisposal(c.name,c,o,n,a,e,i)}}return e.map(function(t){return Pf(t,o,n)})})},t.prototype.getFrozenTensorIds=function(t){var e=[].concat.apply([],Object.keys(t).map(function(e){return t[e]}).map(function(t){return t.map(function(t){return t.id})}));return new Set(e)},t.prototype.checkTensorForDisposal=function(t,e,r,n,o,a,i){"control"!==e.category&&-1===a.indexOf(t)&&(r[t].forEach(function(t){null!=t&&(i[t.id]=(i[t.id]||0)+e.children.length)}),e.inputs.forEach(function(t){if("control"!==t.category){var e=function(t,e,r){return e[qf(t,r.currentContextId)]}(t.name,r,n);null!=e&&e.forEach(function(t){if(t&&!o.has(t.id)){var e=i[t.id];1===e?(t.dispose(),delete i[t.id]):null!=e&&i[t.id]--}})}}))},t.prototype.executeAsync=function(t,e){return _f(this,void 0,void 0,function(){var r,n,o,a,i,s,u=this;return Of(this,function(l){switch(l.label){case 0:return this.checkInputs(t),this.checkInputShapeAndType(t),this.checkOutputs(e),r={},n=new Lm(this._weightMap,r),[4,this.executeWithControlFlow(t,n,e)];case 1:return o=l.sent(),a=e.map(function(t){return Pf(t,o,n)}),i=new Set(a.map(function(t){return t.id})),s=new Set(Object.keys(t).map(function(e){return t[e].id})),Object.keys(o).forEach(function(t){o[t].forEach(function(t){!t||t.isDisposed||i.has(t.id)||s.has(t.id)||-1!==u.weightIds.indexOf(t.id)||t.dispose()})}),[2,a]}})})},t.prototype.executeWithControlFlow=function(t,e,r){return _f(this,void 0,void 0,function(){var n,o,a,i,s,u,l,c,p,d,h,f,m,g,v,b,y=this;return Of(this,function(x){switch(x.label){case 0:n=Object.keys(t),o=n.map(function(t){return y.graph.nodes[t]}),a=r.map(function(t){return y.graph.nodes[Vf(t)[0]]}),i=Pm(t,a,this.weightMap),s=i.usedNodes,u=i.missingInputs,l=i.dynamicNode,c=i.syncInputs,p=o.concat(this.graph.weights).map(function(t){return{node:t,contexts:e.currentContext}}),d=Df({},this.weightMap),Object.keys(t).forEach(function(e){d[e]=[t[e]]}),h={},f=this.getFrozenTensorIds(d),m={},x.label=1;case 1:return p.length>0?(g=this.processStack(o,p,e,d,m,f,r,h,s),[4,Promise.all(g)]):[3,3];case 2:return x.sent(),[3,1];case 3:if(null==l&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead."),(v=a.filter(function(t){return!Vm(t)&&!Pf(t.name,d,e)}).map(function(t){return t.name})).length>0)throw b="",null!=l&&(b="Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs ["+c+"]"),new Error("Cannot compute the outputs ["+v+"] from the provided inputs ["+n+"]. Consider providing the following inputs: ["+u+"]. "+b);return[2,d]}})})},t.prototype.processStack=function(t,e,r,n,o,a,i,s,u){for(var l=this,c=[],p=function(){var p=e.pop();r.currentContext=p.contexts;var h="";if("Enter"===p.node.op&&Lf("isConstant",p.node,n,r)&&(h=Bf(p.node.name,r)[0]),-1===t.indexOf(p.node)){var f=Mm(p.node,n,r);h||(h=Bf(p.node.name,r)[0]);var m=r.currentContext;f instanceof Promise?c.push(f.then(function(t){return n[h]=t,r.currentContext=m,l.checkTensorForDisposal(h,p.node,n,r,a,i,s),l.processChildNodes(p.node,e,r,n,o,u),t})):(n[h]=f,d.checkTensorForDisposal(h,p.node,n,r,a,i,s),d.processChildNodes(p.node,e,r,n,o,u))}else d.processChildNodes(p.node,e,r,n,o,u)},d=this;e.length>0;)p();return c},t.prototype.processChildNodes=function(t,e,r,n,o,a){t.children.forEach(function(t){var i=Bf(t.name,r)[0];!o[i]&&a.has(t.name)&&("Merge"===t.op?t.inputNames.some(function(t){return!!Pf(t,n,r)})&&(o[i]=!0,e.push({contexts:r.currentContext,node:t})):t.inputNames.every(function(t){return!!Pf(t,n,r)})&&(o[i]=!0,e.push({contexts:r.currentContext,node:t})))})},t.prototype.dispose=function(){var t=this;Object.keys(this.weightMap).forEach(function(e){return t.weightMap[e].forEach(function(t){return t.dispose()})})},t.prototype.checkInputShapeAndType=function(t){var e=this;Object.keys(t).forEach(function(r){var n=t[r],o=e.graph.nodes[r];if(o.attrParams.shape&&o.attrParams.shape.value){var a=o.attrParams.shape.value,i=a.length===n.shape.length&&n.shape.every(function(t,e){return-1===a[e]||a[e]===t});cr.assert(i,function(){return"The shape of dict['"+o.name+"'] provided in model.execute(dict) must be ["+a+"], but was ["+n.shape+"]"})}o.attrParams.dtype&&o.attrParams.dtype.value&&cr.assert(n.dtype===o.attrParams.dtype.value,function(){return"The dtype of dict['"+o.name+"'] provided in model.execute(dict) must be "+o.attrParams.dtype.value+", but was "+n.dtype})})},t.prototype.checkInputs=function(t){var e=this,r=Object.keys(t).filter(function(t){return!e.graph.nodes[t]});if(r.length>0)throw new Error("The dict provided in model.execute(dict) has keys: ["+r+"] that are not part of graph")},t.prototype.checkOutputs=function(t){var e=this;t.forEach(function(t){var r=Vf(t)[0];if(!e.graph.nodes[r])throw new Error("The output '"+t+"' is not found in the graph")})},t}(),jm="?tfjs-format=file",Hm="model.json",Gm=function(){function t(t,e){void 0===e&&(e={}),this.modelUrl=t,this.loadOptions=e,this.version="n/a",null==e&&(this.loadOptions={})}return Object.defineProperty(t.prototype,"modelVersion",{get:function(){return this.version},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputNodes",{get:function(){return this.executor.inputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outputNodes",{get:function(){return this.executor.outputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputs",{get:function(){return this.executor.inputs},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outputs",{get:function(){return this.executor.outputs},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"weights",{get:function(){return this.executor.weightMap},enumerable:!0,configurable:!0}),t.prototype.findIOHandler=function(){var t=this.modelUrl;if(null!=t.load)this.handler=t;else if(null!=this.loadOptions.requestInit)this.handler=tf.browserHTTPRequest(t,this.loadOptions);else{var e=tf.getLoadHandlers(t,this.loadOptions.onProgress);if(0===e.length)e.push(tf.browserHTTPRequest(t,this.loadOptions));else if(e.length>1)throw new Error("Found more than one ("+e.length+") load handlers for URL '"+[t]+"'");this.handler=e[0]}},t.prototype.load=function(){return _f(this,void 0,void 0,function(){var t,e,r;return Of(this,function(n){switch(n.label){case 0:if(this.findIOHandler(),null==this.handler.load)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return[4,this.handler.load()];case 1:return t=n.sent(),e=t.modelTopology,this.version=e.versions.producer+"."+e.versions.minConsumer,r=tf.decodeWeights(t.weightData,t.weightSpecs),this.executor=new Um(am.Instance.transformGraph(e)),this.executor.weightMap=this.convertTensorMapToTensorsMap(r),[2,!0]}})})},t.prototype.predict=function(t,e){return this.execute(t,this.outputNodes)},t.prototype.normalizeInputs=function(t){if(!(t instanceof Cr||Array.isArray(t)))return t;if((t=Array.isArray(t)?t:[t]).length!==this.inputNodes.length)throw new Error("Input tensor count mismatch,the graph model has "+this.inputNodes.length+" placeholders, while there are "+t.length+" input tensors.");return this.inputNodes.reduce(function(e,r,n){return e[r]=t[n],e},{})},t.prototype.normalizeOutputs=function(t){return t=t||this.outputNodes,Array.isArray(t)?t:[t]},t.prototype.execute=function(t,e){t=this.normalizeInputs(t),e=this.normalizeOutputs(e);var r=this.executor.execute(t,e);return r.length>1?r:r[0]},t.prototype.executeAsync=function(t,e){return _f(this,void 0,void 0,function(){var r;return Of(this,function(n){switch(n.label){case 0:return t=this.normalizeInputs(t),e=this.normalizeOutputs(e),[4,this.executor.executeAsync(t,e)];case 1:return[2,(r=n.sent()).length>1?r:r[0]]}})})},t.prototype.convertTensorMapToTensorsMap=function(t){return Object.keys(t).reduce(function(e,r){return e[r]=[t[r]],e},{})},t.prototype.dispose=function(){this.executor.dispose()},t}();function $m(t,e){return void 0===e&&(e={}),_f(this,void 0,void 0,function(){var r;return Of(this,function(n){switch(n.label){case 0:if(null==t)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");return null==e&&(e={}),e.fromTFHub&&null==t.load&&(t.endsWith("/")||(t+="/"),t=""+t+Hm+jm),[4,(r=new Gm(t,e)).load()];case 1:return n.sent(),[2,r]}})})}var Km=function(t,e){return(Km=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function Xm(t,e){function r(){this.constructor=t}Km(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var Ym=function(){return(Ym=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function Jm(t,e,r,n){return new(r||(r=Promise))(function(o,a){function i(t){try{u(n.next(t))}catch(t){a(t)}}function s(t){try{u(n.throw(t))}catch(t){a(t)}}function u(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(i,s)}u((n=n.apply(t,e||[])).next())})}function Zm(t,e){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(t,i)}catch(t){a=[6,t],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}var Qm=function(){function t(t,e){this.model=t,this.outputStride=e;var r=this.model.inputs[0].shape;cr.assert(-1===r[1]&&-1===r[2],function(){return"Input shape ["+r[1]+", "+r[2]+"] must both be equal to or -1"})}return t.prototype.predict=function(t){var e=this;return Zn(function(){var r=e.preprocessInput(t.toFloat()).expandDims(0),n=e.model.predict(r).map(function(t){return t.squeeze([0])}),o=e.nameOutputResults(n);return{heatmapScores:o.heatmap.sigmoid(),offsets:o.offsets,displacementFwd:o.displacementFwd,displacementBwd:o.displacementBwd}})},t.prototype.dispose=function(){this.model.dispose()},t}(),tg=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Xm(e,t),e.prototype.preprocessInput=function(t){return Zn(function(){return xc(t,127.5).sub(1)})},e.prototype.nameOutputResults=function(t){return{offsets:t[0],heatmap:t[1],displacementFwd:t[2],displacementBwd:t[3]}},e}(Qm);function eg(t){return Math.floor(t/2)}var rg=function(){function t(t,e){this.priorityQueue=new Array(t),this.numberOfElements=-1,this.getElementValue=e}return t.prototype.enqueue=function(t){this.priorityQueue[++this.numberOfElements]=t,this.swim(this.numberOfElements)},t.prototype.dequeue=function(){var t=this.priorityQueue[0];return this.exchange(0,this.numberOfElements--),this.sink(0),this.priorityQueue[this.numberOfElements+1]=null,t},t.prototype.empty=function(){return-1===this.numberOfElements},t.prototype.size=function(){return this.numberOfElements+1},t.prototype.all=function(){return this.priorityQueue.slice(0,this.numberOfElements+1)},t.prototype.max=function(){return this.priorityQueue[0]},t.prototype.swim=function(t){for(;t>0&&this.less(eg(t),t);)this.exchange(t,eg(t)),t=eg(t)},t.prototype.sink=function(t){for(;2*t<=this.numberOfElements;){var e=2*t;if(e<this.numberOfElements&&this.less(e,e+1)&&e++,!this.less(t,e))break;this.exchange(t,e),t=e}},t.prototype.getValueAt=function(t){return this.getElementValue(this.priorityQueue[t])},t.prototype.less=function(t,e){return this.getValueAt(t)<this.getValueAt(e)},t.prototype.exchange=function(t,e){var r=this.priorityQueue[t];this.priorityQueue[t]=this.priorityQueue[e],this.priorityQueue[e]=r},t}();function ng(t,e,r,n,o,a){for(var i=a.shape,s=i[0],u=i[1],l=!0,c=Math.max(r-o,0),p=Math.min(r+o+1,s),d=c;d<p;++d){for(var h=Math.max(n-o,0),f=Math.min(n+o+1,u),m=h;m<f;++m)if(a.get(d,m,t)>e){l=!1;break}if(!l)break}return l}var og=["nose","leftEye","rightEye","leftEar","rightEar","leftShoulder","rightShoulder","leftElbow","rightElbow","leftWrist","rightWrist","leftHip","rightHip","leftKnee","rightKnee","leftAnkle","rightAnkle"],ag=og.length,ig=og.reduce(function(t,e,r){return t[e]=r,t},{}),sg=[["leftHip","leftShoulder"],["leftElbow","leftShoulder"],["leftElbow","leftWrist"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["rightHip","rightShoulder"],["rightElbow","rightShoulder"],["rightElbow","rightWrist"],["rightHip","rightKnee"],["rightKnee","rightAnkle"],["leftShoulder","rightShoulder"],["leftHip","rightHip"]].map(function(t){var e=t[0],r=t[1];return[ig[e],ig[r]]});function ug(t,e,r,n){return{y:n.get(t,e,r),x:n.get(t,e,r+ag)}}function lg(t,e,r){var n=ug(t.heatmapY,t.heatmapX,t.id,r),o=n.y,a=n.x;return{x:t.heatmapX*e+a,y:t.heatmapY*e+o}}function cg(t,e,r){return t<e?e:t>r?r:t}function pg(t,e){return{x:t.x+e.x,y:t.y+e.y}}var dg=[["nose","leftEye"],["leftEye","leftEar"],["nose","rightEye"],["rightEye","rightEar"],["nose","leftShoulder"],["leftShoulder","leftElbow"],["leftElbow","leftWrist"],["leftShoulder","leftHip"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["nose","rightShoulder"],["rightShoulder","rightElbow"],["rightElbow","rightWrist"],["rightShoulder","rightHip"],["rightHip","rightKnee"],["rightKnee","rightAnkle"]].map(function(t){var e=t[0],r=t[1];return[ig[e],ig[r]]}),hg=dg.map(function(t){return t[1]}),fg=dg.map(function(t){return t[0]});function mg(t,e,r,n){return{y:cg(Math.round(t.y/e),0,r-1),x:cg(Math.round(t.x/e),0,n-1)}}function gg(t,e,r,n,o,a,i,s){void 0===s&&(s=2);for(var u=n.shape,l=u[0],c=u[1],p=function(t,e,r){var n=r.shape[2]/2;return{y:r.get(e.y,e.x,t),x:r.get(e.y,e.x,n+t)}}(t,mg(e.position,a,l,c),i),d=pg(e.position,p),h=0;h<s;h++){var f=mg(d,a,l,c),m=ug(f.y,f.x,r,o);d=pg({x:f.x*a,y:f.y*a},{x:m.x,y:m.y})}var g=mg(d,a,l,c),v=n.get(g.y,g.x,r);return{position:d,part:og[r],score:v}}function vg(t,e,r,n,o,a){var i=e.shape[2],s=hg.length,u=new Array(i),l=t.part,c=t.score,p=lg(l,n,r);u[l.id]={score:c,part:og[l.id],position:p};for(var d=s-1;d>=0;--d){var h=hg[d],f=fg[d];u[h]&&!u[f]&&(u[f]=gg(d,u[h],f,e,r,n,a))}for(d=0;d<s;++d)h=fg[d],f=hg[d],u[h]&&!u[f]&&(u[f]=gg(d,u[h],f,e,r,n,o));return u}function bg(t,e,r,n){var o=r.x,a=r.y;return t.some(function(t){var r=t.keypoints[n].position;return function(t,e,r,n){var o=r-t,a=n-e;return o*o+a*a}(a,o,r.y,r.x)<=e})}function yg(t,e,r){return r.reduce(function(r,n,o){var a=n.position,i=n.score;return bg(t,e,a,o)||(r+=i),r},0)/r.length}var xg=1;function wg(t,e,r,n,o,a,i,s){void 0===i&&(i=.5),void 0===s&&(s=20);for(var u=[],l=function(t,e,r){for(var n=r.shape,o=n[0],a=n[1],i=n[2],s=new rg(o*a*i,function(t){return t.score}),u=0;u<o;++u)for(var l=0;l<a;++l)for(var c=0;c<i;++c){var p=r.get(u,l,c);p<t||ng(c,p,u,l,e,r)&&s.enqueue({score:p,part:{heatmapY:u,heatmapX:l,id:c}})}return s}(i,xg,t),c=s*s;u.length<a&&!l.empty();){var p=l.dequeue();if(!bg(u,c,lg(p.part,o,e),p.part.id)){var d=vg(p,t,e,o,r,n),h=yg(u,c,d);u.push({keypoints:d,score:h})}}return u}function kg(t){var e=t.shape,r=e[0],n=e[1],o=e[2];return Zn(function(){var e=t.reshape([r*n,o]).argMax(0),a=e.div(So(n,"int32")).expandDims(1),i=function(t,e){return Zn(function(){var r=t.div(So(e,"int32"));return t.sub(r.mul(So(e,"int32")))})}(e,n).expandDims(1);return Bo([a,i],1)})}function Cg(t,e,r,n){return{y:n.get(t,e,r),x:n.get(t,e,r+ag)}}function Sg(t,e,r){return Zn(function(){var n=function(t,e){for(var r=[],n=0;n<ag;n++){var o=Cg(t.get(n,0).valueOf(),t.get(n,1).valueOf(),n,e),a=o.x,i=o.y;r.push(i),r.push(a)}return zo(r,[ag,2])}(t,r);return t.toTensor().mul(So(e,"int32")).toFloat().add(n)})}function Eg(t,e,r){return Jm(this,void 0,void 0,function(){var n,o,a,i,s,u,l,c,p,d;return Zm(this,function(h){switch(h.label){case 0:return n=0,o=kg(t),[4,Promise.all([t.buffer(),e.buffer(),o.buffer()])];case 1:return a=h.sent(),i=a[0],s=a[1],u=a[2],[4,(l=Sg(u,r,s)).buffer()];case 2:return c=h.sent(),p=Array.from(function(t,e){for(var r=e.shape[0],n=new Float32Array(r),o=0;o<r;o++){var a=e.get(o,0),i=e.get(o,1);n[o]=t.get(a,i,o)}return n}(i,u)),d=p.map(function(t,e){return n+=t,{position:{y:c.get(e,0),x:c.get(e,1)},part:og[e],score:t}}),o.dispose(),l.dispose(),[2,{keypoints:d,score:n/d.length}]}})})}var zg="https://storage.googleapis.com/tfjs-models/savedmodel/posenet/mobilenet/",Ig="https://storage.googleapis.com/tfjs-models/savedmodel/posenet/resnet50/";var Ag=[-123.15,-115.9,-103.06],Ng=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Xm(e,t),e.prototype.preprocessInput=function(t){return t.add(Ag)},e.prototype.nameOutputResults=function(t){var e=t[0],r=t[1];return{offsets:t[2],heatmap:t[3],displacementFwd:e,displacementBwd:r}},e}(Qm);var Rg=Number.NEGATIVE_INFINITY,Tg=Number.POSITIVE_INFINITY;function Dg(t){return Jm(this,void 0,void 0,function(){return Zm(this,function(e){return[2,Promise.all(t.map(function(t){return t.buffer()}))]})})}function _g(t,e){return Lg(t,e)?t:Math.floor(t/e)*e+1}function Og(t){cr.assert("number"==typeof t||"object"==typeof t,function(){return"Invalid inputResolution "+t+". Should be a number or an object with width and height"}),"object"==typeof t&&(cr.assert("number"==typeof t.width,function(){return"inputResolution.width has a value of "+t.width+" which is invalid; it must be a number"}),cr.assert("number"==typeof t.height,function(){return"inputResolution.height has a value of "+t.height+" which is invalid; it must be a number"}))}function Fg(t,e){return Og(t),"object"==typeof t?[_g(t.height,e),_g(t.width,e)]:[_g(t,e),_g(t,e)]}var Mg=[8,16,32];function Lg(t,e){return(t-1)%e==0}function Pg(t){return t instanceof Cr?[t.shape[0],t.shape[1]]:[t.height,t.width]}function Bg(t,e){var r=e[0],n=e[1],o=Pg(t),a=o[0],i=o[1],s=n/r,u=[0,0,0,0],l=u[0],c=u[1],p=u[2],d=u[3];return i/a<s?(l=0,c=0,p=Math.round(.5*(s*a-i)),d=Math.round(.5*(s*a-i))):(l=Math.round(.5*(1/s*i-a)),c=Math.round(.5*(1/s*i-a)),p=0,d=0),{resized:Zn(function(){var e=function(t){return t instanceof Cr?t:of.fromPixels(t)}(t);return(e=va(e,[[l,c],[p,d],[0,0]])).resizeBilinear([r,n])}),padding:{top:l,left:p,right:d,bottom:c}}}function qg(t,e,r,n,o){var a=e[0],i=e[1],s=r[0],u=r[1],l=function(t,e,r,n,o){return void 0===n&&(n=0),void 0===o&&(o=0),1===r&&1===e&&0===n&&0===o?t:t.map(function(t){return function(t,e,r,n,o){return void 0===n&&(n=0),void 0===o&&(o=0),{score:t.score,keypoints:t.keypoints.map(function(t){var a=t.score,i=t.part,s=t.position;return{score:a,part:i,position:{x:s.x*r+o,y:s.y*e+n}}})}}(t,e,r,n,o)})}(t,(a+n.top+n.bottom)/s,(i+n.left+n.right)/u,-n.top,-n.left);return o?function(t,e){return e<=0?t:t.map(function(t){return function(t,e){return{score:t.score,keypoints:t.keypoints.map(function(t){var r=t.score,n=t.part,o=t.position;return{score:r,part:n,position:{x:e-1-o.x,y:o.y}}})}}(t,e)})}(l,i):l}var Vg={architecture:"MobileNetV1",outputStride:16,multiplier:.75,inputResolution:257},Wg=["MobileNetV1","ResNet50"],Ug={MobileNetV1:[8,16,32],ResNet50:[32,16]},jg={MobileNetV1:[.5,.75,1],ResNet50:[1]},Hg=[1,2,4];var Gg={flipHorizontal:!1},$g={flipHorizontal:!1,maxDetections:5,scoreThreshold:.5,nmsRadius:20};var Kg=function(){function t(t,e){(function(t){cr.assert("number"==typeof t,function(){return"outputStride is not a number"}),cr.assert(Mg.indexOf(t)>=0,function(){return"outputStride of "+t+" is invalid. It must be either 8, 16, or 32"})})(t.outputStride),function(t,e){cr.assert("number"==typeof t[0]&&"number"==typeof t[1],function(){return"both resolution values must be a number but had values "+t}),cr.assert(Lg(t[0],e),function(){return"height of "+t[0]+" is invalid for output stride "+e+"."}),cr.assert(Lg(t[1],e),function(){return"width of "+t[1]+" is invalid for output stride "+e+"."})}(e,t.outputStride),this.baseModel=t,this.inputResolution=e}return t.prototype.estimateMultiplePoses=function(t,e){return void 0===e&&(e=$g),Jm(this,void 0,void 0,function(){var r,n,o,a,i,s,u,l,c,p,d,h,f,m,g,v,b,y,x,w,k;return Zm(this,function(C){switch(C.label){case 0:return r=Ym({},$g,e),function(t){var e=t.maxDetections,r=t.scoreThreshold,n=t.nmsRadius;if(e<=0)throw new Error("Invalid maxDetections "+e+". Should be > 0");if(r<0||r>1)throw new Error("Invalid scoreThreshold "+r+". Should be in range [0.0, 1.0]");if(n<=0)throw new Error("Invalid nmsRadius "+n+".")}(e),n=this.baseModel.outputStride,o=this.inputResolution,a=Pg(t),i=a[0],s=a[1],u=Bg(t,o),l=u.resized,c=u.padding,p=this.baseModel.predict(l),d=p.heatmapScores,h=p.offsets,f=p.displacementFwd,m=p.displacementBwd,[4,Dg([d,h,f,m])];case 1:return g=C.sent(),v=g[0],b=g[1],y=g[2],x=g[3],[4,wg(v,b,y,x,n,r.maxDetections,r.scoreThreshold,r.nmsRadius)];case 2:return w=C.sent(),k=qg(w,[i,s],o,c,r.flipHorizontal),d.dispose(),h.dispose(),f.dispose(),m.dispose(),l.dispose(),[2,k]}})})},t.prototype.estimateSinglePose=function(t,e){return void 0===e&&(e=Gg),Jm(this,void 0,void 0,function(){var r,n,o,a,i,s,u,l,c,p,d,h,f,m,g,v;return Zm(this,function(b){switch(b.label){case 0:return r=Ym({},Gg,e),n=this.baseModel.outputStride,o=this.inputResolution,a=Pg(t),i=a[0],s=a[1],u=Bg(t,o),l=u.resized,c=u.padding,p=this.baseModel.predict(l),d=p.heatmapScores,h=p.offsets,f=p.displacementFwd,m=p.displacementBwd,[4,Eg(d,h,n)];case 1:return g=b.sent(),v=qg([g],[i,s],o,c,r.flipHorizontal),d.dispose(),h.dispose(),f.dispose(),m.dispose(),l.dispose(),[2,v[0]]}})})},t.prototype.estimatePoses=function(t,e){return Jm(this,void 0,void 0,function(){return Zm(this,function(r){switch(r.label){case 0:return"single-person"!==e.decodingMethod?[3,2]:[4,this.estimateSinglePose(t,e)];case 1:return[2,[r.sent()]];case 2:return[2,this.estimateMultiplePoses(t,e)]}})})},t.prototype.dispose=function(){this.baseModel.dispose()},t}();function Xg(t){return Jm(this,void 0,void 0,function(){var e,r,n,o,a,i,s;return Zm(this,function(u){switch(u.label){case 0:if(e=t.outputStride,r=t.quantBytes,n=t.multiplier,null==Tf)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this\n        model.");return o=function(t,e,r){var n={1:"100",.75:"075",.5:"050"},o="model-stride"+t+".json";return 4===r?zg+"float/"+n[e]+"/"+o:zg+"quant"+r+"/"+n[e]+"/"+o}(e,n,r),[4,$m(t.modelUrl||o)];case 1:return a=u.sent(),i=new tg(a,e),s=Fg(t.inputResolution,i.outputStride),[2,new Kg(i,s)]}})})}function Yg(t){return Jm(this,void 0,void 0,function(){var e,r,n,o,a,i;return Zm(this,function(s){switch(s.label){case 0:if(e=t.outputStride,r=t.quantBytes,null==Tf)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this\n        model.");return n=function(t,e){var r="model-stride"+t+".json";return 4===e?Ig+"float/"+r:Ig+"quant"+e+"/"+r}(e,r),[4,$m(t.modelUrl||n)];case 1:return o=s.sent(),a=new Ng(o,e),i=Fg(t.inputResolution,a.outputStride),[2,new Kg(a,i)]}})})}function Jg(t){return void 0===t&&(t=Vg),Jm(this,void 0,void 0,function(){return Zm(this,function(e){return"ResNet50"===(t=function(t){if(null==(t=t||Vg).architecture&&(t.architecture="MobileNetV1"),Wg.indexOf(t.architecture)<0)throw new Error("Invalid architecture "+t.architecture+". Should be one of "+Wg);if(null==t.inputResolution&&(t.inputResolution=257),Og(t.inputResolution),null==t.outputStride&&(t.outputStride=16),Ug[t.architecture].indexOf(t.outputStride)<0)throw new Error("Invalid outputStride "+t.outputStride+". Should be one of "+Ug[t.architecture]+" for architecutre "+t.architecture+".");if(null==t.multiplier&&(t.multiplier=1),jg[t.architecture].indexOf(t.multiplier)<0)throw new Error("Invalid multiplier "+t.multiplier+". Should be one of "+jg[t.architecture]+" for architecutre "+t.architecture+".");if(null==t.quantBytes&&(t.quantBytes=4),Hg.indexOf(t.quantBytes)<0)throw new Error("Invalid quantBytes "+t.quantBytes+". Should be one of "+Hg+" for architecutre "+t.architecture+".");return t}(t)).architecture?[2,Yg(t)]:"MobileNetV1"===t.architecture?[2,Xg(t)]:[2,null]})})}var Zg=function(t,e){return(Zg=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function Qg(t,e){function r(){this.constructor=t}Zg(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var tv,ev=function(){return(ev=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function rv(t,e,r,n){return new(r||(r=Promise))(function(o,a){function i(t){try{u(n.next(t))}catch(t){a(t)}}function s(t){try{u(n.throw(t))}catch(t){a(t)}}function u(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(i,s)}u((n=n.apply(t,e||[])).next())})}function nv(t,e){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(t,i)}catch(t){a=[6,t],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function ov(){return null==tv&&(tv=eo().epsilon()),tv}var av=function(t){function e(r){var n=t.call(this,r)||this;return Object.setPrototypeOf(n,e.prototype),n}return Qg(e,t),e}(Error),iv=function(t){function e(r){var n=t.call(this,r)||this;return Object.setPrototypeOf(n,e.prototype),n}return Qg(e,t),e}(Error),sv=function(t){function e(r){var n=t.call(this,r)||this;return Object.setPrototypeOf(n,e.prototype),n}return Qg(e,t),e}(Error),uv=function(t){function e(r){var n=t.call(this,r)||this;return Object.setPrototypeOf(n,e.prototype),n}return Qg(e,t),e}(Error),lv=function(t){function e(r){var n=t.call(this,r)||this;return Object.setPrototypeOf(n,e.prototype),n}return Qg(e,t),e}(Error);!function(t){function e(r){var n=t.call(this,r)||this;return Object.setPrototypeOf(n,e.prototype),n}Qg(e,t)}(Error);function cv(t,e){if(Array.isArray(t)){for(var r=[],n=0;n<e;n++)r=r.concat(t);return r}return(r=new Array(e)).fill(t),r}function pv(t,e){if(!t)throw new lv(e)}function dv(t,e){for(var r=0,n=0,o=t;n<o.length;n++)o[n]===e&&r++;return r}function hv(t){return 1===t.length?t[0]:t}function fv(t){return Array.isArray(t)?t:[t]}function mv(t){var e=t.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==e[0]?e:"private"+e}function gv(t){return t.length<=1?t:-1===t.indexOf("_")?t:t.replace(/[_]+(\w|$)/g,function(t,e){return e.toUpperCase()})}var vv={};function bv(t){if(null==t)return null;var e={};return e.className=t.getClassName(),e.config=t.getConfig(),e}function yv(t,e,r,n,o){var a,i,s;if(void 0===e&&(e={}),void 0===r&&(r={}),void 0===n&&(n="object"),void 0===o&&(o=!1),"string"==typeof t){var u=t,l=void 0;if(u in r)l=r[u];else if(u in vv)l=vv[u];else if(null==(l=e[u]))throw new sv("Unknown "+n+": "+t+". This may be due to one of the following reasons:\n1. The "+n+" is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom "+n+" is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().");return l}var c=t;if(null==c.className||null==c.config)throw new sv(n+": Improper config format: "+JSON.stringify(c)+".\n'className' and 'config' must set.");var p=c.className,d=void 0,h=void 0;if(p in r?(d=(a=r[p])[0],h=a[1]):p in vv?(d=(i=vv.className)[0],h=i[1]):p in e&&(d=(s=e[p])[0],h=s[1]),null==d)throw new sv("Unknown "+n+": "+p+". This may be due to one of the following reasons:\n1. The "+n+" is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom "+n+" is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().");if(null!=h){for(var f={},m=0,g=Object.keys(vv);m<g.length;m++)f[k=g[m]]=vv[k];for(var v=0,b=Object.keys(r);v<b.length;v++)f[k=b[v]]=r[k];c.config.customObjects=f;for(var y=ev({},vv),x=0,w=Object.keys(r);x<w.length;x++){var k=w[x];vv[k]=r[k]}!function t(e){if(null!=e&&"object"==typeof e)if(Array.isArray(e))e.forEach(function(e){return t(e)});else for(var r=0,n=Object.keys(e);r<n.length;r++){var o=n[r],a=e[o];null!=a&&"object"==typeof a&&(Array.isArray(a)||"ndarray"!==a.type||"number"!=typeof a.value?t(a):e[o]=a.value)}}(c.config);var C=h(d,c.config,r,o);return vv=ev({},y),C}y=ev({},vv);for(var S=0,E=Object.keys(r);S<E.length;S++)k=E[S],vv[k]=r[k];return C=new d(c.config),vv=ev({},y),C}function xv(t,e){return-1*function(t,e){return t<e?-1:t>e?1:0}(t,e)}function wv(t){if(null==t)return t;for(var e=[],r=0,n=t;r<n.length;r++){var o=n[r];-1===e.indexOf(o)&&e.push(o)}return e}function kv(t){if(null==t)throw new sv("Invalid value in obj: "+JSON.stringify(t));for(var e in t)if(t.hasOwnProperty(e))return!1;return!0}function Cv(t,e,r){if(null!=r&&t.indexOf(r)<0)throw new sv(r+" is not a valid "+e+".  Valid values are "+t+" or null/undefined.")}function Sv(t,e,r,n){return void 0===r&&(r=0),void 0===n&&(n=1/0),pv(r>=0),pv(n>=r),Array.isArray(t)&&t.length>=r&&t.length<=n&&t.every(function(t){return typeof t===e})}function Ev(t,e){Array.isArray(t)?(cr.assert(t.length>0,function(){return e+" is unexpectedly an empty array."}),t.forEach(function(t,r){return Ev(t,"element "+(r+1)+" of "+e)})):cr.assert(Number.isInteger(t)&&t>0,function(){return"Expected "+e+" to be a positive integer, but got "+function t(e){return null===e?"null":Array.isArray(e)?"["+e.map(function(e){return t(e)}).join(",")+"]":"string"==typeof e?'"'+e+'"':""+e}(t)+"."})}function zv(t){return"relu"===t?"relu":"linear"===t?"linear":"elu"===t?"elu":null}function Iv(t,e){return Zn(function(){return Gl(Hp(Tc(t,t),e,!0))})}var Av=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Qg(e,t),e.prototype.getConfig=function(){return{}},e}(lf.Serializable),Nv=function(t){function e(e){var r=t.call(this)||this;return r.defaultMaxValue=2,r.defaultAxis=0,r.maxValue=null!=e.maxValue?e.maxValue:r.defaultMaxValue,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return Qg(e,t),e.prototype.apply=function(t){var e=this;return Zn(function(){var r=Iv(t,e.axis),n=Sl(r,0,e.maxValue);return Rc(t,xc(n,gc(ov(),r)))})},e.prototype.getConfig=function(){return{maxValue:this.maxValue,axis:this.axis}},e.className="MaxNorm",e}(Av);lf.registerClass(Nv);var Rv=function(t){function e(e){var r=t.call(this)||this;return r.defaultAxis=0,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return Qg(e,t),e.prototype.apply=function(t){var e=this;return Zn(function(){return xc(t,gc(ov(),Iv(t,e.axis)))})},e.prototype.getConfig=function(){return{axis:this.axis}},e.className="UnitNorm",e}(Av);lf.registerClass(Rv);var Tv=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Qg(e,t),e.prototype.apply=function(t){return Yp(t)},e.className="NonNeg",e}(Av);lf.registerClass(Tv);var Dv=function(t){function e(e){var r=t.call(this)||this;return r.defaultMinValue=0,r.defaultMaxValue=1,r.defaultRate=1,r.defaultAxis=0,r.minValue=null!=e.minValue?e.minValue:r.defaultMinValue,r.maxValue=null!=e.maxValue?e.maxValue:r.defaultMaxValue,r.rate=null!=e.rate?e.rate:r.defaultRate,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return Qg(e,t),e.prototype.apply=function(t){var e=this;return Zn(function(){var r=Iv(t,e.axis),n=gc(Rc(e.rate,Sl(r,e.minValue,e.maxValue)),Rc(1-e.rate,r));return Rc(t,xc(n,gc(ov(),r)))})},e.prototype.getConfig=function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}},e.className="MinMaxNorm",e}(Av);lf.registerClass(Dv);var _v={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Ov(t){return bv(t)}function Fv(t,e){return void 0===e&&(e={}),yv(t,lf.SerializationMap.getMap().classNameMap,e,"constraint")}function Mv(t){return null==t?null:"string"==typeof t?Fv({className:t in _v?_v[t]:t,config:{}}):t instanceof Av?t:Fv(t)}Object.freeze({maxNorm:function(t){return new Nv(t)},unitNorm:function(t){return new Rv(t)},nonNeg:function(){return new Tv},minMaxNorm:function(t){return new Dv(t)}});var Lv=["channelsFirst","channelsLast"],Pv=["valid","same","causal"],Bv=["max","avg"],qv=["sum","mul","concat","ave"],Vv=new Map;function Wv(t){Cv(Lv,"DataFormat",t)}function Uv(t){Cv(Pv,"PaddingMode",t)}function jv(t){Cv(Bv,"PoolMode",t)}var Hv=[],Gv="/";function $v(t,e){Hv.push(t);try{var r=e();return Hv.pop(),r}catch(t){throw Hv.pop(),t}}function Kv(t){if(!Jv(t))throw new Error("Not a valid tensor name: '"+t+"'");return(0===Hv.length?"":Hv.join(Gv)+Gv)+t}function Xv(t){if(!Jv(t))throw new Error("Not a valid tensor name: '"+t+"'");Vv.has(t)||Vv.set(t,0);var e=Vv.get(t);if(Vv.set(t,Vv.get(t)+1),e>0){var r=t+"_"+e;return Vv.set(r,1),r}return t}var Yv=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function Jv(t){return!!t.match(Yv)}function Zv(t){return t===parseInt(t.toString(),10)}function Qv(t,e,r){null==e&&(e=0),null==r&&(r=t.length);for(var n=1,o=e;o<r;++o)n*=t[o];return n}function tb(t){return Eo(t=Array.isArray(t)?new Float32Array(t):t)}function eb(t){return Up(tb(t)).dataSync()[0]}function rb(t){return Vp(tb(t)).dataSync()[0]}function nb(t,e){if(e<t)throw new sv("end ("+e+") < begin ("+t+") is forbidden.");for(var r=[],n=t;n<e;++n)r.push(n);return r}function ob(t,e){return t.asType(e)}function ab(t,e){void 0===e&&(e=-1);var r=t.shape.slice();return e<0&&(e=r.length+e+1),r.splice(e,0,1),t.reshape(r)}function ib(t,e,r){return Zn(function(){switch(t.rank){case 1:return Tp(t,e,r);case 2:return Dp(t,[e,0],[r,t.shape[1]]);case 3:return _p(t,[e,0,0],[r,t.shape[1],t.shape[2]]);case 4:return Op(t,[e,0,0,0],[r,t.shape[1],t.shape[2],t.shape[3]]);case 5:return Rp(t,[e,0,0,0,0],[r,t.shape[1],t.shape[2],t.shape[3],t.shape[4]]);case 6:return Rp(t,[e,0,0,0,0,0],[r,t.shape[1],t.shape[2],t.shape[3],t.shape[4],t.shape[5]]);default:throw new sv("sliceAlongFirstAxis() received an unsupported tensor rank: "+t.rank)}})}function sb(t,e,r){return Zn(function(){switch(t.rank){case 1:return Tp(t,e,r);case 2:return Dp(t,[0,e],[t.shape[0],r]);case 3:return _p(t,[0,0,e],[t.shape[0],t.shape[1],r]);case 4:return Op(t,[0,0,0,e],[t.shape[0],t.shape[1],t.shape[2],r]);default:throw new sv("sliceAlongLastAxis() received an unsupported tensor rank: "+t.rank)}})}function ub(t,e,r,n){return Zn(function(){switch(t.rank){case 1:return Tp(t,e,r);case 2:switch(n){case 1:return ib(t,e,r);case 2:return sb(t,e,r);default:throw new sv("The axis is not within the rank of the tensor "+n)}case 3:switch(n){case 1:return ib(t,e,r);case 2:return _p(t,[0,e,0],[t.shape[0],r,t.shape[2]]);case 3:return sb(t,e,r);default:throw new sv("The axis is not within the rank of the tensor "+n)}case 4:switch(n){case 1:return ib(t,e,r);case 2:return Op(t,[0,e,0,0],[t.shape[0],r,t.shape[2],t.shape[3]]);case 3:return Op(t,[0,0,e,0],[t.shape[0],t.shape[1],r,t.shape[3]]);case 4:return sb(t,e,r);default:throw new sv("The axis is not within the rank of the tensor "+n)}default:throw new sv("sliceAlongLastAxis() received an unsupported tensor rank: "+t.rank)}})}function lb(t,e){var r;return void 0===e&&(e=-1),e<0&&(e=0!==(r=t[0].rank)?r:0),e===t[0].rank&&(e=-1),Bo(t,e)}function cb(t,e){switch(t.rank){case 1:return qo([t,e]);case 2:return Vo([t,e],0);case 3:return Wo([t,e],0);case 4:return Uo([t,e],0);default:throw new sv("concatAlongFirstAxis() received an unsupported tensor rank: "+t.rank)}}function pb(t,e){if(Array.isArray(e)||(e=[e]),t.rank!==e.length)throw new sv("The length of input n ("+e.length+") does not match the number of dimensions in input x ("+t.rank+")");return Ia(t,e)}function db(t,e,r,n,o){return void 0===e&&(e=0),void 0===r&&(r=1),xa(t,e,r,n,o)}function hb(t,e,r,n){if(t.rank<2||e.rank<2)throw new uv("dot requires both inputs to be rank >= 2 but got x shape = "+t.shape+" and y shape = "+e.shape);if(e.rank>=3&&t.shape.slice(-1)[0]!==(c=e.shape.slice(-2)[0]))throw new uv("If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = "+t.shape+" and  y shape = "+e.shape);if(2===t.rank&&2===e.rank){var o=!1,a=!1;return Zd.matMul({a:t,b:e,transposeA:o,transposeB:a,bias:n?gb(t.rank,n,"channelsLast"):null,activation:r})}var i=t.shape.slice(),s=i.pop();t=t.reshape([-1,s]);var u=e.shape.slice(),l=u.pop(),c=u.pop(),p=u.concat([l]),d=Array.from({length:e.rank},function(t,r){return 0===r?e.rank-2:r<=e.rank-2?r-1:r});e=e.transpose(d).reshape([c,-1]);var h=i.concat(p);return o=!1,a=!1,Zd.matMul({a:t,b:e,transposeA:o,transposeB:a,bias:n?gb(t.rank,n,"channelsLast"):null,activation:r}).reshape(h)}function fb(t,e,r){return Zn(function(){return e=Array.isArray(e)?Eo(e,"int32"):e.toInt(),Zc(t,e,r)})}function mb(t){return Tc(t,t)}function gb(t,e,r){var n=e.shape;if(1!==e.rank&&e.rank!==t)throw new sv("Unexpected bias dimensions: "+e.rank+"; expected it to be 1 or "+t);if(5===t){if("channelsFirst"===r)return 1===n.length?e.reshape([1,n[0],1,1,1]):e.reshape([1,n[3],n[0],n[1],n[2]]);if("channelsLast"===r)return 1===n.length?e.reshape([1,1,1,1,n[0]]):e.reshape([1].concat(n))}else if(4===t){if("channelsFirst"===r)return 1===n.length?e.reshape([1,n[0],1,1]):e.reshape([1,n[2],n[0],n[1]]);if("channelsLast"===r)return 1===n.length?e.reshape([1,1,1,n[0]]):e.reshape([1].concat(n))}else if(3===t){if("channelsFirst"===r)return 1===n.length?e.reshape([1,n[0],1]):e.reshape([1,n[1],n[0]]);if("channelsLast"===r)return 1===n.length?e.reshape([1,1,n[0]]):e.reshape([1].concat(n))}else if(t<3)return e;throw new sv("Unsupported input rank by biasAdd: "+e.rank)}function vb(t,e,r){return Zn(function(){return null==r&&(r="channelsLast"),Wv(r),t.add(gb(t.rank,e,r))})}function bb(t,e,r,n){return Zn(function(){return gd(t,e,r,n)})}function yb(t,e,r){return void 0===r&&(r=!1),r?t():e()}var xb=["fanIn","fanOut","fanAvg"],wb=["normal","uniform","truncatedNormal"];var kb=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Qg(e,t),e.prototype.fromConfigUsesCustomObjects=function(){return!1},e.prototype.getConfig=function(){return{}},e}(lf.Serializable),Cb=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Qg(e,t),e.prototype.apply=function(t,e){return _o(t,e)},e.className="Zeros",e}(kb);lf.registerClass(Cb);var Sb=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Qg(e,t),e.prototype.apply=function(t,e){return Do(t,e)},e.className="Ones",e}(kb);lf.registerClass(Sb);var Eb=function(t){function e(e){var r=t.call(this)||this;if("object"!=typeof e)throw new sv("Expected argument of type ConstantConfig but got "+e);if(void 0===e.value)throw new sv("config must have value set but got "+e);return r.value=e.value,r}return Qg(e,t),e.prototype.apply=function(t,e){var r=this;return Zn(function(){return Rc(So(r.value),Do(t,e))})},e.prototype.getConfig=function(){return{value:this.value}},e.className="Constant",e}(kb);lf.registerClass(Eb);var zb=function(t){function e(e){var r=t.call(this)||this;return r.DEFAULT_MINVAL=-.05,r.DEFAULT_MAXVAL=.05,r.minval=e.minval||r.DEFAULT_MINVAL,r.maxval=e.maxval||r.DEFAULT_MAXVAL,r.seed=e.seed,r}return Qg(e,t),e.prototype.apply=function(t,e){return ka(t,this.minval,this.maxval,e)},e.prototype.getConfig=function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}},e.className="RandomUniform",e}(kb);lf.registerClass(zb);var Ib=function(t){function e(e){var r=t.call(this)||this;return r.DEFAULT_MEAN=0,r.DEFAULT_STDDEV=.05,r.mean=e.mean||r.DEFAULT_MEAN,r.stddev=e.stddev||r.DEFAULT_STDDEV,r.seed=e.seed,r}return Qg(e,t),e.prototype.apply=function(t,e){if("float32"!==(e=e||"float32")&&"int32"!==e)throw new uv("randomNormal does not support dType "+e+".");return db(t,this.mean,this.stddev,e,this.seed)},e.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},e.className="RandomNormal",e}(kb);lf.registerClass(Ib);var Ab=function(t){function e(e){var r=t.call(this)||this;return r.DEFAULT_MEAN=0,r.DEFAULT_STDDEV=.05,r.mean=e.mean||r.DEFAULT_MEAN,r.stddev=e.stddev||r.DEFAULT_STDDEV,r.seed=e.seed,r}return Qg(e,t),e.prototype.apply=function(t,e){if("float32"!==(e=e||"float32")&&"int32"!==e)throw new uv("truncatedNormal does not support dType "+e+".");return Aa(t,this.mean,this.stddev,e,this.seed)},e.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},e.className="TruncatedNormal",e}(kb);lf.registerClass(Ab);var Nb=function(t){function e(e){var r=t.call(this)||this;return r.gain=null!=e.gain?e.gain:1,r}return Qg(e,t),e.prototype.apply=function(t,e){var r=this;return Zn(function(){if(2!==t.length||t[0]!==t[1])throw new sv("Identity matrix initializer can only be used for 2D square matrices.");return Rc(r.gain,pa(t[0]))})},e.prototype.getConfig=function(){return{gain:this.gain}},e.className="Identity",e}(kb);lf.registerClass(Nb);var Rb=function(t){function e(e){var r=t.call(this)||this;if(e.scale<0)throw new sv("scale must be a positive float. Got: "+e.scale);return r.scale=null==e.scale?1:e.scale,r.mode=null==e.mode?"fanIn":e.mode,function(t){Cv(xb,"FanMode",t)}(r.mode),r.distribution=null==e.distribution?"normal":e.distribution,function(t){Cv(wb,"Distribution",t)}(r.distribution),r.seed=e.seed,r}return Qg(e,t),e.prototype.apply=function(t,e){var r=function(t,e){var r,n;if(void 0===e&&(e="channelsLast"),Wv(e),2===t.length)r=t[0],n=t[1];else if(-1!==[3,4,5].indexOf(t.length))if("channelsFirst"===e){var o=Qv(t,2);r=t[1]*o,n=t[0]*o}else"channelsLast"===e&&(o=Qv(t,0,t.length-2),r=t[t.length-2]*o,n=t[t.length-1]*o);else{var a=Qv(t);r=Math.sqrt(a),n=Math.sqrt(a)}return[r,n]}(t),n=r[0],o=r[1],a=this.scale;if("fanIn"===this.mode?a/=Math.max(1,n):"fanOut"===this.mode?a/=Math.max(1,o):a/=Math.max(1,(n+o)/2),"normal"===this.distribution){var i=Math.sqrt(a);if("float32"!==(e=e||"float32")&&"int32"!==e)throw new uv(this.getClassName()+" does not support dType "+e+".");return Aa(t,0,i,e,this.seed)}var s=Math.sqrt(3*a);return ka(t,-s,s,e)},e.prototype.getConfig=function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}},e.className="VarianceScaling",e}(kb);lf.registerClass(Rb);var Tb=function(t){function e(e){return t.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:null==e?null:e.seed})||this}return Qg(e,t),e.prototype.getClassName=function(){return Rb.className},e.className="GlorotUniform",e}(Rb);lf.registerClass(Tb);var Db=function(t){function e(e){return t.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:null==e?null:e.seed})||this}return Qg(e,t),e.prototype.getClassName=function(){return Rb.className},e.className="GlorotNormal",e}(Rb);lf.registerClass(Db);var _b=function(t){function e(e){return t.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})||this}return Qg(e,t),e.prototype.getClassName=function(){return Rb.className},e.className="HeNormal",e}(Rb);lf.registerClass(_b);var Ob=function(t){function e(e){return t.call(this,{scale:2,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})||this}return Qg(e,t),e.prototype.getClassName=function(){return Rb.className},e.className="HeUniform",e}(Rb);lf.registerClass(Ob);var Fb=function(t){function e(e){return t.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})||this}return Qg(e,t),e.prototype.getClassName=function(){return Rb.className},e.className="LeCunNormal",e}(Rb);lf.registerClass(Fb);var Mb=function(t){function e(e){return t.call(this,{scale:1,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})||this}return Qg(e,t),e.prototype.getClassName=function(){return Rb.className},e.className="LeCunNormal",e}(Rb);lf.registerClass(Mb);var Lb=function(t){function e(e){var r=t.call(this)||this;if(r.DEFAULT_GAIN=1,r.gain=null==e.gain?r.DEFAULT_GAIN:e.gain,r.seed=e.seed,null!=r.seed)throw new uv("Random seed is not implemented for Orthogonal Initializer yet.");return r}return Qg(e,t),e.prototype.apply=function(t,e){var r=this;return Zn(function(){if(2!==t.length)throw new uv("The Orthogonal Initializer does not support non-2D shapes yet.");t[0]*t[1]>2e3&&console.warn("Orthogonal initializer is being called on a matrix with more than 2000 ("+t[0]*t[1]+") elements: Slowness may result.");var e=db(t[0]>t[1]?[t[1],t[0]]:t,0,1,"float32"),n=Pd.gramSchmidt(e);return t[0]>t[1]&&(n=n.transpose()),Rc(r.gain,n)})},e.prototype.getConfig=function(){return{gain:this.gain,seed:this.seed}},e.className="Orthogonal",e}(kb);lf.registerClass(Lb);var Pb={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function Bb(t,e){return void 0===e&&(e={}),yv(t,lf.SerializationMap.getMap().classNameMap,e,"initializer")}function qb(t){return bv(t)}function Vb(t){if("string"==typeof t){var e=t in Pb?Pb[t]:t;if("GlorotNormal"===e)return new Db;if("GlorotUniform"===e)return new Tb;if("HeNormal"===e)return new _b;if("HeUniform"===e)return new Ob;if("LeCunNormal"===e)return new Fb;if("LeCunUniform"===e)return new Mb;var r={};return r.className=e,r.config={},Bb(r)}return t instanceof kb?t:Bb(t)}Object.freeze({zeros:function(){return new Cb},ones:function(){return new Sb},constant:function(t){return new Eb(t)},randomUniform:function(t){return new zb(t)},randomNormal:function(t){return new Ib(t)},truncatedNormal:function(t){return new Ab(t)},identity:function(t){return new Nb(t)},varianceScaling:function(t){return new Rb(t)},glorotUniform:function(t){return new Tb(t)},glorotNormal:function(t){return new Db(t)},heNormal:function(t){return new _b(t)},heUniform:function(t){return new Ob(t)},leCunNormal:function(t){return new Fb(t)},leCunUniform:function(t){return new Mb(t)},orthogonal:function(t){return new Lb(t)}});var Wb=0;function Ub(){return Wb++}var jb={};function Hb(t){return void 0===t&&(t=""),t in jb||(jb[t]=0),jb[t]+=1,t+jb[t].toString()}function Gb(t){return Array.isArray(t)&&Array.isArray(t[0])}function $b(t){return 0===t.length?[]:Array.isArray(t[0])?t:[t]}function Kb(t){var e;if(Array.isArray(t)){if(1!==t.length)throw new sv("Expected Tensor length to be 1; got "+t.length);e=t[0]}else e=t;return e}function Xb(t){if(Array.isArray(t)&&Array.isArray(t[0])){if(1===t.length)return(t=t)[0];throw new sv("Expected exactly 1 Shape; got "+t.length)}return t}function Yb(t){for(var e=0,r=0,n=t;r<n.length;r++){var o=n[r];0===o.shape.length?e+=1:e+=o.shape.reduce(function(t,e){return t*e})}return e}var Jb="Variable",Zb=function(){function t(t,e,r,n,o){void 0===e&&(e="float32"),void 0===r&&(r=Jb),void 0===n&&(n=!0),void 0===o&&(o=null),this.dtype=null==e?"float32":e,this.shape=t.shape,this.id=Ub(),r=null==r?Jb:r,this.originalName=Kv(r),this.name=Xv(this.originalName),this.trainable_=n,this.constraint=o,this.val=To(t,this.trainable_,this.name,this.dtype)}return t.prototype.read=function(){return this.assertNotDisposed(),this.val},t.prototype.write=function(t){return this.assertNotDisposed(),function(t,e){if(t.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(t.shape)+" vs. "+JSON.stringify(e.shape))}(this.val,t),this.val.id!==t.id&&(this.val.assign(t),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this},t.prototype.dispose=function(){this.assertNotDisposed(),this.val.dispose()},t.prototype.assertNotDisposed=function(){if(this.val.isDisposed)throw new Error("LayersVariable "+this.name+" is already disposed.")},Object.defineProperty(t.prototype,"trainable",{get:function(){return this.trainable_},set:function(t){this.trainable_=t,this.val.trainable=t},enumerable:!0,configurable:!0}),t}();function Qb(t){return t.map(function(t){return t.read()})}function ty(t){t.forEach(function(t){t[0].write(t[1])})}var ey=function(t){this.dtype=t.dtype,this.shape=t.shape,null!=t.shape?this.ndim=t.shape.length:this.ndim=t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}},ry=function(t,e,r,n,o,a,i){this.dtype=t,this.shape=e,this.sourceLayer=r,this.inputs=n,this.callArgs=o,this.outputTensorIndex=i,this.id=Ub(),null!=a&&(this.originalName=Kv(a),this.name=Xv(this.originalName)),this.rank=e.length},ny=0,oy=function(){function t(t,e){this.callArgs=e,this.id=ny++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;for(var r=0,n=t.inboundLayers;r<n.length;r++){var o=n[r];null!=o&&o.outboundNodes.push(this)}t.outboundLayer.inboundNodes.push(this)}return t.prototype.getConfig=function(){for(var t=[],e=0,r=this.inboundLayers;e<r.length;e++){var n=r[e];null!=n?t.push(n.name):t.push(null)}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}},t}(),ay=0,iy=function(t){function e(e){var r=t.call(this)||this;r._callHook=null,r._addedWeightNames=[],r._stateful=!1,r.id=ay++,r.activityRegularizer=null,r.inputSpec=null,r.supportsMasking=!1,r._trainableWeights=[],r._nonTrainableWeights=[],r._losses=[],r._updates=[],r._built=!1,r.inboundNodes=[],r.outboundNodes=[];var n=e.name;if(!n){var o=r.getClassName();n=mv(o)+"_"+Hb(o)}if(r.name=n,r.trainable_=null==e.trainable||e.trainable,null!=e.inputShape||null!=e.batchInputShape){var a=void 0;if(null!=e.batchInputShape)a=e.batchInputShape;else if(null!=e.inputShape){var i=null;null!=e.batchSize&&(i=e.batchSize),a=[i].concat(e.inputShape)}r.batchInputShape=a;var s=e.dtype;null==s&&(s=e.inputDType),null==s&&(s="float32"),r.dtype=s}return null!=e.weights?r.initialWeights=e.weights:r.initialWeights=null,r._refCount=null,r.fastWeightInitDuringBuild=!1,r}return Qg(e,t),e.nodeKey=function(t,e){return t.name+"_ib-"+e.toString()},e.prototype.getNodeAtIndex=function(t,e){if(0===this.inboundNodes.length)throw new iv("The layer has never been called and thus has no defined "+e+".");if(this.inboundNodes.length<=t)throw new sv("Asked to get "+e+" at node "+t+", but the layer has only "+this.inboundNodes.length+" inbound nodes.");return this.inboundNodes[t]},e.prototype.getInputAt=function(t){return hv(this.getNodeAtIndex(t,"input").inputTensors)},e.prototype.getOutputAt=function(t){return hv(this.getNodeAtIndex(t,"output").outputTensors)},Object.defineProperty(e.prototype,"input",{get:function(){if(this.inboundNodes.length>1)throw new av("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(0===this.inboundNodes.length)throw new av("Layer "+this.name+" is not connected, no input to return.");return hv(this.getNodeAtIndex(0,"input").inputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"output",{get:function(){if(0===this.inboundNodes.length)throw new av("Layer "+this.name+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new av("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return hv(this.getNodeAtIndex(0,"output").outputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"losses",{get:function(){return this._losses},enumerable:!0,configurable:!0}),e.prototype.calculateLosses=function(){return this.losses.map(function(t){return t()})},Object.defineProperty(e.prototype,"updates",{get:function(){return this._updates},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"built",{get:function(){return this._built},set:function(t){this._built=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"trainable",{get:function(){return this.trainable_},set:function(t){this._trainableWeights.forEach(function(e){return e.trainable=t}),this.trainable_=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.trainable_?this._trainableWeights.filter(function(t){return t.trainable}):[]},set:function(t){this._trainableWeights=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this._trainableWeights.filter(function(t){return!t.trainable}).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)},set:function(t){this._nonTrainableWeights=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stateful",{get:function(){return this._stateful},enumerable:!0,configurable:!0}),e.prototype.resetStates=function(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")},e.prototype.assertInputCompatibility=function(t){if(t=fv(t),null!=this.inputSpec&&0!==this.inputSpec.length){var e=fv(this.inputSpec);if(t.length!==e.length)throw new sv("Layer "+this.name+" expects "+e.length+" inputs, but it received "+t.length+" input tensors. Input received: "+t);for(var r=0;r<t.length;r++){var n=t[r],o=e[r];if(null!=o){var a=n.rank;if(null!=o.ndim&&a!==o.ndim)throw new sv("Input "+r+" is incompatible with layer "+this.name+": expected ndim="+o.ndim+", found ndim="+a);if(null!=o.maxNDim&&a>o.maxNDim)throw new sv("Input "+r+" is incompatible with layer "+this.name+": expected max_ndim="+o.maxNDim+", found ndim="+a);if(null!=o.minNDim&&a<o.minNDim)throw new sv("Input "+r+" is incompatible with layer "+this.name+": expected min_ndim="+o.minNDim+", found ndim="+a+".");if(null!=o.dtype&&n.dtype!==o.dtype)throw new sv("Input "+r+" is incompatible with layer "+this.name+" : expected dtype="+o.dtype+", found dtype="+n.dtype+".");if(o.axes){var i=n.shape;for(var s in o.axes){var u=Number(s),l=o.axes[s],c=u>=0?i[u]:i[i.length+u];if(null!=l&&-1===[l,null].indexOf(c))throw new sv("Input "+r+" is incompatible with layer "+this.name+": expected axis "+u+" of input shape to have value "+l+" but got shape "+i+".")}}if(null!=o.shape)for(var p=0;p<o.shape.length;++p){var d=o.shape[p],h=n.shape[p];if(null!=d&&null!=h&&d!==h)throw new sv("Input "+r+" is incompatible with layer "+this.name+": expected shape="+o.shape+", found shape="+n.shape+".")}}}}},e.prototype.call=function(t,e){return t},e.prototype.invokeCallHook=function(t,e){null!=this._callHook&&this._callHook(t,e)},e.prototype.setCallHook=function(t){this._callHook=t},e.prototype.clearCallHook=function(){this._callHook=null},e.prototype.apply=function(t,e){var r=this;e=e||{},this.assertNotDisposed();for(var n=fv(t),o=!0,a=0,i=n;a<i.length;a++)if(!(i[a]instanceof ry)){o=!1;break}for(var s=!0,u=0,l=n;u<l.length;u++)if(l[u]instanceof ry){s=!1;break}if(o===s)throw new sv("Arguments to apply() must be all SymbolicTensors or all Tensors");return $v(this.name,function(){if(!r.built){r.assertInputCompatibility(t);for(var o=[],a=0,i=fv(t);a<i.length;a++){var u=i[a];o.push(u.shape)}r.build(hv(o)),r.built=!0,r.initialWeights&&r.setWeights(r.initialWeights),null===r._refCount&&s&&(r._refCount=1)}if(r.assertInputCompatibility(t),s){for(var l=[],c=0,p=fv(m=r.call(t,e));c<p.length;c++){var d=p[c];-1!==n.indexOf(d)&&(d=d.clone()),l.push(d)}if(m=hv(l),null!=r.activityRegularizer)throw new uv("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return m}var h=function(t){for(var e=[],r=0,n=t=fv(t);r<n.length;r++){var o=n[r];e.push(o.shape)}return hv(e)}(t),f=r.computeOutputShape(h),m=void 0,g="float32";if(r.warnOnIncompatibleInputShape(Array.isArray(t)?h[0]:h),m=null!=f&&f.length>0&&Array.isArray(f[0])?f.map(function(n,o){return new ry(g,n,r,fv(t),e,r.name,o)}):new ry(g,f,r,fv(t),e,r.name),r.addInboundNode(t,m,null,null,h,f,e),r._refCount++,null!=r.activityRegularizer)throw new uv("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return m})},e.prototype.warnOnIncompatibleInputShape=function(t){if(null!=this.batchInputShape)if(t.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+JSON.stringify(t)+") does not match that of the batchInputShape ("+JSON.stringify(this.batchInputShape)+") of the layer "+this.name);else{var e=!1;this.batchInputShape.forEach(function(r,n){null!=r&&null!=t[n]&&t[n]!==r&&(e=!0)}),e&&console.warn("The shape of the input tensor ("+JSON.stringify(t)+") does not match the expectation of layer "+this.name+": "+JSON.stringify(this.batchInputShape))}},Object.defineProperty(e.prototype,"outputShape",{get:function(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new av("The layer "+this.name+" has never been called and thus has no defined output shape.");for(var t=[],e=0,r=this.inboundNodes;e<r.length;e++){var n=r[e],o=JSON.stringify(n.outputShapes);-1===t.indexOf(o)&&t.push(o)}if(1===t.length){var a=this.inboundNodes[0].outputShapes;return Array.isArray(a)&&Array.isArray(a[0])&&1===a.length?a[0]:a}throw new av("The layer "+this.name+' has multiple inbound nodes with different output shapes. Hence the notion of "outut shape" is ill-defined for the layer.')},enumerable:!0,configurable:!0}),e.prototype.countParams=function(){if(!this.built)throw new iv("You tried to call countParams() on "+this.name+", but the layer is not built yet. Build it first by calling build(batchInputShape).");return Yb(this.weights)},e.prototype.build=function(t){this.built=!0},e.prototype.getWeights=function(t){return void 0===t&&(t=!1),Qb(t?this.trainableWeights:this.weights)},e.prototype.setWeights=function(t){var e=this;Zn(function(){var r=e.weights;if(r.length!==t.length)throw new sv('You called setWeights(weights) on layer "'+e.name+'" with a weight list of length '+t.length+", but the layer was expecting "+r.length+" weights. Provided weights: "+t+"...");if(0!==r.length){for(var n=[],o=Qb(r),a=0;a<o.length;++a){var i=o[a],s=r[a],u=t[a];if(!cr.arraysEqual(i.shape,u.shape))throw new sv("Layer weight shape "+i.shape+" not compatible with provided weight shape "+u.shape);n.push([s,u])}ty(n)}})},e.prototype.addWeight=function(t,e,r,n,o,a,i){if(-1!==this._addedWeightNames.indexOf(t))throw new sv("Duplicate weight name "+t+" for layer "+this.name);this._addedWeightNames.push(t),null==r&&(r="float32"),this.fastWeightInitDuringBuild&&(n=Vb("zeros"));var s=n.apply(e,r),u=new Zb(s,r,t,a,i);return s.dispose(),null!=o&&this.addLoss(function(){return o.apply(u.read())}),null==a&&(a=!0),a?this._trainableWeights.push(u):this._nonTrainableWeights.push(u),u},e.prototype.setFastWeightInitDuringBuild=function(t){this.fastWeightInitDuringBuild=t},e.prototype.addLoss=function(t){var e;null==t||Array.isArray(t)&&0===t.length||(t=fv(t),void 0!==this._losses&&null!==this._losses&&(e=this.losses).push.apply(e,t))},e.prototype.computeOutputShape=function(t){return t},e.prototype.computeMask=function(t,e){var r=this;if(!this.supportsMasking){if(null!=e){if(!Array.isArray(e))throw new TypeError("Layer "+this.name+" does not support masking, but was passed an inputMask.");e.forEach(function(t){if(null!=t)throw new TypeError("Layer "+r.name+" does not support masking, but was passed an inputMask.")})}return null}return e},e.prototype.addInboundNode=function(t,e,r,n,o,a,i){void 0===i&&(i=null);var s=fv(t);e=fv(e),r=fv(r),n=fv(n),o=$b(o),a=$b(a);for(var u=[],l=[],c=[],p=0,d=s;p<d.length;p++){var h=d[p];u.push(h.sourceLayer),l.push(h.nodeIndex),c.push(h.tensorIndex)}new oy({outboundLayer:this,inboundLayers:u,nodeIndices:l,tensorIndices:c,inputTensors:s,outputTensors:e,inputMasks:r,outputMasks:n,inputShapes:o,outputShapes:a},i);for(var f=0;f<e.length;f++)e[f].sourceLayer=this,e[f].nodeIndex=this.inboundNodes.length-1,e[f].tensorIndex=f},e.prototype.getConfig=function(){var t={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(t.batchInputShape=this.batchInputShape),null!=this.dtype&&(t.dtype=this.dtype),t},e.prototype.disposeWeights=function(){return this.weights.forEach(function(t){return t.dispose()}),this.weights.length},e.prototype.assertNotDisposed=function(){if(0===this._refCount)throw new Error("Layer '"+this.name+"' is already disposed.")},e.prototype.dispose=function(){if(!this.built)throw new Error("Cannot dispose Layer "+this.name+" because it has not been built yet.");if(null===this._refCount)throw new Error("Cannot dispose Layer "+this.name+" because it has not been used yet.");this.assertNotDisposed();var t=0;return 0==--this._refCount&&(t=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:t}},e}(lf.Serializable);var sy,uy=function(t){function e(e){var r=t.call(this,{dtype:e.dtype,name:null!=e.name?e.name:Hb("input").toString()})||this;if(null==e.batchSize&&(e.batchSize=null),null==e.sparse&&(e.sparse=!1),r.trainable=!1,r.built=!0,r.sparse=e.sparse,null!=e.inputShape&&null!=e.batchInputShape)throw new sv("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var n=e.batchInputShape;if(null==n){if(null==e.inputShape)throw new sv("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");n=[e.batchSize].concat(e.inputShape)}else if(null!=e.batchSize)throw new sv("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");var o=e.dtype||"float32";r.batchInputShape=n,r.dtype=o,r.inputSpec=[{shape:n}];var a=new ry(r.dtype,r.batchInputShape,r,[],{},r.name);return a.nodeIndex=0,a.tensorIndex=0,new oy({outboundLayer:r,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[a],outputTensors:[a],inputMasks:[null],outputMasks:[null],inputShapes:[n],outputShapes:[n]}),r}return Qg(e,t),e.prototype.apply=function(t,e){throw new sv("Cannot pass any input to an InputLayer's apply() method. InputLayer name: "+this.name)},e.prototype.dispose=function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}},e.prototype.getConfig=function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}},e.className="InputLayer",e}(iy);function ly(t){if(null==t.batchShape&&null==t.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=t.batchShape&&null!=t.shape)throw new sv("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var e=t.batchShape;null!=t.shape&&null==e&&(e=[null].concat(t.shape));var r=t.dtype;return null==r&&(r="float32"),new uy({batchInputShape:e,name:t.name,dtype:r,sparse:t.sparse}).inboundNodes[0].outputTensors[0]}function cy(t){return rv(this,void 0,void 0,function(){var e,r,n,o,a,i,s,u;return nv(this,function(l){switch(l.label){case 0:if(null==t)return[2];for(o in e=[],r=[],n=[],t)"number"!=typeof(a=t[o])&&(i=a,e.push(i.data()),r.push(o),n.push(i));return e.length>0?[4,Promise.all(e)]:[3,2];case 1:for(s=l.sent(),u=0;u<s.length;++u)t[r[u]]=s[u][0];Qn(n),l.label=2;case 2:return[2]}})})}function py(t){if(null!=t)for(var e in t){var r=t[e];"number"!=typeof r&&r.dispose()}}lf.registerClass(uy),function(t){t[t.SILENT=0]="SILENT",t[t.VERBOSE=1]="VERBOSE"}(sy||(sy={}));var dy=125,hy=function(){function t(){this.validationData=null}return t.prototype.setParams=function(t){this.params=t},t.prototype.onEpochBegin=function(t,e){return rv(this,void 0,void 0,function(){return nv(this,function(t){return[2]})})},t.prototype.onEpochEnd=function(t,e){return rv(this,void 0,void 0,function(){return nv(this,function(t){return[2]})})},t.prototype.onBatchBegin=function(t,e){return rv(this,void 0,void 0,function(){return nv(this,function(t){return[2]})})},t.prototype.onBatchEnd=function(t,e){return rv(this,void 0,void 0,function(){return nv(this,function(t){return[2]})})},t.prototype.onTrainBegin=function(t){return rv(this,void 0,void 0,function(){return nv(this,function(t){return[2]})})},t.prototype.onTrainEnd=function(t){return rv(this,void 0,void 0,function(){return nv(this,function(t){return[2]})})},t.prototype.setModel=function(t){},t}(),fy=function(){function t(t,e){void 0===e&&(e=10),null==t&&(t=[]),this.callbacks=t,this.queueLength=e}return t.prototype.append=function(t){this.callbacks.push(t)},t.prototype.setParams=function(t){for(var e=0,r=this.callbacks;e<r.length;e++)r[e].setParams(t)},t.prototype.setModel=function(t){for(var e=0,r=this.callbacks;e<r.length;e++)r[e].setModel(t)},t.prototype.onEpochBegin=function(t,e){return rv(this,void 0,void 0,function(){var r,n;return nv(this,function(o){switch(o.label){case 0:null==e&&(e={}),r=0,n=this.callbacks,o.label=1;case 1:return r<n.length?[4,n[r].onEpochBegin(t,e)]:[3,4];case 2:o.sent(),o.label=3;case 3:return r++,[3,1];case 4:return[2]}})})},t.prototype.onEpochEnd=function(t,e){return rv(this,void 0,void 0,function(){var r,n;return nv(this,function(o){switch(o.label){case 0:null==e&&(e={}),r=0,n=this.callbacks,o.label=1;case 1:return r<n.length?[4,n[r].onEpochEnd(t,e)]:[3,4];case 2:o.sent(),o.label=3;case 3:return r++,[3,1];case 4:return[2]}})})},t.prototype.onBatchBegin=function(t,e){return rv(this,void 0,void 0,function(){var r,n;return nv(this,function(o){switch(o.label){case 0:null==e&&(e={}),r=0,n=this.callbacks,o.label=1;case 1:return r<n.length?[4,n[r].onBatchBegin(t,e)]:[3,4];case 2:o.sent(),o.label=3;case 3:return r++,[3,1];case 4:return[2]}})})},t.prototype.onBatchEnd=function(t,e){return rv(this,void 0,void 0,function(){var r,n;return nv(this,function(o){switch(o.label){case 0:null==e&&(e={}),r=0,n=this.callbacks,o.label=1;case 1:return r<n.length?[4,n[r].onBatchEnd(t,e)]:[3,4];case 2:o.sent(),o.label=3;case 3:return r++,[3,1];case 4:return[2]}})})},t.prototype.onTrainBegin=function(t){return rv(this,void 0,void 0,function(){var e,r;return nv(this,function(n){switch(n.label){case 0:null==t&&(t={}),e=0,r=this.callbacks,n.label=1;case 1:return e<r.length?[4,r[e].onTrainBegin(t)]:[3,4];case 2:n.sent(),n.label=3;case 3:return e++,[3,1];case 4:return[2]}})})},t.prototype.onTrainEnd=function(t){return rv(this,void 0,void 0,function(){var e,r;return nv(this,function(n){switch(n.label){case 0:null==t&&(t={}),e=0,r=this.callbacks,n.label=1;case 1:return e<r.length?[4,r[e].onTrainEnd(t)]:[3,4];case 2:n.sent(),n.label=3;case 3:return e++,[3,1];case 4:return[2]}})})},t}(),my=function(t){function e(){return t.call(this)||this}return Qg(e,t),e.prototype.onEpochBegin=function(t){return rv(this,void 0,void 0,function(){return nv(this,function(t){return this.seen=0,this.totals={},[2]})})},e.prototype.onBatchEnd=function(t,e){return rv(this,void 0,void 0,function(){var t,r,n,o,a=this;return nv(this,function(i){for(o in null==e&&(e={}),t=null==e.size?0:e.size,this.seen+=t,r=function(r){var o=e[r];if("number"==typeof o)n.totals.hasOwnProperty(r)||(n.totals[r]=0),n.totals[r]=n.totals[r]+o*t;else{var i=void 0;r in n.totals?i=n.totals[r]:n.totals[r]=0;var s=Zn(function(){return gc(a.totals[r],Rc(o,t))});n.totals[r]=s,null!=i&&i.dispose()}},n=this,e)r(o);return[2]})})},e.prototype.onEpochEnd=function(t,e){return rv(this,void 0,void 0,function(){var t,r,n,o,a,i=this;return nv(this,function(s){if(null!=e)for(t=function(t){if(null==r.totals[t])return"continue";"number"==typeof r.totals[t]?e[t]=r.totals[t]/r.seen:Zn(function(){var r=Rc(xc(1,i.seen),i.totals[t]);e[t]=r,i.totals[t].dispose(),to(e[t])})},r=this,n=0,o=this.params.metrics;n<o.length;n++)a=o[n],t(a);return[2]})})},e}(hy),gy=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Qg(e,t),e.prototype.onTrainBegin=function(t){return rv(this,void 0,void 0,function(){return nv(this,function(t){return this.epoch=[],this.history={},[2]})})},e.prototype.onEpochEnd=function(t,e){return rv(this,void 0,void 0,function(){var r;return nv(this,function(n){for(r in null==e&&(e={}),this.epoch.push(t),e)null==this.history[r]&&(this.history[r]=[]),this.history[r].push(e[r]);return[2]})})},e.prototype.syncData=function(){return rv(this,void 0,void 0,function(){var t,e,r,n,o,a,i,s,u;return nv(this,function(l){switch(l.label){case 0:for(n in t=[],e=[],r=[],this.history)for(o=this.history[n],a=0;a<o.length;++a)"number"!=typeof o[a]&&(i=o[a],t.push(i.data()),e.push(n),r.push(a));return[4,Promise.all(t)];case 1:for(s=l.sent(),u=0;u<s.length;++u)this.history[e[u]][r[u]].dispose(),this.history[e[u]][r[u]]=s[u][0];return[2]}})})},e}(hy),vy=function(t){function e(e,r){var n=t.call(this)||this;if(n.currentEpoch=0,n.yieldEvery=r||"auto","auto"===n.yieldEvery&&(n.yieldEvery=dy),"never"===n.yieldEvery&&null!=e.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");return cr.isNumber(n.yieldEvery)&&(n.maybeWait=function(t,e){var r,n=cr.now();return function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];var i=cr.now();return i-n<e?r:(n=i,r=t.apply(void 0,o))}}(n.maybeWait.bind(n),n.yieldEvery)),n.trainBegin=e.onTrainBegin,n.trainEnd=e.onTrainEnd,n.epochBegin=e.onEpochBegin,n.epochEnd=e.onEpochEnd,n.batchBegin=e.onBatchBegin,n.batchEnd=e.onBatchEnd,n.yield=e.onYield,n}return Qg(e,t),e.prototype.maybeWait=function(t,e,r){return rv(this,void 0,void 0,function(){var n;return nv(this,function(o){switch(o.label){case 0:return n=[],null==this.yield?[3,2]:[4,cy(r)];case 1:o.sent(),n.push(this.yield(t,e,r)),o.label=2;case 2:return n.push(Af()),[4,Promise.all(n)];case 3:return o.sent(),[2]}})})},e.prototype.onEpochBegin=function(t,e){return rv(this,void 0,void 0,function(){return nv(this,function(r){switch(r.label){case 0:return this.currentEpoch=t,null==this.epochBegin?[3,3]:[4,cy(e)];case 1:return r.sent(),[4,this.epochBegin(t,e)];case 2:r.sent(),r.label=3;case 3:return[2]}})})},e.prototype.onEpochEnd=function(t,e){return rv(this,void 0,void 0,function(){var r;return nv(this,function(n){switch(n.label){case 0:return r=[],null==this.epochEnd?[3,2]:[4,cy(e)];case 1:n.sent(),r.push(this.epochEnd(t,e)),n.label=2;case 2:return"epoch"===this.yieldEvery&&r.push(Af()),[4,Promise.all(r)];case 3:return n.sent(),[2]}})})},e.prototype.onBatchBegin=function(t,e){return rv(this,void 0,void 0,function(){return nv(this,function(r){switch(r.label){case 0:return null==this.batchBegin?[3,3]:[4,cy(e)];case 1:return r.sent(),[4,this.batchBegin(t,e)];case 2:r.sent(),r.label=3;case 3:return[2]}})})},e.prototype.onBatchEnd=function(t,e){return rv(this,void 0,void 0,function(){var r;return nv(this,function(n){switch(n.label){case 0:return r=[],null==this.batchEnd?[3,2]:[4,cy(e)];case 1:n.sent(),r.push(this.batchEnd(t,e)),n.label=2;case 2:return"batch"===this.yieldEvery?r.push(Af()):cr.isNumber(this.yieldEvery)&&r.push(this.maybeWait(this.currentEpoch,t,e)),[4,Promise.all(r)];case 3:return n.sent(),[2]}})})},e.prototype.onTrainBegin=function(t){return rv(this,void 0,void 0,function(){return nv(this,function(e){switch(e.label){case 0:return null==this.trainBegin?[3,3]:[4,cy(t)];case 1:return e.sent(),[4,this.trainBegin(t)];case 2:e.sent(),e.label=3;case 3:return[2]}})})},e.prototype.onTrainEnd=function(t){return rv(this,void 0,void 0,function(){return nv(this,function(e){switch(e.label){case 0:return null==this.trainEnd?[3,3]:[4,cy(t)];case 1:return e.sent(),[4,this.trainEnd(t)];case 2:e.sent(),e.label=3;case 3:return[2]}})})},e}(hy);function by(t,e){return null==t&&(t={}),t instanceof hy?[t]:Array.isArray(t)&&t[0]instanceof hy?t:fv(t).map(function(t){return new vy(t,e)})}var yy=function(){function t(){}return t.registerCallbackConstructor=function(e,r){cr.assert(e>=0&&Number.isInteger(e),function(){return"Verbosity level is expected to be an integer >= 0, but got "+e}),t.checkForDuplicate(r),null==t.constructors[e]&&(t.constructors[e]=[]),t.constructors[e].push(r)},t.checkForDuplicate=function(e){for(var r in t.constructors)t.constructors[+r].forEach(function(t){if(t===e)throw new sv("Duplicate callback constructor.")})},t.clear=function(){t.constructors={}},t.createCallbacks=function(e){var r=[];for(var n in t.constructors){var o=+n;e>=o&&r.push.apply(r,t.constructors[o])}return r.map(function(t){return new t})},t.constructors={},t}();function xy(t,e,r,n,o,a,i,s,u){var l=new gy,c=[new my].concat(yy.createCallbacks(e));null!=t&&c.push.apply(c,t),c.push(l);var p=new fy(c);return p.setParams({epochs:r,initialEpoch:n,samples:o,steps:a,batchSize:i,verbose:e,doValidation:s,metrics:u}),{callbackList:p,history:l}}function wy(t,e,r){return void 0===e&&(e={}),void 0===r&&(r=!1),yv(t,lf.SerializationMap.getMap().classNameMap,e,"layer",r)}function ky(t,e){return Zn(function(){"float32"!==t.dtype&&(t=t.asType("float32"));var r=Hp(mb(t),e,!0),n=Oo(r.shape,ov()),o=Gl(Sc(r,n));return xc(t,o)})}function Cy(t,e){return Zn(function(){return Wp(mb(Mc(e,t)),-1)})}function Sy(t,e){return Zn(function(){return Wp(gl(Mc(e,t)),-1)})}function Ey(t,e){return Zn(function(){var r=Mc(t,e),n=Sl(gl(t),ov(),Number.MAX_VALUE),o=gl(xc(r,n));return Rc(100,Wp(o,-1))})}function zy(t,e,r){return void 0===r&&(r=!1),Zn(function(){if(r)e=Ja(e);else{var n=Hp(e,e.shape.length-1,!0);e=xc(e,n)}return e=Sl(e,ov(),1-ov()),Ol(Hp(Rc(t.toFloat(),Tl(e)),e.shape.length-1))})}function Iy(t,e){return Zn(function(){var r=Rl(function(t){var e=[Qv(t.shape)];return t.reshape(e)}(t)).toInt(),n=(e=Sl(e,ov(),1-ov())).shape;return zy(ha(r,n[n.length-1]).reshape(n),e,!1)})}function Ay(t,e){return Zn(function(){var r;return r=Sl(e,ov(),1-ov()),r=Tl(xc(r,Mc(1,r))),Wp(function(t,e){if(!cr.arraysEqual(t.shape,e.shape))throw new sv("logits and labels must have the same shape, but got shapes "+JSON.stringify(t.shape)+" and "+JSON.stringify(e.shape));return Zn(function(){var r=e.relu(),n=e.abs().neg();return r.sub(e.mul(t)).add(n.exp().log1p())})}(t,r),-1)})}function Ny(t,e){return Zn(function(){var r=ky(t,-1),n=ky(e,-1),o=Rc(r,n);return Ol(Hp(o,-1))})}var Ry={meanSquaredError:Cy,meanAbsoluteError:Sy,meanAbsolutePercentageError:Ey,meanSquaredLogarithmicError:function(t,e){return Zn(function(){var r=Sl(e,ov(),Number.MAX_VALUE),n=Tl(gc(1,r)),o=Sl(t,ov(),Number.MAX_VALUE),a=Tl(gc(1,o));return Wp(mb(Mc(n,a)),-1)})},squaredHinge:function(t,e){return Zn(function(){var r=Sc(0,Mc(1,Rc(t,e)));return Wp(mb(r),-1)})},hinge:function(t,e){return Zn(function(){var r=Sc(0,Mc(1,Rc(t,e)));return Wp(r,-1)})},categoricalHinge:function(t,e){return Zn(function(){var r=Hp(Rc(t,e),-1),n=Vp(Rc(Mc(1,t),e),-1);return Sc(0,gc(1,Mc(n,r)))})},logcosh:function(t,e){return Zn(function(){var r=Math.log(2),n=Mc(e,t),o=Mc(gc(n,Hl(Rc(-2,n))),r);return Wp(o,-1)})},categoricalCrossentropy:zy,sparseCategoricalCrossentropy:Iy,binaryCrossentropy:Ay,kullbackLeiblerDivergence:function(t,e){return Zn(function(){var r=Sl(t,ov(),1),n=Sl(e,ov(),1);return Hp(Rc(t,Tl(xc(r,n))),-1)})},poisson:function(t,e){return Zn(function(){var r=Tl(gc(ov(),e));return Wp(Mc(e,Rc(t,r)),-1)})},cosineProximity:Ny};function Ty(t){if("string"==typeof t){if(t in Ry)return Ry[t];var e="Unknown loss "+t;throw t.toLowerCase().includes("softmaxcrossentropy")&&(e="Unknown loss "+t+'. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy'),new sv(e)}return t}function Dy(t,e){return Zn(function(){var r=Rc(.5,Lo(e)),n=ob(qc(e,r),t.dtype);return Wp(Pc(t,n),-1)})}function _y(t,e){return Zn(function(){return ob(Pc(Pp(t,-1),Pp(e,-1)),"float32")})}function Oy(t,e){return Zn(function(){return cc(t.equal(1),e.equal(1)).sum().cast("float32")})}function Fy(t,e){return Zn(function(){var r=Oy(t,e),n=function(t,e){return Zn(function(){return cc(t.equal(0),e.equal(1)).sum().cast("float32")})}(t,e),o=r.add(n);return fc(qc(o,0),r.div(o),0).cast("float32")})}function My(t,e){return Zn(function(){var r=Oy(t,e),n=function(t,e){return Zn(function(){return cc(t.equal(1),e.equal(0)).sum().cast("float32")})}(t,e),o=r.add(n);return fc(qc(o,0),r.div(o),0).cast("float32")})}function Ly(t,e){return Ay(t,e)}function Py(t,e){return t.rank===e.rank&&(t=t.squeeze([t.rank-1])),(e=e.argMax(-1)).dtype!==t.dtype&&(e=e.asType(t.dtype)),Pc(t,e).asType("float32")}var By=zy,qy=Iy,Vy={binaryAccuracy:Dy,categoricalAccuracy:_y,precision:Fy,categoricalCrossentropy:By,sparseCategoricalCrossentropy:qy,mse:Cy,MSE:Cy,mae:Sy,MAE:Sy,mape:Ey,MAPE:Ey,cosine:Ny};function Wy(t){if(pv(null!==t,"Unknown LossOrMetricFn "+t),"string"==typeof t)return t;for(var e=void 0,r=0,n=Object.keys(Ry);r<n.length;r++){var o=n[r];if(Ry[o]===t){e=o;break}}if(void 0!==e)return e;for(var a=0,i=Object.keys(Vy);a<i.length;a++)if(o=i[a],Vy[o]===t){e=o;break}return void 0!==e?e:t.name}var Uy=1048576;function jy(t,e,r){if(void 0===r&&(r=!1),null==t||"object"!=typeof t||Object.getPrototypeOf(t)!==Object.prototype||!function t(e){if(null===e)return!0;if("object"==typeof e){if(Object.getPrototypeOf(e)===Object.prototype){for(var r=0,n=Object.keys(e);r<n.length;r++){var o=n[r];if("string"!=typeof o)return!1;if(!t(e[o]))return!1}return!0}if(Array.isArray(e)){for(var a=0,i=e;a<i.length;a++)if(!t(i[a]))return!1;return!0}return!1}var s=typeof e;return"string"===s||"number"===s||"boolean"===s}(t))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(r){var n=JSON.stringify(t);n.length>Uy&&console.warn('User-defined metadata of model "'+e+'" is too large in size (length='+n.length+" when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= "+Uy+".")}}function Hy(t,e,r,n){void 0===n&&(n=console.log);var o,a=function(t){var e=!0,r=[],n=[];for(var o in t.nodesByDepth)r.push(t.nodesByDepth[o]);for(var a=0,i=r;a<i.length;a++){var s=i[a];if(s.length>1||1===s.length&&s[0].inboundLayers.length>1){e=!1;break}n.push.apply(n,s)}if(e)for(var u=0,l=t.layers;u<l.length;u++){for(var c=!1,p=0,d=l[u].inboundNodes;p<d.length;p++){var h=d[p];if(-1!==n.indexOf(h)){if(c){e=!1;break}c=!0}}if(!e)break}return e}(t),i=["Layer (type)","Output shape","Param #"];if(a?(e=e||65,r=r||[.45,.85,1]):(e=e||98,r=r||[.33,.55,.67,1]),r[r.length-1]<=1&&(r=r.map(function(t){return Math.floor(e*t)})),!a)for(var s in i.push("Receives inputs"),o=[],t.nodesByDepth)o.push.apply(o,t.nodesByDepth[s]);n("_".repeat(e)),Gy(i,r,n),n("=".repeat(e));for(var u=t.layers,l=0;l<u.length;++l)a?$y(u[l],r,n):Ky(u[l],r,o,n),n((l===u.length-1?"=":"_").repeat(e));t.checkTrainableWeightsConsistency();var c=function(t){return null!=t.collectedTrainableWeights?Yb(t.collectedTrainableWeights):Yb(t.trainableWeights)}(t),p=Yb(t.nonTrainableWeights);n("Total params: "+(c+p)),n("Trainable params: "+c),n("Non-trainable params: "+p),n("_".repeat(e))}function Gy(t,e,r){void 0===r&&(r=console.log);for(var n="",o=0;o<t.length;++o)o>0&&(n=n.slice(0,n.length-1)+" "),n=(n+=t[o]).slice(0,e[o]),n+=" ".repeat(e[o]-n.length);r(n)}function $y(t,e,r){var n;try{n=JSON.stringify(t.outputShape)}catch(t){n="multiple"}Gy([t.name+" ("+t.getClassName()+")",n,t.countParams().toString()],e,r)}function Ky(t,e,r,n){var o;try{o=JSON.stringify(t.outputShape)}catch(t){o="multiple"}for(var a=[],i=0,s=t.inboundNodes;i<s.length;i++){var u=s[i];if(!(null!=r&&r.length>0&&-1===r.indexOf(u)))for(var l=0;l<u.inboundLayers.length;++l){var c=u.inboundLayers[l].name,p=u.nodeIndices[l],d=u.tensorIndices[l];a.push(c+"["+p+"]["+d+"]")}}var h=t.name,f=t.getClassName(),m=0===a.length?"":a[0];for(Gy([h+" ("+f+")",o,t.countParams().toString(),m],e,n),l=1;l<a.length;++l)Gy(["","","",a[l]],e,n)}function Xy(t,e,r){return("inboundNodes"===t||"outputLayers"===t||"inputLayers"===t)&&0===e&&"string"==typeof r}function Yy(t,e){if(null===t)return null;if("string"==typeof t)return gv(t);if("number"==typeof t||"boolean"==typeof t)return t;if(t instanceof Array){for(var r=[],n=t.length,o=0;o<n;++o){var a=t[o];Xy(e,o,a)?r.push(a):r.push(Yy(a,e))}return r}for(var i={},s=0,u=Object.keys(t);s<u.length;s++){var l=u[s],c=t[l];if("name"===l&&"string"==typeof c)i[l]=c;else{var p=gv(l);i[p]=Yy(c,p)}}return i}var Jy=function(){function t(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof t)for(var r in e.id2Value)this.id2Value[r]=e.id2Value[r],r in e.id2Mask&&(this.id2Mask[r]=e.id2Mask[r]);else{if(null==e)return;for(var n=0,o=e;n<o.length;n++){var a=o[n];this.add(a.key,a.value)}}}return t.prototype.add=function(t,e,r){if(null!=this.id2Value[t.id])throw new sv("Duplicate key: name="+t.name+", id="+t.id);return this.id2Value[t.id]=function(t,e){if(null==t.dtype||t.dtype===e.dtype)return e;try{return ia(e,t.dtype)}catch(r){throw new sv("The dtype of the feed ("+e.dtype+") can not be cast to the dtype of the key '"+t.name+"' ("+t.dtype+").")}}(t,e),this.name2Id[t.name]=t.id,null!=r&&(this.id2Mask[t.id]=r),this},t.prototype.addFeed=function(t){this.add(t.key,t.value)},t.prototype.hasKey=function(t){return null!=this.id2Value[t.id]},t.prototype.names=function(){return Object.keys(this.name2Id)},t.prototype.getValue=function(t){if(t instanceof ry){if(null==this.id2Value[t.id])throw new sv("Nonexistent key: "+t.name);return this.id2Value[t.id]}var e=this.name2Id[t];if(null==e)throw new sv("Feed dict has no SymbolicTensor name: "+t);return this.id2Value[e]},t.prototype.getMask=function(t){if(t instanceof ry){if(null==this.id2Value[t.id])throw new sv("Nonexistent key: "+t.name);return this.id2Mask[t.id]}var e=this.name2Id[t];if(null==e)throw new sv("Feed dict has no SymbolicTensor name: "+t);return this.id2Mask[e]},t.prototype.disposeMasks=function(){null!=this.id2Mask&&Qn(this.id2Mask)},t}(),Zy={},Qy={};function tx(t,e,r,n){for(var o=null!=r&&r.training,a=Array.isArray(t),i=a?t:[t],s=i.map(function(t){return t.name}),u=[],l=e.names(),c=0,p=s;c<p.length;c++){var d=p[c];-1!==l.indexOf(d)?u.push(e.getValue(d)):u.push(null)}null!=n&&(n.maxNumTensors=-1/0,n.minNumTensors=1/0);var h,f,m=s.join(",")+"|"+e.names().join(",");if(null==Zy[m]){var g=function(t,e){cr.assert(null!=t&&t.length>0,function(){return"Expected at least one fetch, got none"});var r=[],n={};if(1===t.length){var o=rx(t[0],e);r=o.sorted,n=o.recipientMap}else for(var a=new Set,i=0,s=t;i<s.length;i++){for(var u=rx(s[i],e),l=u.sorted,c=u.recipientMap,p=0,d=l;p<d.length;p++){var h=d[p];a.has(h.name)||(r.push(h),a.add(h.name))}var f=function(t){null==n[t]&&(n[t]=new Set),c[t].forEach(function(e){return n[t].add(e)})};for(var m in c)f(m)}return{sorted:r,recipientCounts:ex(n)}}(i,e);h=g.sorted,f=g.recipientCounts,Zy[m]=h,Qy[m]=f}h=Zy[m],f={},o||Object.assign(f,Qy[m]);for(var v=new Jy(e),b=0;b<h.length;++b){if(null!=n){var y=Jn().numTensors;y>n.maxNumTensors&&(n.maxNumTensors=y),y<n.minNumTensors&&(n.minNumTensors=y)}var x=h[b],w=x.sourceLayer;if(!(w instanceof uy)){for(var k=[],C=[],S=[],E=!1,z=0,I=x.inputs;z<I.length;z++){var A=I[z],N=v.getValue(A),R=v.getMask(A);k.push(N),C.push(R),null!=R&&(E=!0),o||(f[A.name]--,0!==f[A.name]||e.hasKey(A)||-1!==s.indexOf(A.name)||N.isDisposed||!0===A.sourceLayer.stateful||S.push(N))}E&&((r=r||{}).mask=C[0]);var T=fv(w.apply(k,r)),D=null;w.supportsMasking&&(D=w.computeMask(k,C));for(var _=nx(x),O=Array.isArray(_)?_:[_],F=0;F<O.length;++F){v.hasKey(O[F])||v.add(O[F],T[F],Array.isArray(D)?D[0]:D);var M=s.indexOf(O[F].name);-1!==M&&(u[M]=T[F])}o||Qn(S)}}return v.disposeMasks(),a?u:u[0]}function ex(t){var e={};for(var r in t)e[r]=t[r].size;return e}function rx(t,e){for(var r=new Set,n=[],o={},a=0,i=e.names();a<i.length;a++){var s=i[a];r.add(s)}var u=[],l=[];for(u.push(t);u.length>0;){var c=u[u.length-1];if(r.has(c.name))u.pop();else{var p=l[l.length-1]===u.length-1;if(0===c.inputs.length||p)u.pop(),n.push(c),r.add(c.name),p&&l.pop();else{l.push(u.length-1);for(var d=0,h=c.inputs;d<h.length;d++){var f=h[d];null==o[f.name]&&(o[f.name]=new Set),o[f.name].add(c.name),r.has(f.name)||u.push(f)}}}}return{sorted:n,recipientMap:o}}function nx(t){var e;if(1===t.sourceLayer.inboundNodes.length)e=t.sourceLayer.output;else{for(var r=null,n=0;n<t.sourceLayer.inboundNodes.length;++n)for(var o=0,a=t.sourceLayer.inboundNodes[n].outputTensors;o<a.length;o++)if(a[o].id===t.id){r=n;break}e=t.sourceLayer.getOutputAt(r)}return e}var ox=function(t){function e(r){var n=t.call(this,{})||this;if(n.containerNodes=new Set,n.name=r.name,null==n.name){var o=n.getClassName().toLowerCase();n.name=Hb(o)}if(n.supportsMasking=!1,n.trainable_=!0,Array.isArray(r.inputs)?n.inputs=r.inputs.slice():n.inputs=[r.inputs],Array.isArray(r.outputs)?n.outputs=r.outputs.slice():n.outputs=[r.outputs],wv(n.inputs).length!==n.inputs.length)throw new sv("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+n.inputs.map(function(t){return t.name}));wv(n.outputs).length!==n.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+n.outputs.map(function(t){return t.name})),n.inputLayers=[],n.inputLayersNodeIndices=[],n.inputLayersTensorIndices=[],n.outputLayers=[],n.outputLayersNodeIndices=[],n.outputLayersTensorIndices=[],n.layers=[],n.internalContainerRefs=[];for(var a=0,i=n.outputs;a<i.length;a++){var s=(z=i[a]).sourceLayer,u=z.nodeIndex,l=z.tensorIndex;n.outputLayers.push(s),n.outputLayersNodeIndices.push(u),n.outputLayersTensorIndices.push(l)}for(var c=0,p=n.inputs;c<p.length;c++)s=(z=p[c]).sourceLayer,u=z.nodeIndex,l=z.tensorIndex,pv(0===u,"input layer has >1 nodes"),pv(0===l,"input layer has >1 tensors"),n.inputLayers.push(s),n.inputLayersNodeIndices.push(u),n.inputLayersTensorIndices.push(l);n.inputNames=[],n.outputNames=[],n.feedInputShapes=[],n.feedInputNames=[],n.feedOutputNames=[];for(var d=0;d<n.inputLayers.length;d++){if(!((s=n.inputLayers[d])instanceof uy))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. Received inputs: "+r.inputs+". Input "+d+" (0-based) originates from layer type "+s.getClassName()+".");n.inputNames.push(s.name),n.feedInputShapes.push(s.batchInputShape),n.feedInputNames.push(s.name)}for(var h=0,f=n.outputLayers;h<f.length;h++)s=f[h],n.outputNames.push(s.name);n.internalInputShapes=n.inputs.map(function(t){return t.shape}),n.internalOutputShapes=n.outputs.map(function(t){return t.shape});for(var m={},g={},v={},b={},y={},x=[],w=function t(r,o,a,i,s,u){null!=i&&null!=s&&null!=u||(i=r.sourceLayer,s=r.nodeIndex,u=r.tensorIndex);var l=i.inboundNodes[s];if(-1!==a.indexOf(l))throw new iv("The tensor "+r.name+' at layer "'+i.name+'" is part of a cycle.');if(-1===o.indexOf(l)){n.containerNodes.add(e.nodeKey(i,s)),i.id in y||(y[i.id]=Object.keys(y).length),-1===a.indexOf(l)&&a.push(l);for(var c=l.inboundLayers.length,p=0;p<c;p++){t(l.inputTensors[p],o,a,l.inboundLayers[p],l.nodeIndices[p],l.tensorIndices[p])}for(o.push(l);a.indexOf(l)>=0;)a.splice(a.indexOf(l),1);x.push(l)}},k=[],C=[],S=0,E=n.outputs;S<E.length;S++){var z=E[S];w(z,k,C)}for(var I=0,A=x.slice().reverse();I<A.length;I++){g[(Y=A[I]).id]=Y,Y.id in m||(m[Y.id]=0);var N=m[Y.id],R=null==v[Y.outboundLayer.id]?0:v[Y.outboundLayer.id];for(N=Math.max(N,R),v[Y.outboundLayer.id]=N,b[Y.outboundLayer.id]=Y.outboundLayer,m[Y.id]=N,d=0;d<Y.inboundLayers.length;d++){var T=Y.inboundLayers[d],D=(u=Y.nodeIndices[d],T.inboundNodes[u]),_=null==m[D.id]?0:m[D.id];m[D.id]=Math.max(N+1,_),g[D.id]=D}}var O={};for(var F in m)(N=m[F])in O||(O[N]=[]),O[N].push(g[F]);var M={};for(var L in v)(N=v[L])in M||(M[N]=[]),M[N].push(b[L]);var P=Object.keys(M).map(function(t){return parseInt(t,10)}).sort(xv);n.layers=[];for(var B=0,q=P;B<q.length;B++){var V=M[N=q[B]];V.sort(function(t,e){var r=y[t.id],n=y[e.id];return r<n?-1:r>n?1:0});for(var W=0,U=V;W<U.length;W++)(s=U[W])instanceof e&&n.internalContainerRefs.push(s),n.layers.push(s)}n.layersByDepth=M,P=Object.keys(O).map(function(t){return parseInt(t,10)}).sort(xv);for(var j=n.inputs.slice(),H=[],G=0,$=P;G<$.length;G++)for(var K=0,X=O[N=$[G]];K<X.length;K++){var Y;if(null!=(s=(Y=X[K]).outboundLayer)){for(var J=0,Z=Y.inputTensors;J<Z.length;J++)if(z=Z[J],-1===j.indexOf(z))throw new iv("Graph disconnected: cannot obtain value for tensor "+z+' at layer "'+s.name+'". The following previous layers were accessed without issue: '+H);for(var Q=0,tt=Y.outputTensors;Q<tt.length;Q++)z=tt[Q],j.push(z);H.push(s.name)}}n.nodesByDepth=O;for(var et=n.layers.map(function(t){return t.name}),rt=function(t){var e=et.filter(function(e){return e===t}).length;if(1!==e)throw new iv('The name "'+t+'" is used '+e+" times in the model. All layer names should be unique. Layer names: "+JSON.stringify(et))},nt=0,ot=et;nt<ot.length;nt++)rt(ot[nt]);return n.outboundNodes=[],n.inboundNodes=[],new oy({outboundLayer:n,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:n.inputs,outputTensors:n.outputs,inputMasks:n.inputs.map(function(t){return null}),outputMasks:n.outputs.map(function(t){return null}),inputShapes:n.inputs.map(function(t){return t.shape}),outputShapes:n.outputs.map(function(t){return t.shape})}),n.built=!0,n._refCount=1,n}return Qg(e,t),e.prototype.assertNotDisposed=function(){if(0===this._refCount)throw new Error("Container '"+this.name+"' is already disposed.")},e.prototype.dispose=function(){this.assertNotDisposed();var t={refCountAfterDispose:null,numDisposedVariables:0};if(0==--this._refCount){for(var e=0,r=this.layers;e<r.length;e++){var n=r[e];t.numDisposedVariables+=n.dispose().numDisposedVariables}for(var o=0,a=this.internalContainerRefs;o<a.length;o++){var i=a[o];t.numDisposedVariables+=i.dispose().numDisposedVariables}}return t.refCountAfterDispose=this._refCount,t},Object.defineProperty(e.prototype,"trainable",{get:function(){return this.trainable_},set:function(t){this.layers.forEach(function(e){e._trainableWeights.forEach(function(e){return e.trainable=t})}),this.trainable_=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){if(this._trainableWeights.length>0)throw new sv("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];for(var t=[],e=0,r=this.layers;e<r.length;e++){var n=r[e];t=t.concat(n.trainableWeights)}return t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){for(var t=[],e=0,r=this.layers;e<r.length;e++){var n=r[e];t.push.apply(t,n.nonTrainableWeights)}if(!this.trainable){for(var o=[],a=0,i=this.layers;a<i.length;a++)n=i[a],o.push.apply(o,n.trainableWeights);return o.concat(t)}return t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),e.prototype.loadWeights=function(t,e){void 0===e&&(e=!0);for(var r={},n=0,o=0,a=this.layers;o<a.length;o++)for(var i=0,s=a[o].weights;i<s.length;i++){var u=s[i];if(null!=r[u.originalName])throw new sv("Duplicate weight name: "+u.originalName);r[u.originalName]=u,n++}var l=[];for(var c in t){if(null!=r[c])l.push([r[c],t[c]]);else if(e)throw new sv("Provided weight data has no target variable: "+c);delete r[c]}if(e){var p=[];for(var d in r)p.push(d);if(p.length>0)throw new sv(p.length+" of "+n+" weights are not set: "+p)}ty(l)},e.prototype.updatedConfig=function(){var t=this.getConfig(),e={};return e.className=this.getClassName(),e.config=t,e.kerasVersion="tfjs-layers 1.3.2",e.backend="TensorFlow.js",e},e.prototype.toJSON=function(t,e){void 0===e&&(e=!0);var r=function t(e,r){if(null==e)return null;if("string"==typeof e)return mv(e);if("number"==typeof e||"boolean"==typeof e)return e;if(e instanceof Array){for(var n=[],o=e.length,a=0;a<o;++a){var i=e[a];Xy(r,a,i)?n.push(i):n.push(t(i,r))}return n}for(var s={},u=0,l=Object.keys(e);u<l.length;u++){var c=l[u],p=e[c];s[mv(c)]="name"!==c&&"className"!==c||"string"!=typeof p?t(p,c):p}return s}(this.updatedConfig());return e?JSON.stringify(r):r},e.prototype.call=function(t,e){var r=this;return Zn(function(){t=fv(t);for(var n=new Jy,o=0;o<r.inputs.length;++o)n.add(r.inputs[o],t[o]);return tx(r.outputs,n,e)})},e.prototype.computeMask=function(t,e){var r=this;return Zn(function(){var n;return t=fv(t),n=null==e?cv(null,t.length):fv(e),r.runInternalGraph(t,n)[1]})},e.prototype.computeOutputShape=function(t){var e=$b(t);if(e.length!==this.inputLayers.length)throw new sv("Invalid inputShape argument "+t+": model has "+this.inputLayers.length+" tensor inputs.");for(var r={},n=0;n<e.length;n++){var o=this.inputLayers[n],a=e[n];r[C=o.name+"_0_0"]=a}var i=Object.keys(this.nodesByDepth).map(function(t){return parseInt(t,10)}).sort(xv);if(i.length>1)for(var s=0,u=i;s<u.length;s++)for(var l=u[s],c=0,p=this.nodesByDepth[l];c<p.length;c++){var d=p[c];if(o=d.outboundLayer,-1===this.inputLayers.map(function(t){return t.id}).indexOf(o.id)){for(var h=[],f=0;f<d.inboundLayers.length;f++){var m=d.inboundLayers[f],g=d.nodeIndices[f],v=d.tensorIndices[f],b=r[C=m.name+"_"+g+"_"+v];h.push(b)}var y=$b(o.computeOutputShape(hv(h))),x=o.inboundNodes.indexOf(d);for(f=0;f<y.length;f++)r[C=o.name+"_"+x+"_"+f]=y[f]}}var w=[],k=[];for(n=0;n<this.outputLayers.length;n++){o=this.outputLayers[n],x=this.outputLayersNodeIndices[n],v=this.outputLayersTensorIndices[n];var C=o.name+"_"+x+"_"+v;k.push(C)}for(n=0;n<k.length;n++){var S=k[n];pv(S in r),w.push(r[S])}return hv(w)},e.prototype.runInternalGraph=function(t,e){null==e&&(e=cv(null,t.length));for(var r={},n=0;n<this.inputs.length;++n){var o=this.inputs[n],a=t[n],i=e[n];r[o.id]=[a,i]}for(var s=0,u=Object.keys(this.nodesByDepth).map(function(t){return parseInt(t,10)}).sort(xv);s<u.length;s++)for(var l=u[s],c=0,p=this.nodesByDepth[l];c<p.length;c++){for(var d=p[c],h=d.outboundLayer,f=d.inputTensors,m=d.outputTensors,g=new Array,v=0,b=f;v<b.length;v++)(o=b[v]).id in r&&g.push(r[o.id]);if(g.length===f.length){var y={},x=void 0,w=void 0,k=void 0,C=void 0;if(null!=d.callArgs&&(y=d.callArgs),1===g.length){var S=g[0],E=S[0],z=S[1];null==y.mask&&(y.mask=z),k=fv(h.call(E,y)),C=fv(h.computeMask(E,z)),x=[E],w=[z]}else x=g.map(function(t){return t[0]}),w=g.map(function(t){return t[1]}),null==y.mask&&(y.mask=w),k=fv(h.call(x,y)),C=fv(h.computeMask(x,w));if(h.activityRegularizer)throw new uv("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(n=0;n<m.length;++n)o=m[n],a=k[n],i=C[n],r[o.id]=[a,i]}}for(var I=[],A=[],N=[],R=0,T=this.outputs;R<T.length;R++){pv((o=T[R]).id in r,"Could not compute output "+o.name+" : "+o.id);var D=r[o.id],_=D[0];i=D[1],N.push(_.shape),I.push(_),A.push(i)}return[I,A,N]},e.prototype.buildNodeConversionMap=function(t){for(var r,n={},o=0,a=this.layers;o<a.length;o++){var i=a[o];r=i instanceof e?1:0;for(var s=0;s<i.inboundNodes.length;s++){var u=e.nodeKey(i,s);this.containerNodes.has(u)&&(n[u]=r,r+=1)}}return n},e.prototype.getLayer=function(t,e){if(null!=e){if(this.layers.length<=e)throw new sv("Was asked to retrieve layer at index "+e+", but model only has "+this.layers.length+" layer(s).");return this.layers[e]}if(null==t)throw new sv("Provide either a layer name or layer index");for(var r=0,n=this.layers;r<n.length;r++){var o=n[r];if(o.name===t)return o}throw new sv("No such layer: "+t)},e.prototype.calculateLosses=function(){var t=this;return Zn(function(){for(var r=[],n=0,o=t.layers;n<o.length;n++)for(var a=o[n],i=0;i<a.inboundNodes.length;++i){var s=e.nodeKey(a,i);t.containerNodes.has(s)&&r.push.apply(r,a.calculateLosses())}return r})},e.prototype.getConfig=function(){for(var t={name:this.name},r=this.buildNodeConversionMap(this.layers),n=[],o=0,a=this.layers;o<a.length;o++){for(var i=(x=a[o]).getClassName(),s=x.getConfig(),u=[],l=0;l<x.inboundNodes.length;l++){var c=x.inboundNodes[l],p=e.nodeKey(x,l),d={};if(this.containerNodes.has(p)){if(c.callArgs)try{JSON.stringify(c.callArgs),d=c.callArgs}catch(t){console.warn("Layer "+x.name+" was passed non-serializable keyword arguments: "+c.callArgs+". They will not be included in the serialized model (and thus will be missing at deserialization time)."),d={}}if(c.inboundLayers.length>0){for(var h=[],f=0;f<c.inboundLayers.length;f++){var m=c.inboundLayers[f],g=c.nodeIndices[f],v=c.tensorIndices[f];null==(k=r[e.nodeKey(m,g)])&&(k=0),h.push([m.name,k,v,d])}u.push(h)}}}var b={};b.name=x.name,b.className=i,b.config=s,b.inboundNodes=u,n.push(b)}t.layers=n;var y=[];for(f=0;f<this.inputLayers.length;f++){var x=this.inputLayers[f];g=this.inputLayersNodeIndices[f],p=e.nodeKey(x,g),this.containerNodes.has(p)&&(null!==(k=r[p])&&void 0!==k||(k=0),v=this.inputLayersTensorIndices[f],y.push([x.name,k,v]))}t.inputLayers=y;var w=[];for(f=0;f<this.outputLayers.length;f++){var k;if(x=this.outputLayers[f],g=this.outputLayersNodeIndices[f],p=e.nodeKey(x,g),this.containerNodes.has(p))null!==(k=r[p])&&void 0!==k||(k=0),v=this.outputLayersTensorIndices[f],w.push([x.name,k,v])}return t.outputLayers=w,t},e.fromConfig=function(t,e,r,n){void 0===n&&(n=!1);var o={},a={};function i(t,e){t.name in a?a[t.name].push(e):a[t.name]=[e]}function s(t,e){for(var r,n=[],a=0,s=e;a<s.length;a++){var u=s[a],l=u[0],c=u[1],p=u[2];if(r=null==u[3]?{}:u[3],!(l in o))return void i(t,e);var d=o[l];if(d.inboundNodes.length<=c)return void i(t,e);var h=d.inboundNodes[c];n.push(h.outputTensors[p])}n.length>0&&t.apply(hv(n),r)}function u(t){var r=t.name,a=wy(t,null!=e.customObjects?e.customObjects:{});a.setFastWeightInitDuringBuild(n),o[r]=a,t.inboundNodes.forEach(function(t){if(!(t instanceof Array))throw new sv("Corrupted configuration, expected array for nodeData: "+t);i(a,t)})}for(var l=e.name,c=e.layers,p=0,d=c;p<d.length;p++)u(m=d[p]);for(;!kv(a);)for(var h=0,f=c;h<f.length;h++){var m=f[h];if((N=o[m.name]).name in a){var g=a[N.name];delete a[N.name];for(var v=0,b=g;v<b.length;v++)s(N,b[v])}}for(var y=[],x=[],w=0,k=e.inputLayers;w<k.length;w++){var C=(m=k[w])[0],S=m[1],E=m[2];pv(C in o);var z=(N=o[C]).inboundNodes[S].outputTensors;y.push(z[E])}for(var I=0,A=e.outputLayers;I<A.length;I++){var N;C=(m=A[I])[0],S=m[1],E=m[2],pv(C in o),z=(N=o[C]).inboundNodes[S].outputTensors,x.push(z[E])}return new t({inputs:y,outputs:x,name:l})},Object.defineProperty(e.prototype,"stateful",{get:function(){if(this._stateful)throw new sv("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(var t=0,e=this.layers;t<e.length;t++)if(e[t].stateful)return!0;return!1},enumerable:!0,configurable:!0}),e.prototype.resetStates=function(){var t=this;Zn(function(){t.layers.forEach(function(t){t.stateful&&t.resetStates()})})},e}(iy);function ax(t,e){return function(t,e,r){var n=e.length;if(null==t||Array.isArray(t)&&0===t.length)return e.map(function(t){return null});if(1===n)return Array.isArray(t)&&1===t.length?t:"object"==typeof t&&e[0]in t?[t[e[0]]]:[t];if(Array.isArray(t)){if(t.length!==n)throw new Error("Provided "+r+" is an array of "+t.length+" element(s), but the model has "+n+" outputs. Make sure a set of weights is provided for each model output.");return t}if("object"==typeof t&&Object.keys(t).length>0&&"object"==typeof t[Object.keys(t)[0]]){var o=[];return e.forEach(function(e){e in t?o.push(t[e]):o.push(null)}),o}throw new Error("The model has multiple ("+n+") outputs, so "+r+" must be either an array with "+n+" elements or an object with "+e+" keys. Provided "+r+" not understood: "+JSON.stringify(t))}(t,e,"classWeight")}function ix(t,e,r,n){return rv(this,void 0,void 0,function(){var o,a,i,s,u;return nv(this,function(l){switch(l.label){case 0:if(null!=e||null!=n)throw new Error("Support sampleWeight is not implemented yet");return null==r?[3,2]:(o=Zn(function(){if(1===t.shape.length)return t.clone();if(2===t.shape.length){if(t.shape[1]>1)return t.argMax(1);if(1===t.shape[1])return t.reshape([t.shape[0]]);throw new Error("Encountered unexpected last-dimension size ("+t.shape[1]+") during handling of class weights. The size is expected to be >= 1.")}throw new Error("Unexpected rank of target (y) tensor ("+t.rank+") during handling of class weights. The rank is expected to be 1 or 2.")}),s=(i=Array).from,[4,o.data()]);case 1:return a=s.apply(i,[l.sent()]),Qn(o),u=[],a.forEach(function(t){if(null==r[t])throw new Error("classWeight must contain all classes in the training data. The class "+t+" exists in the data but not in classWeight");u.push(r[t])}),[2,Eo(u,"float32")];case 2:return[2,null]}})})}function sx(t,e){return Rc(t,e)}var ux=32;function lx(t,e){var r,n,o=e;r=o.xs,n=o.ys,cr.assert(null!=r&&null!=n,function(){return"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates "+e});var a=cx("input",t.inputNames,r),i=cx("output",t.outputNames,n),s=a[0].shape[0];cr.assert(a.length===t.inputs.length,function(){return"LayersModel has "+t.inputs.length+" inputs, but the dataset provides "+a.length+" inputs.  (Expected input keys: "+JSON.stringify(t.inputNames)+")"}),cr.assert(i.length===t.outputs.length,function(){return"LayersModel has "+t.outputs.length+" outputs, but the dataset provides "+i.length+" outputs.  (Expected output keys: "+JSON.stringify(t.outputNames)+")"});var u=function(e){cr.assert(a[e].shape[0]===s,function(){return"Batch size mismatch: input "+t.inputNames[e]+" has "+a[e].shape[0]+"; expected  "+s+" based on input "+t.inputNames[0]+"."})};for(var l in a)u(l);var c=function(e){cr.assert(i[e].shape[0]===s,function(){return"Batch size mismatch: output "+t.outputNames[e]+" has "+i[e].shape[0]+"; expected  "+s+" based on input "+t.inputNames[0]+"."})};for(var p in i)c(p);return{xs:a,ys:i}}function cx(t,e,r){if(r instanceof Cr)return[r];if(Array.isArray(r))return cr.assert(r.length===e.length,function(){return"Received an array of "+r.length+" Tensors, but expected "+e.length+" to match the "+t+" keys "+e+"."}),r;for(var n=[],o=0,a=e;o<a.length;o++){var i=a[o];if(null==r[i])throw new sv("The feature data generated by the dataset lacks the required "+t+" key '"+i+"'.");n.push(r[i])}return n}function px(t,e,r){return rv(this,void 0,void 0,function(){var n,o,a,i,s,u,l,c,p,d,h,f,m,g,v,b,y,x,w,k,C,S,E,z,I,A,N,R,T,D,_,O,F,M;return nv(this,function(L){switch(L.label){case 0:if(n=null!=r.batchesPerEpoch,cr.assert(null!=t.optimizer,function(){return"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."}),cr.assert(null!=r,function(){return"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."}),cr.assert(null!=r.epochs&&r.epochs>0&&Number.isInteger(r.epochs),function(){return"For fitDataset(), config.epochs is expected to be a positive integer, but got "+r.epochs}),cr.assert(!n||r.batchesPerEpoch>0&&Number.isInteger(r.batchesPerEpoch),function(){return"For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got "+r.batchesPerEpoch}),cr.assert(null==r.validationSplit,function(){return"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."}),t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0,L.label=1;case 1:return L.trys.push([1,,26,27]),o=null!=r.validationData,a=void 0,i=void 0,o&&(dx(r.validationData)?cr.assert(null==r.validationBatches||r.validationBatches>0&&Number.isInteger(r.validationBatches),function(){return"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got "+r.validationBatches}):(s=function(t){if(3===t.length)throw new uv("Validation with sample weights is not implemented yet.");return{xs:t[0],ys:t[1]}}(r.validationData),a=s.xs,i=s.ys)),u=t.makeTrainFunction(),l=t.getDedupedMetricsNames(),void 0,c=o?l.slice().concat(l.map(function(t){return"val_"+t})):l.slice(),p=by(r.callbacks,r.yieldEvery),d=null==r.verbose?1:r.verbose,h=xy(p,d,r.epochs,null,null,function(t,e){var r=null;return null!=e.batchesPerEpoch?r=e.batchesPerEpoch:Number.isFinite(t.size)&&(r=t.size),r}(e,r),null,o,c),f=h.callbackList,m=h.history,f.setModel(t),t.history=m,[4,f.onTrainBegin()];case 2:return L.sent(),t.stopTraining_=!1,g=null==r.initialEpoch?0:r.initialEpoch,[4,e.iterator()];case 3:v=L.sent(),L.label=4;case 4:return g<r.epochs?(b={},[4,f.onEpochBegin(g)]):[3,23];case 5:return L.sent(),y=0,x=0,n?[3,7]:[4,e.iterator()];case 6:v=L.sent(),L.label=7;case 7:return!n||y<r.batchesPerEpoch?[4,v.next()]:[3,21];case 8:return w=L.sent(),n&&w.done?(console.warn("You provided `batchesPerEpoch` as "+r.batchesPerEpoch+", but your dataset iterator ran out of data after "+y+" batches; interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, "+r.batchesPerEpoch*r.epochs+" batches). You may need to use the repeat() function when building your dataset."),[3,21]):null==w.value?[3,15]:(k=lx(t,w.value),C=k.xs,S=k.ys,(E={}).batch=x,E.size=C[0].shape[0],[4,f.onBatchBegin(x,E)]);case 9:if(L.sent(),z=[],null==r.classWeight)return[3,13];I=ax(r.classWeight,t.outputNames),M=0,L.label=10;case 10:return M<I.length?(N=(A=z).push,[4,ix(S[M],null,I[M])]):[3,13];case 11:N.apply(A,[L.sent()]),L.label=12;case 12:return++M,[3,10];case 13:for(R=C.concat(S).concat(z),T=u(R),Qn(R),M=0;M<l.length;++M)D=l[M],_=T[M],E[D]=_,to(_);return[4,f.onBatchEnd(x,E)];case 14:L.sent(),py(E),x++,y++,L.label=15;case 15:return(n?y>=r.batchesPerEpoch:w.done)?o?(O=void 0,dx(r.validationData)?(F=fv,[4,t.evaluateDataset(r.validationData,{batches:r.validationBatches})]):[3,17]):[3,19]:[3,20];case 16:return O=F.apply(void 0,[L.sent()]),[3,18];case 17:O=fv(t.evaluate(a,i,{batchSize:null==r.validationBatchSize?ux:r.validationBatchSize,verbose:0})),L.label=18;case 18:for(M=0;M<t.metricsNames.length;++M)b["val_"+t.metricsNames[M]]=O[M];L.label=19;case 19:return[3,21];case 20:return t.stopTraining_?[3,21]:[3,7];case 21:return[4,f.onEpochEnd(g,b)];case 22:return L.sent(),g++,t.stopTraining_?[3,23]:[3,4];case 23:return[4,f.onTrainEnd()];case 24:return L.sent(),[4,t.history.syncData()];case 25:return L.sent(),[2,t.history];case 26:return t.isTraining=!1,[7];case 27:return[2]}})})}function dx(t){return"function"==typeof t.iterator}function hx(t,e,r){return rv(this,void 0,void 0,function(){var n,o,a,i,s,u,l,c,p,d;return nv(this,function(h){switch(h.label){case 0:if(n=null!=(r=r||{}).batches,o=t.testFunction,a=[],r.verbose>0)throw new uv("Verbose mode is not implemented yet.");return cr.assert(!n||r.batches>0&&Number.isInteger(r.batches),function(){return"Test loop expects `batches` to be a positive integer, but received "+JSON.stringify(r.batches)}),function(t){return"function"==typeof t.next}(e)?(s=e,[3,3]):[3,1];case 1:return[4,e.iterator()];case 2:s=h.sent(),h.label=3;case 3:i=s,u=0,l=0,c=function(){var e;return nv(this,function(s){switch(s.label){case 0:return[4,i.next()];case 1:return e=s.sent(),a=Zn(function(){if(e.value){var r=lx(t,e.value),n=r.xs,i=r.ys,s=n.concat(i),c=Zn(function(){return o(s)});if(Qn(s),0===l)for(var p=0;p<c.length;++p)a.push(So(0));var d=s[0].shape[0],h=function(t){var e=c[t],r=a[t];a[t]=Zn(function(){return gc(a[t],Rc(d,e))}),l>0&&Qn(r)};for(p=0;p<c.length;++p)h(p);Qn(c),u+=d,++l}return a}),e.done?(n&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` batches (in this case, "+r.batches+" batches). You may need to use the repeat() function when building your dataset."),[2,"break"]):[2]}})},h.label=4;case 4:return!n||l<r.batches?[5,c()]:[3,6];case 5:return"break"===h.sent()?[3,6]:[3,4];case 6:for(p=0;p<a.length;++p)d=a[p],a[p]=xc(a[p],u),Qn(d);return[2,hv(a)]}})})}function fx(t){cr.assert(t>0&&Number.isInteger(t),function(){return"batchSize is required to be a positive integer, but got "+t})}function mx(t,e,r){return null==t?[null]:Array.isArray(t)?t.map(function(t){return ib(t,e,r-e)}):ib(t,e,r-e)}function gx(t,e){return Zn(function(){return null==t?null:Array.isArray(t)?t.map(function(t){return gx(t,e)}):fb(t,"int32"===e.dtype?e:e.toInt())})}function vx(t,e){for(var r=[],n=0,o=null;n<t;)(o=n+e)>=t&&(o=t),r.push([n,o]),n=o;return r}function bx(t,e,r,n,o,a,i,s,u,l,c,p,d,h,f){return rv(this,void 0,void 0,function(){var m,g,v,b,y,x,w,k;return nv(this,function(C){switch(C.label){case 0:if(null==o&&(o=32),null==a&&(a=1),null==c&&(c=!0),null==d&&(d=0),m=!1,null!=u&&null!=l&&(m=!0),null!=f&&(m=!0,null==h))throw new sv("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");return null!=(g=t.checkNumSamples(r,o,h,"steps_per_epoch"))&&(v=nb(0,g)),null==i&&(i=1),b=xy(s,i,a,d,g,h,o,m,p),y=b.callbackList,x=b.history,y.setModel(t),t.history=x,[4,y.onTrainBegin()];case 1:C.sent(),t.stopTraining_=!1,w=function(a){var i,s,p,d,f;return nv(this,function(b){switch(b.label){case 0:return[4,y.onEpochBegin(a)];case 1:if(b.sent(),i={},null==h)return[3,2];throw new uv("stepsPerEpoch mode is not implemented yet.");case 2:if("batch"===c)throw new uv("batch shuffling is not implemneted yet");c&&cr.shuffle(v),s=Eo(v),p=vx(g,o),d=function(a){var c;return nv(this,function(d){switch(d.label){case 0:return c={},[4,y.onBatchBegin(a,c)];case 1:return d.sent(),Zn(function(){var d=p[a][0],h=p[a][1],f=ib(s,d,h-d);c.batch=a,c.size=h-d;for(var g=gx(r,f),v=e(g),b=0;b<n.length;++b){var y=n[b],x=v[b];c[y]=x,to(x)}if(a===p.length-1&&m){var w=t.testLoop(u,l,o);for(b=0;b<n.length;++b)y=n[b],to(x=w[b]),i["val_"+y]=x}}),[4,y.onBatchEnd(a,c)];case 2:return d.sent(),py(c),t.stopTraining_?[2,"break"]:[2]}})},f=0,b.label=3;case 3:return f<p.length?[5,d(f)]:[3,6];case 4:if("break"===b.sent())return[3,6];b.label=5;case 5:return++f,[3,3];case 6:s.dispose(),b.label=7;case 7:return[4,y.onEpochEnd(a,i)];case 8:return b.sent(),t.stopTraining_?[2,"break"]:[2]}})},k=d,C.label=2;case 2:return k<a?[5,w(k)]:[3,5];case 3:if("break"===C.sent())return[3,5];C.label=4;case 4:return++k,[3,2];case 5:return[4,y.onTrainEnd()];case 6:return C.sent(),[4,t.history.syncData()];case 7:return C.sent(),[2,t.history]}})})}function yx(t,e,r,n){return void 0===n&&(n={}),rv(this,void 0,void 0,function(){var o,a,i,s,u,l,c,p,d,h,f,m,g,v,b,y,x,w,k,C;return nv(this,function(S){switch(S.label){case 0:if(t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0,S.label=1;case 1:return S.trys.push([1,,7,8]),fx(p=null==n.batchSize?32:n.batchSize),!1,[4,t.standardizeUserData(e,r,n.sampleWeight,n.classWeight,!1,p)];case 2:if(d=S.sent(),o=d[0],a=d[1],c=d[2],h=!1,f=void 0,!(null!=n.validationData&&n.validationData.length>0))return[3,4];if(h=!0,2!==n.validationData.length)throw 3===n.validationData.length?new uv("validationData including sample weights is not supported yet."):new sv("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+n.validationData+" is invalid.");return i=n.validationData[0],s=n.validationData[1],!0,[4,t.standardizeUserData(i,s,null,null,!0,p)];case 3:return m=S.sent(),u=m[0],l=m[1],f=u.concat(l),[3,5];case 4:null!=n.validationSplit&&n.validationSplit>0&&n.validationSplit<1?(h=!0,g=Math.floor(o[0].shape[0]*(1-n.validationSplit)),v=o[0].shape[0],u=mx(o,g,v),o=mx(o,0,g),l=mx(a,g,v),a=mx(a,0,g),f=u.concat(l)):null!=n.validationSteps&&(h=!0),S.label=5;case 5:return b=o.concat(a).concat(c),t.checkTrainableWeightsConsistency(),y=t.makeTrainFunction(),x=t.getDedupedMetricsNames(),w=void 0,k=void 0,h?(t.makeTestFunction(),w=t.testFunction,k=x.slice().concat(x.map(function(t){return"val_"+t}))):(w=null,f=[],k=x.slice()),C=by(n.callbacks,n.yieldEvery),[4,bx(t,y,b,x,p,n.epochs,n.verbose,C,w,f,n.shuffle,k,n.initialEpoch,null,null)];case 6:return[2,S.sent()];case 7:return t.isTraining=!1,wx(o,e),wx(a,r),wx(u,i),wx(l,s),null!=c&&Qn(c),[7];case 8:return[2]}})})}function xx(t){var e=[];t instanceof Cr&&(t=[t]);for(var r=0;r<t.length;++r){var n=t[r];if(1===n.rank)e.push(ab(n,1));else{if(0===n.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(n)}}return e}function wx(t,e){if(null!=t){var r=[];if(e instanceof Cr)r.push(e.id);else if(Array.isArray(e))e.forEach(function(t){return r.push(t.id)});else if(null!=e)for(var n in e){var o=e[n];r.push(o.id)}var a=[];if(t instanceof Cr)-1===r.indexOf(t.id)&&a.push(t);else if(Array.isArray(t))t.forEach(function(t){-1===r.indexOf(t.id)&&a.push(t)});else if(null!=t)for(var i in t){var s=t[i];-1===r.indexOf(s.id)&&a.push(s)}a.forEach(function(t){t.isDisposed||t.dispose()})}}function kx(t){return Array.isArray(t)}function Cx(t){return!function(t){return t instanceof Cr}(t)&&!kx(t)}function Sx(t,e,r,n,o){if(void 0===n&&(n=!0),void 0===o&&(o=""),null==e||0===e.length){if(null!=t){var a=!1;if(kx(t)&&t.length>0)a=!0;else if(Cx(t)){for(var i in t)if(t.hasOwnProperty(i)){a=!0;break}}else a=!0;if(a)throw new sv("Error when checking model "+o+" expected no data, but got "+t)}return[]}if(null==t)return e.map(function(t){return null});var s;if(Cx(t)){t=t,s=[];for(var u=0,l=e;u<l.length;u++){var c=l[u];if(null==t[c])throw new sv('No data provided for "'+c+'". Need data for each key in: '+e);s.push(t[c])}}else if(kx(t)){if((t=t).length!==e.length)throw new sv("Error when checking model "+o+": the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see "+e.length+" Tensor(s), but instead got the following list of Tensor(s): "+t);s=t}else{if(t=t,e.length>1)throw new sv("The model "+o+" expects "+e.length+" Tensor(s), but only received one Tensor. Found: Tensor with shape "+t.shape);s=[t]}if(s=xx(s),null!=r)for(var p=0;p<e.length;++p)if(null!=r[p]){var d=s[p];if(d.shape.length!==r[p].length)throw new sv("Error when checking "+o+": expected "+e[p]+" to have "+r[p].length+" dimension(s). but got array with shape "+d.shape);for(var h=0;h<r[p].length;++h)if(0!==h||n){var f=d.shape[h],m=r[p][h];if(null!=m&&m>=0&&f!==m)throw new sv("Error when checking "+o+": expected "+e[p]+" to have shape ["+r[p]+"], but got array with shape ["+d.shape+"].")}}return s}function Ex(t,e,r,n,o){var a;if(void 0===n&&(n=!0),void 0===o&&(o=""),Array.isArray(t)){if(t.length!==e.length)throw new sv("Error when checking model "+o+": the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see "+e.length+" Tensor(s), but instead got "+t.length+" Tensors(s).");a=t}else{if(e.length>1)throw new sv("The model expects "+e.length+" "+o+" Tensors, but only received one Tensor. Found: array with shape "+JSON.stringify(t.shape)+".");a=[t]}if(null!=r)for(var i=0;i<e.length;++i)if(null!=r[i]){var s=a[i];if(s.shape.length!==r[i].length)throw new sv("Error when checking "+o+": expected "+e[i]+" to have "+r[i].length+" dimension(s), but got array with shape "+JSON.stringify(s.shape));for(var u=0;u<r[i].length;++u)if(0!==u||n){var l=s.shape[u],c=r[i][u];if(null!=c&&c!==l)throw new sv("Error when checking "+o+": expected "+e[i]+" to have shape "+JSON.stringify(r[i])+" but got array with shape "+JSON.stringify(s.shape)+".")}}}var zx=function(t){function e(e){var r=t.call(this,e)||this;return r.isTraining=!1,r}return Qg(e,t),e.prototype.summary=function(t,e,r){if(void 0===r&&(r=console.log),!this.built)throw new sv("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");Hy(this,t,e,r)},e.prototype.compile=function(t){var e=this;if(null==t.loss&&(t.loss=[]),this.loss=t.loss,"string"==typeof t.optimizer)this.optimizer_=function(t){var e={Adagrad:function(){return zf.adagrad(.01)},Adadelta:function(){return zf.adadelta(1,.95,ov())},Adam:function(){return zf.adam(.001,.9,.999,ov())},Adamax:function(){return zf.adamax(.002,.9,.999,ov(),0)},RMSProp:function(){return zf.rmsprop(.001,.9,0,ov())},SGD:function(){return zf.sgd(.01)}};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,t in e)return e[t]();throw new sv("Unknown Optimizer "+t)}(t.optimizer),this.isOptimizerOwned=!0;else{if(!(t.optimizer instanceof vf))throw new sv("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=t.optimizer,this.isOptimizerOwned=!1}var r=[];if(Array.isArray(t.loss)||"string"==typeof t.loss||"function"==typeof t.loss)if(Array.isArray(t.loss)){if(t.loss.length!==this.outputs.length)throw new sv("When passing an Array as loss, it should have one entry per model output. The model has "+this.outputs.length+" output(s), but you passed loss="+t.loss+".");var n=t.loss;r=n.map(function(t){return Ty(t)})}else{var o=Ty(t.loss);this.outputs.forEach(function(t){r.push(o)})}else{for(var a in t.loss=t.loss,t.loss)if(-1===this.outputNames.indexOf(a))throw new sv('Unknown entry in loss dictionary: "'+a+'". Only expected the following keys: '+this.outputNames);for(var i=0,s=this.outputNames;i<s.length;i++){var u=s[i];null==t.loss[u]&&console.warn('Output "'+u+'" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to '+u+" during training"),r.push(Ty(t.loss[u]))}}this.lossFunctions=r,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var l=0;l<this.outputs.length;++l){var c=this.internalOutputShapes[l],p=this.outputNames[l];this.feedOutputNames.push(p),this.feedOutputShapes.push(c),this.feedLossFns.push(this.lossFunctions[l])}var d=[];this.metrics=t.metrics,this.metricsNames=["loss"],this.metricsTensors=[],$v("loss",function(){for(var t=0;t<e.outputs.length;++t)if(-1===d.indexOf(t)){var r=e.lossFunctions[t];e.outputs.length>1&&(e.metricsTensors.push([r,t]),e.metricsNames.push(e.outputNames[t]+"_loss"))}});var h=function(t,e){if(null==t||Array.isArray(t)&&0===t.length)return e.map(function(t){return[]});var r;if("string"==typeof t||"function"==typeof t)r=[t];else{if(!Array.isArray(t)&&"object"!=typeof t)throw new TypeError("Type of metrics argument not understood. Expected an string,function, Array, or Object, found: "+t);r=t}if(Array.isArray(r))return e.map(function(t){return r});for(var n=[],o=0,a=e;o<a.length;o++){var i=a[o],s=r.hasOwnProperty(i)?r[i]:[];Array.isArray(s)||(s=[s]),n.push(s)}return n}(t.metrics,this.outputNames);$v("metric",function(){for(var t=function(t){if(-1!==d.indexOf(t))return"continue";!function(r){for(var n,o,a,i=function(r){if("string"==typeof r&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(r)){var i=e.internalOutputShapes[t];1===i[i.length-1]||e.lossFunctions[t]===Ay?-1!==["accuracy","acc"].indexOf(r)?o=Dy:-1!==["crossentropy","ce"].indexOf(r)&&(o=Ly):e.lossFunctions[t]===Iy?-1!==["accuracy","acc"].indexOf(r)?o=Py:-1!==["crossentropy","ce"].indexOf(r)&&(o=qy):-1!==["accuracy","acc"].indexOf(r)?o=_y:-1!==["crossentropy","ce"].indexOf(r)&&(o=By);var s=void 0;-1!==["accuracy","acc"].indexOf(r)?s="acc":-1!==["crossentropy","ce"].indexOf(r)&&(s="ce"),a=o,n=""+s}else{var u=function(t){if("string"==typeof t&&t in Vy)return Vy[t];if("string"!=typeof t&&null!=t)return t;throw new sv("Unknown metric "+t)}(r);a=u,n=""+Wy(r)}var l;$v(n,function(){l=a}),function(t,r,n){e.outputNames.length>1&&(r=e.outputNames[t]+"_"+r),e.metricsNames.push(r),e.metricsTensors.push([n,t])}(t,n,l)},s=0,u=h[t];s<u.length;s++)i(u[s])}()},r=0;r<e.outputs.length;++r)t(r)}),this.collectedTrainableWeights=this.trainableWeights},e.prototype.checkTrainableWeightsConsistency=function(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")},e.prototype.evaluate=function(t,e,r){void 0===r&&(r={});var n=null==r.batchSize?32:r.batchSize;fx(n);var o=this.standardizeUserDataXY(t,e,!0,n);try{var a=o[0].concat(o[1]);this.makeTestFunction();var i=this.testFunction;return hv(this.testLoop(i,a,n,r.verbose,r.steps))}finally{wx(o[0],t),wx(o[1],e)}},e.prototype.evaluateDataset=function(t,e){return rv(this,void 0,void 0,function(){return nv(this,function(r){return this.makeTestFunction(),[2,hx(this,t,e)]})})},e.prototype.checkNumSamples=function(t,e,r,n){var o;if(void 0===n&&(n="steps"),null!=r){if(o=null,null!=e)throw new sv("If "+n+" is set, batchSize must be null or undefined.Got batchSize = "+e)}else{if(null==t)throw new sv("Either the input data should have a defined shape, or "+n+" shoud be specified.");o=Array.isArray(t)?t[0].shape[0]:t.shape[0]}return o},e.prototype.execute=function(t,e){if(Array.isArray(e)&&0===e.length)throw new sv("`outputs` is an empty Array, which is not allowed.");var r=Array.isArray(e),n=r?e:[e],o=this.retrieveSymbolicTensors(n),a=new Jy;if(t instanceof Cr&&(t=[t]),Array.isArray(t)){if(t.length!==this.inputs.length)throw new sv("The number of inputs provided ("+t.length+") does not match the number of inputs of this model ("+this.inputs.length+").");for(var i=0;i<this.inputs.length;++i)a.add(this.inputs[i],t[i])}else for(var s=0,u=this.inputs;s<u.length;s++){var l=u[s],c=t[l.name];if(null==c)throw new sv("No value is provided for the model's input "+l.name);a.add(l,c)}var p=tx(o,a);return r?p:p[0]},e.prototype.retrieveSymbolicTensors=function(t){for(var e=cv(null,t.length),r=t.length,n=0,o=this.layers;n<o.length;n++){for(var a=o[n],i=Array.isArray(a.output)?a.output:[a.output],s=i.map(function(t){return t.name}),u=0;u<t.length;++u){var l=s.indexOf(t[u]);if(-1!==l&&(e[u]=i[l],r--),0===r)break}if(0===r)break}if(r>0){var c=[];throw e.forEach(function(e,r){null==e&&c.push(t[r])}),new sv("Cannot find SymbolicTensors for output name(s): "+JSON.stringify(c))}return e},e.prototype.predictLoop=function(t,e,r){var n=this;return void 0===e&&(e=32),void 0===r&&(r=!1),Zn(function(){var o=n.checkNumSamples(t);if(r)throw new uv("Verbose predictLoop() is not implemented yet.");for(var a=vx(o,e),i=n.outputs.map(function(t){return[]}),s=function(e){Zn(function(){var r=a[e][0],o=a[e][1],i=mx(t,r,o),s=[];if(Array.isArray(i))for(var u=0;u<i.length;++u)s.push({key:n.inputs[u],value:i[u]});else s.push({key:n.inputs[0],value:i});var l=new Jy(s);return tx(n.outputs,l)}).forEach(function(t,e){return i[e].push(t)})},u=0;u<a.length;++u)s(u);return hv(i.map(function(t){return Bo(t,0)}))})},e.prototype.predict=function(t,e){void 0===e&&(e={});var r=xx(t);Ex(r,this.inputNames,this.feedInputShapes,!1);try{var n=null==e.batchSize?32:e.batchSize;return fx(n),this.predictLoop(r,n)}finally{wx(r,t)}},e.prototype.predictOnBatch=function(t){Ex(t,this.inputNames,this.feedInputShapes,!0);var e=(Array.isArray(t)?t[0]:t).shape[0];return this.predictLoop(t,e)},e.prototype.standardizeUserDataXY=function(t,e,r,n){if(null==this.optimizer_)throw new iv("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");for(var o=[],a=0;a<this.feedOutputShapes.length;++a){var i=this.feedOutputShapes[a];this.feedLossFns[a]===Iy?o.push(i.slice(0,i.length-1).concat([1])):o.push(i)}if(function(t,e,r){var n=wv(t.map(function(t){return t.shape[0]}));n.sort();var o=wv(e.map(function(t){return t.shape[0]}));if(o.sort(),n.length>1)throw new sv("All input Tensors (x) should have the same number of samples. Got array shapes: "+JSON.stringify(t.map(function(t){return t.shape})));if(o.length>1)throw new sv("All target Tensors (y) should have the same number of samples. Got array shapes: "+JSON.stringify(e.map(function(t){return t.shape})));if(n.length>0&&o.length>0&&!cr.arraysEqual(n,o))throw new sv("Input Tensors should have the same number of samples as target Tensors. Found "+n[0]+" input sample(s) and "+o[0]+" target sample(s).")}(t=Sx(t,this.feedInputNames,this.feedInputShapes,!1,"input"),e=Sx(e,this.feedOutputNames,o,!1,"target")),function(t,e,r){for(var n=[Cy,Ay,zy],o=0;o<t.length;++o){var a=t[o],i=e[o],s=r[o];if(null!=i){if(i===zy&&1===a.shape[a.shape.length-1])throw new sv("You are passing a target array of shape "+a.shape+" while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].");if(-1!==n.indexOf(i))for(var u=a.shape.slice(1),l=s.slice(1),c=0;c<u.length;++c){var p=u[c],d=l[c];if(null!=d&&p!==d)throw new sv("A target Tensor with shape "+a.shape+" was passed for an output of shape "+s+", while using a loss function that expects targets to have the same shape as the output.")}}}}(e,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=n&&n>0&&t[0].shape[0]%n!=0)throw new sv("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size "+n+". Found: "+t[0].shape[0]+" sample(s).");return[t,e]},e.prototype.standardizeUserData=function(t,e,r,n,o,a){return void 0===o&&(o=!0),rv(this,void 0,void 0,function(){var i,s,u,l,c,p,d,h;return nv(this,function(f){switch(f.label){case 0:if(i=this.standardizeUserDataXY(t,e,o,a),s=i[0],u=i[1],null!=r)throw new Error("sample weight is not supported yet.");if(l=null,null==n)return[3,4];c=ax(n,this.outputNames),l=[],p=0,f.label=1;case 1:return p<c.length?(h=(d=l).push,[4,ix(u[p],null,c[p])]):[3,4];case 2:h.apply(d,[f.sent()]),f.label=3;case 3:return++p,[3,1];case 4:return[2,[s,u,l]]}})})},e.prototype.testLoop=function(t,e,r,n,o){var a=this;return void 0===n&&(n=0),Zn(function(){var i=a.checkNumSamples(e,r,o,"steps"),s=[];if(n>0)throw new uv("Verbose mode is not implemented yet.");if(null!=o)throw new uv("steps mode in testLoop() is not implemented yet");for(var u=vx(i,r),l=Eo(nb(0,i)),c=0;c<u.length;++c){var p=u[c][0],d=u[c][1],h=ib(l,p,d-p),f=gx(e,h),m=t(f);if(0===c)for(var g=0;g<m.length;++g)s.push(So(0));for(g=0;g<m.length;++g){var v=m[g];s[g]=gc(s[g],Rc(d-p,v))}}for(g=0;g<s.length;++g)s[g]=xc(s[g],i);return s})},e.prototype.getDedupedMetricsNames=function(){for(var t=this.metricsNames,e=[],r=0;r<t.length;++r){var n=t[r],o=n;dv(t,n)>1&&(o+="_"+dv(t.slice(0,r),n)),e.push(o)}return e},e.prototype.makeTrainFunction=function(){var t=this;return function(e){var r=[],n=e.slice(0,t.inputs.length),o=e.slice(t.inputs.length,t.inputs.length+t.outputs.length),a=e.slice(t.inputs.length+t.outputs.length,t.inputs.length+2*t.outputs.length),i=[],s=t.collectedTrainableWeights.map(function(t){return t.read()});return[t.optimizer_.minimize(function(){for(var e=[],s=0;s<t.inputs.length;++s)e.push({key:t.inputs[s],value:n[s]});var u,l=new Jy(e),c=tx(t.outputs,l,{training:!0});for(s=0;s<t.lossFunctions.length;++s){var p=(0,t.lossFunctions[s])(o[s],c[s]);null!=a[s]&&(p=sx(p,a[s]));var d=Wp(p);r.push(d),u=0===s?p:gc(u,p)}for(s=0;s<t.metricsTensors.length;++s){var h=void 0;if(t.outputs.length>1&&s<t.outputs.length)h=r[s];else{var f=t.metricsTensors[s][0],m=t.metricsTensors[s][1];h=Wp(f(o[m],c[m]))}to(h),i.push(h)}return u=Wp(u),t.calculateLosses().forEach(function(t){u=gc(u,t)}),u},!0,s)].concat(i)}},e.prototype.makeTestFunction=function(){var t=this;this.testFunction=function(e){return Zn(function(){for(var r,n=[],o=e.slice(0,t.inputs.length),a=e.slice(t.inputs.length,t.inputs.length+t.outputs.length),i=[],s=0;s<t.inputs.length;++s)i.push({key:t.inputs[s],value:o[s]});var u=new Jy(i),l=tx(t.outputs,u);for(s=0;s<t.lossFunctions.length;++s){var c=t.lossFunctions[s],p=Wp(c(a[s],l[s]));r=0===s?p:gc(r,p),n.push(r)}for(s=0;s<t.metricsTensors.length;++s){var d=t.metricsTensors[s][0],h=t.metricsTensors[s][1],f=Wp(d(a[h],l[h]));n.push(f)}return n})}},e.prototype.fit=function(t,e,r){return void 0===r&&(r={}),rv(this,void 0,void 0,function(){return nv(this,function(n){return[2,yx(this,t,e,r)]})})},e.prototype.fitDataset=function(t,e){return rv(this,void 0,void 0,function(){return nv(this,function(r){return[2,px(this,t,e)]})})},e.prototype.trainOnBatch=function(t,e){return rv(this,void 0,void 0,function(){var r,n,o,a,i,s,u,l,c;return nv(this,function(p){switch(p.label){case 0:return[4,this.standardizeUserData(t,e)];case 1:r=p.sent(),n=r[0],o=r[1],a=this.makeTrainFunction(),i=a(n.concat(o)),s=[],u=0,l=i,p.label=2;case 2:return u<l.length?[4,l[u].data()]:[3,5];case 3:c=p.sent(),s.push(c[0]),p.label=4;case 4:return u++,[3,2];case 5:return Qn(i),[2,hv(s)]}})})},e.prototype.getNamedWeights=function(t){for(var e=[],r=null!=t&&t.trainableOnly,n=r?this.trainableWeights:this.weights,o=this.getWeights(r),a=0;a<n.length;++a)r&&!n[a].trainable||e.push({name:n[a].originalName,tensor:o[a]});return e},Object.defineProperty(e.prototype,"stopTraining",{get:function(){return this.stopTraining_},set:function(t){this.stopTraining_=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"optimizer",{get:function(){return this.optimizer_},set:function(t){this.optimizer_!==t&&(this.optimizer_=t,this.isOptimizerOwned=!1)},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var e=t.prototype.dispose.call(this);if(0===e.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){var r=Jn().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=r-Jn().numTensors}return e},e.prototype.getLossIdentifiers=function(){var t;if("string"==typeof this.loss)t=mv(this.loss);else if(Array.isArray(this.loss)){for(var e=0,r=this.loss;e<r.length;e++)if("string"!=typeof r[e])throw new Error("Serialization of non-string loss is not supported.");t=this.loss.map(function(t){return mv(t)})}else{var n=Object.keys(this.loss);t={};for(var o=this.loss,a=0,i=n;a<i.length;a++){var s=i[a];if("string"!=typeof o[s])throw new Error("Serialization of non-string loss is not supported.");t[s]=mv(o[s])}}return t},e.prototype.getMetricIdentifiers=function(){if("string"==typeof this.metrics||"function"==typeof this.metrics)return[mv(Wy(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(function(t){return mv(Wy(t))});var t={};for(var e in this.metrics)t[e]=mv(Wy(this.metrics[e]));return t},e.prototype.getTrainingConfig=function(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}},e.prototype.loadTrainingConfig=function(t){if(null!=t.weighted_metrics)throw new Error("Loading weight_metrics is not supported yet.");if(null!=t.loss_weights)throw new Error("Loading loss_weights is not supported yet.");if(null!=t.sample_weight_mode)throw new Error("Loading sample_weight_mode is not supported yet.");var e,r,n=wy(Yy(t.optimizer_config));if("string"==typeof t.loss)e=gv(t.loss);else if(Array.isArray(t.loss))e=t.loss.map(function(t){return gv(t)});else if(null!=t.loss)for(var o in e={},t.loss)e[o]=gv(t.loss[o]);if(Array.isArray(t.metrics))r=t.metrics.map(function(t){return gv(t)});else if(null!=t.metrics)for(var o in r={},t.metrics)r[o]=gv(t.metrics[o]);this.compile({loss:e,metrics:r,optimizer:n})},e.prototype.save=function(t,e){return rv(this,void 0,void 0,function(){var r,n,o,a,i,s,u,l,c,p,d;return nv(this,function(h){switch(h.label){case 0:if("string"==typeof t){if(0===(r=tf.getSaveHandlers(t)).length)throw new sv("Cannot find any save handlers for URL '"+t+"'");if(r.length>1)throw new sv("Found more than one ("+r.length+") save handlers for URL '"+t+"'");t=r[0]}if(null==t.save)throw new sv("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[4,tf.encodeWeights(this.getNamedWeights(e))];case 1:return n=h.sent(),!1,null,o=this.toJSON(null,!1),a={modelTopology:o,format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v1.3.2",convertedBy:null},null!=e&&e.includeOptimizer&&null!=this.optimizer?(a.trainingConfig=this.getTrainingConfig(),i="optimizer",p=(c=tf).encodeWeights,[4,this.optimizer.getWeights()]):[3,4];case 2:return[4,p.apply(c,[h.sent(),i])];case 3:s=h.sent(),u=s.data,l=s.specs,(d=n.specs).push.apply(d,l),n.data=tf.concatenateArrayBuffers([n.data,u]),h.label=4;case 4:return null!=this.userDefinedMetadata&&(!0,jy(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=n.data,a.weightSpecs=n.specs,[2,t.save(a)]}})})},e.prototype.setUserDefinedMetadata=function(t){jy(t,this.name),this.userDefinedMetadata=t},e.prototype.getUserDefinedMetadata=function(){return this.userDefinedMetadata},e.className="Model",e}(ox);lf.registerClass(zx);var Ix=function(t){function e(e){var r=t.call(this,{inputs:[],outputs:[]})||this;if(e=e||{},r.trainable=!0,r.built=!1,r.name=null!=e.name?e.name:Hb("sequential_"),null!=e.layers)for(var n=0,o=e.layers;n<o.length;n++){var a=o[n];r.add(a)}return r}return Qg(e,t),e.prototype.checkShape=function(t){if(t.inboundNodes[0].outputTensors[0].shape.some(function(t){return t<0}))throw new sv("Negative dimension size caused by adding layer "+t.name+" with input shape ["+t.inboundNodes[0].inputTensors[0].shape+"]")},e.prototype.add=function(t){var r,n=t instanceof e||t instanceof zx;if(n){if(1!==(r=t).outputs.length)throw new sv("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==r.inputs.length)throw new sv("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===t.inboundNodes.length){if(null==t.batchInputShape)throw new sv("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var o=ly({batchShape:t.batchInputShape,dtype:t.dtype,name:t.name+"_input"});t.apply(o)}if(n)this.outputs=r.outputs,this.inputs=r.inputs;else{if(1!==t.inboundNodes.length)throw new sv("A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer "+t.name+" which has "+t.inboundNodes.length+" pre-existing inbound connections.");if(1!==t.inboundNodes[0].outputTensors.length)throw new sv("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[t.inboundNodes[0].outputTensors[0]],this.inputs=function t(e,r,n){if((null==r||null!=n&&n>0)&&(r=e.sourceLayer,n=e.nodeIndex),0===r.inboundNodes.length)return[e];var o=r.inboundNodes[n];if(0===o.inboundLayers.length)return o.inputTensors;for(var a=[],i=0;i<o.inboundLayers.length;i++)for(var s=0,u=t(o.inputTensors[i],o.inboundLayers[i],o.nodeIndices[i]);s<u.length;s++){var l=u[s];-1===a.indexOf(l)&&a.push(l)}return a}(this.outputs[0])}this.inboundNodes=[],new oy({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:cv(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(function(t){return t.shape}),outputShapes:this.outputs[0].shape})}else{var a=t.apply(this.outputs[0]);if(Array.isArray(a))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[a],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(t),this.built=!1},e.prototype.pop=function(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var t=this.layers.length-1;this.layers[t].outboundNodes=[],this.outputs=[this.layers[t].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}},e.prototype.call=function(t,e){return null==this.model&&this.build(),this.model.call(t,e)},e.prototype.build=function(t){if(Xb(t),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new zx({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0},e.prototype.countParams=function(){return this.built||this.build(),t.prototype.countParams.call(this)},e.prototype.summary=function(e,r,n){void 0===n&&(n=console.log),this.built||this.build(),t.prototype.summary.call(this,e,r,n)},e.prototype.setWeights=function(t){null==this.model&&this.build(),this.model.setWeights(t)},e.prototype.evaluate=function(t,e,r){if(void 0===r&&(r={}),!this.built)throw new iv("The model needs to be compiled before being used.");return this.model.evaluate(t,e,r)},e.prototype.evaluateDataset=function(t,e){return rv(this,void 0,void 0,function(){return nv(this,function(r){if(!this.built)throw new iv("The model needs to be compiled before being used.");return[2,this.model.evaluateDataset(t,e)]})})},e.prototype.predict=function(t,e){return void 0===e&&(e={}),null==this.model&&this.build(),this.model.predict(t,e)},e.prototype.predictOnBatch=function(t){return null==this.model&&this.build(),this.model.predictOnBatch(t)},e.prototype.compile=function(t){this.build(),this.model.compile(t),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames},Object.defineProperty(e.prototype,"optimizer",{get:function(){return null==this.model?void 0:this.model.optimizer},set:function(t){this.model.optimizer=t},enumerable:!0,configurable:!0}),e.prototype.fit=function(t,e,r){return void 0===r&&(r={}),rv(this,void 0,void 0,function(){return nv(this,function(n){if(!this.built)throw new iv("The model needs to be compiled before being used.");return[2,this.model.fit(t,e,r)]})})},e.prototype.fitDataset=function(t,e){return rv(this,void 0,void 0,function(){return nv(this,function(r){if(!this.built)throw new iv("The model needs to be compiled before being used.");return[2,this.model.fitDataset(t,e)]})})},e.prototype.trainOnBatch=function(t,e){return rv(this,void 0,void 0,function(){return nv(this,function(r){return[2,this.model.trainOnBatch(t,e)]})})},e.fromConfig=function(t,r,n,o){var a;void 0===o&&(o=!1);var i={};if(r instanceof Array){if(null==r[0].className||"Merge"===r[0].className)throw new sv("Legacy serialization format not supported yet.");a=r}else cr.assert(null!=r.layers,function(){return"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."}),a=r.layers,delete r.layers,i=r;var s=new t(i);if(!(s instanceof e))throw new uv("Sequential.fromConfig called on non-Sequential input: "+s);for(var u=0,l=a;u<l.length;u++){var c=wy(l[u],void 0,o);o&&c.setFastWeightInitDuringBuild(!0),s.add(c)}return s},Object.defineProperty(e.prototype,"stopTraining",{get:function(){if(null==this.model)throw new sv("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining},set:function(t){if(null==this.model)throw new sv("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=t},enumerable:!0,configurable:!0}),e.prototype.getConfig=function(){for(var t=[],e=0,r=this.layers;e<r.length;e++){var n=r[e],o={};o.className=n.getClassName(),o.config=n.getConfig(),t.push(o)}return{name:this.name,layers:t}},e.className="Sequential",e}(zx);lf.registerClass(Ix);var Ax=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Qg(e,t),e.prototype.getConfig=function(){return{}},e}(lf.Serializable),Nx=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Qg(e,t),e.prototype.apply=function(t,e){return void 0===e&&(e=1),function(t,e){if(void 0===e&&(e=1),1!==e)throw new uv("Support for alpha values other than 1 ("+e+") is not implemented yet.");return $p(t)}(t,e)},e.className="elu",e}(Ax);lf.registerClass(Nx);var Rx=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Qg(e,t),e.prototype.apply=function(t){return Zp(t)},e.className="selu",e}(Ax);lf.registerClass(Rx);var Tx=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Qg(e,t),e.prototype.apply=function(t){return Yp(t)},e.className="relu",e}(Ax);lf.registerClass(Tx);var Dx=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Qg(e,t),e.prototype.apply=function(t){return Zn(function(){return zc(6,Yp(t))})},e.className="relu6",e}(Ax);lf.registerClass(Dx);var _x=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Qg(e,t),e.prototype.apply=function(t){return t},e.className="linear",e}(Ax);lf.registerClass(_x);var Ox=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Qg(e,t),e.prototype.apply=function(t){return Pl(t)},e.className="sigmoid",e}(Ax);lf.registerClass(Ox);var Fx=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Qg(e,t),e.prototype.apply=function(t){return function(t){return Zn(function(){var e=gc(.5,Rc(.2,t));return Sl(e,0,1)})}(t)},e.className="hardSigmoid",e}(Ax);lf.registerClass(Fx);var Mx=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Qg(e,t),e.prototype.apply=function(t){return Hl(t)},e.className="softplus",e}(Ax);lf.registerClass(Mx);var Lx=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Qg(e,t),e.prototype.apply=function(t){return function(t){return Zn(function(){return xc(t,gl(t).add(1))})}(t)},e.className="softsign",e}(Ax);lf.registerClass(Lx);var Px=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Qg(e,t),e.prototype.apply=function(t){return Xl(t)},e.className="tanh",e}(Ax);lf.registerClass(Px);var Bx=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Qg(e,t),e.prototype.apply=function(t,e){return void 0===e&&(e=-1),Ja(t,e)},e.className="softmax",e}(Ax);lf.registerClass(Bx);var qx=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Qg(e,t),e.prototype.apply=function(t,e){return void 0===e&&(e=-1),Za(t,e)},e.className="logSoftmax",e}(Ax);function Vx(t){return t.getClassName()}function Wx(t,e){return void 0===e&&(e={}),yv(t,lf.SerializationMap.getMap().classNameMap,e,"activation")}function Ux(t){var e;return null==t?Wx(e={className:"linear",config:{}}):"string"==typeof t?((e={}).className=t,e.config={},Wx(e)):t instanceof Ax?t:Wx(t)}function jx(t){if(null!=t&&"object"!=typeof t)throw new Error("Argument to L1L2 regularizer's constructor is expected to be an object, but received: "+t)}lf.registerClass(qx);var Hx=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Qg(e,t),e}(lf.Serializable),Gx=function(t){function e(e){var r=t.call(this)||this;return jx(e),r.l1=null==e||null==e.l1?.01:e.l1,r.l2=null==e||null==e.l2?.01:e.l2,r.hasL1=0!==r.l1,r.hasL2=0!==r.l2,r}return Qg(e,t),e.prototype.apply=function(t){var e=this;return Zn(function(){var r=_o([1]);return e.hasL1&&(r=gc(r,Hp(Rc(e.l1,gl(t))))),e.hasL2&&(r=gc(r,Hp(Rc(e.l2,mb(t))))),r.asScalar()})},e.prototype.getConfig=function(){return{l1:this.l1,l2:this.l2}},e.fromConfig=function(t,e){return new t({l1:e.l1,l2:e.l2})},e.className="L1L2",e}(Hx);lf.registerClass(Gx);var $x={l1l2:"L1L2"};function Kx(t){return bv(t)}function Xx(t,e){return void 0===e&&(e={}),yv(t,lf.SerializationMap.getMap().classNameMap,e,"regularizer")}function Yx(t){return null==t?null:"string"==typeof t?Xx({className:t in $x?$x[t]:t,config:{}}):t instanceof Hx?t:Xx(t)}var Jx=function(t){function e(e){var r=t.call(this,null==e?{}:e)||this;return r.supportsMasking=!0,null!=e&&(r.maxValue=e.maxValue),r}return Qg(e,t),e.prototype.call=function(t,e){t=Kb(t);var r=Yp(t);return null!=this.maxValue&&(r=Sl(r,0,this.maxValue)),r},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var e={maxValue:this.maxValue},r=t.prototype.getConfig.call(this);return Object.assign(e,r),e},e.className="ReLU",e}(iy);lf.registerClass(Jx);var Zx=function(t){function e(e){var r=t.call(this,null==e?{}:e)||this;return r.DEFAULT_ALPHA=.3,null==e&&(e={}),r.alpha=null==e.alpha?r.DEFAULT_ALPHA:e.alpha,r}return Qg(e,t),e.prototype.call=function(t,e){var r=Kb(t);return Kp(r,this.alpha)},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var e={alpha:this.alpha},r=t.prototype.getConfig.call(this);return Object.assign(e,r),e},e.className="LeakyReLU",e}(iy);lf.registerClass(Zx);var Qx=function(t){function e(e){var r=t.call(this,null==e?{}:e)||this;if(r.DEFAULT_ALPHA_INITIALIZER="zeros",null==e&&(e={}),r.supportsMasking=!0,r.alphaInitializer=Vb(e.alphaInitializer||r.DEFAULT_ALPHA_INITIALIZER),r.alphaRegularizer=Yx(e.alphaRegularizer),r.alphaConstraint=Mv(e.alphaConstraint),null==e.sharedAxes)r.sharedAxes=null;else if(Array.isArray(e.sharedAxes))r.sharedAxes=e.sharedAxes;else{if("number"!=typeof e.sharedAxes)throw new sv("Expected sharedAxes to be a number or an array of numbers, but got "+e.sharedAxes);r.sharedAxes=[e.sharedAxes]}return r}return Qg(e,t),e.prototype.build=function(t){var e=(t=Xb(t)).slice(1);if(null!=this.sharedAxes)for(var r=0,n=this.sharedAxes;r<n.length;r++)e[(a=n[r])-1]=1;this.alpha=this.addWeight("alpha",e,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);var o={};if(null!=this.sharedAxes)for(var a=1;a<t.length;++a)o[a]=t[a];this.inputSpec=[new ey({ndim:t.length,axes:o})],this.built=!0},e.prototype.call=function(t,e){return t=Kb(t),Xp(t,this.alpha.read())},e.prototype.getConfig=function(){var e={alphaInitializer:qb(this.alphaInitializer),alphaRegularizer:Kx(this.alphaRegularizer),alphaConstraint:Ov(this.alphaConstraint),sharedAxes:this.sharedAxes},r=t.prototype.getConfig.call(this);return Object.assign(e,r),e},e.className="PReLU",e}(iy);lf.registerClass(Qx);var tw=function(t){function e(e){var r=t.call(this,null==e?{}:e)||this;if(r.DEFAULT_ALPHA=1,null==e&&(e={}),null!=e.alpha&&e.alpha!==r.DEFAULT_ALPHA)throw new uv("Non-default alpha value ("+e.alpha+") is not supported by the ELU layer yet.");return r.alpha=null==e.alpha?r.DEFAULT_ALPHA:e.alpha,r}return Qg(e,t),e.prototype.call=function(t,e){var r=Kb(t);return $p(r)},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var e={alpha:this.alpha},r=t.prototype.getConfig.call(this);return Object.assign(e,r),e},e.className="ELU",e}(iy);lf.registerClass(tw);var ew=function(t){function e(e){var r=t.call(this,null==e?{}:e)||this;return r.DEFAULT_THETA=1,null==e&&(e={}),r.theta=null==e.theta?r.DEFAULT_THETA:e.theta,r}return Qg(e,t),e.prototype.call=function(t,e){var r=Kb(t);return r.mul(ob(r.greater(this.theta),"float32"))},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var e={theta:this.theta},r=t.prototype.getConfig.call(this);return Object.assign(e,r),e},e.className="ThresholdedReLU",e}(iy);lf.registerClass(ew);var rw=function(t){function e(e){var r=t.call(this,null==e?{}:e)||this;return r.DEFAULT_AXIS=1,null==e&&(e={}),r.softmax=(new Bx).apply,r.axis=null==e.axis?r.DEFAULT_AXIS:e.axis,r}return Qg(e,t),e.prototype.call=function(t,e){var r=Kb(t);return this.softmax(r,this.axis)},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var e={axis:this.axis},r=t.prototype.getConfig.call(this);return Object.assign(e,r),e},e.className="Softmax",e}(iy);function nw(t,e,r){if("number"==typeof t)return cv(t,e);if(t.length!==e)throw new sv("The "+r+" argument must be an integer or tuple of "+e+" integers. Received: "+t.length+" elements.");for(var n=0;n<e;++n){var o=t[n];if(!Zv(o))throw new sv("The "+r+" argument must be an integer or tuple of "+e+" integers. Received: "+JSON.stringify(t)+" including a non-integer number "+o)}return t}function ow(t,e,r,n,o){return void 0===o&&(o=1),null==t?t:(a="same"===r?t:t-(e+(e-1)*(o-1))+1,Math.floor((a+n-1)/n));var a}function aw(t,e,r,n){if(null==t)return null;if("valid"===n)t=t*e+rb([r-e,0]);else{if("same"!==n)throw new sv("Unsupport padding mode: "+n+".");t*=e}return t}function iw(t,e){return Zn(function(){return Wv(e),"channelsFirst"===e?Qp(t,[0,2,3,1]):t})}function sw(t,e){return Zn(function(){return Wv(e),"channelsFirst"===e?Qp(t,[0,2,3,4,1]):t})}function uw(t,e,r,n,o,a,i,s){return void 0===n&&(n=[1,1]),void 0===o&&(o="valid"),void 0===s&&(s=null),Zn(function(){if(null==a&&(a="channelsLast"),Wv(a),3!==t.rank&&4!==t.rank)throw new sv("conv2dWithBiasActivation expects input to be of rank 3 or 4, but received "+t.rank+".");if(3!==e.rank&&4!==e.rank)throw new sv("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received "+t.rank+".");var u=iw(t,a);if("causal"===o)throw new uv("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return u=Zd.conv2d({x:u,filter:e,strides:n,pad:"same"===o?"same":"valid",dilations:i,dataFormat:"NHWC",bias:r,activation:s}),"channelsFirst"===a&&(u=Qp(u,[0,3,1,2])),u})}lf.registerClass(rw);var lw=function(t){function e(r,n){var o=t.call(this,n)||this;if(o.bias=null,o.DEFAULT_KERNEL_INITIALIZER="glorotNormal",o.DEFAULT_BIAS_INITIALIZER="zeros",e.verifyArgs(n),o.rank=r,Ev(o.rank,"rank"),1!==o.rank&&2!==o.rank&&3!==o.rank)throw new uv("Convolution layer for rank other than 1, 2, or 3 ("+o.rank+") is not implemented yet.");if(o.kernelSize=nw(n.kernelSize,r,"kernelSize"),o.strides=nw(null==n.strides?1:n.strides,r,"strides"),o.padding=null==n.padding?"valid":n.padding,Uv(o.padding),o.dataFormat=null==n.dataFormat?"channelsLast":n.dataFormat,Wv(o.dataFormat),o.activation=Ux(n.activation),o.useBias=null==n.useBias||n.useBias,o.biasInitializer=Vb(n.biasInitializer||o.DEFAULT_BIAS_INITIALIZER),o.biasConstraint=Mv(n.biasConstraint),o.biasRegularizer=Yx(n.biasRegularizer),o.activityRegularizer=Yx(n.activityRegularizer),o.dilationRate=nw(null==n.dilationRate?1:n.dilationRate,r,"dilationRate"),1===o.rank&&Array.isArray(o.dilationRate)&&1!==o.dilationRate.length)throw new sv("dilationRate must be a number or an array of a single number for 1D convolution, but received "+JSON.stringify(o.dilationRate));if(2===o.rank){if("number"==typeof o.dilationRate)o.dilationRate=[o.dilationRate,o.dilationRate];else if(2!==o.dilationRate.length)throw new sv("dilationRate must be a number or array of two numbers for 2D convolution, but received "+JSON.stringify(o.dilationRate))}else if(3===o.rank)if("number"==typeof o.dilationRate)o.dilationRate=[o.dilationRate,o.dilationRate,o.dilationRate];else if(3!==o.dilationRate.length)throw new sv("dilationRate must be a number or array of three numbers for 3D convolution, but received "+JSON.stringify(o.dilationRate));return o}return Qg(e,t),e.verifyArgs=function(t){if(pv("kernelSize"in t,"required key 'kernelSize' not in config"),"number"!=typeof t.kernelSize&&!Sv(t.kernelSize,"number",1,3))throw new sv("BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received "+JSON.stringify(t.kernelSize)+".")},e.prototype.getConfig=function(){var e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Vx(this.activation),useBias:this.useBias,biasInitializer:qb(this.biasInitializer),biasRegularizer:Kx(this.biasRegularizer),activityRegularizer:Kx(this.activityRegularizer),biasConstraint:Ov(this.biasConstraint)},r=t.prototype.getConfig.call(this);return Object.assign(e,r),e},e}(iy),cw=function(t){function e(r,n){var o=t.call(this,r,n)||this;return o.kernel=null,e.verifyArgs(n),o.filters=n.filters,Ev(o.filters,"filters"),o.kernelInitializer=Vb(n.kernelInitializer||o.DEFAULT_KERNEL_INITIALIZER),o.kernelConstraint=Mv(n.kernelConstraint),o.kernelRegularizer=Yx(n.kernelRegularizer),o}return Qg(e,t),e.prototype.build=function(t){var e;t=Xb(t);var r="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[r])throw new sv("The channel dimension of the input should be defined. Found "+t[r]);var n=t[r],o=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:(e={},e[r]=n,e)}],this.built=!0},e.prototype.call=function(t,e){var r=this;return Zn(function(){var e;t=Kb(t);var n=null==r.bias?null:r.bias.read(),o=zv(r.activation.getClassName());if(null!=o&&2===r.rank)e=uw(t,r.kernel.read(),n,r.strides,r.padding,r.dataFormat,r.dilationRate,o);else{if(1===r.rank)e=function(t,e,r,n,o,a,i){return void 0===n&&(n=1),void 0===o&&(o="valid"),void 0===i&&(i=1),Zn(function(){if(null==a&&(a="channelsLast"),Wv(a),3!==t.shape.length)throw new sv("The input of a conv1dWithBias operation should be 3, but is "+t.shape.length+" instead.");if(3!==e.shape.length)throw new sv("The kernel for a conv1dWithBias operation should be 3, but is "+e.shape.length+" instead");if(null!=r&&1!==r.shape.length)throw new sv("The bias for a conv1dWithBias operation should be 1, but is "+e.shape.length+" instead");if("channelsFirst"===a&&(t=Qp(t,[0,2,1])),"causal"===o)throw new uv("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var s=op(t,e,n,"same"===o?"same":"valid","NWC",i);return null!=r&&(s=vb(s,r)),s})}(t,r.kernel.read(),n,r.strides[0],r.padding,r.dataFormat,r.dilationRate[0]);else if(2===r.rank)e=uw(t,r.kernel.read(),n,r.strides,r.padding,r.dataFormat,r.dilationRate);else{if(3!==r.rank)throw new uv("convolutions greater than 3D are not implemented yet.");e=function(t,e,r,n,o,a,i){return void 0===n&&(n=[1,1,1]),void 0===o&&(o="valid"),Zn(function(){if(null==a&&(a="channelsLast"),Wv(a),4!==t.rank&&5!==t.rank)throw new sv("conv3dWithBias expects input to be of rank 4 or 5, but received "+t.rank+".");if(4!==e.rank&&5!==e.rank)throw new sv("conv3dWithBias expects kernel to be of rank 4 or 5, but received "+t.rank+".");var s=sw(t,a);if("causal"===o)throw new uv("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return s=ip(s,e,n,"same"===o?"same":"valid","NDHWC",i),null!=r&&(s=vb(s,r)),"channelsFirst"===a&&(s=Qp(s,[0,4,1,2,3])),s})}(t,r.kernel.read(),n,r.strides,r.padding,r.dataFormat,r.dilationRate)}null!=r.activation&&(e=r.activation.apply(e))}return e})},e.prototype.computeOutputShape=function(t){t=Xb(t);for(var e=[],r="channelsLast"===this.dataFormat?t.slice(1,t.length-1):t.slice(2),n=0;n<r.length;++n){var o=ow(r[n],this.kernelSize[n],this.padding,this.strides[n],"number"==typeof this.dilationRate?this.dilationRate:this.dilationRate[n]);e.push(o)}var a=[t[0]];return"channelsLast"===this.dataFormat?(a=a.concat(e)).push(this.filters):(a.push(this.filters),a=a.concat(e)),a},e.prototype.getConfig=function(){var e={filters:this.filters,kernelInitializer:qb(this.kernelInitializer),kernelRegularizer:Kx(this.kernelRegularizer),kernelConstraint:Ov(this.kernelConstraint)},r=t.prototype.getConfig.call(this);return Object.assign(e,r),e},e.verifyArgs=function(t){if(!("filters"in t)||"number"!=typeof t.filters||t.filters<1)throw new sv("Convolution layer expected config.filters to be a 'number' > 0 but got "+JSON.stringify(t.filters))},e}(lw),pw=function(t){function e(r){var n=t.call(this,2,r)||this;return e.verifyArgs(r),n}return Qg(e,t),e.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this);return delete e.rank,e},e.verifyArgs=function(t){if("number"!=typeof t.kernelSize&&!Sv(t.kernelSize,"number",1,2))throw new sv("Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received "+JSON.stringify(t.kernelSize)+".")},e.className="Conv2D",e}(cw);lf.registerClass(pw);var dw=function(t){function e(r){var n=t.call(this,3,r)||this;return e.verifyArgs(r),n}return Qg(e,t),e.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this);return delete e.rank,e},e.verifyArgs=function(t){if("number"!=typeof t.kernelSize&&(!Array.isArray(t.kernelSize)||1!==t.kernelSize.length&&3!==t.kernelSize.length))throw new sv("Conv3D expects config.kernelSize to be number or [number, number, number], but received "+JSON.stringify(t.kernelSize)+".")},e.className="Conv3D",e}(cw);lf.registerClass(dw);var hw=function(t){function e(e){var r=t.call(this,e)||this;if(r.inputSpec=[new ey({ndim:4})],"same"!==r.padding&&"valid"!==r.padding)throw new sv("Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode "+r.padding);return r}return Qg(e,t),e.prototype.build=function(t){var e;if(4!==(t=Xb(t)).length)throw new sv("Input should have rank 4; Received input shape: "+JSON.stringify(t));var r="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[r])throw new sv("The channel dimension of the inputs should be defined. Found `None`.");var n=t[r],o=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",o,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new ey({ndim:4,axes:(e={},e[r]=n,e)})],this.built=!0},e.prototype.call=function(t,e){var r=this;return Zn(function(){var e=Kb(t);if(4!==e.shape.length)throw new sv("Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-"+e.shape.length);var n,o,a=e.shape,i=a[0];"channelsFirst"===r.dataFormat?(n=2,o=3):(n=1,o=2);var s=a[n],u=a[o],l=r.kernelSize[0],c=r.kernelSize[1],p=r.strides[0],d=r.strides[1],h=[i,aw(s,p,l,r.padding),aw(u,d,c,r.padding),r.filters];"channelsLast"!==r.dataFormat&&(e=Qp(e,[0,2,3,1]));var f=hp(e,r.kernel.read(),h,r.strides,r.padding);return"channelsLast"!==r.dataFormat&&(f=Qp(f,[0,3,1,2])),null!=r.bias&&(f=vb(f,r.bias.read(),r.dataFormat)),null!=r.activation&&(f=r.activation.apply(f)),f})},e.prototype.computeOutputShape=function(t){var e,r,n,o=(t=Xb(t)).slice();"channelsFirst"===this.dataFormat?(e=1,r=2,n=3):(e=3,r=1,n=2);var a=this.kernelSize[0],i=this.kernelSize[1],s=this.strides[0],u=this.strides[1];return o[e]=this.filters,o[r]=aw(o[r],s,a,this.padding),o[n]=aw(o[n],u,i,this.padding),o},e.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this);return delete e.dilationRate,e},e.className="Conv2DTranspose",e}(pw);lf.registerClass(hw);var fw=function(t){function e(e){return t.call(this,2,e)||this}return Qg(e,t),e.className="SeparableConv2D",e}(function(t){function e(e,r){var n=t.call(this,e,r)||this;if(n.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",n.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",n.depthwiseKernel=null,n.pointwiseKernel=null,null==r.filters)throw new sv("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=r.kernelInitializer||null!=r.kernelRegularizer||null!=r.kernelConstraint)throw new sv("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=r.padding&&"same"!==r.padding&&"valid"!==r.padding)throw new sv("SeparableConv"+n.rank+"D supports only padding modes: 'same' and 'valid', but received "+JSON.stringify(r.padding));return n.depthMultiplier=null==r.depthMultiplier?1:r.depthMultiplier,n.depthwiseInitializer=Vb(r.depthwiseInitializer||n.DEFAULT_DEPTHWISE_INITIALIZER),n.depthwiseRegularizer=Yx(r.depthwiseRegularizer),n.depthwiseConstraint=Mv(r.depthwiseConstraint),n.pointwiseInitializer=Vb(r.depthwiseInitializer||n.DEFAULT_POINTWISE_INITIALIZER),n.pointwiseRegularizer=Yx(r.pointwiseRegularizer),n.pointwiseConstraint=Mv(r.pointwiseConstraint),n}return Qg(e,t),e.prototype.build=function(t){var e;if((t=Xb(t)).length<this.rank+2)throw new sv("Inputs to SeparableConv"+this.rank+"D should have rank "+(this.rank+2)+", but received input shape: "+JSON.stringify(t));var r="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[r]||t[r]<0)throw new sv("The channel dimension of the inputs should be defined, but found "+JSON.stringify(t[r]));for(var n=t[r],o=this.kernelSize.concat([n,this.depthMultiplier]),a=[],i=0;i<this.rank;++i)a.push(1);a.push(n*this.depthMultiplier,this.filters),this.depthwiseKernel=this.addWeight("depthwise_kernel",o,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",a,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,!0,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.inputSpec=[new ey({ndim:this.rank+2,axes:(e={},e[r]=n,e)})],this.built=!0},e.prototype.call=function(t,e){var r=this;return Zn(function(){var e;if(t=Kb(t),1===r.rank)throw new uv("1D separable convolution is not implemented yet.");return 2===r.rank&&("channelsFirst"===r.dataFormat&&(t=Qp(t,[0,2,3,1])),e=dp(t,r.depthwiseKernel.read(),r.pointwiseKernel.read(),r.strides,r.padding,r.dilationRate,"NHWC")),r.useBias&&(e=vb(e,r.bias.read(),r.dataFormat)),null!=r.activation&&(e=r.activation.apply(e)),"channelsFirst"===r.dataFormat&&(e=Qp(e,[0,3,1,2])),e})},e.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this);return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=qb(this.depthwiseInitializer),e.pointwiseInitializer=qb(this.pointwiseInitializer),e.depthwiseRegularizer=Kx(this.depthwiseRegularizer),e.pointwiseRegularizer=Kx(this.pointwiseRegularizer),e.depthwiseConstraint=Ov(this.depthwiseConstraint),e.pointwiseConstraint=Ov(this.pointwiseConstraint),e},e.className="SeparableConv",e}(cw));lf.registerClass(fw);var mw=function(t){function e(r){var n=t.call(this,1,r)||this;return e.verifyArgs(r),n.inputSpec=[{ndim:3}],n}return Qg(e,t),e.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this);return delete e.rank,delete e.dataFormat,e},e.verifyArgs=function(t){if("number"!=typeof t.kernelSize&&!Sv(t.kernelSize,"number",1,1))throw new sv("Conv1D expects config.kernelSize to be number or number[] with length 1, but received "+JSON.stringify(t.kernelSize)+".")},e.className="Conv1D",e}(cw);lf.registerClass(mw);var gw=function(t){function e(e){var r=t.call(this,e)||this;return"number"==typeof e.cropping?r.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:"number"==typeof e.cropping[0]?r.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:r.cropping=e.cropping,r.dataFormat=void 0===e.dataFormat?"channelsLast":e.dataFormat,r.inputSpec=[{ndim:4}],r}return Qg(e,t),e.prototype.computeOutputShape=function(t){return"channelsFirst"===this.dataFormat?[t[0],t[1],t[2]-this.cropping[0][0]-this.cropping[0][1],t[3]-this.cropping[1][0]-this.cropping[1][1]]:[t[0],t[1]-this.cropping[0][0]-this.cropping[0][1],t[2]-this.cropping[1][0]-this.cropping[1][1],t[3]]},e.prototype.call=function(t,e){var r=this;return Zn(function(){return t=Kb(t),"channelsLast"===r.dataFormat?ub(ub(t,r.cropping[0][0],t.shape[1]-r.cropping[0][0]-r.cropping[0][1],2),r.cropping[1][0],t.shape[2]-r.cropping[1][1]-r.cropping[1][0],3):ub(ub(t,r.cropping[0][0],t.shape[2]-r.cropping[0][0]-r.cropping[0][1],3),r.cropping[1][0],t.shape[3]-r.cropping[1][1]-r.cropping[1][0],4)})},e.prototype.getConfig=function(){var e={cropping:this.cropping,dataFormat:this.dataFormat},r=t.prototype.getConfig.call(this);return Object.assign(e,r),e},e.className="Cropping2D",e}(iy);lf.registerClass(gw);var vw=function(t){function e(e){var r=t.call(this,e)||this;return r.DEFAULT_SIZE=[2,2],r.inputSpec=[{ndim:4}],r.size=null==e.size?r.DEFAULT_SIZE:e.size,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,r}return Qg(e,t),e.prototype.computeOutputShape=function(t){if("channelsFirst"===this.dataFormat){var e=null==t[2]?null:this.size[0]*t[2],r=null==t[3]?null:this.size[1]*t[3];return[t[0],t[1],e,r]}return e=null==t[1]?null:this.size[0]*t[1],r=null==t[2]?null:this.size[1]*t[2],[t[0],e,r,t[3]]},e.prototype.call=function(t,e){var r=this;return Zn(function(){var e=Kb(t),n=e.shape;if("channelsFirst"===r.dataFormat){e=Qp(e,[0,2,3,1]);var o=r.size[0]*n[2],a=r.size[1]*n[3],i=e.resizeNearestNeighbor([o,a]);return Qp(i,[0,3,1,2])}return o=r.size[0]*n[1],a=r.size[1]*n[2],e.resizeNearestNeighbor([o,a])})},e.prototype.getConfig=function(){var e={size:this.size,dataFormat:this.dataFormat},r=t.prototype.getConfig.call(this);return Object.assign(e,r),e},e.className="UpSampling2D",e}(iy);lf.registerClass(vw);var bw=function(t){function e(e){var r=t.call(this,2,e)||this;return r.depthwiseKernel=null,r.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,r.depthwiseInitializer=Vb(e.depthwiseInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.depthwiseConstraint=Mv(e.depthwiseConstraint),r.depthwiseRegularizer=Yx(e.depthwiseRegularizer),r}return Qg(e,t),e.prototype.build=function(t){if((t=Xb(t)).length<4)throw new sv("Inputs to DepthwiseConv2D should have rank 4. Received input shape: "+JSON.stringify(t)+".");var e="channelsFirst"===this.dataFormat?1:3;if(null==t[e]||t[e]<0)throw new sv("The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not ("+t[e]+").");var r=t[e],n=[this.kernelSize[0],this.kernelSize[1],r,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",n,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[r*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},e.prototype.call=function(t,e){var r=this;return Zn(function(){var e=function(t,e,r,n,o,a){return void 0===r&&(r=[1,1]),void 0===n&&(n="valid"),Zn(function(){null==o&&(o="channelsLast"),Wv(o);var i=iw(t,o);if(4!==t.rank)throw new sv("Input for depthwiseConv2d is required to be 4-D, but is instead "+t.rank+"-D");if(4!==e.rank)throw new sv("depthwiseKernel is required to be 4-D, but is instead "+e.rank+"-D");return i=lp(i,e,r,"same"===n?"same":"valid","NHWC",a),"channelsFirst"===o&&(i=Qp(i,[0,3,1,2])),i})}(t=Kb(t),r.depthwiseKernel.read(),r.strides,r.padding,r.dataFormat,null);return r.useBias&&(e=vb(e,r.bias.read(),r.dataFormat)),null!=r.activation&&(e=r.activation.apply(e)),e})},e.prototype.computeOutputShape=function(t){t=Xb(t);var e="channelsFirst"===this.dataFormat?t[2]:t[1],r="channelsFirst"===this.dataFormat?t[3]:t[2],n="channelsFirst"===this.dataFormat?t[1]*this.depthMultiplier:t[3]*this.depthMultiplier,o=ow(e,this.kernelSize[0],this.padding,this.strides[0]),a=ow(r,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[t[0],n,o,a]:[t[0],o,a,n]},e.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this);return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=qb(this.depthwiseInitializer),e.depthwiseRegularizer=Kx(this.depthwiseRegularizer),e.depthwiseConstraint=Ov(this.depthwiseRegularizer),e},e.className="DepthwiseConv2D",e}(lw);lf.registerClass(bw);var yw=function(t){function e(e){var r=t.call(this,e)||this;return r.rate=Math.max(Math.min(e.rate,1),0),r.noiseShape=e.noiseShape,r.seed=e.seed,r.supportsMasking=!0,r}return Qg(e,t),e.prototype.getNoiseShape=function(t){if(null==this.noiseShape)return this.noiseShape;for(var e=t.shape,r=[],n=0;n<this.noiseShape.length;++n)r.push(null==this.noiseShape[n]?e[n]:this.noiseShape[n]);return r},e.prototype.call=function(t,e){var r=this;return Zn(function(){r.invokeCallHook(t,e);var n=Kb(t);if(0<r.rate&&r.rate<1){var o=null!=e.training&&e.training,a=r.getNoiseShape(n);return yb(function(){return bb(n,r.rate,a,r.seed)},function(){return n},o)}return t})},e.prototype.getConfig=function(){var e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},r=t.prototype.getConfig.call(this);return Object.assign(e,r),e},e.prototype.dispose=function(){return t.prototype.dispose.call(this)},e.className="Dropout",e}(iy);lf.registerClass(yw);var xw=function(t){function e(e){var r=t.call(this,e)||this;return r.inputSpec=[{ndim:3}],r}return Qg(e,t),e.prototype.getNoiseShape=function(t){var e=t.shape;return[e[0],1,e[2]]},e.className="SpatialDropout1D",e}(yw);lf.registerClass(xw);var ww=function(t){function e(e){var r=t.call(this,e)||this;if(r.activation=null,r.useBias=!0,r.kernel=null,r.bias=null,r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_BIAS_INITIALIZER="zeros",null==e.batchInputShape&&null==e.inputShape&&null!=e.inputDim){var n=null;null!=e.batchSize&&(n=e.batchSize),r.batchInputShape=[n,e.inputDim]}return r.units=e.units,Ev(r.units,"units"),r.activation=Ux(e.activation),null!=e.useBias&&(r.useBias=e.useBias),r.kernelInitializer=Vb(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.biasInitializer=Vb(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelConstraint=Mv(e.kernelConstraint),r.biasConstraint=Mv(e.biasConstraint),r.kernelRegularizer=Yx(e.kernelRegularizer),r.biasRegularizer=Yx(e.biasRegularizer),r.activityRegularizer=Yx(e.activityRegularizer),r.supportsMasking=!0,r.inputSpec=[{minNDim:2}],r}return Qg(e,t),e.prototype.build=function(t){var e,r=(t=Xb(t))[t.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[r,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:(e={},e[-1]=r,e)}],this.built=!0},e.prototype.computeOutputShape=function(t){var e=(t=Xb(t)).slice();return e[e.length-1]=this.units,e},e.prototype.call=function(t,e){var r=this;return Zn(function(){r.invokeCallHook(t,e);var n,o=Kb(t),a=zv(r.activation.getClassName());return null!=a?n=hb(o,r.kernel.read(),a,r.bias?r.bias.read():null):(n=hb(o,r.kernel.read()),null!=r.bias&&(n=vb(n,r.bias.read())),null!=r.activation&&(n=r.activation.apply(n))),n})},e.prototype.getConfig=function(){var e={units:this.units,activation:Vx(this.activation),useBias:this.useBias,kernelInitializer:qb(this.kernelInitializer),biasInitializer:qb(this.biasInitializer),kernelRegularizer:Kx(this.kernelRegularizer),biasRegularizer:Kx(this.biasRegularizer),activityRegularizer:Kx(this.activityRegularizer),kernelConstraint:Ov(this.kernelConstraint),biasConstraint:Ov(this.biasConstraint)},r=t.prototype.getConfig.call(this);return Object.assign(e,r),e},e.className="Dense",e}(iy);lf.registerClass(ww);var kw=function(t){function e(e){var r=this;return e=e||{},(r=t.call(this,e)||this).inputSpec=[{minNDim:3}],r.dataFormat=e.dataFormat,r}return Qg(e,t),e.prototype.computeOutputShape=function(t){for(var e=0,r=(t=Xb(t)).slice(1);e<r.length;e++)if(null==r[e])throw new sv('The shape of the input to "Flatten" is not fully defined (got '+t.slice(1)+'). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.');return[t[0],Qv(t,1)]},e.prototype.call=function(t,e){var r=this;return Zn(function(){r.invokeCallHook(t,e);var n=Kb(t);if("channelsFirst"===r.dataFormat&&n.rank>1){for(var o=[0],a=2;a<n.rank;++a)o.push(a);o.push(1),n=n.transpose(o)}return function(t){if(t.rank<=1)throw new sv("batchFlatten requires a minimum rank of 2. Got rank: "+t.rank+".");var e=[t.shape[0],Qv(t.shape,1)];return t.reshape(e)}(n)})},e.prototype.getConfig=function(){var e={};null!=this.dataFormat&&(e.dataFormat=this.dataFormat);var r=t.prototype.getConfig.call(this);return Object.assign(e,r),e},e.className="Flatten",e}(iy);lf.registerClass(kw);var Cw=function(t){function e(e){var r=t.call(this,e)||this;return r.supportsMasking=!0,r.activation=Ux(e.activation),r}return Qg(e,t),e.prototype.call=function(t,e){var r=this;return Zn(function(){r.invokeCallHook(t,e);var n=Kb(t);return r.activation.apply(n)})},e.prototype.getConfig=function(){var e={activation:Vx(this.activation)},r=t.prototype.getConfig.call(this);return Object.assign(e,r),e},e.className="Activation",e}(iy);lf.registerClass(Cw);var Sw=function(t){function e(e){var r=t.call(this,e)||this;return r.n=e.n,r.inputSpec=[{ndim:2}],r}return Qg(e,t),e.prototype.computeOutputShape=function(t){return[t[0],this.n,t[1]]},e.prototype.call=function(t,e){var r=this;return Zn(function(){return function(t,e){return Zn(function(){if(2!==t.shape.length)throw new sv("repeat() expects a rank-2 tensor, but received a rank-"+t.shape.length+" tensor.");return pb(ab(t,1),[1,e,1])})}(t=Kb(t),r.n)})},e.prototype.getConfig=function(){var e={n:this.n},r=t.prototype.getConfig.call(this);return Object.assign(e,r),e},e.className="RepeatVector",e}(iy);lf.registerClass(Sw);var Ew=function(t){function e(e){var r=t.call(this,e)||this;r.targetShape=e.targetShape;for(var n=0;n<r.targetShape.length;++n)r.isUnknown(r.targetShape[n])&&(r.targetShape[n]=null);return r}return Qg(e,t),e.prototype.isUnknown=function(t){return t<0||null==t},e.prototype.fixUnknownDimension=function(t,e){for(var r="Total size of new array must be unchanged.",n=e.slice(),o=1,a=null,i=0;i<n.length;++i){var s=n[i];if(this.isUnknown(s)){if(null!==a)throw new sv("Can only specifiy one unknown dimension.");a=i}else o*=s}var u=Qv(t);if(null!==a){if(0===o||u%o!=0)throw new sv(r);n[a]=u/o}else if(u!==o)throw new sv(r);return n},e.prototype.computeOutputShape=function(t){for(var e=!1,r=0;r<t.length;++r)if(this.isUnknown(t[r])){e=!0;break}return e?t.slice(0,1).concat(this.targetShape):t.slice(0,1).concat(this.fixUnknownDimension(t.slice(1),this.targetShape))},e.prototype.call=function(t,e){var r=this;return Zn(function(){r.invokeCallHook(t,e);var n=Kb(t),o=n.shape,a=o.slice(0,1).concat(r.fixUnknownDimension(o.slice(1),r.targetShape));return n.reshape(a)})},e.prototype.getConfig=function(){var e={targetShape:this.targetShape},r=t.prototype.getConfig.call(this);return Object.assign(e,r),e},e.className="Reshape",e}(iy);lf.registerClass(Ew);var zw=function(t){function e(e){var r=t.call(this,e)||this;if(null==e.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+e.dims+" instead.");var n=nb(1,e.dims.length+1);if(!cr.arraysEqual(e.dims.slice().sort(),n))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");return r.dims=e.dims,r.dimsIncludingBatch=[0].concat(r.dims),r.inputSpec=[new ey({ndim:r.dims.length+1})],r}return Qg(e,t),e.prototype.computeOutputShape=function(t){var e=(t=Xb(t)).slice();return this.dims.forEach(function(r,n){e[n+1]=t[r]}),e},e.prototype.call=function(t,e){return Qp(Kb(t),this.dimsIncludingBatch)},e.prototype.getConfig=function(){var e={dims:this.dims},r=t.prototype.getConfig.call(this);return Object.assign(e,r),e},e.className="Permute",e}(iy);lf.registerClass(zw);var Iw=function(t){function e(e){var r=t.call(this,null==e?{}:e)||this;return r.supportsMasking=!0,r.maskValue=null!=e?null==e.maskValue?0:e.maskValue:0,r}return Qg(e,t),e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this),r={maskValue:this.maskValue};return Object.assign(r,e),r},e.prototype.computeMask=function(t,e){var r=Kb(t);return Lp(Kc(r,this.maskValue),-1)},e.prototype.call=function(t,e){var r=this;return Zn(function(){r.invokeCallHook(t,e);var n=Kb(t),o=Lp(Kc(n,r.maskValue),-1,!0);return n.mul(o.asType(n.dtype))})},e.className="Masking",e}(iy);lf.registerClass(Iw);var Aw=function(t){function e(e){var r=t.call(this,e)||this;if(r.embeddings=null,r.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==e.batchInputShape&&null==e.inputShape){var n=null;null!=e.batchSize&&(n=e.batchSize),null==e.inputLength?r.batchInputShape=[n,null]:r.batchInputShape=[n].concat(fv(e.inputLength))}return r.inputDim=e.inputDim,Ev(r.inputDim,"inputDim"),r.outputDim=e.outputDim,Ev(r.outputDim,"outputDim"),r.embeddingsInitializer=Vb(e.embeddingsInitializer||r.DEFAULT_EMBEDDINGS_INITIALIZER),r.embeddingsRegularizer=Yx(e.embeddingsRegularizer),r.activityRegularizer=Yx(e.activityRegularizer),r.embeddingsConstraint=Mv(e.embeddingsConstraint),r.maskZero=e.maskZero,r.supportsMasking=e.maskZero,r.inputLength=e.inputLength,r}return Qg(e,t),e.prototype.build=function(t){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0},e.prototype.warnOnIncompatibleInputShape=function(t){},e.prototype.computeMask=function(t,e){var r=this;return Zn(function(){return r.maskZero?(t=Kb(t),Kc(t,Po(t))):null})},e.prototype.computeOutputShape=function(t){if(t=Xb(t),null==this.inputLength)return t.concat([this.outputDim]);var e=fv(this.inputLength);if(e.length!==t.length-1)throw new sv('"inputLength" is '+this.inputLength+", but received input shape has shape "+t);for(var r=0,n=0;n<e.length;++n){var o=e[n],a=t[n+1];if(null!=o&&null!=a&&o!==a)throw new sv('"inputLength" is '+this.inputLength+", but received input shape has shape "+t);null==o&&(e[r]=a),r++}return[t[0]].concat(e,[this.outputDim])},e.prototype.call=function(t,e){var r=this;return Zn(function(){r.invokeCallHook(t,e);var n=Kb(t);return"int32"!==n.dtype&&(n=ob(n,"int32")),fb(r.embeddings.read(),n.as1D()).reshape(Xb(r.computeOutputShape(n.shape)))})},e.prototype.getConfig=function(){var e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:qb(this.embeddingsInitializer),embeddingsRegularizer:Kx(this.embeddingsRegularizer),activityRegularizer:Kx(this.activityRegularizer),embeddingsConstraint:Ov(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},r=t.prototype.getConfig.call(this);return Object.assign(e,r),e},e.className="Embedding",e}(iy);lf.registerClass(Aw);var Nw=function(t){function e(e){var r=t.call(this,e||{})||this;return r.supportsMasking=!0,r}return Qg(e,t),e.prototype.mergeFunction=function(t){throw new uv},e.prototype.computeElementwiseOpOutputShape=function(t,e){if(null==t||null==e)return null;if(t.length<e.length)return this.computeElementwiseOpOutputShape(e,t);if(0===e.length)return t;for(var r=t.slice(0,t.length-e.length),n=0;n<e.length;++n){var o=t[t.length-e.length+n],a=e[n];if(null==o||null==a||o<0||a<0)r.push(null);else if(1===o)r.push(a);else if(1===a)r.push(o);else{if(o!==a)throw new sv("Operands could not be broadcast together with shapes "+JSON.stringify(t)+" "+JSON.stringify(e));r.push(o)}}return r},e.prototype.build=function(t){if(Array.isArray(t)&&!Array.isArray(t[0])&&(t=[Xb(t)]),(t=t).length<2)throw new sv("A merge layer should be called on an Array of at least 2 inputs. Got "+t.length+" input(s).");for(var e=[],r=0,n=t;r<n.length;r++)null!=(i=n[r])&&null!==i[0]&&e.push(i[0]);if((e=wv(e)).length>1)throw new sv("Can not merge tensors with different batch sizes. Got tensors with shapes: "+JSON.stringify(t)+".");for(var o=null==t[0]?null:t[0].slice(1),a=1;a<t.length;++a){var i=null==t[a]?null:t[a].slice(1);o=this.computeElementwiseOpOutputShape(o,i)}var s=t.map(function(t){return t.length});-1===t.indexOf(null)&&1===wv(s).length?this.reshapeRequired=!1:this.reshapeRequired=!0},e.prototype.call=function(t,e){var r=this;return Zn(function(){if(t=t,r.reshapeRequired){var e=[],n=t.map(function(t){return t.rank});if(-1===n.indexOf(null)){for(var o=rb(n),a=0,i=t;a<i.length;a++){for(var s=(d=i[a]).rank,u=0;u<o-s;++u)d=ab(d,1);e.push(d)}return r.mergeFunction(e)}for(var l=!1,c=0,p=t;c<p.length;c++){var d;if(null==(s=(d=p[c]).rank)){var h=d.shape,f=h[0],m=h.slice(1).concat([f]),g=d.reshape([f].concat(Qv(h.slice(1))));g=(g=Qp(g,[1,0])).reshape(m),e.push(g),l=!0}else if(s>1){var v=nb(1,s).concat([0]);e.push(Qp(d,v)),l=!0}else e.push(d)}var b=r.mergeFunction(e),y=b.rank;if(l)if(null==y){var x=b.shape;m=[f=x[x.length-1]].concat(x.slice(0,x.length-1)),b=Qp(b.reshape([-1,f]),[1,0]).reshape(m)}else y>1&&(v=[y-1].concat(nb(0,y-1)),b=Qp(b,v));return b}return r.mergeFunction(t)})},e.prototype.computeOutputShape=function(t){var e;e=null==(t=t)[0]?null:t[0].slice(1);for(var r=1;r<t.length;++r){var n=null==t[r]?null:t[r].slice(1);e=this.computeElementwiseOpOutputShape(e,n)}for(var o=[],a=0,i=t;a<i.length;a++)null!=(n=i[a])&&null!==n[0]&&o.push(n[0]);return 1===(o=wv(o)).length?o.concat(e):[null].concat(e)},e.prototype.computeMask=function(t,e){return Zn(function(){if(null==e)return null;if(!Array.isArray(e))throw new sv("`mask` should be an Array");if(!Array.isArray(t))throw new sv("`inputs` should be an Array");if(e.length!==t.length)throw new sv("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths ("+t.length+" vs "+e.length+")");if(e.every(function(t){return null==t}))return null;for(var r=(e=e.map(function(t){return null==t?t:ca(t,0)}))[0],n=1;n<e.length-1;++n)r=cc(r,e[n]);return r})},e}(iy),Rw=function(t){function e(e){return t.call(this,e)||this}return Qg(e,t),e.prototype.mergeFunction=function(t){return Zn(function(){for(var e=t[0].clone(),r=1;r<t.length;++r)e=gc(e,t[r]);return e})},e.className="Add",e}(Nw);lf.registerClass(Rw);var Tw=function(t){function e(e){return t.call(this,e)||this}return Qg(e,t),e.prototype.mergeFunction=function(t){return Zn(function(){for(var e=t[0].clone(),r=1;r<t.length;++r)e=Rc(e,t[r]);return e})},e.className="Multiply",e}(Nw);lf.registerClass(Tw);var Dw=function(t){function e(e){return t.call(this,e)||this}return Qg(e,t),e.prototype.mergeFunction=function(t){return Zn(function(){for(var e=t[0].clone(),r=1;r<t.length;++r)e=gc(e,t[r]);return Rc(1/t.length,e)})},e.className="Average",e}(Nw);lf.registerClass(Dw);var _w=function(t){function e(e){return t.call(this,e)||this}return Qg(e,t),e.prototype.mergeFunction=function(t){return Zn(function(){for(var e=t[0],r=1;r<t.length;++r)e=Sc(e,t[r]);return e})},e.className="Maximum",e}(Nw);lf.registerClass(_w);var Ow=function(t){function e(e){return t.call(this,e)||this}return Qg(e,t),e.prototype.mergeFunction=function(t){return Zn(function(){for(var e=t[0],r=1;r<t.length;++r)e=zc(e,t[r]);return e})},e.className="Minimum",e}(Nw);lf.registerClass(Ow);var Fw=function(t){function e(e){var r=t.call(this,e)||this;return r.DEFAULT_AXIS=-1,null==e&&(e={}),r.axis=null==e.axis?r.DEFAULT_AXIS:e.axis,r.supportsMasking=!0,r.reshapeRequired=!1,r}return Qg(e,t),e.prototype.build=function(t){if(!Array.isArray(t)||!Array.isArray(t[0])||1===t.length)throw new sv("A `Concatenate` layer should be called on a list of at least 2 inputs");for(var e=!0,r=0,n=t=t;r<n.length;r++)if(null!=(c=n[r])){e=!1;break}if(!e){for(var o=[],a=0;a<t.length;++a){var i=t[a].slice();i.splice(this.axis,1);for(var s=!1,u=0,l=o;u<l.length;u++){var c=l[u];if(cr.arraysEqual(c,i)){s=!0;break}}s||o.push(i)}if(o.length>1)throw new sv("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(t))}},e.prototype.mergeFunction=function(t){var e=this;return Zn(function(){return lb(t,e.axis)})},e.prototype.computeOutputShape=function(t){if(!Array.isArray(t)||!Array.isArray(t[0]))throw new sv("A `Concatenate` layer should be called on a list of inputs.");for(var e=t,r=e[0].slice(),n=this.axis<0?r.length+this.axis:this.axis,o=0,a=e.slice(1);o<a.length;o++){var i=a[o];if(null==r[n]||null==i[n]){r[n]=null;break}r[n]+=i[n]}return r},e.prototype.computeMask=function(t,e){var r=this;if(null==e)return null;if(!Array.isArray(e))throw new sv("`mask` should be an array for Concatenate");if(!Array.isArray(t))throw new sv("`inputs` should be an array for Concatenate");if(e.length!==t.length)throw new sv("Mismatch in the length of mask ("+e.length+") and the legnth of inputs ("+t.length+")");return Zn(function(){var n=!0;if(e.forEach(function(t){null==t||(n=!1)}),n)return null;for(var o=[],a=0;a<t.length;++a)null==e[a]?o.push(Lo(t[a]).asType("bool")):e[a].rank<t[a].rank?o.push(ca(e[a],-1)):o.push(e[a]);var i=Bo(o,r.axis);return Mp(i,-1,!1)})},e.prototype.getConfig=function(){var e={axis:this.axis},r=t.prototype.getConfig.call(this);return Object.assign(e,r),e},e.className="Concatenate",e}(Nw);function Mw(t,e){for(;t<0;)t+=e;return t}lf.registerClass(Fw);var Lw=function(t){function e(e){var r=t.call(this,e)||this;return r.axes=e.axes,r.normalize=null!=e.normalize&&e.normalize,r.supportsMasking=!0,r.reshapeRequired=!1,r}return Qg(e,t),e.prototype.build=function(t){cr.assert(Array.isArray(t)&&2===t.length&&Array.isArray(t[0])&&Array.isArray(t[1]),function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."});var e=t[0],r=t[1];if(e.length>3||r.length>3)throw new uv("Dot layer does not support tensors of 4D or higher rank yet.");var n=this.interpretAxes(e,r);if(e[n[0]]!==r[n[1]])throw new sv("Dimension incompatibility: "+e[n[0]]+" !== "+r[n[1]])},e.prototype.mergeFunction=function(t){if(2!==t.length)throw new sv("A `Dot` layer must be called on exactly 2 inputs, but received "+t.length+" input(s).");var e,r=t[0],n=t[1];return e=Array.isArray(this.axes)?this.axes.map(function(e,r){return Mw(e,t[r].shape.length)}):[Mw(this.axes,r.shape.length),Mw(this.axes,n.shape.length)],this.normalize&&(r=ky(r,e[0]),n=ky(n,e[1])),function(t,e,r){if(t.shape.length>3||e.shape.length>3)throw new uv("batchDot is not implemented for tensors of 4D or higher rank yet");if(cr.assert(t.shape.length>=2,function(){return"batchDot requires the rank of x to be >= 2, but got "+t.shape.length}),cr.assert(t.shape.length>=2,function(){return"batchDot requires the rank of y to be >= 2, but got "+e.shape.length}),"number"==typeof r&&(r=[r,r]),"complex64"===t.dtype||"complex64"===e.dtype)throw new uv("batchDot is not implemented for complex64-type Tensors yet.");var n=t.shape.length,o=e.shape.length;null==r&&(r=[n-1,o-2]);var a=r;return Zn(function(){var r,i;if(n>o){r=n-o;for(var s=[],u=0;u<r;++u)s.push(1);e=e.reshape(e.shape.concat(s))}else if(o>n){for(r=o-n,s=[],u=0;u<r;++u)s.push(1);t=t.reshape(t.shape.concat(s))}else r=0;if(2===t.shape.length&&2===e.shape.length)i=a[0]===a[1]?t.mulStrict(e).sum(a[0]):t.transpose([1,0]).mulStrict(e).sum(a[1]);else{var l=a[0]!==t.shape.length-1,c=a[1]===e.shape.length-1;i=t.matMul(e,l,c)}if(r>0){var p,d=[];for(u=p=n>o?n+o-3:n-1;u<p+r;++u)d.push(u);i=i.squeeze(d)}return 1===i.shape.length&&(i=i.expandDims(1)),i})}(r,n,e)},e.prototype.interpretAxes=function(t,e){return Array.isArray(this.axes)?this.axes:[Mw(this.axes,t.length),Mw(this.axes,e.length)]},e.prototype.computeOutputShape=function(t){cr.assert(Array.isArray(t)&&2===t.length&&Array.isArray(t[0])&&Array.isArray(t[1]),function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."});var e=t[0].slice(),r=t[1].slice();if(e.length>3||r.length>3)throw new uv("Dot layer does not support tensors of 4D or higher rank yet.");var n=this.interpretAxes(e,r);e.splice(n[0],1),r.splice(n[1],1),r.splice(0,1);var o=e.concat(r);return 1===o.length&&o.push(1),o},e.prototype.computeMask=function(t,e){return null},e.prototype.getConfig=function(){var e={axes:this.axes,normalize:this.normalize},r=t.prototype.getConfig.call(this);return Object.assign(e,r),e},e.className="Dot",e}(Nw);lf.registerClass(Lw);var Pw=function(t){function e(e){var r=t.call(this,e)||this;return r.supportsMasking=!0,r.stddev=e.stddev,r}return Qg(e,t),e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this),r={stddev:this.stddev};return Object.assign(r,e),r},e.prototype.call=function(t,e){var r=this;return Zn(function(){r.invokeCallHook(t,e);var n=Kb(t);return yb(function(){return db(n.shape,0,r.stddev).add(n)},function(){return n},e.training||!1)})},e.className="GaussianNoise",e}(iy);lf.registerClass(Pw);var Bw=function(t){function e(e){var r=t.call(this,e)||this;return r.supportsMasking=!0,r.rate=e.rate,r}return Qg(e,t),e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this),r={rate:this.rate};return Object.assign(r,e),r},e.prototype.call=function(t,e){var r=this;return Zn(function(){r.invokeCallHook(t,e);var n=Kb(t);return r.rate>0&&r.rate<1?yb(function(){var t=Math.sqrt(r.rate/(1-r.rate));return n.mul(db(n.shape,1,t))},function(){return n},e.training||!1):n})},e.className="GaussianDropout",e}(iy);lf.registerClass(Bw);var qw=function(t){function e(e){var r=t.call(this,e)||this;return r.supportsMasking=!0,r.rate=e.rate,r.noiseShape=e.noiseShape,r}return Qg(e,t),e.prototype._getNoiseShape=function(t){return this.noiseShape||Kb(t).shape},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this),r={rate:this.rate};return Object.assign(r,e),r},e.prototype.call=function(t,e){var r=this;return Zn(function(){if(r.rate<1&&r.rate>0){var n=r._getNoiseShape(t);return yb(function(){var e=Kb(t),o=-1.7580993408473766,a=Vc(ka(n),r.rate);a=ob(a,"float32");var i=Math.pow((1-r.rate)*(1+r.rate*Math.pow(o,2)),-.5),s=-i*o*r.rate;return e.mul(a).add(a.add(-1).mul(o)).mul(i).add(s)},function(){return Kb(t)},e.training||!1)}return t})},e.className="AlphaDropout",e}(iy);function Vw(t,e,r,n,o,a){var i;if(void 0===a&&(a=.001),2===t.rank)i=sc(t,e,r,n,o,a);else if(3===t.rank)i=uc(t,e,r,n,o,a);else{if(4!==t.rank)throw new uv("batchNormalization is not implemented for array of rank "+t.rank+" yet");i=lc(t,e,r,n,o,a)}return i}function Ww(t,e,r,n,o){return void 0===o&&(o=.001),cr.arraysEqual(n.slice().sort(),nb(0,t.rank-1))?function(t,e,r,n,o){return void 0===o&&(o=.001),Zn(function(){var a=jp(t,n),i=a.mean,s=a.variance;return[Vw(t,i,s,r,e,o),i,s]})}(t,e,r,n,o):function(t,e,r,n,o){return void 0===o&&(o=.001),Zn(function(){for(var a=jp(t,n),i=a.mean,s=a.variance,u=[],l=0,c=nb(0,t.rank);l<c.length;l++){var p=c[l];-1!==n.indexOf(p)?u.push(1):u.push(t.shape[p])}var d=i.reshape(u),h=s.reshape(u),f=null==e?null:e.reshape(u),m=null==r?null:r.reshape(u);return[Vw(t,d,h,m,f,o),i,s]})}(t,e,r,n,o)}lf.registerClass(qw);var Uw=function(t){function e(e){var r=this;return null==e&&(e={}),(r=t.call(this,e)||this).supportsMasking=!0,r.axis=null==e.axis?-1:e.axis,r.momentum=null==e.momentum?.99:e.momentum,r.epsilon=null==e.epsilon?.001:e.epsilon,r.center=null==e.center||e.center,r.scale=null==e.scale||e.scale,r.betaInitializer=Vb(e.betaInitializer||"zeros"),r.gammaInitializer=Vb(e.gammaInitializer||"ones"),r.movingMeanInitializer=Vb(e.movingMeanInitializer||"zeros"),r.movingVarianceInitializer=Vb(e.movingVarianceInitializer||"ones"),r.betaConstraint=Mv(e.betaConstraint),r.gammaConstraint=Mv(e.gammaConstraint),r.betaRegularizer=Yx(e.betaRegularizer),r.gammaRegularizer=Yx(e.gammaRegularizer),r}return Qg(e,t),e.prototype.build=function(t){var e;t=Xb(t);var r=this.axis>=0?this.axis:this.axis+t.length,n=t[r];if(null==n)throw new sv("Axis "+r+" of input tensor should have a defined dimension but the layer received an input with shape "+JSON.stringify(t)+".");this.inputSpec=[new ey({ndim:t.length,axes:(e={},e[r]=n,e)})];var o=[n];this.scale&&(this.gamma=this.addWeight("gamma",o,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",o,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",o,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",o,null,this.movingVarianceInitializer,null,!1),this.built=!0},e.prototype.call=function(t,e){var r=this;return Zn(function(){var n=null!=e.training&&e.training,o=Kb(t),a=o.shape,i=a.length,s=nb(0,i),u=r.axis>=0?r.axis:r.axis+i;s.splice(u,1);var l=cv(1,i);l[u]=a[u];var c=s.slice();c.sort();var p=!cr.arraysEqual(c,nb(0,i).slice(0,i-1));if(!n)return function(){if(p){var t=r.movingMean.read().reshape(l),e=r.movingVariance.read().reshape(l),n=r.center?r.beta.read().reshape(l):null,a=r.scale?r.gamma.read().reshape(l):null;return Vw(o,t,e,n,a,r.epsilon)}return Vw(o,r.movingMean.read(),r.movingVariance.read(),null==r.beta?null:r.beta.read(),null==r.gamma?null:r.gamma.read(),r.epsilon)}();var d=Ww(o,r.gamma.read(),r.beta.read(),s,r.epsilon),h=d[0],f=d[1],m=d[2],g=function(t,e,r){Zn(function(){var n=1-r,o=t.read(),a=o.sub(e).mul(n);t.write(o.sub(a))})};return g(r.movingMean,f,r.momentum),g(r.movingVariance,m,r.momentum),h})},e.prototype.getConfig=function(){var e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:qb(this.betaInitializer),gammaInitializer:qb(this.gammaInitializer),movingMeanInitializer:qb(this.movingMeanInitializer),movingVarianceInitializer:qb(this.movingVarianceInitializer),betaRegularizer:Kx(this.betaRegularizer),gammaRegularizer:Kx(this.gammaRegularizer),betaConstraint:Ov(this.betaConstraint),gammaConstraint:Ov(this.gammaConstraint)},r=t.prototype.getConfig.call(this);return Object.assign(e,r),e},e.className="BatchNormalization",e}(iy);lf.registerClass(Uw);var jw=function(t){function e(e){var r=this;if(null==e&&(e={}),(r=t.call(this,e)||this).axis=null==e.axis?-1:e.axis,"number"==typeof r.axis){if(!Number.isInteger(r.axis))throw new Error("Expected axis to be an integer, but received "+r.axis)}else{if(!Array.isArray(r.axis))throw new Error("Expected axis to be an integer or an array of integers, but received "+JSON.stringify(r.axis));for(var n=0,o=r.axis;n<o.length;n++){var a=o[n];if(!Number.isInteger(a))throw new Error("Expected axis to be an array of integers, but received "+JSON.stringify(r.axis))}}return r.epsilon=null==e.epsilon?.001:e.epsilon,r.center=null==e.center||e.center,r.scale=null==e.scale||e.scale,r.betaInitializer=Vb(e.betaInitializer||"zeros"),r.gammaInitializer=Vb(e.gammaInitializer||"ones"),r.betaRegularizer=Yx(e.betaRegularizer),r.gammaRegularizer=Yx(e.gammaRegularizer),r.supportsMasking=!0,r}return Qg(e,t),e.prototype.build=function(t){var e=(t=Xb(t)).length;"number"==typeof this.axis&&(this.axis=[this.axis]);for(var r=0;r<this.axis.length;++r)this.axis[r]<0&&(this.axis[r]+=e);for(var n=0,o=this.axis;n<o.length;n++){var a=o[n];if(a<0||a>=e)throw new Error("Invalid axis: "+a)}if(this.axis.length!==wv(this.axis).length)throw new Error("Found duplicate axes in: "+this.axis);var i=this.axis.map(function(e){return t[e]});this.scale?this.gamma=this.addWeight("gamma",i,"float32",this.gammaInitializer,this.gammaRegularizer,!0):this.gamma=null,this.center?this.beta=this.addWeight("beta",i,"float32",this.betaInitializer,this.betaRegularizer,!0):this.beta=null,this.built=!0},e.prototype.call=function(t,e){var r=this,n=Kb(t),o=n.shape,a=o.length;return Zn(function(){for(var t=jp(n,r.axis,!0),e=t.mean,i=t.variance,s=cv(1,a),u=0,l=r.axis;u<l.length;u++){var c=l[u];s[c]=o[c]}for(var p=function(t){return null!=t&&t.shape.length!==a&&r.axis!==[a-1]?t.reshape(s):t},d=p(r.gamma.read()),h=p(r.beta.read()),f=[],m=[],g=0;g<a;++g)-1!==r.axis.indexOf(g)?(f.push(o[g]),m.push(1)):(f.push(1),m.push(o[g]));return e=e.tile(f),i=i.tile(f),d=d.tile(m),h=h.tile(m),Vw(n,e,i,h,d,r.epsilon)})},e.prototype.getConfig=function(){var e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:qb(this.betaInitializer),gammaInitializer:qb(this.gammaInitializer),betaRegularizer:Kx(this.betaRegularizer),gammaRegularizer:Kx(this.gammaRegularizer)},r=t.prototype.getConfig.call(this);return Object.assign(e,r),e},e.className="LayerNormalization",e}(iy);lf.registerClass(jw);var Hw=function(t){function e(e){var r=this;if(null==e&&(e={}),(r=t.call(this,e)||this).dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,null==e.padding)r.padding=[[1,1],[1,1]];else if("number"==typeof e.padding)r.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,2!==e.padding.length)throw new sv("ZeroPadding2D expects padding to be a length-2 array, but received a length-"+e.padding.length+" array.");var n=void 0,o=void 0;if("number"==typeof e.padding[0])n=[e.padding[0],e.padding[0]],o=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,2!==e.padding[0].length)throw new sv("ZeroPadding2D expects height padding to be a length-2 array, but received a length-"+e.padding[0].length+" array.");if(n=e.padding[0],2!==e.padding[1].length)throw new sv("ZeroPadding2D expects width padding to be a length-2 array, but received a length-"+e.padding[1].length+" array.");o=e.padding[1]}r.padding=[n,o]}return r.inputSpec=[new ey({ndim:4})],r}return Qg(e,t),e.prototype.computeOutputShape=function(t){var e,r;return t=Xb(t),"channelsFirst"===this.dataFormat?(e=null!=t[2]&&t[2]>=0?t[2]+this.padding[0][0]+this.padding[0][1]:null,r=null!=t[3]&&t[3]>=0?t[3]+this.padding[1][0]+this.padding[1][1]:null,[t[0],t[1],e,r]):(e=null!=t[1]&&t[1]>=0?t[1]+this.padding[0][0]+this.padding[0][1]:null,r=null!=t[2]&&t[2]>=0?t[2]+this.padding[1][0]+this.padding[1][1]:null,[t[0],e,r,t[3]])},e.prototype.call=function(t,e){var r=this;return Zn(function(){return function(t,e,r){return Zn(function(){if(4!==t.rank)throw new sv("temporalPadding expects input tensor to be 4-D, but received a "+t.rank+"-D tensor.");if(null==e&&(e=[[1,1],[1,1]]),2!==e.length||2!==e[0].length||2!==e[1].length)throw new sv("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==r&&(r="channelsLast"),"channelsLast"!==r&&"channelsFirst"!==r)throw new sv("Unknown data format: "+r+". Supported data formats are 'channelsLast' and 'channelsFirst.");var n;return n="channelsFirst"===r?[[0,0],[0,0],e[0],e[1]]:[[0,0],e[0],e[1],[0,0]],fa(t,n)})}(Kb(t),r.padding,r.dataFormat)})},e.prototype.getConfig=function(){var e={padding:this.padding,dataFormat:this.dataFormat},r=t.prototype.getConfig.call(this);return Object.assign(e,r),e},e.className="ZeroPadding2D",e}(iy);function Gw(t,e,r,n,o,a){return Zn(function(){var i;Wv(o),jv(a),Uv(n),null==r&&(r=[1,1]),null==n&&(n="valid"),null==o&&(o="channelsLast"),null==a&&(a="max"),t=iw(t,o);var s="same"===n?"same":"valid";return i="max"===a?Ep(t,e,r,s):zp(t,e,r,s),"channelsFirst"===o&&(i=Qp(i,[0,3,1,2])),i})}function $w(t,e,r,n,o,a){return Zn(function(){var i;Wv(o),jv(a),Uv(n),null==r&&(r=[1,1,1]),null==n&&(n="valid"),null==o&&(o="channelsLast"),null==a&&(a="max"),t=sw(t,o);var s="same"===n?"same":"valid";return i="max"===a?Ap(t,e,r,s):Np(t,e,r,s),"channelsFirst"===o&&(i=Qp(i,[0,4,1,2,3])),i})}lf.registerClass(Hw);var Kw=function(t){function e(e){var r=this;if(null==e.poolSize&&(e.poolSize=2),r=t.call(this,e)||this,"number"==typeof e.poolSize)r.poolSize=[e.poolSize];else{if(!Array.isArray(e.poolSize)||1!==e.poolSize.length||"number"!=typeof e.poolSize[0])throw new sv("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(e.poolSize));r.poolSize=e.poolSize}if(Ev(r.poolSize,"poolSize"),null==e.strides)r.strides=r.poolSize;else if("number"==typeof e.strides)r.strides=[e.strides];else{if(!Array.isArray(e.strides)||1!==e.strides.length||"number"!=typeof e.strides[0])throw new sv("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(e.strides));r.strides=e.strides}return Ev(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,Uv(r.padding),r.inputSpec=[new ey({ndim:3})],r}return Qg(e,t),e.prototype.computeOutputShape=function(t){var e=ow((t=Xb(t))[1],this.poolSize[0],this.padding,this.strides[0]);return[t[0],e,t[2]]},e.prototype.call=function(t,e){var r=this;return Zn(function(){r.invokeCallHook(t,e),t=ab(Kb(t),2);var n=r.poolingFunction(Kb(t),[r.poolSize[0],1],[r.strides[0],1],r.padding,"channelsLast");return Ea(n,[2])})},e.prototype.getConfig=function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},r=t.prototype.getConfig.call(this);return Object.assign(e,r),e},e}(iy),Xw=function(t){function e(e){return t.call(this,e)||this}return Qg(e,t),e.prototype.poolingFunction=function(t,e,r,n,o){return Wv(o),Uv(n),Gw(t,e,r,n,o,"max")},e.className="MaxPooling1D",e}(Kw);lf.registerClass(Xw);var Yw=function(t){function e(e){return t.call(this,e)||this}return Qg(e,t),e.prototype.poolingFunction=function(t,e,r,n,o){return Wv(o),Uv(n),Gw(t,e,r,n,o,"avg")},e.className="AveragePooling1D",e}(Kw);lf.registerClass(Yw);var Jw=function(t){function e(e){var r=this;if(null==e.poolSize&&(e.poolSize=[2,2]),(r=t.call(this,e)||this).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],null==e.strides)r.strides=r.poolSize;else if(Array.isArray(e.strides)){if(2!==e.strides.length)throw new sv("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+e.strides.length+".");r.strides=e.strides}else r.strides=[e.strides,e.strides];return Ev(r.poolSize,"poolSize"),Ev(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Wv(r.dataFormat),Uv(r.padding),r.inputSpec=[new ey({ndim:4})],r}return Qg(e,t),e.prototype.computeOutputShape=function(t){t=Xb(t);var e="channelsFirst"===this.dataFormat?t[2]:t[1],r="channelsFirst"===this.dataFormat?t[3]:t[2];return e=ow(e,this.poolSize[0],this.padding,this.strides[0]),r=ow(r,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[t[0],t[1],e,r]:[t[0],e,r,t[3]]},e.prototype.call=function(t,e){var r=this;return Zn(function(){return r.invokeCallHook(t,e),r.poolingFunction(Kb(t),r.poolSize,r.strides,r.padding,r.dataFormat)})},e.prototype.getConfig=function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},r=t.prototype.getConfig.call(this);return Object.assign(e,r),e},e}(iy),Zw=function(t){function e(e){return t.call(this,e)||this}return Qg(e,t),e.prototype.poolingFunction=function(t,e,r,n,o){return Wv(o),Uv(n),Gw(t,e,r,n,o,"max")},e.className="MaxPooling2D",e}(Jw);lf.registerClass(Zw);var Qw=function(t){function e(e){return t.call(this,e)||this}return Qg(e,t),e.prototype.poolingFunction=function(t,e,r,n,o){return Wv(o),Uv(n),Gw(t,e,r,n,o,"avg")},e.className="AveragePooling2D",e}(Jw);lf.registerClass(Qw);var tk=function(t){function e(e){var r=this;if(null==e.poolSize&&(e.poolSize=[2,2,2]),(r=t.call(this,e)||this).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],null==e.strides)r.strides=r.poolSize;else if(Array.isArray(e.strides)){if(3!==e.strides.length)throw new sv("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length "+e.strides.length+".");r.strides=e.strides}else r.strides=[e.strides,e.strides,e.strides];return Ev(r.poolSize,"poolSize"),Ev(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Wv(r.dataFormat),Uv(r.padding),r.inputSpec=[new ey({ndim:5})],r}return Qg(e,t),e.prototype.computeOutputShape=function(t){t=Xb(t);var e="channelsFirst"===this.dataFormat?t[2]:t[1],r="channelsFirst"===this.dataFormat?t[3]:t[2],n="channelsFirst"===this.dataFormat?t[4]:t[3];return e=ow(e,this.poolSize[0],this.padding,this.strides[0]),r=ow(r,this.poolSize[1],this.padding,this.strides[1]),n=ow(n,this.poolSize[2],this.padding,this.strides[2]),"channelsFirst"===this.dataFormat?[t[0],t[1],e,r,n]:[t[0],e,r,n,t[4]]},e.prototype.call=function(t,e){var r=this;return Zn(function(){return r.invokeCallHook(t,e),r.poolingFunction(Kb(t),r.poolSize,r.strides,r.padding,r.dataFormat)})},e.prototype.getConfig=function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},r=t.prototype.getConfig.call(this);return Object.assign(e,r),e},e}(iy),ek=function(t){function e(e){return t.call(this,e)||this}return Qg(e,t),e.prototype.poolingFunction=function(t,e,r,n,o){return Wv(o),Uv(n),$w(t,e,r,n,o,"max")},e.className="MaxPooling3D",e}(tk);lf.registerClass(ek);var rk=function(t){function e(e){return t.call(this,e)||this}return Qg(e,t),e.prototype.poolingFunction=function(t,e,r,n,o){return Wv(o),Uv(n),$w(t,e,r,n,o,"avg")},e.className="AveragePooling3D",e}(tk);lf.registerClass(rk);var nk=function(t){function e(e){var r=t.call(this,e)||this;return r.inputSpec=[new ey({ndim:3})],r}return Qg(e,t),e.prototype.computeOutputShape=function(t){return[t[0],t[2]]},e.prototype.call=function(t,e){throw new uv},e}(iy),ok=function(t){function e(e){return t.call(this,e||{})||this}return Qg(e,t),e.prototype.call=function(t,e){return Zn(function(){var e=Kb(t);return Wp(e,1)})},e.className="GlobalAveragePooling1D",e}(nk);lf.registerClass(ok);var ak=function(t){function e(e){return t.call(this,e||{})||this}return Qg(e,t),e.prototype.call=function(t,e){return Zn(function(){var e=Kb(t);return Vp(e,1)})},e.className="GlobalMaxPooling1D",e}(nk);lf.registerClass(ak);var ik=function(t){function e(e){var r=t.call(this,e)||this;return r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Wv(r.dataFormat),r.inputSpec=[new ey({ndim:4})],r}return Qg(e,t),e.prototype.computeOutputShape=function(t){return t=t,"channelsLast"===this.dataFormat?[t[0],t[3]]:[t[0],t[1]]},e.prototype.call=function(t,e){throw new uv},e.prototype.getConfig=function(){var e={dataFormat:this.dataFormat},r=t.prototype.getConfig.call(this);return Object.assign(e,r),e},e}(iy),sk=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Qg(e,t),e.prototype.call=function(t,e){var r=this;return Zn(function(){var e=Kb(t);return"channelsLast"===r.dataFormat?Wp(e,[1,2]):Wp(e,[2,3])})},e.className="GlobalAveragePooling2D",e}(ik);lf.registerClass(sk);var uk=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Qg(e,t),e.prototype.call=function(t,e){var r=this;return Zn(function(){var e=Kb(t);return"channelsLast"===r.dataFormat?Vp(e,[1,2]):Vp(e,[2,3])})},e.className="GlobalMaxPooling2D",e}(ik);function lk(t,e,r,n){if(Array.isArray(t)){if(null!=e||null!=r)throw new sv("When inputs is an array, neither initialState or constants should be provided");null!=n&&(r=t.slice(t.length-n,t.length),t=t.slice(0,t.length-n)),t.length>1&&(e=t.slice(1,t.length)),t=t[0]}function o(t){return null==t||Array.isArray(t)?t:[t]}return{inputs:t,initialState:e=o(e),constants:r=o(r)}}function ck(t,e,r,n,o,a,i,s){return void 0===n&&(n=!1),void 0===i&&(i=!1),void 0===s&&(s=!1),Zn(function(){var u=e.shape.length;if(u<3)throw new sv("Input should be at least 3D, but is "+u+"D.");var l=[1,0].concat(nb(2,u));if(e=Qp(e,l),null!=a)throw new uv("The rnn() functoin of the deeplearn.js backend does not support constants yet.");i&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=o&&((o=o.asType("bool").asType("float32")).rank===u-1&&(o=ca(o,-1)),o=Qp(o,l)),n&&(e=bp(e,0),null!=o&&(o=bp(o,0)));var c,p,d=[],h=r,f=e.shape[0],m=Na(e);null!=o&&(p=Na(o));for(var g,v=function(e){var r=m[e],n=Zn(function(){return t(r,h)});if(null==o)c=n[0],h=n[1];else{var a=Zn(function(){var t=p[e],r=Lo(t).sub(t);return{output:n[0].mul(t).addStrict(h[0].mul(r)),newStates:h.map(function(e,o){return n[1][o].mul(t).addStrict(e.mul(r))})}});c=a.output,h=a.newStates}s&&d.push(c)},b=0;b<f;++b)v(b);return s&&(g=za(d,1)),[c,g,h]})}lf.registerClass(uk);var pk=function(t){function e(e){var r,n=t.call(this,e)||this;if(null==e.cell)throw new sv("cell property is missing for the constructor of RNN.");if(null==(r=Array.isArray(e.cell)?new yk({cells:e.cell}):e.cell).stateSize)throw new sv("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return n.cell=r,n.returnSequences=null!=e.returnSequences&&e.returnSequences,n.returnState=null!=e.returnState&&e.returnState,n.goBackwards=null!=e.goBackwards&&e.goBackwards,n._stateful=null!=e.stateful&&e.stateful,n.unroll=null!=e.unroll&&e.unroll,n.supportsMasking=!0,n.inputSpec=[new ey({ndim:3})],n.stateSpec=null,n.states_=null,n.numConstants=null,n.keptStates=[],n}return Qg(e,t),e.prototype.getStates=function(){return null==this.states_?nb(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map(function(t){return null}):this.states_},e.prototype.setStates=function(t){this.states_=t},e.prototype.computeOutputShape=function(t){Gb(t)&&(t=t[0]),t=t;var e=this.cell.stateSize;Array.isArray(e)||(e=[e]);var r,n=e[0];if(r=this.returnSequences?[t[0],t[1],n]:[t[0],n],this.returnState){for(var o=[],a=0,i=e;a<i.length;a++){var s=i[a];o.push([t[0],s])}return[r].concat(o)}return r},e.prototype.computeMask=function(t,e){var r=this;return Zn(function(){Array.isArray(e)&&(e=e[0]);var t=r.returnSequences?e:null;if(r.returnState){var n=r.states.map(function(t){return null});return[t].concat(n)}return t})},Object.defineProperty(e.prototype,"states",{get:function(){if(null==this.states_){for(var t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,e=[],r=0;r<t;++r)e.push(null);return e}return this.states_},set:function(t){this.states_=t},enumerable:!0,configurable:!0}),e.prototype.build=function(t){if(null!=this.numConstants)throw new uv("Constants support is not implemented in RNN yet.");Gb(t)&&(t=t[0]),t=t;var e=this.stateful?t[0]:null,r=t[t.length-1];this.inputSpec[0]=new ey({shape:[e,null,r]});var n,o=[t[0]].concat(t.slice(2));if(this.cell.build(o),n=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!cr.arraysEqual(this.stateSpec.map(function(t){return t.shape[t.shape.length-1]}),n))throw new sv("An initialState was passed that is not compatible with cell.stateSize. Received stateSpec="+this.stateSpec+"; However cell.stateSize is "+this.cell.stateSize)}else this.stateSpec=n.map(function(t){return new ey({shape:[null,t]})});this.stateful&&this.resetStates()},e.prototype.resetStates=function(t,e){var r=this;void 0===e&&(e=!1),Zn(function(){if(!r.stateful)throw new av("Cannot call resetStates() on an RNN Layer that is not stateful.");var n=r.inputSpec[0].shape[0];if(null==n)throw new sv("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==r.states_)Array.isArray(r.cell.stateSize)?r.states_=r.cell.stateSize.map(function(t){return _o([n,t])}):r.states_=[_o([n,r.cell.stateSize])];else if(null==t)Qn(r.states_),null!=r.keptStates&&(Qn(r.keptStates),r.keptStates=[]),Array.isArray(r.cell.stateSize)?r.states_=r.cell.stateSize.map(function(t){return _o([n,t])}):r.states_[0]=_o([n,r.cell.stateSize]);else{if(Array.isArray(t)||(t=[t]),t.length!==r.states_.length)throw new sv("Layer "+r.name+" expects "+r.states_.length+" state(s), but it received "+t.length+" state value(s). Input received: "+t);!0===e?r.keptStates.push(r.states_.slice()):Qn(r.states_);for(var o=0;o<r.states_.length;++o){var a=t[o],i=Array.isArray(r.cell.stateSize)?r.cell.stateSize[o]:r.cell.stateSize,s=[n,i];if(!cr.arraysEqual(a.shape,s))throw new sv("State "+o+" is incompatible with layer "+r.name+": expected shape="+s+", received shape="+a.shape);r.states_[o]=a}}r.states_=r.states_.map(function(t){return to(t.clone())})})},e.prototype.apply=function(e,r){var n=null==r?null:r.initialState,o=null==r?null:r.constants;null==r&&(r={});var a=lk(e,n,o,this.numConstants);e=a.inputs,n=a.initialState,o=a.constants;var i=[],s=[];if(null!=n){r.initialState=n,i=i.concat(n),this.stateSpec=[];for(var u=0,l=n;u<l.length;u++){var c=l[u];this.stateSpec.push(new ey({shape:c.shape}))}s=s.concat(this.stateSpec)}if(null!=o&&(r.constants=o,i=i.concat(o),this.numConstants=o.length),i[0]instanceof ry){var p=[e].concat(i),d=this.inputSpec.concat(s),h=this.inputSpec;this.inputSpec=d;var f=t.prototype.apply.call(this,p,r);return this.inputSpec=h,f}return t.prototype.apply.call(this,e,r)},e.prototype.call=function(t,e){var r=this;return Zn(function(){var n=null==e?null:e.mask,o=null==e?null:e.training,a=null==e?null:e.initialState;t=Kb(t),null==a&&(a=r.stateful?r.states_:r.getInitialState(t));var i=Array.isArray(r.cell.stateSize)?r.cell.stateSize.length:1;if(a.length!==i)throw new sv("RNN Layer has "+i+" state(s) but was passed "+a.length+" initial state(s).");r.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var s={training:o},u=ck(function(t,e){var n=r.cell.call([t].concat(e),s);return[n[0],n.slice(1)]},t,a,r.goBackwards,n,null,r.unroll,r.returnSequences),l=u[0],c=u[1],p=u[2];r.stateful&&r.resetStates(p,o);var d=r.returnSequences?c:l;return r.returnState?[d].concat(p):d})},e.prototype.getInitialState=function(t){var e=this;return Zn(function(){var r=_o(t.shape);return r=ab(r=Hp(r,[1,2])),Array.isArray(e.cell.stateSize)?e.cell.stateSize.map(function(t){return t>1?pb(r,[1,t]):r}):e.cell.stateSize>1?[pb(r,[1,e.cell.stateSize])]:[r]})},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.trainable?this.cell.trainableWeights:[]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights},enumerable:!0,configurable:!0}),e.prototype.setFastWeightInitDuringBuild=function(e){t.prototype.setFastWeightInitDuringBuild.call(this,e),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(e)},e.prototype.getConfig=function(){var e={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(e.numConstants=this.numConstants);var r=this.cell.getConfig();e.cell={className:this.cell.getClassName(),config:r};var n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.fromConfig=function(t,e,r){void 0===r&&(r={});var n=wy(e.cell,r);return new t(Object.assign(e,{cell:n}))},e.className="RNN",e}(iy);lf.registerClass(pk);var dk=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Qg(e,t),e}(iy),hk=function(t){function e(e){var r=t.call(this,e)||this;return r.DEFAULT_ACTIVATION="tanh",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",r.units=e.units,Ev(r.units,"units"),r.activation=Ux(null==e.activation?r.DEFAULT_ACTIVATION:e.activation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=Vb(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=Vb(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=Vb(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelRegularizer=Yx(e.kernelRegularizer),r.recurrentRegularizer=Yx(e.recurrentRegularizer),r.biasRegularizer=Yx(e.biasRegularizer),r.kernelConstraint=Mv(e.kernelConstraint),r.recurrentConstraint=Mv(e.recurrentConstraint),r.biasConstraint=Mv(e.biasConstraint),r.dropout=eb([1,rb([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=eb([1,rb([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.stateSize=r.units,r.dropoutMask=null,r.recurrentDropoutMask=null,r}return Qg(e,t),e.prototype.build=function(t){t=Xb(t),this.kernel=this.addWeight("kernel",[t[t.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},e.prototype.call=function(t,e){var r=this;return Zn(function(){if(2!==(t=t).length)throw new sv("SimpleRNNCell expects 2 input Tensors, got "+t.length+".");var n=t[1];t=t[0];var o,a=null!=e.training&&e.training;0<r.dropout&&r.dropout<1&&null==r.dropoutMask&&(r.dropoutMask=xk(function(){return Lo(t)},r.dropout,a)),0<r.recurrentDropout&&r.recurrentDropout<1&&null==r.recurrentDropoutMask&&(r.recurrentDropoutMask=xk(function(){return Lo(n)},r.recurrentDropout,a));var i=r.dropoutMask,s=r.recurrentDropoutMask;o=hb(null!=i?Rc(t,i):t,r.kernel.read()),null!=r.bias&&(o=vb(o,r.bias.read())),null!=s&&(n=Rc(n,s));var u=gc(o,hb(n,r.recurrentKernel.read()));return null!=r.activation&&(u=r.activation.apply(u)),[u,u]})},e.prototype.getConfig=function(){var e={units:this.units,activation:Vx(this.activation),useBias:this.useBias,kernelInitializer:qb(this.kernelInitializer),recurrentInitializer:qb(this.recurrentInitializer),biasInitializer:qb(this.biasInitializer),kernelRegularizer:Kx(this.kernelRegularizer),recurrentRegularizer:Kx(this.recurrentRegularizer),biasRegularizer:Kx(this.biasRegularizer),activityRegularizer:Kx(this.activityRegularizer),kernelConstraint:Ov(this.kernelConstraint),recurrentConstraint:Ov(this.recurrentConstraint),biasConstraint:Ov(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout},r=t.prototype.getConfig.call(this);return Object.assign(e,r),e},e.className="SimpleRNNCell",e}(dk);lf.registerClass(hk);var fk=function(t){function e(e){return e.cell=new hk(e),t.call(this,e)||this}return Qg(e,t),e.prototype.call=function(e,r){var n=this;return Zn(function(){null!=n.cell.dropoutMask&&(Qn(n.cell.dropoutMask),n.cell.dropoutMask=null),null!=n.cell.recurrentDropoutMask&&(Qn(n.cell.recurrentDropoutMask),n.cell.recurrentDropoutMask=null);var o=null==r?null:r.mask,a=null==r?null:r.training,i=null==r?null:r.initialState;return t.prototype.call.call(n,e,{mask:o,training:a,initialState:i})})},Object.defineProperty(e.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),e.prototype.getConfig=function(){var e={units:this.units,activation:Vx(this.activation),useBias:this.useBias,kernelInitializer:qb(this.kernelInitializer),recurrentInitializer:qb(this.recurrentInitializer),biasInitializer:qb(this.biasInitializer),kernelRegularizer:Kx(this.kernelRegularizer),recurrentRegularizer:Kx(this.recurrentRegularizer),biasRegularizer:Kx(this.biasRegularizer),activityRegularizer:Kx(this.activityRegularizer),kernelConstraint:Ov(this.kernelConstraint),recurrentConstraint:Ov(this.recurrentConstraint),biasConstraint:Ov(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout},r=t.prototype.getConfig.call(this);return delete r.cell,Object.assign(e,r),e},e.fromConfig=function(t,e){return new t(e)},e.className="SimpleRNN",e}(pk);lf.registerClass(fk);var mk=function(t){function e(e){var r=t.call(this,e)||this;return r.DEFAULT_ACTIVATION="tanh",r.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",r.units=e.units,Ev(r.units,"units"),r.activation=Ux(void 0===e.activation?r.DEFAULT_ACTIVATION:e.activation),r.recurrentActivation=Ux(void 0===e.recurrentActivation?r.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=Vb(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=Vb(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=Vb(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelRegularizer=Yx(e.kernelRegularizer),r.recurrentRegularizer=Yx(e.recurrentRegularizer),r.biasRegularizer=Yx(e.biasRegularizer),r.kernelConstraint=Mv(e.kernelConstraint),r.recurrentConstraint=Mv(e.recurrentConstraint),r.biasConstraint=Mv(e.biasConstraint),r.dropout=eb([1,rb([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=eb([1,rb([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.implementation=e.implementation,r.stateSize=r.units,r.dropoutMask=null,r.recurrentDropoutMask=null,r}return Qg(e,t),e.prototype.build=function(t){var e=(t=Xb(t))[t.length-1];this.kernel=this.addWeight("kernel",[e,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},e.prototype.call=function(t,e){var r=this;return Zn(function(){if(2!==(t=t).length)throw new sv("GRUCell expects 2 input Tensors (inputs, h, c), got "+t.length+".");var n=null!=e.training&&e.training,o=t[1];t=t[0],0<r.dropout&&r.dropout<1&&null==r.dropoutMask&&(r.dropoutMask=xk(function(){return Lo(t)},r.dropout,n,3)),0<r.recurrentDropout&&r.recurrentDropout<1&&null==r.recurrentDropoutMask&&(r.recurrentDropoutMask=xk(function(){return Lo(o)},r.recurrentDropout,n,3));var a,i,s,u=r.dropoutMask,l=r.recurrentDropoutMask;0<r.dropout&&r.dropout<1&&(t=Rc(t,u[0]));var c=hb(t,r.kernel.read());r.useBias&&(c=vb(c,r.bias.read())),0<r.recurrentDropout&&r.recurrentDropout<1&&(o=Rc(o,l[0]));var p=r.recurrentKernel.read(),d=jo(p,[2*r.units,r.units],p.rank-1),h=d[0],f=d[1],m=hb(o,h),g=jo(c,3,c.rank-1),v=g[0],b=g[1],y=g[2],x=jo(m,2,m.rank-1),w=x[0],k=x[1];a=r.recurrentActivation.apply(gc(v,w)),i=r.recurrentActivation.apply(gc(b,k));var C=hb(Rc(i,o),f);s=r.activation.apply(gc(y,C));var S=gc(Rc(a,o),Rc(gc(1,Ol(a)),s));return[S,S]})},e.prototype.getConfig=function(){var e={units:this.units,activation:Vx(this.activation),recurrentActivation:Vx(this.recurrentActivation),useBias:this.useBias,kernelInitializer:qb(this.kernelInitializer),recurrentInitializer:qb(this.recurrentInitializer),biasInitializer:qb(this.biasInitializer),kernelRegularizer:Kx(this.kernelRegularizer),recurrentRegularizer:Kx(this.recurrentRegularizer),biasRegularizer:Kx(this.biasRegularizer),activityRegularizer:Kx(this.activityRegularizer),kernelConstraint:Ov(this.kernelConstraint),recurrentConstraint:Ov(this.recurrentConstraint),biasConstraint:Ov(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},r=t.prototype.getConfig.call(this);return Object.assign(e,r),e},e.className="GRUCell",e}(dk);lf.registerClass(mk);var gk=function(t){function e(e){return 0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new mk(e),t.call(this,e)||this}return Qg(e,t),e.prototype.call=function(e,r){var n=this;return Zn(function(){null!=n.cell.dropoutMask&&(Qn(n.cell.dropoutMask),n.cell.dropoutMask=null),null!=n.cell.recurrentDropoutMask&&(Qn(n.cell.recurrentDropoutMask),n.cell.recurrentDropoutMask=null);var o=null==r?null:r.mask,a=null==r?null:r.training,i=null==r?null:r.initialState;return t.prototype.call.call(n,e,{mask:o,training:a,initialState:i})})},Object.defineProperty(e.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentActivation",{get:function(){return this.cell.recurrentActivation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"implementation",{get:function(){return this.cell.implementation},enumerable:!0,configurable:!0}),e.prototype.getConfig=function(){var e={units:this.units,activation:Vx(this.activation),recurrentActivation:Vx(this.recurrentActivation),useBias:this.useBias,kernelInitializer:qb(this.kernelInitializer),recurrentInitializer:qb(this.recurrentInitializer),biasInitializer:qb(this.biasInitializer),kernelRegularizer:Kx(this.kernelRegularizer),recurrentRegularizer:Kx(this.recurrentRegularizer),biasRegularizer:Kx(this.biasRegularizer),activityRegularizer:Kx(this.activityRegularizer),kernelConstraint:Ov(this.kernelConstraint),recurrentConstraint:Ov(this.recurrentConstraint),biasConstraint:Ov(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},r=t.prototype.getConfig.call(this);return delete r.cell,Object.assign(e,r),e},e.fromConfig=function(t,e){return 0===e.implmentation&&(e.implementation=1),new t(e)},e.className="GRU",e}(pk);lf.registerClass(gk);var vk=function(t){function e(e){var r=t.call(this,e)||this;return r.DEFAULT_ACTIVATION="tanh",r.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",r.units=e.units,Ev(r.units,"units"),r.activation=Ux(void 0===e.activation?r.DEFAULT_ACTIVATION:e.activation),r.recurrentActivation=Ux(void 0===e.recurrentActivation?r.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=Vb(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=Vb(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=Vb(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.unitForgetBias=e.unitForgetBias,r.kernelRegularizer=Yx(e.kernelRegularizer),r.recurrentRegularizer=Yx(e.recurrentRegularizer),r.biasRegularizer=Yx(e.biasRegularizer),r.kernelConstraint=Mv(e.kernelConstraint),r.recurrentConstraint=Mv(e.recurrentConstraint),r.biasConstraint=Mv(e.biasConstraint),r.dropout=eb([1,rb([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=eb([1,rb([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.implementation=e.implementation,r.stateSize=[r.units,r.units],r.dropoutMask=null,r.recurrentDropoutMask=null,r}return Qg(e,t),e.prototype.build=function(t){var e,r,n=(t=Xb(t))[t.length-1];if(this.kernel=this.addWeight("kernel",[n,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){var o=this.biasInitializer,a=this.units;r=new((e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Qg(e,t),e.prototype.apply=function(t,e){var r=o.apply([a]),n=(new Sb).apply([a]),i=o.apply([2*a]);return cb(cb(r,n),i)},e}(kb)).className="CustomInit",e)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0},e.prototype.call=function(t,e){var r=this;return Zn(function(){var n=null!=e.training&&e.training;if(3!==(t=t).length)throw new sv("LSTMCell expects 3 input Tensors (inputs, h, c), got "+t.length+".");var o=t[1],a=t[2];t=t[0],0<r.dropout&&r.dropout<1&&null==r.dropoutMask&&(r.dropoutMask=xk(function(){return Lo(t)},r.dropout,n,4)),0<r.recurrentDropout&&r.recurrentDropout<1&&null==r.recurrentDropoutMask&&(r.recurrentDropoutMask=xk(function(){return Lo(o)},r.recurrentDropout,n,4));var i,s,u,l,c=r.dropoutMask,p=r.recurrentDropoutMask;0<r.dropout&&r.dropout<1&&(t=Rc(t,c[0]));var d=hb(t,r.kernel.read());0<r.recurrentDropout&&r.recurrentDropout<1&&(o=Rc(o,p[0])),d=gc(d,hb(o,r.recurrentKernel.read())),r.useBias&&(d=vb(d,r.bias.read()));var h=jo(d,4,d.rank-1),f=h[0],m=h[1],g=h[2],v=h[3];i=r.recurrentActivation.apply(f),s=r.recurrentActivation.apply(m),u=gc(Rc(s,a),Rc(i,r.activation.apply(g))),l=r.recurrentActivation.apply(v);var b=Rc(l,r.activation.apply(u));return[b,b,u]})},e.prototype.getConfig=function(){var e={units:this.units,activation:Vx(this.activation),recurrentActivation:Vx(this.recurrentActivation),useBias:this.useBias,kernelInitializer:qb(this.kernelInitializer),recurrentInitializer:qb(this.recurrentInitializer),biasInitializer:qb(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Kx(this.kernelRegularizer),recurrentRegularizer:Kx(this.recurrentRegularizer),biasRegularizer:Kx(this.biasRegularizer),activityRegularizer:Kx(this.activityRegularizer),kernelConstraint:Ov(this.kernelConstraint),recurrentConstraint:Ov(this.recurrentConstraint),biasConstraint:Ov(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},r=t.prototype.getConfig.call(this);return Object.assign(e,r),e},e.className="LSTMCell",e}(dk);lf.registerClass(vk);var bk=function(t){function e(e){return 0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new vk(e),t.call(this,e)||this}return Qg(e,t),e.prototype.call=function(e,r){var n=this;return Zn(function(){null!=n.cell.dropoutMask&&(Qn(n.cell.dropoutMask),n.cell.dropoutMask=null),null!=n.cell.recurrentDropoutMask&&(Qn(n.cell.recurrentDropoutMask),n.cell.recurrentDropoutMask=null);var o=null==r?null:r.mask,a=null==r?null:r.training,i=null==r?null:r.initialState;return t.prototype.call.call(n,e,{mask:o,training:a,initialState:i})})},Object.defineProperty(e.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentActivation",{get:function(){return this.cell.recurrentActivation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"unitForgetBias",{get:function(){return this.cell.unitForgetBias},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"implementation",{get:function(){return this.cell.implementation},enumerable:!0,configurable:!0}),e.prototype.getConfig=function(){var e={units:this.units,activation:Vx(this.activation),recurrentActivation:Vx(this.recurrentActivation),useBias:this.useBias,kernelInitializer:qb(this.kernelInitializer),recurrentInitializer:qb(this.recurrentInitializer),biasInitializer:qb(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Kx(this.kernelRegularizer),recurrentRegularizer:Kx(this.recurrentRegularizer),biasRegularizer:Kx(this.biasRegularizer),activityRegularizer:Kx(this.activityRegularizer),kernelConstraint:Ov(this.kernelConstraint),recurrentConstraint:Ov(this.recurrentConstraint),biasConstraint:Ov(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},r=t.prototype.getConfig.call(this);return delete r.cell,Object.assign(e,r),e},e.fromConfig=function(t,e){return 0===e.implmentation&&(e.implementation=1),new t(e)},e.className="LSTM",e}(pk);lf.registerClass(bk);var yk=function(t){function e(e){var r=t.call(this,e)||this;return r.cells=e.cells,r}return Qg(e,t),Object.defineProperty(e.prototype,"stateSize",{get:function(){for(var t=[],e=0,r=this.cells.slice().reverse();e<r.length;e++){var n=r[e];Array.isArray(n.stateSize)?t.push.apply(t,n.stateSize):t.push(n.stateSize)}return t},enumerable:!0,configurable:!0}),e.prototype.call=function(t,e){var r=this;return Zn(function(){for(var n=(t=t).slice(1),o=[],a=0,i=r.cells.slice().reverse();a<i.length;a++){var s=i[a];Array.isArray(s.stateSize)?o.push(n.splice(0,s.stateSize.length)):o.push(n.splice(0,1))}o.reverse();for(var u,l=[],c=0;c<r.cells.length;++c)s=r.cells[c],n=o[c],u=0===c?[t[0]].concat(n):[u[0]].concat(n),u=s.call(u,e),l.push(u.slice(1));n=[];for(var p=0,d=l.slice().reverse();p<d.length;p++){var h=d[p];n.push.apply(n,h)}return[u[0]].concat(n)})},e.prototype.build=function(t){var e;Gb(t)&&(t=t[0]),t=t,this.cells.forEach(function(r,n){$v("RNNCell_"+n,function(){r.build(t),e=Array.isArray(r.stateSize)?r.stateSize[0]:r.stateSize,t=[t[0],e]})}),this.built=!0},e.prototype.getConfig=function(){for(var e=[],r=0,n=this.cells;r<n.length;r++){var o=n[r];e.push({className:o.getClassName(),config:o.getConfig()})}var a={cells:e},i=t.prototype.getConfig.call(this);return Object.assign(a,i),a},e.fromConfig=function(t,e,r){void 0===r&&(r={});for(var n=[],o=0,a=e.cells;o<a.length;o++){var i=a[o];n.push(wy(i,r))}return new t({cells:n})},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){if(!this.trainable)return[];for(var t=[],e=0,r=this.cells;e<r.length;e++){var n=r[e];t.push.apply(t,n.trainableWeights)}return t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){for(var t=[],e=0,r=this.cells;e<r.length;e++){var n=r[e];t.push.apply(t,n.nonTrainableWeights)}if(!this.trainable){for(var o=[],a=0,i=this.cells;a<i.length;a++)n=i[a],o.push.apply(o,n.trainableWeights);return o.concat(t)}return t},enumerable:!0,configurable:!0}),e.prototype.getWeights=function(){for(var t=[],e=0,r=this.cells;e<r.length;e++){var n=r[e];t.push.apply(t,n.weights)}return Qb(t)},e.prototype.setWeights=function(t){for(var e=[],r=0,n=this.cells;r<n.length;r++)for(var o=n[r],a=o.weights.length,i=t.splice(a),s=0;s<o.weights.length;++s)e.push([o.weights[s],i[s]]);ty(e)},e.className="StackedRNNCells",e}(dk);function xk(t,e,r,n){function o(){return bb(t(),e)}if(void 0===r&&(r=null),void 0===n&&(n=1),n>1){for(var a=[],i=0;i<n;i++)a.push(yb(o,t,r));return a.map(function(t){return to(t.clone())})}return to(yb(o,t,r).clone())}lf.registerClass(yk);var wk=function(t){function e(e){var r=t.call(this,e)||this;return r.layer=e.layer,r}return Qg(e,t),e.prototype.build=function(t){this.built=!0},Object.defineProperty(e.prototype,"trainable",{get:function(){return null!=this.layer&&this.layer.trainable},set:function(t){null!=this.layer&&(this.layer.trainable=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.layer.trainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.layer.nonTrainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"updates",{get:function(){return this.layer._updates},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"losses",{get:function(){return this.layer.losses},enumerable:!0,configurable:!0}),e.prototype.getWeights=function(){return this.layer.getWeights()},e.prototype.setWeights=function(t){this.layer.setWeights(t)},e.prototype.getConfig=function(){var e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},r=t.prototype.getConfig.call(this);return Object.assign(e,r),e},e.prototype.setFastWeightInitDuringBuild=function(e){t.prototype.setFastWeightInitDuringBuild.call(this,e),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(e)},e.fromConfig=function(t,e,r){void 0===r&&(r={});var n=wy(e.layer,r);delete e.layer;var o={layer:n};return Object.assign(o,e),new t(o)},e}(iy),kk=function(t){function e(e){var r=t.call(this,e)||this;return r.supportsMasking=!0,r}return Qg(e,t),e.prototype.build=function(e){if((e=Xb(e)).length<3)throw new sv("TimeDistributed layer expects an input shape >= 3D, but received input shape "+JSON.stringify(e));this.inputSpec=[{shape:e}];var r=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(r),this.layer.built=!0),t.prototype.build.call(this,e)},e.prototype.computeOutputShape=function(t){var e=[(t=Xb(t))[0]].concat(t.slice(2)),r=this.layer.computeOutputShape(e),n=t[1];return[r[0],n].concat(r.slice(1))},e.prototype.call=function(t,e){var r=this;return Zn(function(){return ck(function(t,n){return[Kb(r.layer.call(t,e)),[]]},t=Kb(t),[],!1,null,null,!1,!0)[1]})},e.className="TimeDistributed",e}(wk);lf.registerClass(kk);var Ck="concat",Sk=function(t){function e(e){var r=t.call(this,e)||this,n=e.layer.getConfig(),o={};o.className=e.layer.getClassName(),o.config=n,r.forwardLayer=wy(o),n.goBackwards=!0!==n.goBackwards;var a={};if(a.className=e.layer.getClassName(),a.config=n,r.backwardLayer=wy(a),r.forwardLayer.name="forward_"+r.forwardLayer.name,r.backwardLayer.name="backward_"+r.backwardLayer.name,r.mergeMode=void 0===e.mergeMode?Ck:e.mergeMode,function(t){Cv(qv,"BidirectionalMergeMode",t)}(r.mergeMode),e.weights)throw new uv("weights support is not implemented for Bidirectional layer yet.");return r._stateful=e.layer.stateful,r.returnSequences=e.layer.returnSequences,r.returnState=e.layer.returnState,r.supportsMasking=!0,r._trainable=!0,r.inputSpec=e.layer.inputSpec,r.numConstants=null,r}return Qg(e,t),Object.defineProperty(e.prototype,"trainable",{get:function(){return this._trainable},set:function(t){this._trainable=t,null!=this.forwardLayer&&(this.forwardLayer.trainable=t),null!=this.backwardLayer&&(this.backwardLayer.trainable=t)},enumerable:!0,configurable:!0}),e.prototype.getWeights=function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())},e.prototype.setWeights=function(t){var e=t.length,r=Math.floor(e/2);this.forwardLayer.setWeights(t.slice(0,r)),this.backwardLayer.setWeights(t.slice(r))},e.prototype.computeOutputShape=function(t){var e,r,n,o=this.forwardLayer.computeOutputShape(t);return Array.isArray(o)&&Array.isArray(o[0])||(o=[o]),o=o,this.returnState?(n=o.slice(1),e=o[0]):e=o[0],e=e,"concat"===this.mergeMode?(e[e.length-1]*=2,r=[e]):r=null==this.mergeMode?[e,e.slice()]:[e],this.returnState?null==this.mergeMode?r.concat(n).concat(n.slice()):[e].concat(n).concat(n.slice()):hv(r)},e.prototype.apply=function(e,r){var n=null==r?null:r.initialState,o=null==r?null:r.constants;null==r&&(r={});var a=lk(e,n,o,this.numConstants);if(e=a.inputs,n=a.initialState,o=a.constants,Array.isArray(e)&&(n=e.slice(1),e=e[0]),(null==n||0===n.length)&&null==o)return t.prototype.apply.call(this,e,r);var i=[],s=[];if(null!=n){var u=n.length;if(u%2>0)throw new sv("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");r.initialState=n,i.push.apply(i,n);var l=n.map(function(t){return new ey({shape:t.shape})});this.forwardLayer.stateSpec=l.slice(0,u/2),this.backwardLayer.stateSpec=l.slice(u/2),s.push.apply(s,l)}if(null!=o)throw new uv("Support for constants in Bidirectional layers is not implemented yet.");for(var c=i[0]instanceof ry,p=0,d=i;p<d.length;p++)if(d[p]instanceof ry!==c)throw new sv("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(c){var h=[e].concat(i),f=this.inputSpec.concat(s),m=this.inputSpec;this.inputSpec=f;var g=t.prototype.apply.call(this,h,r);return this.inputSpec=m,g}return t.prototype.apply.call(this,e,r)},e.prototype.call=function(t,e){var r=this;return Zn(function(){var n,o,a,i,s=e.initialState;if(null==s)n=r.forwardLayer.call(t,e),o=r.backwardLayer.call(t,e);else{var u=s.slice(0,s.length/2),l=s.slice(s.length/2);n=r.forwardLayer.call(t,Object.assign(e,{initialState:u})),o=r.backwardLayer.call(t,Object.assign(e,{initialState:l}))}return r.returnState&&(Array.isArray(n)&&(a=n.slice(1).concat(o.slice(1))),n=n[0],o=o[0]),r.returnSequences&&(o=bp(o,1)),"concat"===r.mergeMode?i=lb([n,o]):"sum"===r.mergeMode?i=gc(n,o):"ave"===r.mergeMode?i=Rc(.5,gc(n,o)):"mul"===r.mergeMode?i=Rc(n,o):null==r.mergeMode&&(i=[n,o]),r.returnState?null==r.mergeMode?i.concat(a):[i].concat(a):i})},e.prototype.resetStates=function(t){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()},e.prototype.build=function(t){var e=this;$v(this.forwardLayer.name,function(){e.forwardLayer.build(t)}),$v(this.backwardLayer.name,function(){e.backwardLayer.build(t)}),this.built=!0},e.prototype.computeMask=function(t,e){var r;if(Array.isArray(e)&&(e=e[0]),r=this.returnSequences?null==this.mergeMode?[e,e]:e:null==this.mergeMode?[null,null]:null,this.returnState){var n=this.forwardLayer.states.map(function(t){return null});return Array.isArray(r)?r.concat(n).concat(n):[r].concat(n).concat(n)}return r},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)},enumerable:!0,configurable:!0}),e.prototype.setFastWeightInitDuringBuild=function(e){t.prototype.setFastWeightInitDuringBuild.call(this,e),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(e),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(e)},e.prototype.getConfig=function(){var e={mergeMode:this.mergeMode},r=t.prototype.getConfig.call(this);return Object.assign(e,r),e},e.fromConfig=function(t,e){var r=wy(e.layer);if(delete e.layer,null!=e.numConstants)throw new uv("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var n=e;return n.layer=r,new t(n)},e.className="Bidirectional",e}(wk);function Ek(t){return new Yw(t)}function zk(t){return new Qw(t)}function Ik(t){return new rk(t)}function Ak(t){return new ak(t)}function Nk(t){return new uk(t)}function Rk(t){return new Xw(t)}function Tk(t){return new Zw(t)}lf.registerClass(Sk);var Dk=Ak,_k=Nk,Ok=Rk,Fk=Tk;Object.freeze({inputLayer:function(t){return new uy(t)},elu:function(t){return new tw(t)},reLU:function(t){return new Jx(t)},leakyReLU:function(t){return new Zx(t)},prelu:function(t){return new Qx(t)},softmax:function(t){return new rw(t)},thresholdedReLU:function(t){return new ew(t)},conv1d:function(t){return new mw(t)},conv2d:function(t){return new pw(t)},conv2dTranspose:function(t){return new hw(t)},conv3d:function(t){return new dw(t)},separableConv2d:function(t){return new fw(t)},cropping2D:function(t){return new gw(t)},upSampling2d:function(t){return new vw(t)},depthwiseConv2d:function(t){return new bw(t)},activation:function(t){return new Cw(t)},dense:function(t){return new ww(t)},dropout:function(t){return new yw(t)},spatialDropout1d:function(t){return new xw(t)},flatten:function(t){return new kw(t)},repeatVector:function(t){return new Sw(t)},reshape:function(t){return new Ew(t)},permute:function(t){return new zw(t)},embedding:function(t){return new Aw(t)},add:function(t){return new Rw(t)},average:function(t){return new Dw(t)},concatenate:function(t){return new Fw(t)},maximum:function(t){return new _w(t)},minimum:function(t){return new Ow(t)},multiply:function(t){return new Tw(t)},dot:function(t){return new Lw(t)},batchNormalization:function(t){return new Uw(t)},layerNormalization:function(t){return new jw(t)},zeroPadding2d:function(t){return new Hw(t)},averagePooling1d:Ek,avgPool1d:function(t){return Ek(t)},avgPooling1d:function(t){return Ek(t)},averagePooling2d:zk,avgPool2d:function(t){return zk(t)},avgPooling2d:function(t){return zk(t)},averagePooling3d:Ik,avgPool3d:function(t){return Ik(t)},avgPooling3d:function(t){return Ik(t)},globalAveragePooling1d:function(t){return new ok(t)},globalAveragePooling2d:function(t){return new sk(t)},globalMaxPooling1d:Ak,globalMaxPooling2d:Nk,maxPooling1d:Rk,maxPooling2d:Tk,maxPooling3d:function(t){return new ek(t)},gru:function(t){return new gk(t)},gruCell:function(t){return new mk(t)},lstm:function(t){return new bk(t)},lstmCell:function(t){return new vk(t)},simpleRNN:function(t){return new fk(t)},simpleRNNCell:function(t){return new hk(t)},rnn:function(t){return new pk(t)},stackedRNNCells:function(t){return new yk(t)},bidirectional:function(t){return new Sk(t)},timeDistributed:function(t){return new kk(t)},globalMaxPool1d:Dk,globalMaxPool2d:_k,maxPool1d:Ok,maxPool2d:Fk,Layer:iy,RNN:pk,RNNCell:dk,input:function(t){return ly(t)},gaussianNoise:function(t){return new Pw(t)},gaussianDropout:function(t){return new Bw(t)},alphaDropout:function(t){return new qw(t)},masking:function(t){return new Iw(t)}});Object.freeze({binaryAccuracy:function(t,e){return Dy(t,e)},binaryCrossentropy:function(t,e){return Ly(t,e)},sparseCategoricalAccuracy:function(t,e){return Py(t,e)},categoricalAccuracy:function(t,e){return _y(t,e)},categoricalCrossentropy:function(t,e){return By(t,e)},precision:function(t,e){return Fy(t,e)},recall:function(t,e){return My(t,e)},cosineProximity:function(t,e){return Ny(t,e)},meanAbsoluteError:function(t,e){return Sy(t,e)},meanAbsolutePercentageError:function(t,e){return Ey(t,e)},MAPE:function(t,e){return Ey(t,e)},mape:function(t,e){return Ey(t,e)},meanSquaredError:function(t,e){return Cy(t,e)},MSE:function(t,e){return Cy(t,e)},mse:function(t,e){return Cy(t,e)}}),Object.freeze({modelFromJSON:function(t,e){return rv(this,void 0,void 0,function(){var r,n,o,a,i,s,u,l;return nv(this,function(c){switch(c.label){case 0:return"modelTopology"in t||(t={modelTopology:t}),null!=(r=(t=t).modelTopology).model_config&&(r=r.model_config),n=Yy(r),o=wy(n,e),null==t.weightsManifest?[3,2]:[4,tf.loadWeights(t.weightsManifest,t.pathPrefix,o.weights.map(function(t){return t.originalName}))];case 1:for(a=c.sent(),i={},s=0,u=o.weights;s<u.length;s++)l=u[s],i[l.originalName]=a[l.originalName];o.loadWeights(i),Qn(a),c.label=2;case 2:return[2,o]}})})}});Object.freeze({l1l2:function(t){return new Gx(t)},l1:function(t){return function(t){return jx(t),new Gx({l1:null!=t?t.l1:null,l2:0})}(t)},l2:function(t){return function(t){return jx(t),new Gx({l2:null!=t?t.l2:null,l1:0})}(t)}});function Mk(t,e){return t<e}function Lk(t,e){return t>e}!function(t){function e(e){var r=t.call(this)||this;if(null==e&&(e={}),e.restoreBestWeights)throw new uv("restoreBestWeights = True is not implemented in EarlyStopping yet.");return r.monitor=e.monitor||"val_loss",r.minDelta=Math.abs(e.minDelta||0),r.patience=e.patience||0,r.verbose=e.verbose||0,r.mode=e.mode||"auto",r.baseline=e.baseline,-1===["auto","min","max"].indexOf(r.mode)&&(console.warn("EarlyStopping mode '"+r.mode+"' is invalid. Falling back to mode 'auto'."),r.mode="auto"),"min"===r.mode?r.monitorFunc=Mk:"max"===r.mode?r.monitorFunc=Lk:-1!==r.monitor.indexOf("acc")?r.monitorFunc=Lk:r.monitorFunc=Mk,r.monitorFunc===Mk&&(r.minDelta*=-1),r}Qg(e,t),e.prototype.onTrainBegin=function(t){return rv(this,void 0,void 0,function(){return nv(this,function(t){return this.wait=0,this.stoppedEpoch=0,null!=this.baseline?this.best=this.baseline:this.best=this.monitorFunc===Mk?1/0:-1/0,[2]})})},e.prototype.onEpochEnd=function(t,e){return rv(this,void 0,void 0,function(){var r;return nv(this,function(n){switch(n.label){case 0:return[4,cy(e)];case 1:return n.sent(),null==(r=this.getMonitorValue(e))?[2]:(this.monitorFunc(r-this.minDelta,this.best)?(this.best=r,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=t,this.model.stopTraining=!0)),[2])}})})},e.prototype.onTrainEnd=function(t){return rv(this,void 0,void 0,function(){return nv(this,function(t){return this.stoppedEpoch>0&&this.verbose&&console.log("Epoch "+this.stoppedEpoch+": early stopping."),[2]})})},e.prototype.getMonitorValue=function(t){null==t&&(t={});var e=t[this.monitor];return null==e&&console.warn("Metric for EarlyStopping "+this.monitor+" is not available. Available metrics are: "+Object.keys(t)),e}}(function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.model=null,e}return Qg(e,t),e.prototype.setModel=function(t){if(!(t instanceof zx))throw new Error("model must be a LayersModel, not some other Container");this.model=t},e}(hy));var Pk=function(t,e){return(Pk=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function Bk(t,e){function r(){this.constructor=t}Pk(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}function qk(t,e,r,n){return new(r||(r=Promise))(function(o,a){function i(t){try{u(n.next(t))}catch(t){a(t)}}function s(t){try{u(n.throw(t))}catch(t){a(t)}}function u(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(i,s)}u((n=n.apply(t,e||[])).next())})}function Vk(t,e){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(t,i)}catch(t){a=[6,t],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function Wk(t,e){return t(e={exports:{}},e.exports),e.exports}var Uk=Wk(function(t){!function(t,e,r){function n(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function o(t,e){var r=new function(t){var e,r=this,n=(e=4022871197,function(t){t=t.toString();for(var r=0;r<t.length;r++){var n=.02519603282416938*(e+=t.charCodeAt(r));n-=e=n>>>0,e=(n*=e)>>>0,e+=4294967296*(n-=e)}return 2.3283064365386963e-10*(e>>>0)});r.next=function(){var t=2091639*r.s0+2.3283064365386963e-10*r.c;return r.s0=r.s1,r.s1=r.s2,r.s2=t-(r.c=0|t)},r.c=1,r.s0=n(" "),r.s1=n(" "),r.s2=n(" "),r.s0-=n(t),r.s0<0&&(r.s0+=1),r.s1-=n(t),r.s1<0&&(r.s1+=1),r.s2-=n(t),r.s2<0&&(r.s2+=1),n=null}(t),o=e&&e.state,a=r.next;return a.int32=function(){return 4294967296*r.next()|0},a.double=function(){return a()+1.1102230246251565e-16*(2097152*a()|0)},a.quick=a,o&&("object"==typeof o&&n(o,r),a.state=function(){return n(r,{})}),a}e&&e.exports?e.exports=o:this.alea=o}(0,t)}),jk=Wk(function(t){!function(t,e,r){function n(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function o(t,e){var r=new function(t){var e=this,r="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:r+=t;for(var n=0;n<r.length+64;n++)e.x^=0|r.charCodeAt(n),e.next()}(t),o=e&&e.state,a=function(){return(r.next()>>>0)/4294967296};return a.double=function(){do{var t=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},a.int32=r.next,a.quick=a,o&&("object"==typeof o&&n(o,r),a.state=function(){return n(r,{})}),a}e&&e.exports?e.exports=o:this.xor128=o}(0,t)}),Hk=Wk(function(t){!function(t,e,r){function n(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function o(t,e){var r=new function(t){var e=this,r="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:r+=t;for(var n=0;n<r.length+64;n++)e.x^=0|r.charCodeAt(n),n==r.length&&(e.d=e.x<<10^e.x>>>4),e.next()}(t),o=e&&e.state,a=function(){return(r.next()>>>0)/4294967296};return a.double=function(){do{var t=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},a.int32=r.next,a.quick=a,o&&("object"==typeof o&&n(o,r),a.state=function(){return n(r,{})}),a}e&&e.exports?e.exports=o:this.xorwow=o}(0,t)}),Gk=Wk(function(t){!function(t,e,r){function n(t,e){return e.x=t.x.slice(),e.i=t.i,e}function o(t,e){null==t&&(t=+new Date);var r=new function(t){var e=this;e.next=function(){var t,r,n=e.x,o=e.i;return t=n[o],r=(t^=t>>>7)^t<<24,r^=(t=n[o+1&7])^t>>>10,r^=(t=n[o+3&7])^t>>>3,r^=(t=n[o+4&7])^t<<7,t=n[o+7&7],r^=(t^=t<<13)^t<<9,n[o]=r,e.i=o+1&7,r},function(t,e){var r,n=[];if(e===(0|e))n[0]=e;else for(e=""+e,r=0;r<e.length;++r)n[7&r]=n[7&r]<<15^e.charCodeAt(r)+n[r+1&7]<<13;for(;n.length<8;)n.push(0);for(r=0;r<8&&0===n[r];++r);for(8==r?n[7]=-1:n[r],t.x=n,t.i=0,r=256;r>0;--r)t.next()}(e,t)}(t),o=e&&e.state,a=function(){return(r.next()>>>0)/4294967296};return a.double=function(){do{var t=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},a.int32=r.next,a.quick=a,o&&(o.x&&n(o,r),a.state=function(){return n(r,{})}),a}e&&e.exports?e.exports=o:this.xorshift7=o}(0,t)}),$k=Wk(function(t){!function(t,e,r){function n(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function o(t,e){null==t&&(t=+new Date);var r=new function(t){var e=this;e.next=function(){var t,r,n=e.w,o=e.X,a=e.i;return e.w=n=n+1640531527|0,r=o[a+34&127],t=o[a=a+1&127],r^=r<<13,t^=t<<17,r^=r>>>15,t^=t>>>12,r=o[a]=r^t,e.i=a,r+(n^n>>>16)|0},function(t,e){var r,n,o,a,i,s=[],u=128;for(e===(0|e)?(n=e,e=null):(e+="\0",n=0,u=Math.max(u,e.length)),o=0,a=-32;a<u;++a)e&&(n^=e.charCodeAt((a+32)%e.length)),0===a&&(i=n),n^=n<<10,n^=n>>>15,n^=n<<4,n^=n>>>13,a>=0&&(i=i+1640531527|0,o=0==(r=s[127&a]^=n+i)?o+1:0);for(o>=128&&(s[127&(e&&e.length||0)]=-1),o=127,a=512;a>0;--a)n=s[o+34&127],r=s[o=o+1&127],n^=n<<13,r^=r<<17,n^=n>>>15,r^=r>>>12,s[o]=n^r;t.w=i,t.X=s,t.i=o}(e,t)}(t),o=e&&e.state,a=function(){return(r.next()>>>0)/4294967296};return a.double=function(){do{var t=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},a.int32=r.next,a.quick=a,o&&(o.X&&n(o,r),a.state=function(){return n(r,{})}),a}e&&e.exports?e.exports=o:this.xor4096=o}(0,t)}),Kk=Wk(function(t){!function(t,e,r){function n(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function o(t,e){var r=new function(t){var e=this,r="";e.next=function(){var t=e.b,r=e.c,n=e.d,o=e.a;return t=t<<25^t>>>7^r,r=r-n|0,n=n<<24^n>>>8^o,o=o-t|0,e.b=t=t<<20^t>>>12^r,e.c=r=r-n|0,e.d=n<<16^r>>>16^o,e.a=o-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):r+=t;for(var n=0;n<r.length+20;n++)e.b^=0|r.charCodeAt(n),e.next()}(t),o=e&&e.state,a=function(){return(r.next()>>>0)/4294967296};return a.double=function(){do{var t=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},a.int32=r.next,a.quick=a,o&&("object"==typeof o&&n(o,r),a.state=function(){return n(r,{})}),a}e&&e.exports?e.exports=o:this.tychei=o}(0,t)}),Xk=Wk(function(t){!function(e,r){var n,o=this,a=256,i=6,s="random",u=r.pow(a,i),l=r.pow(2,52),c=2*l,p=a-1;function d(t,d,g){var v=[],b=f(function t(e,r){var n,o=[],a=typeof e;if(r&&"object"==a)for(n in e)try{o.push(t(e[n],r-1))}catch(t){}return o.length?o:"string"==a?e:e+"\0"}((d=1==d?{entropy:!0}:d||{}).entropy?[t,m(e)]:null==t?function(){try{var t;return n&&(t=n.randomBytes)?t=t(a):(t=new Uint8Array(a),(o.crypto||o.msCrypto).getRandomValues(t)),m(t)}catch(t){var r=o.navigator,i=r&&r.plugins;return[+new Date,o,i,o.screen,m(e)]}}():t,3),v),y=new function(t){var e,r=t.length,n=this,o=0,i=n.i=n.j=0,s=n.S=[];for(r||(t=[r++]);o<a;)s[o]=o++;for(o=0;o<a;o++)s[o]=s[i=p&i+t[o%r]+(e=s[o])],s[i]=e;(n.g=function(t){for(var e,r=0,o=n.i,i=n.j,s=n.S;t--;)e=s[o=p&o+1],r=r*a+s[p&(s[o]=s[i=p&i+e])+(s[i]=e)];return n.i=o,n.j=i,r})(a)}(v),x=function(){for(var t=y.g(i),e=u,r=0;t<l;)t=(t+r)*a,e*=a,r=y.g(1);for(;t>=c;)t/=2,e/=2,r>>>=1;return(t+r)/e};return x.int32=function(){return 0|y.g(4)},x.quick=function(){return y.g(4)/4294967296},x.double=x,f(m(y.S),e),(d.pass||g||function(t,e,n,o){return o&&(o.S&&h(o,y),t.state=function(){return h(y,{})}),n?(r[s]=t,e):t})(x,b,"global"in d?d.global:this==r,d.state)}function h(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function f(t,e){for(var r,n=t+"",o=0;o<n.length;)e[p&o]=p&(r^=19*e[p&o])+n.charCodeAt(o++);return m(e)}function m(t){return String.fromCharCode.apply(0,t)}if(r["seed"+s]=d,f(r.random(),e),t.exports){t.exports=d;try{n=require("crypto")}catch(t){}}}([],Math)});Xk.alea=Uk,Xk.xor128=jk,Xk.xorwow=Hk,Xk.xorshift7=Gk,Xk.xor4096=$k,Xk.tychei=Kk;var Yk=Xk.alea;function Jk(t,e,r,n){if(void 0===r&&(r=new Map),void 0===n&&(n=new Set),null==t)return null;if(n.has(t))throw new Error("Circular references are not supported.");if(r.has(t))return r.get(t);var o=e(t);if(o.recurse&&null!==o.value)throw new Error("A deep map function may not return both a value and recurse=true.");if(o.recurse){if(eC(t)){var a=Array.isArray(t)?[]:{};for(var i in n.add(t),t){var s=Jk(t[i],e,r,n);a[i]=s}return n.delete(t),a}throw new Error("Can't recurse into non-iterable type: "+t)}return r.set(t,o.value),o.value}function Zk(t,e){return void 0===e&&(e=Qk),function t(e,r,n){void 0===n&&(n=new Set);var o=e[0];if(n.has(o))throw new Error("Circular references are not supported.");var a=r(e);if(a.recurse&&null!==a.value)throw new Error("A deep zip function may not return both a value and recurse=true.");if(a.recurse){if(eC(o)){var i=Array.isArray(o)?[]:{};n.add(o);var s=function(o){var a=t(e.map(function(t){return t[o]}),r,n);i[o]=a};for(var u in o)s(u);return n.delete(o),i}throw new Error("Can't recurse into non-iterable type: "+o)}return a.value}(t,e)}function Qk(t){return null===t?null:eC(t[0])?{value:null,recurse:!0}:{value:t,recurse:!1}}function tC(t,e){return qk(this,void 0,void 0,function(){var r,n,o,a,i,s;return Vk(this,function(u){switch(u.label){case 0:r=new Map,Jk(t,e,r),n=0,o=Array.from(r.keys()),u.label=1;case 1:return n<o.length?(a=o[n],(i=r.get(a))instanceof Promise?[4,i]:[3,3]):[3,4];case 2:s=u.sent(),r.set(a,s),u.label=3;case 3:return n++,[3,1];case 4:return[2,Jk(t,e,r)]}})})}function eC(t){return null!=t&&!ArrayBuffer.isView(t)&&(Array.isArray(t)||"object"==typeof t&&!(t instanceof Cr))}function rC(t){return function(t,e){return Jk(t,e)}(t,nC)}function nC(t){return t instanceof Cr?{value:t.clone(),recurse:!1}:eC(t)?{value:null,recurse:!0}:{value:t,recurse:!1}}var oC=function(){function t(t){if(this.capacity=t,this.begin=0,this.end=0,null==t)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(t<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(t),this.doubledCapacity=2*t}return t.prototype.wrap=function(t){for(;t<0;)t+=this.doubledCapacity;return t%this.doubledCapacity},t.prototype.get=function(t){if(t<0)throw new RangeError("Can't get item at a negative index.");return this.data[t%this.capacity]},t.prototype.set=function(t,e){if(t<0)throw new RangeError("Can't set item at a negative index.");this.data[t%this.capacity]=e},t.prototype.length=function(){var t=this.end-this.begin;return t<0&&(t=this.doubledCapacity+t),t},t.prototype.isFull=function(){return this.length()===this.capacity},t.prototype.isEmpty=function(){return 0===this.length()},t.prototype.push=function(t){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,t),this.end=this.wrap(this.end+1)},t.prototype.pushAll=function(t){for(var e=0,r=t;e<r.length;e++){var n=r[e];this.push(n)}},t.prototype.pop=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);var t=this.get(this.end);return this.set(this.end,void 0),t},t.prototype.unshift=function(t){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,t)},t.prototype.shift=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var t=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),t},t.prototype.shuffleExcise=function(t){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var e=this.wrap(this.begin+t),r=this.get(e);return this.set(e,this.pop()),r},t}(),aC=function(t){function e(){return t.call(this,e.INITIAL_CAPACITY)||this}return Bk(e,t),e.prototype.isFull=function(){return!1},e.prototype.push=function(e){t.prototype.isFull.call(this)&&this.expand(),t.prototype.push.call(this,e)},e.prototype.unshift=function(e){t.prototype.isFull.call(this)&&this.expand(),t.prototype.unshift.call(this,e)},e.prototype.expand=function(){for(var t=2*this.capacity,e=new Array(t),r=this.length(),n=0;n<r;n++)e[n]=this.get(this.wrap(this.begin+n));this.data=e,this.capacity=t,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=r},e.INITIAL_CAPACITY=32,e}(oC);function iC(t){return new pC(t)}function sC(t,e){return new kC(t,e)}var uC,lC=function(){function t(){}return t.prototype.toArray=function(){return qk(this,void 0,void 0,function(){var t,e;return Vk(this,function(r){switch(r.label){case 0:return t=[],[4,this.next()];case 1:e=r.sent(),r.label=2;case 2:return e.done?[3,4]:(t.push(e.value),[4,this.next()]);case 3:return e=r.sent(),[3,2];case 4:return[2,t]}})})},t.prototype.toArrayForTest=function(){return qk(this,void 0,void 0,function(){var t,e,r;return Vk(this,function(n){switch(n.label){case 0:return t=this.prefetch(100),e=[],[4,t.next()];case 1:r=n.sent(),n.label=2;case 2:return r.done?[3,4]:(e.push(r.value),[4,t.next()]);case 3:return r=n.sent(),[3,2];case 4:return[2,e]}})})},t.prototype.resolveFully=function(){return qk(this,void 0,void 0,function(){var t;return Vk(this,function(e){switch(e.label){case 0:return[4,this.next()];case 1:t=e.sent(),e.label=2;case 2:return t.done?[3,4]:[4,this.next()];case 3:return t=e.sent(),[3,2];case 4:return[2]}})})},t.prototype.resolveWhile=function(t){return qk(this,void 0,void 0,function(){var e,r;return Vk(this,function(n){switch(n.label){case 0:return[4,this.next()];case 1:e=n.sent(),r=t(e.value),n.label=2;case 2:return e.done||!r?[3,4]:[4,this.next()];case 3:return e=n.sent(),r=t(e.value),[3,2];case 4:return[2]}})})},t.prototype.handleErrors=function(t){return new bC(this,t)},t.prototype.filter=function(t){return new gC(this,t)},t.prototype.map=function(t){return new vC(this,t)},t.prototype.mapAsync=function(t){return new yC(this,t)},t.prototype.serialMapAsync=function(t){return new yC(this,t).serial()},t.prototype.flatmap=function(t){return new wC(this,t)},t.prototype.forEachAsync=function(t){return qk(this,void 0,void 0,function(){return Vk(this,function(e){return[2,this.map(t).resolveFully()]})})},t.prototype.serialForEach=function(t){return qk(this,void 0,void 0,function(){return Vk(this,function(e){return[2,this.serialMapAsync(t).resolveWhile(function(t){return!0===t})]})})},t.prototype.rowMajorBatch=function(t,e){return void 0===e&&(e=!0),new mC(this,t,e)},t.prototype.columnMajorBatch=function(t,e,r){return void 0===e&&(e=!0),void 0===r&&(r=Qk),this.rowMajorBatch(t,e).map(function(t){return Zk(t,r)})},t.prototype.concatenate=function(t,e){return new kC(function(t){return new cC(t)}([this,t]),e)},t.prototype.take=function(t){return t<0||null==t?this:new fC(this,t)},t.prototype.skip=function(t){return t<0||null==t?this:new hC(this,t)},t.prototype.prefetch=function(t){return new CC(this,t)},t.prototype.shuffle=function(t,e){return new SC(this,t,e)},t.prototype.serial=function(){return new dC(this)},t}(),cC=function(t){function e(e){var r=t.call(this)||this;return r.items=e,r.trav=0,r}return Bk(e,t),e.prototype.summary=function(){return"Array of "+this.items.length+" items"},e.prototype.next=function(){return qk(this,void 0,void 0,function(){var t;return Vk(this,function(e){return this.trav>=this.items.length?[2,{value:null,done:!0}]:(t=this.items[this.trav],this.trav++,[2,{value:rC(t),done:!1}])})})},e}(lC),pC=function(t){function e(e){var r=t.call(this)||this;return r.nextFn=e,r}return Bk(e,t),e.prototype.summary=function(){return"Function call"},e.prototype.next=function(){return qk(this,void 0,void 0,function(){return Vk(this,function(t){try{return[2,this.nextFn()]}catch(t){throw t.message="Error thrown while iterating through a dataset: "+t.message,t}return[2]})})},e}(lC),dC=function(t){function e(e){var r=t.call(this)||this;return r.upstream=e,r.lastRead=Promise.resolve({value:null,done:!1}),r}return Bk(e,t),e.prototype.summary=function(){return this.upstream.summary()+" -> Serial"},e.prototype.next=function(){return qk(this,void 0,void 0,function(){var t=this;return Vk(this,function(e){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return qk(this,void 0,void 0,function(){return Vk(this,function(t){return[2,this.upstream.next()]})})},e}(lC),hC=function(t){function e(e,r){var n=t.call(this)||this;return n.upstream=e,n.maxCount=r,n.count=0,n.lastRead=Promise.resolve({value:null,done:!1}),n}return Bk(e,t),e.prototype.summary=function(){return this.upstream.summary()+" -> Skip"},e.prototype.next=function(){return qk(this,void 0,void 0,function(){var t=this;return Vk(this,function(e){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return qk(this,void 0,void 0,function(){var t;return Vk(this,function(e){switch(e.label){case 0:return this.count++<this.maxCount?[4,this.upstream.next()]:[3,2];case 1:return(t=e.sent()).done?[2,t]:(Qn(t.value),[3,0]);case 2:return[2,this.upstream.next()]}})})},e}(lC),fC=function(t){function e(e,r){var n=t.call(this)||this;return n.upstream=e,n.maxCount=r,n.count=0,n}return Bk(e,t),e.prototype.summary=function(){return this.upstream.summary()+" -> Take"},e.prototype.next=function(){return qk(this,void 0,void 0,function(){return Vk(this,function(t){return this.count++>=this.maxCount?[2,{value:null,done:!0}]:[2,this.upstream.next()]})})},e}(lC),mC=function(t){function e(e,r,n){void 0===n&&(n=!0);var o=t.call(this)||this;return o.upstream=e,o.batchSize=r,o.enableSmallLastBatch=n,o.lastRead=Promise.resolve({value:null,done:!1}),o}return Bk(e,t),e.prototype.summary=function(){return this.upstream.summary()+" -> RowMajorBatch"},e.prototype.next=function(){return qk(this,void 0,void 0,function(){var t=this;return Vk(this,function(e){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return qk(this,void 0,void 0,function(){var t,e;return Vk(this,function(r){switch(r.label){case 0:t=[],r.label=1;case 1:return t.length<this.batchSize?[4,this.upstream.next()]:[3,3];case 2:return(e=r.sent()).done?this.enableSmallLastBatch&&t.length>0?[2,{value:t,done:!1}]:[2,{value:null,done:!0}]:(t.push(e.value),[3,1]);case 3:return[2,{value:t,done:!1}]}})})},e}(lC),gC=function(t){function e(e,r){var n=t.call(this)||this;return n.upstream=e,n.predicate=r,n.lastRead=Promise.resolve({value:null,done:!1}),n}return Bk(e,t),e.prototype.summary=function(){return this.upstream.summary()+" -> Filter"},e.prototype.next=function(){return qk(this,void 0,void 0,function(){var t=this;return Vk(this,function(e){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return qk(this,void 0,void 0,function(){var t;return Vk(this,function(e){switch(e.label){case 0:return[4,this.upstream.next()];case 1:return(t=e.sent()).done||this.predicate(t.value)?[2,t]:(Qn(t.value),[3,0]);case 2:return[2]}})})},e}(lC),vC=function(t){function e(e,r){var n=t.call(this)||this;return n.upstream=e,n.transform=r,n}return Bk(e,t),e.prototype.summary=function(){return this.upstream.summary()+" -> Map"},e.prototype.next=function(){return qk(this,void 0,void 0,function(){var t,e,r,n,o,a,i;return Vk(this,function(s){switch(s.label){case 0:return[4,this.upstream.next()];case 1:if((t=s.sent()).done)return[2,{value:null,done:!0}];for(e=Pr.getTensorsInContainer(t.value),r=this.transform(t.value),n=Pr.getTensorsInContainer(r),o=0,a=e;o<a.length;o++)i=a[o],Pr.isTensorInList(i,n)||i.dispose();return[2,{value:r,done:!1}]}})})},e}(lC),bC=function(t){function e(e,r){var n=t.call(this)||this;return n.upstream=e,n.handler=r,n.count=0,n.lastRead=Promise.resolve({value:null,done:!1}),n}return Bk(e,t),e.prototype.summary=function(){return this.upstream.summary()+" -> handleErrors"},e.prototype.next=function(){return qk(this,void 0,void 0,function(){var t=this;return Vk(this,function(e){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return qk(this,void 0,void 0,function(){var t;return Vk(this,function(e){switch(e.label){case 0:e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.upstream.next()];case 2:return[2,e.sent()];case 3:return t=e.sent(),this.handler(t)?[3,4]:[2,{value:null,done:!0}];case 4:return[3,0];case 5:return[2]}})})},e}(lC),yC=function(t){function e(e,r){var n=t.call(this)||this;return n.upstream=e,n.transform=r,n}return Bk(e,t),e.prototype.summary=function(){return this.upstream.summary()+" -> AsyncMap"},e.prototype.next=function(){return qk(this,void 0,void 0,function(){var t,e,r,n,o,a,i;return Vk(this,function(s){switch(s.label){case 0:return[4,this.upstream.next()];case 1:return(t=s.sent()).done?[2,{value:null,done:!0}]:(e=Pr.getTensorsInContainer(t.value),[4,this.transform(t.value)]);case 2:for(r=s.sent(),n=Pr.getTensorsInContainer(r),o=0,a=e;o<a.length;o++)i=a[o],Pr.isTensorInList(i,n)||i.dispose();return[2,{value:r,done:!1}]}})})},e}(lC),xC=function(t){function e(){var e=t.call(this)||this;return e.outputQueue=new aC,e.lastRead=Promise.resolve({value:null,done:!1}),e}return Bk(e,t),e.prototype.next=function(){return qk(this,void 0,void 0,function(){var t=this;return Vk(this,function(e){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return qk(this,void 0,void 0,function(){return Vk(this,function(t){switch(t.label){case 0:return 0!==this.outputQueue.length()?[3,2]:[4,this.pump()];case 1:return t.sent()?[3,0]:[2,{value:null,done:!0}];case 2:return[2,{value:this.outputQueue.shift(),done:!1}]}})})},e}(lC),wC=function(t){function e(e,r){var n=t.call(this)||this;return n.upstream=e,n.transform=r,n}return Bk(e,t),e.prototype.summary=function(){return this.upstream.summary()+" -> Flatmap"},e.prototype.pump=function(){return qk(this,void 0,void 0,function(){var t,e,r,n,o,a,i;return Vk(this,function(s){switch(s.label){case 0:return[4,this.upstream.next()];case 1:if((t=s.sent()).done)return[2,!1];for(e=Pr.getTensorsInContainer(t.value),r=this.transform(t.value),n=Pr.getTensorsInContainer(r),this.outputQueue.pushAll(r),o=0,a=e;o<a.length;o++)i=a[o],Pr.isTensorInList(i,n)||i.dispose();return[2,!0]}})})},e}(xC),kC=function(t){function e(e,r){var n=t.call(this)||this;return n.baseErrorHandler=r,n.lastRead=null,n.iterator=null,n.moreIterators=e,n}return Bk(e,t),e.prototype.summary=function(){return"TODO: fill in upstream of chained summaries -> Chained"},e.prototype.next=function(){return qk(this,void 0,void 0,function(){return Vk(this,function(t){return this.lastRead=this.readFromChain(this.lastRead),[2,this.lastRead]})})},e.prototype.readFromChain=function(t){return qk(this,void 0,void 0,function(){var e,r;return Vk(this,function(n){switch(n.label){case 0:return[4,t];case 1:return n.sent(),null!=this.iterator?[3,3]:[4,this.moreIterators.next()];case 2:if((e=n.sent()).done)return[2,{value:null,done:!0}];this.iterator=e.value,null!=this.baseErrorHandler&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler)),n.label=3;case 3:return[4,this.iterator.next()];case 4:return(r=n.sent()).done?(this.iterator=null,[2,this.readFromChain(t)]):[2,r]}})})},e}(lC);!function(t){t[t.FAIL=0]="FAIL",t[t.SHORTEST=1]="SHORTEST",t[t.LONGEST=2]="LONGEST"}(uC||(uC={}));!function(t){function e(e,r){void 0===r&&(r=uC.FAIL);var n=t.call(this)||this;return n.iterators=e,n.mismatchMode=r,n.count=0,n.currentPromise=null,n}Bk(e,t),e.prototype.summary=function(){return"{TODO: fill in upstream of zip summaries} -> Zip"},e.prototype.nextState=function(t){return qk(this,void 0,void 0,function(){function e(t){return t instanceof lC?{value:t.next().then(function(t){return r++,t.done&&n++,t.value}),recurse:!1}:{value:null,recurse:!0}}var r,n,o;return Vk(this,function(a){switch(a.label){case 0:return[4,t];case 1:return a.sent(),r=0,n=0,[4,tC(this.iterators,e)];case 2:if(o=a.sent(),r===n)return[2,{value:null,done:!0}];if(n>0)switch(this.mismatchMode){case uC.FAIL:throw new Error("Zipped streams should have the same length. Mismatched at element "+this.count+".");case uC.SHORTEST:return[2,{value:null,done:!0}];case uC.LONGEST:}return this.count++,[2,{value:o,done:!1}]}})})},e.prototype.next=function(){return qk(this,void 0,void 0,function(){return Vk(this,function(t){return this.currentPromise=this.nextState(this.currentPromise),[2,this.currentPromise]})})}}(lC);var CC=function(t){function e(e,r){var n=t.call(this)||this;return n.upstream=e,n.bufferSize=r,n.buffer=new oC(r),n}return Bk(e,t),e.prototype.summary=function(){return this.upstream.summary()+" -> Prefetch"},e.prototype.refill=function(){for(;!this.buffer.isFull();){var t=this.upstream.next();this.buffer.push(t)}},e.prototype.next=function(){return this.refill(),this.buffer.shift()},e}(lC),SC=function(t){function e(e,r,n){var o=t.call(this,e,r)||this;return o.upstream=e,o.windowSize=r,o.upstreamExhausted=!1,o.random=Yk(n||cr.now().toString()),o.lastRead=Promise.resolve({value:null,done:!1}),o}return Bk(e,t),e.prototype.next=function(){return qk(this,void 0,void 0,function(){var t=this;return Vk(this,function(e){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.randomInt=function(t){return Math.floor(this.random()*t)},e.prototype.chooseIndex=function(){return this.randomInt(this.buffer.length())},e.prototype.serialNext=function(){return qk(this,void 0,void 0,function(){var t,e;return Vk(this,function(r){switch(r.label){case 0:this.upstreamExhausted||this.refill(),r.label=1;case 1:return this.buffer.isEmpty()?[3,3]:(t=this.chooseIndex(),[4,this.buffer.shuffleExcise(t)]);case 2:return(e=r.sent()).done?(this.upstreamExhausted=!0,[3,1]):(this.refill(),[2,e]);case 3:return[2,{value:null,done:!0}]}})})},e}(CC),EC=function(){function t(){this.size=null}return t.prototype.batch=function(t,e){var r=this;void 0===e&&(e=!0);var n=this;return cr.assert(t>0,function(){return"batchSize needs to be positive, but it is\n      "+t}),zC(function(){return qk(r,void 0,void 0,function(){return Vk(this,function(r){switch(r.label){case 0:return[4,n.iterator()];case 1:return[2,r.sent().columnMajorBatch(t,e,IC)]}})})},this.size===1/0||null==this.size?this.size:e?Math.ceil(this.size/t):Math.floor(this.size/t))},t.prototype.concatenate=function(t){var e=this,r=this;return zC(function(){return qk(e,void 0,void 0,function(){var e,n;return Vk(this,function(o){switch(o.label){case 0:return[4,r.iterator()];case 1:return n=(e=o.sent()).concatenate,[4,t.iterator()];case 2:return[2,n.apply(e,[o.sent()])]}})})},this.size===1/0||t.size===1/0?1/0:null!=this.size&&null!=t.size?this.size+t.size:null)},t.prototype.filter=function(t){var e=this,r=this;return zC(function(){return qk(e,void 0,void 0,function(){return Vk(this,function(e){switch(e.label){case 0:return[4,r.iterator()];case 1:return[2,e.sent().filter(function(e){return Zn(function(){return t(e)})})]}})})},this.size===1/0?1/0:null)},t.prototype.forEachAsync=function(t){return qk(this,void 0,void 0,function(){return Vk(this,function(e){switch(e.label){case 0:return[4,this.iterator()];case 1:return[2,e.sent().forEachAsync(t)]}})})},t.prototype.forEach=function(t){return qk(this,void 0,void 0,function(){return Vk(this,function(e){return Yn("dataset.forEach() is deprecated and will be removed. Please use dataset.forEachAsync() instead"),[2,this.forEachAsync(t)]})})},t.prototype.map=function(t){var e=this,r=this;return zC(function(){return qk(e,void 0,void 0,function(){return Vk(this,function(e){switch(e.label){case 0:return[4,r.iterator()];case 1:return[2,e.sent().map(function(e){return Zn(function(){return t(e)})})]}})})},this.size)},t.prototype.mapAsync=function(t){var e=this,r=this;return zC(function(){return qk(e,void 0,void 0,function(){return Vk(this,function(e){switch(e.label){case 0:return[4,r.iterator()];case 1:return[2,e.sent().mapAsync(t)]}})})},this.size)},t.prototype.prefetch=function(t){var e=this;if(null==t)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");var r=this;return zC(function(){return qk(e,void 0,void 0,function(){return Vk(this,function(e){switch(e.label){case 0:return[4,r.iterator()];case 1:return[2,e.sent().prefetch(t)]}})})},this.size)},t.prototype.repeat=function(t){var e=this,r=this;return zC(function(){return qk(e,void 0,void 0,function(){var e=this;return Vk(this,function(n){return[2,sC(iC(function(){return qk(e,void 0,void 0,function(){var t;return Vk(this,function(e){switch(e.label){case 0:return t={},[4,r.iterator()];case 1:return[2,(t.value=e.sent(),t.done=!1,t)]}})})}).take(t))]})})},null!=this.size&&t>0?this.size*t:0===t?0:null!=this.size&&(void 0===t||t<0)?1/0:null)},t.prototype.skip=function(t){var e=this,r=this;return zC(function(){return qk(e,void 0,void 0,function(){return Vk(this,function(e){switch(e.label){case 0:return[4,r.iterator()];case 1:return[2,e.sent().skip(t)]}})})},null!=this.size&&t>=0&&this.size>=t?this.size-t:null!=this.size&&(this.size<t||void 0===t||t<0)?0:null)},t.prototype.shuffle=function(t,e,r){var n=this;if(void 0===r&&(r=!0),null==t||t<0)throw null==this.size?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting bufferSize to the dataset size ("+this.size+" elements)");var o=this,a=Yk(e||cr.now().toString());return zC(function(){return qk(n,void 0,void 0,function(){var e;return Vk(this,function(n){switch(n.label){case 0:return e=a.int32(),r&&(e+=a.int32()),[4,o.iterator()];case 1:return[2,n.sent().shuffle(t,e.toString())]}})})},this.size)},t.prototype.take=function(t){var e=this,r=this;return zC(function(){return qk(e,void 0,void 0,function(){return Vk(this,function(e){switch(e.label){case 0:return[4,r.iterator()];case 1:return[2,e.sent().take(t)]}})})},null!=this.size&&this.size>t?t:null!=this.size&&this.size<=t?this.size:null)},t.prototype.toArray=function(){return qk(this,void 0,void 0,function(){return Vk(this,function(t){switch(t.label){case 0:if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return[4,this.iterator()];case 1:return[2,t.sent().toArray()]}})})},t.prototype.toArrayForTest=function(){return qk(this,void 0,void 0,function(){return Vk(this,function(t){switch(t.label){case 0:if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return[4,this.iterator()];case 1:return[2,t.sent().toArrayForTest()]}})})},t.MAX_BUFFER_SIZE=1e4,t}();function zC(t,e){return void 0===e&&(e=null),new(function(r){function n(){var t=null!==r&&r.apply(this,arguments)||this;return t.size=e,t}return Bk(n,r),n.prototype.iterator=function(){return qk(this,void 0,void 0,function(){return Vk(this,function(e){return[2,t()]})})},n}(EC))}function IC(t){return null===t?null:function(t){return null==t||function(t){return null===t||"object"!=typeof t&&"function"!=typeof t}(t)||Array.isArray(t)||"object"==typeof t&&t instanceof Cr||cr.isTypedArray(t)}(t[0])?{value:AC(t),recurse:!1}:{value:null,recurse:!0}}function AC(t){if(0===t.length)throw new Error("Can't make a batch of zero elements.");return t[0]instanceof Cr?za(t):ko(t)}var NC=function(t){function e(e){var r=t.call(this)||this;return r.input=e,r}return Bk(e,t),e.prototype.iterator=function(){return qk(this,void 0,void 0,function(){var t;return Vk(this,function(e){switch(e.label){case 0:return[4,this.input.iterator()];case 1:return t=e.sent(),[2,t.decodeUTF8().split("\n").map(function(t){return t.endsWith("\r")&&(t=t.slice(0,-1)),t})]}})})},e}(EC),RC=Symbol("out"),TC=Symbol("field"),DC=Symbol("quote"),_C=Symbol("quoteafterquote"),OC=Symbol("quoteinquote"),FC=(function(t){function e(e,r){var n=t.call(this)||this;return n.input=e,n.hasHeader=!0,n.fullColumnNames=null,n.columnNamesValidated=!1,n.columnConfigs=null,n.configuredColumnsOnly=!1,n.delimiter=",",n.delimWhitespace=!1,n.base=new NC(e),r||(r={}),n.hasHeader=!1!==r.hasHeader,n.fullColumnNames=r.columnNames,n.columnConfigs=r.columnConfigs,n.configuredColumnsOnly=r.configuredColumnsOnly,r.delimWhitespace?(cr.assert(null==r.delimiter,function(){return"Delimiter should not be provided when delimWhitespace is true."}),n.delimWhitespace=!0,n.delimiter=" "):n.delimiter=r.delimiter?r.delimiter:",",n}Bk(e,t),e.prototype.columnNames=function(){return qk(this,void 0,void 0,function(){return Vk(this,function(t){switch(t.label){case 0:return this.columnNamesValidated?[3,2]:[4,this.setColumnNames()];case 1:t.sent(),t.label=2;case 2:return[2,this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames]}})})},e.prototype.setColumnNames=function(){return qk(this,void 0,void 0,function(){var t,e,r,n,o,a,i=this;return Vk(this,function(s){switch(s.label){case 0:return[4,this.maybeReadHeaderLine()];case 1:if(t=s.sent(),!this.fullColumnNames&&!t)throw new Error("Column names must be provided if there is no header line.");if(this.fullColumnNames&&t&&cr.assert(t.length===this.fullColumnNames.length,function(){return"The length of provided columnNames ("+i.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+t.length.toString()+")."}),this.fullColumnNames||(this.fullColumnNames=t),e=this.fullColumnNames.reduce(function(t,e){return t[e]=t[e]+1||1,t},{}),r=Object.keys(e).filter(function(t){return e[t]>1}),cr.assert(0===r.length,function(){return"Duplicate column names found: "+r.toString()}),this.columnConfigs)for(n=0,o=Object.keys(this.columnConfigs);n<o.length;n++)if(a=o[n],-1===this.fullColumnNames.indexOf(a))throw new Error('The key "'+a+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").");return this.columnNamesValidated=!0,[2]}})})},e.prototype.maybeReadHeaderLine=function(){return qk(this,void 0,void 0,function(){var t,e;return Vk(this,function(r){switch(r.label){case 0:return this.hasHeader?[4,this.base.iterator()]:[3,3];case 1:return[4,r.sent().next()];case 2:if((t=r.sent()).done)throw new Error("No data was found for CSV parsing.");return e=t.value,[2,this.parseRow(e,!1)];case 3:return[2,null]}})})},e.prototype.iterator=function(){return qk(this,void 0,void 0,function(){var t,e=this;return Vk(this,function(r){switch(r.label){case 0:return this.columnNamesValidated?[3,2]:[4,this.setColumnNames()];case 1:r.sent(),r.label=2;case 2:return[4,this.base.iterator()];case 3:return t=r.sent(),this.hasHeader&&(t=t.skip(1)),[2,t.map(function(t){return e.makeDataElement(t)})]}})})},e.prototype.makeDataElement=function(t){for(var e=this.parseRow(t),r={},n={},o=0;o<this.fullColumnNames.length;o++){var a=this.fullColumnNames[o],i=this.columnConfigs?this.columnConfigs[a]:null;if(!this.configuredColumnsOnly||i){var s=e[o],u=null;if(""===s)if(i&&void 0!==i.default)u=i.default;else{if(i&&(i.required||i.isLabel))throw new Error("Required column "+a+" is empty in this line: "+t);u=void 0}else{var l=Number(s);if(isNaN(l))u=i&&"bool"===i.dtype?this.getBoolean(s):s;else if(i&&i.dtype)switch(i.dtype){case"float32":u=l;break;case"int32":u=Math.floor(l);break;case"bool":u=this.getBoolean(s);break;default:u=l}else u=l}i&&i.isLabel?n[a]=u:r[a]=u}}return 0===Object.keys(n).length?r:{xs:r,ys:n}},e.prototype.getBoolean=function(t){return"1"===t||"true"===t.toLowerCase()?1:0},e.prototype.parseRow=function(t,e){void 0===e&&(e=!0);for(var r=[],n=0,o=t.length,a=RC,i=0;i<o;i++)switch(a){case RC:switch(t.charAt(i)){case'"':n=i+1,a=DC;break;case this.delimiter:if(n=i+1," "===this.delimiter&&this.delimWhitespace)break;r.push(""),a=RC;break;default:a=TC,n=i}break;case TC:switch(t.charAt(i)){case this.delimiter:r.push(t.substring(n,i)),a=RC,n=i+1}break;case DC:switch(t.charAt(i)){case'"':a=_C}break;case _C:switch(t.charAt(i)){case this.delimiter:r.push(t.substring(n,i-1)),a=RC,n=i+1;break;case'"':a=DC;break;default:a=OC}break;case OC:switch(t.charAt(i)){case'"':a=DC}}if(a===_C?r.push(t.substring(n,o-1)):r.push(t.substring(n)),e&&r.length!==this.fullColumnNames.length)throw new Error("Invalid row in csv file. Should have "+this.fullColumnNames.length+" elements in a row, but got "+r);return r}}(EC),function(t){function e(e){var r=t.call(this)||this;r.microphoneConfig=e,r.isClosed=!1,r.fftSize=e.fftSize||1024;var n=Math.log2(r.fftSize);if(r.fftSize<0||n<4||n>14||!Number.isInteger(n))throw new Error("Invalid fftSize: it must be a power of 2 between 2 to 4 and 2 to 14, but got "+r.fftSize);if(r.numFrames=e.numFramesPerSpectrogram||43,r.sampleRateHz=e.sampleRateHz,r.columnTruncateLength=e.columnTruncateLength||r.fftSize,r.audioTrackConstraints=e.audioTrackConstraints,r.smoothingTimeConstant=e.smoothingTimeConstant||0,r.includeSpectrogram=!1!==e.includeSpectrogram,r.includeWaveform=!0===e.includeWaveform,!r.includeSpectrogram&&!r.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.");return r}Bk(e,t),e.prototype.summary=function(){return"microphone"},e.create=function(t){return void 0===t&&(t={}),qk(this,void 0,void 0,function(){var r;return Vk(this,function(n){switch(n.label){case 0:if(ge().get("IS_NODE"))throw new Error("microphone API is only supported in browser environment.");return[4,(r=new e(t)).start()];case 1:return n.sent(),[2,r]}})})},e.prototype.start=function(){return qk(this,void 0,void 0,function(){var t,e,r,n;return Vk(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),t=this,[4,navigator.mediaDevices.getUserMedia({audio:null==this.audioTrackConstraints||this.audioTrackConstraints,video:!1})];case 1:return t.stream=o.sent(),[3,3];case 2:throw e=o.sent(),new Error("Error thrown while initializing video stream: "+e.message);case 3:if(!this.stream)throw new Error("Could not obtain audio from microphone.");if(r=window.AudioContext||window.webkitAudioContext,this.audioContext=new r,this.sampleRateHz){if(this.audioContext.sampleRate!==this.sampleRateHz)throw new Error("Mismatch in sampling rate: Expected: "+this.sampleRateHz+"; Actual: "+this.audioContext.sampleRate)}else this.sampleRateHz=this.audioContext.sampleRate;return n=this.audioContext.createMediaStreamSource(this.stream),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2*this.fftSize,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,n.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize),[2]}})})},e.prototype.next=function(){return qk(this,void 0,void 0,function(){var t,e,r,n,o;return Vk(this,function(a){switch(a.label){case 0:return this.isClosed?[2,{value:null,done:!0}]:[4,this.getAudioData()];case 1:return r=a.sent(),this.includeSpectrogram&&(n=this.flattenQueue(r.freqDataQueue),t=this.getTensorFromAudioDataArray(n,[this.numFrames,this.columnTruncateLength,1])),this.includeWaveform&&(o=this.flattenQueue(r.timeDataQueue),e=this.getTensorFromAudioDataArray(o,[this.numFrames*this.fftSize,1])),[2,{value:{spectrogram:t,waveform:e},done:!1}]}})})},e.prototype.capture=function(){return qk(this,void 0,void 0,function(){return Vk(this,function(t){switch(t.label){case 0:return[4,this.next()];case 1:return[2,t.sent().value]}})})},e.prototype.getAudioData=function(){return qk(this,void 0,void 0,function(){var t,e,r,n=this;return Vk(this,function(o){return t=[],e=[],r=0,[2,new Promise(function(o){var a=setInterval(function(){n.includeSpectrogram&&(n.analyser.getFloatFrequencyData(n.freqData),n.freqData[0]===-1/0&&o({freqDataQueue:t,timeDataQueue:e}),t.push(n.freqData.slice(0,n.columnTruncateLength))),n.includeWaveform&&(n.analyser.getFloatTimeDomainData(n.timeData),e.push(n.timeData.slice())),++r===n.numFrames&&(clearInterval(a),o({freqDataQueue:t,timeDataQueue:e}))},n.fftSize/n.sampleRateHz*1e3)})]})})},e.prototype.stop=function(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),null!=this.stream&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())},e.prototype.toArray=function(){throw new Error("Can not convert infinite audio stream to array.")},e.prototype.getSampleRate=function(){return this.sampleRateHz},e.prototype.flattenQueue=function(t){var e=t[0].length,r=new Float32Array(t.length*e);return t.forEach(function(t,n){return r.set(t,n*e)}),r},e.prototype.getTensorFromAudioDataArray=function(t,e){var r=new Float32Array(cr.sizeFromShape(e));return r.set(t,r.length-t.length),ko(r,e)}}(lC),function(t){function e(e,r){var n=t.call(this)||this;if(n.webcamVideoElement=e,n.webcamConfig=r,n.isClosed=!0,n.resize=!1,n.needToResize())if(n.resize=!0,n.cropSize=[n.webcamConfig.resizeHeight,n.webcamConfig.resizeWidth],n.cropBoxInd=Eo([0],"int32"),n.webcamConfig.centerCrop){var o=1*n.webcamConfig.resizeWidth/n.webcamVideoElement.width,a=1*n.webcamConfig.resizeHeight/n.webcamVideoElement.height,i=(1-o)/2,s=(1-a)/2,u=i+o,l=a+s;n.cropBox=zo([s,i,l,u],[1,4])}else n.cropBox=zo([0,0,1,1],[1,4]);return n}Bk(e,t),e.prototype.summary=function(){return"webcam"},e.create=function(t,r){return void 0===r&&(r={}),qk(this,void 0,void 0,function(){var n;return Vk(this,function(o){switch(o.label){case 0:if(ge().get("IS_NODE"))throw new Error("tf.data.webcam is only supported in browser environment.");if(!t){if(t=document.createElement("video"),!r.resizeWidth||!r.resizeHeight)throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");t.width=r.resizeWidth,t.height=r.resizeHeight}return[4,(n=new e(t,r)).start()];case 1:return o.sent(),[2,n]}})})},e.prototype.start=function(){return qk(this,void 0,void 0,function(){var t,e,r=this;return Vk(this,function(n){switch(n.label){case 0:this.webcamConfig.facingMode&&cr.assert("user"===this.webcamConfig.facingMode||"environment"===this.webcamConfig.facingMode,function(){return"Invalid webcam facing mode: "+r.webcamConfig.facingMode+". Please provide 'user' or 'environment'"}),n.label=1;case 1:return n.trys.push([1,3,,4]),t=this,[4,navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}})];case 2:return t.stream=n.sent(),[3,4];case 3:throw(e=n.sent()).message="Error thrown while initializing video stream: "+e.message,e;case 4:if(!this.stream)throw new Error("Could not obtain video from webcam.");try{this.webcamVideoElement.srcObject=this.stream}catch(t){console.log(t),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return this.webcamVideoElement.play(),this.isClosed=!1,[2,new Promise(function(t){r.webcamVideoElement.onloadedmetadata=function(){t()}})]}})})},e.prototype.next=function(){return qk(this,void 0,void 0,function(){var t;return Vk(this,function(e){if(this.isClosed)return[2,{value:null,done:!0}];try{t=of.fromPixels(this.webcamVideoElement)}catch(t){throw new Error("Error thrown converting video to pixels: "+JSON.stringify(t))}if(!this.resize)return[2,{value:t,done:!1}];try{return[2,{value:this.cropAndResizeFrame(t),done:!1}]}catch(t){throw new Error("Error thrown cropping the video: "+t.message)}finally{t.dispose()}return[2]})})},e.prototype.needToResize=function(){return!(!this.webcamConfig.resizeWidth||!this.webcamConfig.resizeHeight||this.webcamVideoElement.width===this.webcamConfig.resizeWidth&&this.webcamVideoElement.height===this.webcamConfig.resizeHeight)},e.prototype.cropAndResizeFrame=function(t){var e=this;return Zn(function(){var r,n=t.toFloat().expandDims(0),o=(r=jd.cropAndResize(n,e.cropBox,e.cropBoxInd,e.cropSize,"bilinear")).shape;return r.reshape(o.slice(1))})},e.prototype.capture=function(){return qk(this,void 0,void 0,function(){return Vk(this,function(t){switch(t.label){case 0:return[4,this.next()];case 1:return[2,t.sent().value]}})})},e.prototype.stop=function(){this.stream.getTracks().forEach(function(t){return t.stop()});try{this.webcamVideoElement.srcObject=null}catch(t){console.log(t),this.webcamVideoElement.src=null}this.isClosed=!0},e.prototype.toArray=function(){throw new Error("Can not convert infinite video stream to array.")}}(lC),function(){}),MC=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Bk(e,t),e.prototype.split=function(t){return new LC(this,t)},e}(lC),LC=function(t){function e(e,r){var n=t.call(this)||this;return n.upstream=e,n.impl=new PC(e,r),n}return Bk(e,t),e.prototype.summary=function(){return this.impl.summary()},e.prototype.next=function(){return qk(this,void 0,void 0,function(){return Vk(this,function(t){return[2,this.impl.next()]})})},e}(MC),PC=function(t){function e(e,r){var n=t.call(this)||this;return n.upstream=e,n.separator=r,n.carryover="",n}return Bk(e,t),e.prototype.summary=function(){return this.upstream.summary()+" -> Split('"+this.separator+"')"},e.prototype.pump=function(){return qk(this,void 0,void 0,function(){var t,e,r,n,o;return Vk(this,function(a){switch(a.label){case 0:return[4,this.upstream.next()];case 1:if((t=a.sent()).done)return""===this.carryover?[2,!1]:(this.outputQueue.push(this.carryover),this.carryover="",[2,!0]);for((e=t.value.split(this.separator))[0]=this.carryover+e[0],r=0,n=e.slice(0,-1);r<n.length;r++)o=n[r],this.outputQueue.push(o);return this.carryover=e[e.length-1],[2,!0]}})})},e}(xC),BC=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Bk(e,t),e.prototype.decodeUTF8=function(){return new qC(this)},e}(lC),qC=function(t){function e(e){var r=t.call(this)||this;return r.upstream=e,r.impl=new VC(e),r}return Bk(e,t),e.prototype.summary=function(){return this.impl.summary()},e.prototype.next=function(){return qk(this,void 0,void 0,function(){return Vk(this,function(t){return[2,this.impl.next()]})})},e}(MC),VC=function(t){function e(e){var r=t.call(this)||this;if(r.upstream=e,ge().get("IS_BROWSER"))r.decoder=new TextDecoder("utf-8");else{var n=require("string_decoder").StringDecoder;r.decoder=new n("utf8")}return r}return Bk(e,t),e.prototype.summary=function(){return this.upstream.summary()+" -> Utf8"},e.prototype.pump=function(){return qk(this,void 0,void 0,function(){var t,e,r;return Vk(this,function(n){switch(n.label){case 0:return[4,this.upstream.next()];case 1:return(t=n.sent()).done?[2,!1]:(e=t.value,r=ge().get("IS_BROWSER")?this.decoder.decode(e,{stream:!0}):this.decoder.write(Buffer.from(e.buffer)),this.outputQueue.push(r),[2,!0])}})})},e}(xC),WC=function(t){function e(e,r){void 0===r&&(r={});var n=t.call(this)||this;return n.file=e,n.options=r,cr.assert(e instanceof Uint8Array||!!ge().get("IS_BROWSER")&&(e instanceof File||e instanceof Blob),function(){return"FileChunkIterator only supports File, Blob and Uint8Array right now."}),n.offset=r.offset||0,n.chunkSize=r.chunkSize||1048576,n}return Bk(e,t),e.prototype.summary=function(){return"FileChunks "+this.file},e.prototype.next=function(){return qk(this,void 0,void 0,function(){var t,e,r=this;return Vk(this,function(n){switch(n.label){case 0:return this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size)?[2,{value:null,done:!0}]:(t=new Promise(function(t,e){var n=r.offset+r.chunkSize;if(r.file instanceof Uint8Array)t(new Uint8Array(r.file.slice(r.offset,n)));else{var o=new FileReader;o.onload=function(r){var n=o.result;if(n instanceof ArrayBuffer&&(n=new Uint8Array(n)),!(n instanceof Uint8Array))return e(new TypeError("FileReader returned unknown type."));t(n)},o.onabort=function(t){return e(new Error("Aborted"))},o.onerror=function(t){return e(new Error(t.type))};var a=r.file.slice(r.offset,n);o.readAsArrayBuffer(a)}r.offset=n}),e={},[4,t]);case 1:return[2,(e.value=n.sent(),e.done=!1,e)]}})})},e}(BC);function UC(t,e){return void 0===e&&(e={}),qk(this,void 0,void 0,function(){var r,n,o,a,i;return Vk(this,function(s){switch(s.label){case 0:return"string"==typeof t?r=t:(r=t.url,n=jC(t)),[4,cr.fetch(r,n)];case 1:return(o=s.sent()).ok?(i=Uint8Array.bind,[4,o.arrayBuffer()]):[3,3];case 2:return a=new(i.apply(Uint8Array,[void 0,s.sent()])),[2,new WC(a,e)];case 3:throw new Error(o.statusText)}})})}var jC=function(t){return{method:t.method,headers:t.headers,body:t.body,mode:t.mode,credentials:t.credentials,cache:t.cache,redirect:t.redirect,referrer:t.referrer,integrity:t.integrity}};function HC(t){return"string"==typeof t&&"file://"===t.substr(0,7)}var GC=function(t){function e(e,r){void 0===r&&(r={});var n=t.call(this)||this;return n.input=e,n.options=r,n}return Bk(e,t),e.prototype.iterator=function(){return qk(this,void 0,void 0,function(){var t;return Vk(this,function(e){return HC(this.input)&&ge().get("IS_NODE")&&(t=require("fs"),this.input=t.readFileSync(this.input.substr(7))),[2,new WC(this.input,this.options)]})})},e}(FC);!function(t){function e(e,r){void 0===r&&(r={});var n=t.call(this)||this;return n.url=e,n.fileOptions=r,n}Bk(e,t),e.prototype.iterator=function(){return qk(this,void 0,void 0,function(){return Vk(this,function(t){return HC(this.url)?[2,new GC(this.url,this.fileOptions).iterator()]:[2,UC(this.url,this.fileOptions)]})})}}(FC);const $C="aqua",KC="red";function XC(t,e,r,n,o){t.beginPath(),t.arc(r,e,n,0,2*Math.PI),t.fillStyle=o,t.fill()}function YC(t,e){const r=t.reduce(function(t,e){var r=t.maxX,n=t.maxY,o=t.minX,a=t.minY,i=e.position,s=i.x,u=i.y;return{maxX:Math.max(r,s),maxY:Math.max(n,u),minX:Math.min(o,s),minY:Math.min(a,u)}},{maxX:Rg,maxY:Rg,minX:Tg,minY:Tg});e.rect(r.minX,r.minY,r.maxX-r.minX,r.maxY-r.minY),e.strokeStyle=KC,e.stroke()}const JC=5120,ZC=5121,QC=5122,tS=5123,eS=5124,rS=5125,nS=5126,oS={};{const t=oS;t[JC]=Int8Array,t[ZC]=Uint8Array,t[QC]=Int16Array,t[tS]=Uint16Array,t[eS]=Int32Array,t[rS]=Uint32Array,t[nS]=Float32Array,t[32819]=Uint16Array,t[32820]=Uint16Array,t[33635]=Uint16Array,t[5131]=Uint16Array,t[33640]=Uint32Array,t[35899]=Uint32Array,t[35902]=Uint32Array,t[36269]=Uint32Array,t[34042]=Uint32Array}function aS(t){if(t instanceof Int8Array)return JC;if(t instanceof Uint8Array)return ZC;if(t instanceof Uint8ClampedArray)return ZC;if(t instanceof Int16Array)return QC;if(t instanceof Uint16Array)return tS;if(t instanceof Int32Array)return eS;if(t instanceof Uint32Array)return rS;if(t instanceof Float32Array)return nS;throw new Error("unsupported typed array type")}const iS="undefined"!=typeof SharedArrayBuffer?function(t){return t&&t.buffer&&(t.buffer instanceof ArrayBuffer||t.buffer instanceof SharedArrayBuffer)}:function(t){return t&&t.buffer&&t.buffer instanceof ArrayBuffer};function sS(){console.error(...arguments)}function uS(t,e){return"undefined"!=typeof WebGLTexture&&e instanceof WebGLTexture}const lS=35044,cS=34962,pS=34963,dS=34660,hS=5120,fS=5121,mS=5122,gS=5123,vS=5124,bS=5125,yS=5126,xS={attribPrefix:""};function wS(t,e,r,n){if(o=e,"undefined"!=typeof WebGLBuffer&&o instanceof WebGLBuffer)return e;var o;r=r||cS;const a=t.createBuffer();return function(t,e,r,n,o){t.bindBuffer(e,r),t.bufferData(e,n,o||lS)}(t,r,a,e,n),a}function kS(t){return"indices"===t}const CS=/coord|texture/i,SS=/color|colour/i;function ES(t,e){let r;if(e%(r=CS.test(t)?2:SS.test(t)?4:3)>0)throw new Error(`Can not guess numComponents for attribute '${t}'. Tried ${r} but ${e} values is not evenly divisible by ${r}. You should specify it.`);return r}function zS(t,e){if(iS(t))return t;if(iS(t.data))return t.data;Array.isArray(t)&&(t={data:t});let r=t.type;return r||(r=kS(e)?Uint16Array:Float32Array),new r(t.data)}function IS(t,e){const r={};return Object.keys(e).forEach(function(n){if(!kS(n)){const a=e[n],i=a.attrib||a.name||a.attribName||xS.attribPrefix+n;if(a.value){if(!Array.isArray(a.value)&&!iS(a.value))throw new Error("array.value is not array or typedarray");r[i]={value:a.value}}else{let e,s,u,l;if(a.buffer&&a.buffer instanceof WebGLBuffer)e=a.buffer,l=a.numComponents||a.size,s=a.type,u=a.normalize;else if("number"==typeof a||"number"==typeof a.data){const r=a.data||a,i=a.type||Float32Array,c=r*i.BYTES_PER_ELEMENT;s=function(t){if(t===Int8Array)return JC;if(t===Uint8Array)return ZC;if(t===Uint8ClampedArray)return ZC;if(t===Int16Array)return QC;if(t===Uint16Array)return tS;if(t===Int32Array)return eS;if(t===Uint32Array)return rS;if(t===Float32Array)return nS;throw new Error("unsupported typed array type")}(i),u=void 0!==a.normalize?a.normalize:(o=i)===Int8Array||o===Uint8Array,l=a.numComponents||a.size||ES(n,r),e=t.createBuffer(),t.bindBuffer(cS,e),t.bufferData(cS,c,a.drawType||lS)}else{const r=zS(a,n);e=wS(t,r,void 0,a.drawType),s=aS(r),u=void 0!==a.normalize?a.normalize:function(t){return t instanceof Int8Array||t instanceof Uint8Array}(r),l=function(t,e){return t.numComponents||t.size||ES(e,function(t){return t.length?t:t.data}(t).length)}(a,n)}r[i]={buffer:e,numComponents:l,type:s,normalize:u,stride:a.stride||0,offset:a.offset||0,divisor:void 0===a.divisor?void 0:a.divisor,drawType:a.drawType}}}var o}),t.bindBuffer(cS,null),r}const AS=["position","positions","a_position"];function NS(t,e){let r,n;for(n=0;n<AS.length&&!((r=AS[n])in e)&&!((r=xS.attribPrefix+r)in e);++n);n===AS.length&&(r=Object.keys(e)[0]);const o=e[r];t.bindBuffer(cS,o.buffer);const a=t.getBufferParameter(cS,dS);var i;t.bindBuffer(cS,null);const s=a/((i=o.type)===hS?1:i===fS?1:i===mS?2:i===gS?2:i===vS?4:i===bS?4:i===yS?4:0),u=o.numComponents||o.size,l=s/u;if(l%1!=0)throw new Error(`numComponents ${u} not correct for length ${length}`);return l}function RS(t){return!!t.texStorage2D}const TS=function(){const t={},e={};return function(r,n){return function(r){const n=r.constructor.name;if(!t[n]){for(const t in r)if("number"==typeof r[t]){const n=e[r[t]];e[r[t]]=n?`${n} | ${t}`:t}t[n]=!0}}(r),e[n]||"0x"+n.toString(16)}}(),DS={textureColor:new Uint8Array([128,192,255,255]),textureOptions:{},crossOrigin:void 0},_S=iS;let OS;function FS(){return OS=OS||("undefined"!=typeof document&&document.createElement?document.createElement("canvas").getContext("2d"):null)}const MS=6406,LS=6407,PS=6408,BS=6409,qS=6410,VS=6402,WS=34041,US=33071,jS=9728,HS=9729,GS=3553,$S=34067,KS=32879,XS=35866,YS=34069,JS=34070,ZS=34071,QS=34072,tE=34073,eE=34074,rE=10241,nE=10240,oE=10242,aE=10243,iE=32882,sE=33082,uE=33083,lE=33084,cE=33085,pE=3317,dE=3314,hE=32878,fE=3316,mE=3315,gE=32877,vE=37443,bE=37441,yE=37440,xE=33321,wE=36756,kE=33325,CE=33326,SE=33330,EE=33329,zE=33338,IE=33337,AE=33340,NE=33339,RE=33323,TE=36757,DE=33327,_E=33328,OE=33336,FE=33335,ME=33332,LE=33331,PE=33334,BE=33333,qE=32849,VE=35905,WE=36194,UE=36758,jE=35898,HE=35901,GE=34843,$E=34837,KE=36221,XE=36239,YE=36215,JE=36233,ZE=36209,QE=36227,tz=32856,ez=35907,rz=36759,nz=32855,oz=32854,az=32857,iz=34842,sz=34836,uz=36220,lz=36238,cz=36975,pz=36214,dz=36232,hz=36226,fz=36208,mz=33189,gz=33190,vz=36012,bz=36013,yz=35056,xz=5120,wz=5121,kz=5122,Cz=5123,Sz=5124,Ez=5125,zz=5126,Iz=32819,Az=32820,Nz=33635,Rz=5131,Tz=36193,Dz=33640,_z=35899,Oz=35902,Fz=36269,Mz=34042,Lz=33319,Pz=33320,Bz=6403,qz=36244,Vz=36248,Wz=36249;let Uz;function jz(t){if(!Uz){const t={};t[MS]={textureFormat:MS,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1,2,2,4],type:[wz,Rz,Tz,zz]},t[BS]={textureFormat:BS,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1,2,2,4],type:[wz,Rz,Tz,zz]},t[qS]={textureFormat:qS,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[2,4,4,8],type:[wz,Rz,Tz,zz]},t[LS]={textureFormat:LS,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3,6,6,12,2],type:[wz,Rz,Tz,zz,Nz]},t[PS]={textureFormat:PS,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,8,8,16,2,2],type:[wz,Rz,Tz,zz,Iz,Az]},t[xE]={textureFormat:Bz,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1],type:[wz]},t[wE]={textureFormat:Bz,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[1],type:[xz]},t[kE]={textureFormat:Bz,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[4,2],type:[zz,Rz]},t[CE]={textureFormat:Bz,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[4],type:[zz]},t[SE]={textureFormat:qz,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[1],type:[wz]},t[EE]={textureFormat:qz,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[1],type:[xz]},t[ME]={textureFormat:qz,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[Cz]},t[LE]={textureFormat:qz,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[kz]},t[PE]={textureFormat:qz,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Ez]},t[BE]={textureFormat:qz,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Sz]},t[RE]={textureFormat:Lz,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[2],type:[wz]},t[TE]={textureFormat:Lz,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[2],type:[xz]},t[DE]={textureFormat:Lz,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[8,4],type:[zz,Rz]},t[_E]={textureFormat:Lz,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[8],type:[zz]},t[OE]={textureFormat:Pz,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[wz]},t[FE]={textureFormat:Pz,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[xz]},t[zE]={textureFormat:Pz,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Cz]},t[IE]={textureFormat:Pz,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[kz]},t[AE]={textureFormat:Pz,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[Ez]},t[NE]={textureFormat:Pz,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[Sz]},t[qE]={textureFormat:LS,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3],type:[wz]},t[VE]={textureFormat:LS,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[3],type:[wz]},t[WE]={textureFormat:LS,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3,2],type:[wz,Nz]},t[UE]={textureFormat:LS,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[3],type:[xz]},t[jE]={textureFormat:LS,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6,4],type:[zz,Rz,_z]},t[HE]={textureFormat:LS,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6,4],type:[zz,Rz,Oz]},t[GE]={textureFormat:LS,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6],type:[zz,Rz]},t[$E]={textureFormat:LS,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[zz]},t[KE]={textureFormat:Vz,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[3],type:[wz]},t[XE]={textureFormat:Vz,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[3],type:[xz]},t[YE]={textureFormat:Vz,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[6],type:[Cz]},t[JE]={textureFormat:Vz,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[6],type:[kz]},t[ZE]={textureFormat:Vz,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[Ez]},t[QE]={textureFormat:Vz,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[Sz]},t[tz]={textureFormat:PS,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[wz]},t[ez]={textureFormat:PS,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[wz]},t[rz]={textureFormat:PS,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[4],type:[xz]},t[nz]={textureFormat:PS,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,2,4],type:[wz,Az,Dz]},t[oz]={textureFormat:PS,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,2],type:[wz,Iz]},t[az]={textureFormat:PS,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[Dz]},t[iz]={textureFormat:PS,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[16,8],type:[zz,Rz]},t[sz]={textureFormat:PS,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[16],type:[zz]},t[uz]={textureFormat:Wz,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[wz]},t[lz]={textureFormat:Wz,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[xz]},t[cz]={textureFormat:Wz,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Dz]},t[pz]={textureFormat:Wz,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[Cz]},t[dz]={textureFormat:Wz,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[kz]},t[hz]={textureFormat:Wz,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[16],type:[Sz]},t[fz]={textureFormat:Wz,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[16],type:[Ez]},t[mz]={textureFormat:VS,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2,4],type:[Cz,Ez]},t[gz]={textureFormat:VS,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Ez]},t[vz]={textureFormat:VS,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[zz]},t[yz]={textureFormat:WS,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Mz]},t[bz]={textureFormat:WS,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Fz]},Object.keys(t).forEach(function(e){const r=t[e];r.bytesPerElementMap={},r.bytesPerElement.forEach(function(t,e){const n=r.type[e];r.bytesPerElementMap[n]=t})}),Uz=t}return Uz[t]}function Hz(t){const e=jz(t);if(!e)throw"unknown internal format";return{format:e.textureFormat,type:e.type[0]}}function Gz(t){return 0==(t&t-1)}function $z(t,e,r,n,o){if(o%1!=0)throw"can't guess dimensions";if(r||n){if(n){if(!r&&(r=o/n)%1)throw"can't guess dimensions"}else if((n=o/r)%1)throw"can't guess dimensions"}else{const t=Math.sqrt(o/(e===$S?6:1));t%1==0?(r=t,n=t):(r=o,n=1)}return{width:r,height:n}}const Kz={};function Xz(t,e){void 0!==e.colorspaceConversion&&(Kz.colorspaceConversion=t.getParameter(vE),t.pixelStorei(vE,e.colorspaceConversion)),void 0!==e.premultiplyAlpha&&(Kz.premultiplyAlpha=t.getParameter(bE),t.pixelStorei(bE,e.premultiplyAlpha)),void 0!==e.flipY&&(Kz.flipY=t.getParameter(yE),t.pixelStorei(yE,e.flipY))}function Yz(t,e){void 0!==e.colorspaceConversion&&t.pixelStorei(vE,Kz.colorspaceConversion),void 0!==e.premultiplyAlpha&&t.pixelStorei(bE,Kz.premultiplyAlpha),void 0!==e.flipY&&t.pixelStorei(yE,Kz.flipY)}function Jz(t){Kz.unpackAlignment=t.getParameter(pE),RS(t)&&(Kz.unpackRowLength=t.getParameter(dE),Kz.unpackImageHeight=t.getParameter(hE),Kz.unpackSkipPixels=t.getParameter(fE),Kz.unpackSkipRows=t.getParameter(mE),Kz.unpackSkipImages=t.getParameter(gE))}function Zz(t){t.pixelStorei(pE,Kz.unpackAlignment),RS(t)&&(t.pixelStorei(dE,Kz.unpackRowLength),t.pixelStorei(hE,Kz.unpackImageHeight),t.pixelStorei(fE,Kz.unpackSkipPixels),t.pixelStorei(mE,Kz.unpackSkipRows),t.pixelStorei(gE,Kz.unpackSkipImages))}function Qz(t,e,r,n){var o;n.minMag&&(r.call(t,e,rE,n.minMag),r.call(t,e,nE,n.minMag)),n.min&&r.call(t,e,rE,n.min),n.mag&&r.call(t,e,nE,n.mag),n.wrap&&(r.call(t,e,oE,n.wrap),r.call(t,e,aE,n.wrap),(e===KS||(o=e,"undefined"!=typeof WebGLSampler&&o instanceof WebGLSampler))&&r.call(t,e,iE,n.wrap)),n.wrapR&&r.call(t,e,iE,n.wrapR),n.wrapS&&r.call(t,e,oE,n.wrapS),n.wrapT&&r.call(t,e,aE,n.wrapT),n.minLod&&r.call(t,e,sE,n.minLod),n.maxLod&&r.call(t,e,uE,n.maxLod),n.baseLevel&&r.call(t,e,lE,n.baseLevel),n.maxLevel&&r.call(t,e,cE,n.maxLevel)}function tI(t,e,r){const n=r.target||GS;t.bindTexture(n,e),Qz(t,n,t.texParameteri,r)}function eI(t,e,r,n,o,a){r=r||DS.textureOptions,a=a||PS;const i=r.target||GS;if(n=n||r.width,o=o||r.height,t.bindTexture(i,e),function(t,e,r,n){if(!RS(t))return Gz(e)&&Gz(r);const o=jz(n);if(!o)throw"unknown internal format";return o.colorRenderable&&o.textureFilterable}(t,n,o,a))t.generateMipmap(i);else{const e=function(t){const e=jz(t);if(!e)throw"unknown internal format";return e.textureFilterable}(a)?HS:jS;t.texParameteri(i,rE,e),t.texParameteri(i,nE,e),t.texParameteri(i,oE,US),t.texParameteri(i,aE,US)}}function rI(t){return!0===t.auto||void 0===t.auto&&void 0===t.level}function nI(t,e){return(e=e||{}).cubeFaceOrder||[YS,JS,ZS,QS,tE,eE]}function oI(t,e){const r=nI(0,e).map(function(t,e){return{face:t,ndx:e}});return r.sort(function(t,e){return t.face-e.face}),r}function aI(t,e,r,n){const o=(n=n||DS.textureOptions).target||GS,a=n.level||0;let i=r.width,s=r.height;const u=n.internalFormat||n.format||PS,l=Hz(u),c=n.format||l.format,p=n.type||l.type;if(Xz(t,n),t.bindTexture(o,e),o===$S){const l=r.width,d=r.height;let h,f;if(l/6===d)h=d,f=[0,0,1,0,2,0,3,0,4,0,5,0];else if(d/6===l)h=l,f=[0,0,0,1,0,2,0,3,0,4,0,5];else if(l/3==d/2)h=l/3,f=[0,0,1,0,2,0,0,1,1,1,2,1];else{if(l/2!=d/3)throw"can't figure out cube map from element: "+(r.src?r.src:r.nodeName);h=l/2,f=[0,0,1,0,0,1,1,1,0,2,1,2]}const m=FS();m?(m.canvas.width=h,m.canvas.height=h,i=h,s=h,oI(0,n).forEach(function(e){const n=f[2*e.ndx+0]*h,o=f[2*e.ndx+1]*h;m.drawImage(r,n,o,h,h,0,0,h,h),t.texImage2D(e.face,a,u,c,p,m.canvas)}),m.canvas.width=1,m.canvas.height=1):"undefined"!=typeof createImageBitmap&&(i=h,s=h,oI(0,n).forEach(function(l){const d=f[2*l.ndx+0]*h,m=f[2*l.ndx+1]*h;t.texImage2D(l.face,a,u,h,h,0,c,p,null),createImageBitmap(r,d,m,h,h,{premultiplyAlpha:"none",colorSpaceConversion:"none"}).then(function(r){Xz(t,n),t.bindTexture(o,e),t.texImage2D(l.face,a,u,c,p,r),Yz(t,n),rI(n)&&eI(t,e,n,i,s,u)})}))}else if(o===KS||o===XS){const e=Math.min(r.width,r.height),n=Math.max(r.width,r.height),i=n/e;if(i%1!=0)throw"can not compute 3D dimensions of element";const s=r.width===n?1:0,l=r.height===n?1:0;Jz(t),t.pixelStorei(pE,1),t.pixelStorei(dE,r.width),t.pixelStorei(hE,0),t.pixelStorei(gE,0),t.texImage3D(o,a,u,e,e,e,0,c,p,null);for(let n=0;n<i;++n){const i=n*e*s,u=n*e*l;t.pixelStorei(fE,i),t.pixelStorei(mE,u),t.texSubImage3D(o,a,0,0,n,e,e,1,c,p,r)}Zz(t)}else t.texImage2D(o,a,u,c,p,r);Yz(t,n),rI(n)&&eI(t,e,n,i,s,u),tI(t,e,n)}function iI(){}function sI(t,e){return void 0!==e||function(t){if("undefined"!=typeof document){const e=document.createElement("a");return e.href=t,e.hostname===location.hostname&&e.port===location.port&&e.protocol===location.protocol}{const e=new URL(location.href).origin;return new URL(t,location.href).origin===e}}(t)?e:"anonymous"}function uI(t){return"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof ImageData&&t instanceof ImageData||"undefined"!=typeof HTMLElement&&t instanceof HTMLElement}function lI(t,e,r){return uI(t)?(setTimeout(function(){r(null,t)}),t):function(t,e,r){let n;if(r=r||iI,e=void 0!==e?e:DS.crossOrigin,e=sI(t,e),"undefined"!=typeof Image){n=new Image,void 0!==e&&(n.crossOrigin=e);const o=function(){n.removeEventListener("error",a),n.removeEventListener("load",i),n=null},a=function(){const e="couldn't load image: "+t;sS(e),r(e,n),o()},i=function(){r(null,n),o()};return n.addEventListener("error",a),n.addEventListener("load",i),n.src=t,n}if("undefined"!=typeof ImageBitmap){let o,a;const i=function(){r(o,a)},s={};e&&(s.mode="cors"),fetch(t,s).then(function(t){if(!t.ok)throw t;return t.blob()}).then(function(t){return createImageBitmap(t,{premultiplyAlpha:"none",colorSpaceConversion:"none"})}).then(function(t){a=t,setTimeout(i)}).catch(function(t){o=t,setTimeout(i)}),n=null}return n}(t,e,r)}function cI(t,e,r){const n=(r=r||DS.textureOptions).target||GS;if(t.bindTexture(n,e),!1===r.color)return;const o=function(t){return t=t||DS.textureColor,_S(t)?t:new Uint8Array([255*t[0],255*t[1],255*t[2],255*t[3]])}(r.color);if(n===$S)for(let e=0;e<6;++e)t.texImage2D(YS+e,0,PS,1,1,0,PS,wz,o);else n===KS||n===XS?t.texImage3D(n,0,PS,1,1,1,0,PS,wz,o):t.texImage2D(n,0,PS,1,1,0,PS,wz,o)}function pI(t,e,r,n){n=n||iI;const o=r.src;if(6!==o.length)throw"there must be 6 urls for a cubemap";const a=r.level||0,i=r.internalFormat||r.format||PS,s=Hz(i),u=r.format||s.format,l=r.type||wz,c=r.target||GS;if(c!==$S)throw"target must be TEXTURE_CUBE_MAP";cI(t,e,r),r=Object.assign({},r);let p=6;const d=[],h=nI(0,r);let f;f=o.map(function(o,s){return lI(o,r.crossOrigin,(m=h[s],function(o,s){--p,o?d.push(o):s.width!==s.height?d.push("cubemap face img is not a square: "+s.src):(Xz(t,r),t.bindTexture(c,e),5===p?nI().forEach(function(e){t.texImage2D(e,a,i,u,l,s)}):t.texImage2D(m,a,i,u,l,s),Yz(t,r),rI(r)&&t.generateMipmap(c)),0===p&&n(d.length?d:void 0,e,f)}));var m})}function dI(t,e,r,n){n=n||iI;const o=r.src,a=r.internalFormat||r.format||PS,i=Hz(a),s=r.format||i.format,u=r.type||wz,l=r.target||XS;if(l!==KS&&l!==XS)throw"target must be TEXTURE_3D or TEXTURE_2D_ARRAY";cI(t,e,r),r=Object.assign({},r);let c=o.length;const p=[];let d;const h=r.level||0;let f=r.width,m=r.height;const g=o.length;let v=!0;d=o.map(function(o,i){return lI(o,r.crossOrigin,(b=i,function(o,i){if(--c,o)p.push(o);else{if(Xz(t,r),t.bindTexture(l,e),v){v=!1,f=r.width||i.width,m=r.height||i.height,t.texImage3D(l,h,a,f,m,g,0,s,u,null);for(let e=0;e<g;++e)t.texSubImage3D(l,h,0,0,e,f,m,1,s,u,i)}else{let e,r=i;i.width===f&&i.height===m||(r=(e=FS()).canvas,e.canvas.width=f,e.canvas.height=m,e.drawImage(i,0,0,f,m)),t.texSubImage3D(l,h,0,0,b,f,m,1,s,u,r),e&&r===e.canvas&&(e.canvas.width=0,e.canvas.height=0)}Yz(t,r),rI(r)&&t.generateMipmap(l)}0===c&&n(p.length?p:void 0,e,d)}));var b})}function hI(t,e,r,n){const o=(n=n||DS.textureOptions).target||GS;t.bindTexture(o,e);let a=n.width,i=n.height,s=n.depth;const u=n.level||0,l=n.internalFormat||n.format||PS,c=Hz(l),p=n.format||c.format,d=n.type||function(t,e,r){return _S(e)?aS(e):r||wz}(0,r,c.type);if(_S(r))r instanceof Uint8ClampedArray&&(r=new Uint8Array(r.buffer));else{const t=function(t){const e=oS[t];if(!e)throw new Error("unknown gl type");return e}(d);r=new t(r)}const h=function(t,e){const r=jz(t);if(!r)throw"unknown internal format";const n=r.bytesPerElementMap[e];if(void 0===n)throw"unknown internal format";return n}(l,d),f=r.byteLength/h;if(f%1)throw"length wrong size for format: "+TS(t,p);let m;if(o===KS||o===XS)if(a||i||s)!a||i&&s?!i||a&&s?(m=$z(0,o,a,i,f/s),a=m.width,i=m.height):(m=$z(0,o,a,s,f/i),a=m.width,s=m.height):(m=$z(0,o,i,s,f/a),i=m.width,s=m.height);else{const t=Math.cbrt(f);if(t%1!=0)throw"can't guess cube size of array of numElements: "+f;a=t,i=t,s=t}else m=$z(0,o,a,i,f),a=m.width,i=m.height;if(Jz(t),t.pixelStorei(pE,n.unpackAlignment||1),Xz(t,n),o===$S){const e=f/6*(h/r.BYTES_PER_ELEMENT);oI(0,n).forEach(n=>{const o=e*n.ndx,s=r.subarray(o,o+e);t.texImage2D(n.face,u,l,a,i,0,p,d,s)})}else o===KS||o===XS?t.texImage3D(o,u,l,a,i,s,0,p,d,r):t.texImage2D(o,u,l,a,i,0,p,d,r);return Yz(t,n),Zz(t),{width:a,height:i,depth:s,type:d}}function fI(t,e,r){r=r||iI,e=e||DS.textureOptions;const n=t.createTexture(),o=e.target||GS;let a=e.width||1,i=e.height||1;const s=e.internalFormat||PS;t.bindTexture(o,n),o===$S&&(t.texParameteri(o,oE,US),t.texParameteri(o,aE,US));let u=e.src;if(u)if("function"==typeof u&&(u=u(t,e)),"string"==typeof u)!function(t,e,r,n){n=n||iI,r=r||DS.textureOptions,cI(t,e,r),lI((r=Object.assign({},r)).src,r.crossOrigin,function(o,a){o?n(o,e,a):(aI(t,e,a,r),n(null,e,a))})}(t,n,e,r);else if(_S(u)||Array.isArray(u)&&("number"==typeof u[0]||Array.isArray(u[0])||_S(u[0]))){const r=hI(t,n,u,e);a=r.width,i=r.height}else if(Array.isArray(u)&&("string"==typeof u[0]||uI(u[0])))o===$S?pI(t,n,e,r):dI(t,n,e,r);else{if(!uI(u))throw"unsupported src type";aI(t,n,u,e),a=u.width,i=u.height}else!function(t,e,r){const n=r.target||GS;t.bindTexture(n,e);const o=r.level||0,a=r.internalFormat||r.format||PS,i=Hz(a),s=r.format||i.format,u=r.type||i.type;if(Xz(t,r),n===$S)for(let e=0;e<6;++e)t.texImage2D(YS+e,o,a,r.width,r.height,0,s,u,null);else n===KS||n===XS?t.texImage3D(n,o,a,r.width,r.height,r.depth,0,s,u,null):t.texImage2D(n,o,a,r.width,r.height,0,s,u,null);Yz(t,r)}(t,n,e);return rI(e)&&eI(t,n,e,a,i,s),tI(t,n,e),n}const mI=sS;function gI(t){return"undefined"!=typeof document&&document.getElementById?document.getElementById(t):null}const vI=33984,bI=34962,yI=34963,xI=35713,wI=35714,kI=35632,CI=35633,SI=35981,EI=35718,zI=35721,II=35971,AI=35382,NI=35396,RI=35398,TI=35392,DI=35395,_I=5126,OI=5124,FI=5125,MI={};function LI(t,e){return MI[e].bindPoint}function PI(t,e){return function(r){t.uniform1i(e,r)}}function BI(t,e){return function(r){t.uniform1iv(e,r)}}function qI(t,e){return function(r){t.uniform2iv(e,r)}}function VI(t,e){return function(r){t.uniform3iv(e,r)}}function WI(t,e){return function(r){t.uniform4iv(e,r)}}function UI(t,e,r,n){const o=LI(0,e);return RS(t)?function(e){let a,i;uS(0,e)?(a=e,i=null):(a=e.texture,i=e.sampler),t.uniform1i(n,r),t.activeTexture(vI+r),t.bindTexture(o,a),t.bindSampler(r,i)}:function(e){t.uniform1i(n,r),t.activeTexture(vI+r),t.bindTexture(o,e)}}function jI(t,e,r,n,o){const a=LI(0,e),i=new Int32Array(o);for(let t=0;t<o;++t)i[t]=r+t;return RS(t)?function(e){t.uniform1iv(n,i),e.forEach(function(e,n){let o,s;t.activeTexture(vI+i[n]),uS(0,e)?(o=e,s=null):(o=e.texture,s=e.sampler),t.bindSampler(r,s),t.bindTexture(a,o)})}:function(e){t.uniform1iv(n,i),e.forEach(function(e,r){t.activeTexture(vI+i[r]),t.bindTexture(a,e)})}}function HI(t,e){return function(r){if(r.value)switch(t.disableVertexAttribArray(e),r.value.length){case 4:t.vertexAttrib4fv(e,r.value);break;case 3:t.vertexAttrib3fv(e,r.value);break;case 2:t.vertexAttrib2fv(e,r.value);break;case 1:t.vertexAttrib1fv(e,r.value);break;default:throw new Error("the length of a float constant value must be between 1 and 4!")}else t.bindBuffer(bI,r.buffer),t.enableVertexAttribArray(e),t.vertexAttribPointer(e,r.numComponents||r.size,r.type||_I,r.normalize||!1,r.stride||0,r.offset||0),void 0!==r.divisor&&t.vertexAttribDivisor(e,r.divisor)}}function GI(t,e){return function(r){if(r.value){if(t.disableVertexAttribArray(e),4!==r.value.length)throw new Error("The length of an integer constant value must be 4!");t.vertexAttrib4iv(e,r.value)}else t.bindBuffer(bI,r.buffer),t.enableVertexAttribArray(e),t.vertexAttribIPointer(e,r.numComponents||r.size,r.type||OI,r.stride||0,r.offset||0),void 0!==r.divisor&&t.vertexAttribDivisor(e,r.divisor)}}function $I(t,e){return function(r){if(r.value){if(t.disableVertexAttribArray(e),4!==r.value.length)throw new Error("The length of an unsigned integer constant value must be 4!");t.vertexAttrib4uiv(e,r.value)}else t.bindBuffer(bI,r.buffer),t.enableVertexAttribArray(e),t.vertexAttribIPointer(e,r.numComponents||r.size,r.type||FI,r.stride||0,r.offset||0),void 0!==r.divisor&&t.vertexAttribDivisor(e,r.divisor)}}function KI(t,e,r){const n=r.size,o=r.count;return function(r){t.bindBuffer(bI,r.buffer);const a=r.size||r.numComponents||n,i=a/o,s=r.type||_I,u=MI[s].size*a,l=r.normalize||!1,c=r.offset||0,p=u/o;for(let n=0;n<o;++n)t.enableVertexAttribArray(e+n),t.vertexAttribPointer(e+n,i,s,l,u,c+p*n),void 0!==r.divisor&&t.vertexAttribDivisor(e+n,r.divisor)}}MI[_I]={Type:Float32Array,size:4,setter:function(t,e){return function(r){t.uniform1f(e,r)}},arraySetter:function(t,e){return function(r){t.uniform1fv(e,r)}}},MI[35664]={Type:Float32Array,size:8,setter:function(t,e){return function(r){t.uniform2fv(e,r)}}},MI[35665]={Type:Float32Array,size:12,setter:function(t,e){return function(r){t.uniform3fv(e,r)}}},MI[35666]={Type:Float32Array,size:16,setter:function(t,e){return function(r){t.uniform4fv(e,r)}}},MI[OI]={Type:Int32Array,size:4,setter:PI,arraySetter:BI},MI[35667]={Type:Int32Array,size:8,setter:qI},MI[35668]={Type:Int32Array,size:12,setter:VI},MI[35669]={Type:Int32Array,size:16,setter:WI},MI[FI]={Type:Uint32Array,size:4,setter:function(t,e){return function(r){t.uniform1ui(e,r)}},arraySetter:function(t,e){return function(r){t.uniform1uiv(e,r)}}},MI[36294]={Type:Uint32Array,size:8,setter:function(t,e){return function(r){t.uniform2uiv(e,r)}}},MI[36295]={Type:Uint32Array,size:12,setter:function(t,e){return function(r){t.uniform3uiv(e,r)}}},MI[36296]={Type:Uint32Array,size:16,setter:function(t,e){return function(r){t.uniform4uiv(e,r)}}},MI[35670]={Type:Uint32Array,size:4,setter:PI,arraySetter:BI},MI[35671]={Type:Uint32Array,size:8,setter:qI},MI[35672]={Type:Uint32Array,size:12,setter:VI},MI[35673]={Type:Uint32Array,size:16,setter:WI},MI[35674]={Type:Float32Array,size:16,setter:function(t,e){return function(r){t.uniformMatrix2fv(e,!1,r)}}},MI[35675]={Type:Float32Array,size:36,setter:function(t,e){return function(r){t.uniformMatrix3fv(e,!1,r)}}},MI[35676]={Type:Float32Array,size:64,setter:function(t,e){return function(r){t.uniformMatrix4fv(e,!1,r)}}},MI[35685]={Type:Float32Array,size:24,setter:function(t,e){return function(r){t.uniformMatrix2x3fv(e,!1,r)}}},MI[35686]={Type:Float32Array,size:32,setter:function(t,e){return function(r){t.uniformMatrix2x4fv(e,!1,r)}}},MI[35687]={Type:Float32Array,size:24,setter:function(t,e){return function(r){t.uniformMatrix3x2fv(e,!1,r)}}},MI[35688]={Type:Float32Array,size:48,setter:function(t,e){return function(r){t.uniformMatrix3x4fv(e,!1,r)}}},MI[35689]={Type:Float32Array,size:32,setter:function(t,e){return function(r){t.uniformMatrix4x2fv(e,!1,r)}}},MI[35690]={Type:Float32Array,size:48,setter:function(t,e){return function(r){t.uniformMatrix4x3fv(e,!1,r)}}},MI[35678]={Type:null,size:0,setter:UI,arraySetter:jI,bindPoint:3553},MI[35680]={Type:null,size:0,setter:UI,arraySetter:jI,bindPoint:34067},MI[35679]={Type:null,size:0,setter:UI,arraySetter:jI,bindPoint:32879},MI[35682]={Type:null,size:0,setter:UI,arraySetter:jI,bindPoint:3553},MI[36289]={Type:null,size:0,setter:UI,arraySetter:jI,bindPoint:35866},MI[36292]={Type:null,size:0,setter:UI,arraySetter:jI,bindPoint:35866},MI[36293]={Type:null,size:0,setter:UI,arraySetter:jI,bindPoint:34067},MI[36298]={Type:null,size:0,setter:UI,arraySetter:jI,bindPoint:3553},MI[36299]={Type:null,size:0,setter:UI,arraySetter:jI,bindPoint:32879},MI[36300]={Type:null,size:0,setter:UI,arraySetter:jI,bindPoint:34067},MI[36303]={Type:null,size:0,setter:UI,arraySetter:jI,bindPoint:35866},MI[36306]={Type:null,size:0,setter:UI,arraySetter:jI,bindPoint:3553},MI[36307]={Type:null,size:0,setter:UI,arraySetter:jI,bindPoint:32879},MI[36308]={Type:null,size:0,setter:UI,arraySetter:jI,bindPoint:34067},MI[36311]={Type:null,size:0,setter:UI,arraySetter:jI,bindPoint:35866};const XI={};XI[_I]={size:4,setter:HI},XI[35664]={size:8,setter:HI},XI[35665]={size:12,setter:HI},XI[35666]={size:16,setter:HI},XI[OI]={size:4,setter:GI},XI[35667]={size:8,setter:GI},XI[35668]={size:12,setter:GI},XI[35669]={size:16,setter:GI},XI[FI]={size:4,setter:$I},XI[36294]={size:8,setter:$I},XI[36295]={size:12,setter:$I},XI[36296]={size:16,setter:$I},XI[35670]={size:4,setter:GI},XI[35671]={size:8,setter:GI},XI[35672]={size:12,setter:GI},XI[35673]={size:16,setter:GI},XI[35674]={size:4,setter:KI,count:2},XI[35675]={size:9,setter:KI,count:3},XI[35676]={size:16,setter:KI,count:4};const YI=/^[ \t]*\n/;function JI(t,e,r,n){const o=n||mI,a=t.createShader(r);let i=0;if(YI.test(e)&&(i=1,e=e.replace(YI,"")),t.shaderSource(a,e),t.compileShader(a),!t.getShaderParameter(a,xI)){const r=t.getShaderInfoLog(a);return o(function(t,e){return e=e||0,++e,t.split("\n").map(function(t,r){return r+e+": "+t}).join("\n")}(e,i)+"\n*** Error compiling shader: "+r),t.deleteShader(a),null}return a}function ZI(t,e,r){let n,o;if("function"==typeof e&&(r=e,e=void 0),"function"==typeof t)r=t,t=void 0;else if(t&&!Array.isArray(t)){if(t.errorCallback)return t;const e=t;r=e.errorCallback,t=e.attribLocations,n=e.transformFeedbackVaryings,o=e.transformFeedbackMode}const a={errorCallback:r||mI,transformFeedbackVaryings:n,transformFeedbackMode:o};if(t){let r={};Array.isArray(t)?t.forEach(function(t,n){r[t]=e?e[n]:n}):r=t,a.attribLocations=r}return a}const QI=["VERTEX_SHADER","FRAGMENT_SHADER"];function tA(t,e){e.forEach(function(e){t.deleteShader(e)})}function eA(t,e,r,n,o){const a=ZI(r,n,o),i=[];for(let r=0;r<e.length;++r){const n=JI(t,e[r],t[QI[r]],a.errorCallback);if(!n)return null;i.push(n)}return function(t,e,r,n,o){const a=ZI(r,n,o),i=[],s=[];for(let r=0;r<e.length;++r){let n=e[r];if("string"==typeof n){const e=gI(n),o=e?e.text:n;let i=t[QI[r]];e&&e.type&&(i=((l=e.type).indexOf("frag")>=0?kI:l.indexOf("vert")>=0?CI:void 0)||i),n=JI(t,o,i,a.errorCallback),s.push(n)}u=n,"undefined"!=typeof WebGLShader&&u instanceof WebGLShader&&i.push(n)}var u,l;if(i.length!==e.length)return a.errorCallback("not enough shaders for program"),tA(t,s),null;const c=t.createProgram();i.forEach(function(e){t.attachShader(c,e)}),a.attribLocations&&Object.keys(a.attribLocations).forEach(function(e){t.bindAttribLocation(c,a.attribLocations[e],e)});let p=a.transformFeedbackVaryings;if(p&&(p.attribs&&(p=p.attribs),Array.isArray(p)||(p=Object.keys(p)),t.transformFeedbackVaryings(c,p,a.transformFeedbackMode||SI)),t.linkProgram(c),!t.getProgramParameter(c,wI)){const e=t.getProgramInfoLog(c);return a.errorCallback("Error in program linking:"+e),t.deleteProgram(c),tA(t,s),null}return c}(t,i,a)}function rA(t){const e=t.name;return e.startsWith("gl_")||e.startsWith("webgl_")}function nA(t,e){const r={program:e,uniformSetters:function(t,e){let r=0;function n(e,n){const o=t.getUniformLocation(e,n.name),a=n.size>1&&"[0]"===n.name.substr(-3),i=n.type,s=MI[i];if(!s)throw new Error(`unknown type: 0x${i.toString(16)}`);let u;if(s.bindPoint){const e=r;r+=n.size,u=a?s.arraySetter(t,i,e,o,n.size):s.setter(t,i,e,o,n.size)}else u=s.arraySetter&&a?s.arraySetter(t,o):s.setter(t,o);return u.location=o,u}const o={},a=t.getProgramParameter(e,EI);for(let r=0;r<a;++r){const a=t.getActiveUniform(e,r);if(rA(a))continue;let i=a.name;"[0]"===i.substr(-3)&&(i=i.substr(0,i.length-3));const s=n(e,a);o[i]=s}return o}(t,e),attribSetters:function(t,e){const r={},n=t.getProgramParameter(e,zI);for(let o=0;o<n;++o){const n=t.getActiveAttrib(e,o);if(rA(n))continue;const a=t.getAttribLocation(e,n.name),i=XI[n.type],s=i.setter(t,a,i);s.location=a,r[n.name]=s}return r}(t,e)};return RS(t)&&(r.uniformBlockSpec=function(t,e){const r=t.getProgramParameter(e,EI),n=[],o=[];for(let a=0;a<r;++a){o.push(a),n.push({});const r=t.getActiveUniform(e,a);if(rA(r))break;n[a].name=r.name}[["UNIFORM_TYPE","type"],["UNIFORM_SIZE","size"],["UNIFORM_BLOCK_INDEX","blockNdx"],["UNIFORM_OFFSET","offset"]].forEach(function(r){const a=r[0],i=r[1];t.getActiveUniforms(e,o,t[a]).forEach(function(t,e){n[e][i]=t})});const a={},i=t.getProgramParameter(e,AI);for(let r=0;r<i;++r){const n=t.getActiveUniformBlockName(e,r),o={index:r,usedByVertexShader:t.getActiveUniformBlockParameter(e,r,NI),usedByFragmentShader:t.getActiveUniformBlockParameter(e,r,RI),size:t.getActiveUniformBlockParameter(e,r,TI),uniformIndices:t.getActiveUniformBlockParameter(e,r,DI)};o.used=o.usedByVertexShader||o.usedByFragmentShader,a[n]=o}return{blockSpecs:a,uniformData:n}}(t,e),r.transformFeedbackInfo=function(t,e){const r={},n=t.getProgramParameter(e,II);for(let o=0;o<n;++o){const n=t.getTransformFeedbackVarying(e,o);r[n.name]={index:o,type:n.type,size:n.size}}return r}(t,e)),r}const oA=4,aA=5123;const iA=[],sA=new class{constructor(t){t&&(this.texture=t),this.glCanvas=document.createElement("canvas"),this.glContext=this.glCanvas.getContext("webgl",{premultipliedAlpha:!1}),this.programInfo=function(t,e,r,n,o){const a=ZI(r,n,o);let i=!0;if(e=e.map(function(t){if(t.indexOf("\n")<0){const e=gI(t);e?t=e.text:(a.errorCallback("no element with id: "+t),i=!1)}return t}),!i)return null;const s=eA(t,e,a);return s?nA(t,s):null}(this.glContext,["\n            attribute vec4 position;\n            attribute vec2 a_texcoord;\n            varying vec2 v_texCoord;\n    \n            void main() {\n                gl_Position = position;\n                v_texCoord = a_texcoord;\n            }","        \n            precision mediump float;\n\n            varying vec4 v_position;\n            varying vec2 v_texCoord;\n            uniform sampler2D u_texture;\n    \n            void main() {\n              gl_FragColor = texture2D(u_texture, v_texCoord);\n            }"])}set texture(t){this.imgSource=t,this.glTexture=fI(this.glContext,{src:t,flipY:!0})}get texture(){return this.imgSource}render(t){if(!this.glTexture)return;const e=Math.min(t.topLeft.x,t.topRight.x,t.bottomLeft.x,t.bottomRight.x),r=Math.max(t.topLeft.x,t.topRight.x,t.bottomLeft.x,t.bottomRight.x),n=Math.min(t.topLeft.y,t.topRight.y,t.bottomLeft.y,t.bottomRight.y),o=Math.max(t.topLeft.y,t.topRight.y,t.bottomLeft.y,t.bottomRight.y),a=r-e,i=o-n;this.glCanvas.width=a,this.glCanvas.height=i;const s=[];Object.keys(t).forEach(r=>{const o=function(t,r){s[t]=(r.x-e)/a*2-1,s[t+1]=1-(r.y-n)/i*2,s[t+2]=0};switch(r){case"topLeft":o(6,t[r]),o(9,t[r]);break;case"bottomRight":o(3,t[r]),o(12,t[r]);break;case"bottomLeft":o(0,t[r]);break;case"topRight":o(15,t[r])}});const u={position:s,a_texcoord:[0,0,1,0,0,1,0,1,1,0,1,1]},l=function(t,e,r){const n=IS(t,e),o=Object.assign({},r||{});o.attribs=Object.assign({},r?r.attribs:{},n);const a=e.indices;if(a){const e=zS(a,"indices");o.indices=wS(t,e,pS),o.numElements=e.length,o.elementType=aS(e)}else o.numElements||(o.numElements=NS(t,o.attribs));return o}(this.glContext,u);this.glContext.viewport(0,0,this.glContext.canvas.width,this.glContext.canvas.height);const c={u_texture:this.glTexture};var p,d,h;return this.glContext.useProgram(this.programInfo.program),p=this.glContext,d=this.programInfo,(h=l).vertexArrayObject?p.bindVertexArray(h.vertexArrayObject):(function(t,e){for(const r in e){const n=t[r];n&&n(e[r])}}(d.attribSetters||d,h.attribs),h.indices&&p.bindBuffer(yI,h.indices)),function t(e,r){const n=e.uniformSetters||e,o=arguments.length;for(let e=1;e<o;++e){const r=arguments[e];if(Array.isArray(r)){const e=r.length;for(let o=0;o<e;++o)t(n,r[o])}else for(const t in r){const e=n[t];e&&e(r[t])}}}(this.programInfo,c),function(t,e,r,n,o,a){r=void 0===r?oA:r;const i=e.indices,s=e.elementType,u=void 0===n?e.numElements:n;o=void 0===o?0:o,s||i?void 0!==a?t.drawElementsInstanced(r,u,void 0===s?aA:e.elementType,o,a):t.drawElements(r,u,void 0===s?aA:e.elementType,o):void 0!==a?t.drawArraysInstanced(r,o,u,a):t.drawArrays(r,o,u)}(this.glContext,l),{x:e,y:n,width:a,height:i,canvas:this.glCanvas}}};var uA={get partsList(){return[this.UPPER_LEFT_ARM,this.UPPER_RIGHT_ARM,this.UPPER_LEFT_LEG,this.UPPER_RIGHT_LEG,this.LOWER_LEFT_LEG,this.LOWER_LEFT_ARM,this.LOWER_RIGHT_ARM,this.LOWER_RIGHT_LEG,this.TORSO,this.HEAD]},get UPPER_LEFT_LEG(){return{name:"upper left leg",defaultPins:[{name:"top",x:.5,y:.1},{name:"bottom",x:.5,y:.9}]}},get LOWER_LEFT_LEG(){return{name:"lower left leg",defaultPins:[{name:"top",x:.5,y:.1},{name:"bottom",x:.5,y:.9}]}},get UPPER_RIGHT_LEG(){return{name:"upper right leg",defaultPins:[{name:"top",x:.5,y:.1},{name:"bottom",x:.5,y:.9}]}},get LOWER_RIGHT_LEG(){return{name:"lower right leg",defaultPins:[{name:"top",x:.5,y:.1},{name:"bottom",x:.5,y:.9}]}},get UPPER_LEFT_ARM(){return{name:"upper left arm",defaultPins:[{name:"top",x:.5,y:.1},{name:"bottom",x:.5,y:.9}]}},get LOWER_LEFT_ARM(){return{name:"lower left arm",defaultPins:[{name:"top",x:.5,y:.1},{name:"bottom",x:.5,y:.9}]}},get UPPER_RIGHT_ARM(){return{name:"upper right arm",defaultPins:[{name:"top",x:.5,y:.1},{name:"bottom",x:.5,y:.9}]}},get LOWER_RIGHT_ARM(){return{name:"lower right arm",defaultPins:[{name:"top",x:.5,y:.1},{name:"bottom",x:.5,y:.9}]}},get TORSO(){return{name:"torso",defaultPins:[{name:"topleft",x:.1,y:.1},{name:"topright",x:.9,y:.1},{name:"bottomleft",x:.1,y:.9},{name:"bottomright",x:.9,y:.9}]}},get HEAD(){return{name:"head",defaultPins:[{name:"lefteye",x:.25,y:.5},{name:"righteye",x:.75,y:.5}]}},get assets(){return iA},export(){const t=document.createElement("a"),e=new Blob([JSON.stringify(iA)],{type:"text/plain"});t.href=URL.createObjectURL(e),t.download="skeleton.json",t.click()},findAssetByFilename(t){for(let e=0;e<iA.length;e++)if(iA[e].filename===t)return iA[e];return null},defaultPinsForPartName(t){for(let e=0;e<this.partsList.length;e++)if(this.partsList[e].name===t)return this.partsList[e].defaultPins.slice()},async loadAssets(t){let e;for(let r=0;r<t.length;r++)"application/json"===t[r].type?e=await this.loadAssetManifest(t[r]):iA.push(await this.loadImage(t[r]));if(e)for(let t=0;t<e.length;t++)for(let r=0;r<iA.length;r++)iA[r].filename===e[t].filename&&e[t].partname&&(iA[r].partname=e[t].partname,e[t].pins&&(iA[r].pins=e[t].pins));return iA},resolvePointsToSegment(t,e){switch([t.part,e.part].sort().join(",")){case"rightElbow,rightShoulder":return this.UPPER_RIGHT_ARM;case"leftElbow,leftShoulder":return this.UPPER_LEFT_ARM;case"rightElbow,rightWrist":return this.LOWER_RIGHT_ARM;case"leftElbow,leftWrist":return this.LOWER_LEFT_ARM;case"leftHip,leftKnee":return this.UPPER_LEFT_LEG;case"rightHip,rightKnee":return this.UPPER_RIGHT_LEG;case"leftAnkle,leftKnee":return this.LOWER_LEFT_LEG;case"rightAnkle,rightKnee":return this.LOWER_RIGHT_LEG}},drawTorso(t,e){let r=iA.find(t=>"torso"===t.partname);if(r&&(sA.texture!==r.image&&(sA.texture=r.image),t.leftShoulder&&t.rightShoulder&&t.leftHip&&t.rightHip)){const n=r.pins.filter(t=>"topleft"===t.name)[0],o=r.pins.filter(t=>"topright"===t.name)[0],a=r.pins.filter(t=>"bottomleft"===t.name)[0],i=r.pins.filter(t=>"bottomright"===t.name)[0],s=sA.render({topLeft:{x:t.leftShoulder.position.x-n.x*(t.rightShoulder.position.x-t.leftShoulder.position.x),y:t.leftShoulder.position.y-n.y*(t.leftHip.position.y-t.leftShoulder.position.y)},topRight:{x:t.rightShoulder.position.x+(1-o.x)*(t.rightShoulder.position.x-t.leftShoulder.position.x),y:t.rightShoulder.position.y-o.y*(t.leftHip.position.y-t.leftShoulder.position.y)},bottomLeft:{x:t.leftHip.position.x-a.x*(t.rightHip.position.x-t.leftHip.position.x),y:t.leftHip.position.y+(1-a.y)*(t.leftHip.position.y-t.leftShoulder.position.y)},bottomRight:{x:t.rightHip.position.x+(1-i.x)*(t.rightHip.position.x-t.leftHip.position.x),y:t.rightHip.position.y+(1-i.y)*(t.rightHip.position.y-t.rightShoulder.position.y)}});e.drawImage(s.canvas,s.x,s.y)}},drawHead(t,e,r){if(!t||!e)return;let n=iA.find(t=>"head"===t.partname);if(!n)return;const o=n.pins.find(t=>"lefteye"===t.name),a=n.pins.find(t=>"righteye"===t.name),i=o.x*n.width,s=o.y*n.height,u=a.x*n.width,l=(1-a.y)*n.height,c=Math.sqrt(Math.pow(t.position.x-e.position.x,2)+Math.pow(t.position.y-e.position.y,2)),p=Math.sqrt(Math.pow(i-u,2)+Math.pow(s-l,2)),d=c/p,h=Math.asin((s-l)/p);let f=Math.acos((t.position.y-e.position.y)/c)-Math.PI/2;f-=h;const m=[Math.cos(f)*d,Math.sin(f)*d,-Math.sin(f)*d,Math.cos(f)*d,t.position.x,e.position.y];r.save(),r.transform(m[0],m[1],m[2],m[3],m[4],m[5]),r.drawImage(n.image,-i,-l),r.restore()},drawLimb(t,e,r){if(!t||!e)return;const n=this.resolvePointsToSegment(t,e);if(!n)return;let o=iA.filter(t=>t.partname===n.name);if(0===o.length)return;o=o[0];const a=Math.sqrt(Math.pow(t.position.x-e.position.x,2)+Math.pow(t.position.y-e.position.y,2)),i=o.pins.filter(t=>"top"===t.name)[0],s=o.pins.filter(t=>"bottom"===t.name)[0],u=i.x*o.width,l=i.y*o.height,c=s.x*o.width,p=(1-s.y)*o.height,d=Math.asin((u-c)/a);let h=Math.asin((t.position.x-e.position.x)/a);e.position.y<t.position.y&&(h=Math.PI-h),h-=d;const f=a/(o.height-(l+p)),m=[Math.cos(h)*f,Math.sin(h)*f,-Math.sin(h)*f,Math.cos(h)*f,t.position.x,t.position.y];r.save(),r.transform(m[0],m[1],m[2],m[3],m[4],m[5]),r.drawImage(o.image,-u,-l),r.restore()},loadAssetManifest:async t=>new Promise((e,r)=>{const n=new FileReader;n.onloadend=function(t){e(JSON.parse(t.target.result))},n.readAsText(t)}),loadImage:async t=>new Promise((e,r)=>{const n=new Image;document.createElement("canvas").getContext("2d");n.onload=(r=>{e({partname:"unmapped",image:n,filename:t.name,width:n.naturalWidth,height:n.naturalHeight,pins:[]})}),"string"==typeof t||(n.src=URL.createObjectURL(t))})};V("dy-video",class extends HTMLElement{async connectedCallback(){this.init(W,{playing:!1,net:null,flipPoseHorizontal:!0,output:{showVideo:!0,showSkeleton:!0,showPoints:!1,showBoundingBox:!1}}),this.videoEl=this.shadowRoot.querySelector("video"),this.displayCanvasEl=this.shadowRoot.querySelector("canvas"),this.displayctx=this.displayCanvasEl.getContext("2d"),this.fullsizeCanvas=document.createElement("canvas"),this.fullsizeContext=this.fullsizeCanvas.getContext("2d"),this.loadPoseNet(),this.poseDetectionFrame(),this.videoEl.onloadedmetadata=(t=>{this.model.videoWidth=this.videoEl.videoWidth,this.model.videoHeight=this.videoEl.videoHeight;const e=this.getBoundingClientRect();this.videoEl.width=this.model.videoWidth,this.videoEl.height=this.model.videoHeight,this.fullsizeCanvas.width=this.model.videoWidth,this.fullsizeCanvas.height=this.model.videoHeight,this.displayCanvasEl.width=e.width,this.displayCanvasEl.height=e.height}),this.videoEl.onloadeddata=(()=>{this.videoEl.play(),this.model.playing=!0}),document.body.onresize=(()=>{const t=this.getBoundingClientRect();this.displayCanvasEl.width=t.width,this.displayCanvasEl.height=t.height}),(new H).addEventListener(ce.VIDEO_SOURCE_CHANGE,t=>{if(this.model.playing=!1,"uploaded"===ce.currentDevice.id)return this.videoEl.srcObject=null,void(this.videoEl.src=ce.uploaded);const e={width:ce.preferredResolution.settings.width,height:ce.preferredResolution.settings.height};"default"!==ce.currentDevice.id&&(e.deviceId=ce.currentDevice.id),navigator.mediaDevices.getUserMedia({audio:!1,video:e}).then(t=>{this.videoEl.srcObject=t})}),(new H).addEventListener(oe.CHANGE_SETTINGS,t=>{-1!==["architecture","outputStride","multiplier","inputResolution","quantBytes"].indexOf(t.detail.key)&&this.loadPoseNet()}),(new H).addEventListener(ne.TAKE_PHOTO,t=>{const e=navigator.userAgent.toLowerCase(),r=t.detail;if(e.indexOf(" electron/")>-1){const t=require("fs"),e=require("os"),n=new Buffer(this.fullsizeCanvas.toDataURL("image/png").replace(/^data:image\/png;base64,/,""),"base64").toString("binary");t.writeFile(`${e.homedir()}/Desktop/out/${r}.png`,n,"binary",()=>{console.log("file written",`${e.homedir()}/Desktop/out/${r}.png`)})}else{const t=document.createElement("a");t.setAttribute("download",`${r}.jpg`),t.setAttribute("href",this.fullsizeCanvas.toDataURL("image/jpg",.7).replace("image/jpg","image/octet-stream")),t.click()}}),(new H).addEventListener(ne.RECORD_VIDEO,t=>{t.detail.recording?this.startRecording():this.stopRecording()});const t=await navigator.mediaDevices.getUserMedia({audio:!1,video:{width:ce.preferredResolution.settings.width,height:ce.preferredResolution.settings.height}});this.videoEl.srcObject=t}loadPoseNet(){this.model.net&&(this.model.net.dispose(),this.model.net=null),Jg({architecture:oe.input.architecture,outputStride:oe.input.outputStride,inputResolution:oe.input.inputResolution,multiplier:oe.input.multiplier,quantBytes:oe.input.quantBytes}).then(t=>{this.model.net=t})}async poseDetectionFrame(){if(this.model.playing&&this.model.net){let t,e,r=[];switch(oe.algorithm){case"single-pose":const n=await this.model.net.estimatePoses(this.videoEl,{flipHorizontal:this.model.flipPoseHorizontal,decodingMethod:"single-person"});r=r.concat(n),t=oe.singlePoseDetection.minPoseConfidence,e=oe.singlePoseDetection.minPartConfidence;break;case"multi-pose":let o=await this.model.net.estimatePoses(this.videoEl,{flipHorizontal:this.model.flipPoseHorizontal,decodingMethod:"multi-person",maxDetections:oe.multiPoseDetection.maxPoseDetections,scoreThreshold:oe.multiPoseDetection.minPartConfidence,nmsRadius:oe.multiPoseDetection.nmsRadius});r=r.concat(o),t=oe.multiPoseDetection.minPoseConfidence,e=oe.multiPoseDetection.minPartConfidence}this.fullsizeContext.clearRect(0,0,this.model.videoWidth,this.model.videoHeight),this.model.output.showVideo&&(this.fullsizeContext.save(),this.fullsizeContext.scale(-1,1),this.fullsizeContext.translate(-this.model.videoWidth,0),this.fullsizeContext.drawImage(this.videoEl,0,0,this.model.videoWidth,this.model.videoHeight),this.fullsizeContext.restore()),r.forEach(r=>{let{score:n,keypoints:o}=r;if(n>=t){if(this.model.output.showSkeleton){const e=function(t,e){return sg.reduce(function(r,n){var o=n[0],a=n[1];return function(t,e,r){return t<r||e<r}(t[o].score,t[a].score,e)?r:(r.push([t[o],t[a]]),r)},[])}(o,t),r={};e.forEach(t=>{r[t[0].part]=t[0],r[t[1].part]=t[1]}),uA.drawTorso(r,this.fullsizeContext),uA.drawHead(o.find(t=>"leftEye"===t.part),o.find(t=>"rightEye"===t.part),this.fullsizeContext),uA.drawLimb(r.rightShoulder,r.rightElbow,this.fullsizeContext),uA.drawLimb(r.rightElbow,r.rightWrist,this.fullsizeContext),uA.drawLimb(r.leftShoulder,r.leftElbow,this.fullsizeContext),uA.drawLimb(r.leftElbow,r.leftWrist,this.fullsizeContext),uA.drawLimb(r.rightHip,r.rightKnee,this.fullsizeContext),uA.drawLimb(r.rightKnee,r.rightAnkle,this.fullsizeContext),uA.drawLimb(r.leftHip,r.leftKnee,this.fullsizeContext),uA.drawLimb(r.leftKnee,r.leftAnkle,this.fullsizeContext)}this.model.output.showPoints&&function(t,e,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;for(let o=0;o<t.length;o++){const a=t[o];if(a.score<e)continue;const{y:i,x:s}=a.position;XC(r,i*n,s*n,3,$C)}}(o,e,this.fullsizeContext),this.model.output.showBoundingBox&&YC(o,this.fullsizeContext)}})}const t=this.getBoundingClientRect(),e={};t.width>t.height?(e.width=t.width,e.height=t.width*this.model.videoHeight/this.model.videoWidth):(e.height=t.height,e.width=t.height*this.model.videoHeight/this.model.videoWidth);const r=this.getSizeToFit(this.fullsizeCanvas.width,this.fullsizeCanvas.height,this.displayCanvasEl.width,this.displayCanvasEl.height);this.displayctx.drawImage(this.fullsizeCanvas,0,0,this.fullsizeCanvas.width,this.fullsizeCanvas.height,(this.displayCanvasEl.width-r.computedWidth)/2,(this.displayCanvasEl.height-r.computedHeight)/2,r.computedWidth,r.computedHeight),requestAnimationFrame(()=>this.poseDetectionFrame())}getSizeToFit(t,e,r,n){var o=t/e,a=r/n,i=r,s=n;o>a?s=r/o:o<a&&(i=n*o);var u={};return u.computedWidth=i,u.computedHeight=s,u}},P);class lA extends _t{constructor(){super(...arguments),this.checked=!1,this.quiet=!1}static get styles(){return[...super.styles]}get focusElement(){return this.inputElement}handleChange(t){this.checked=this.inputElement.checked;const e=new CustomEvent("change",{detail:{sourceEvent:t},bubbles:t.bubbles,cancelable:t.cancelable});this.dispatchEvent(e)}render(){return M`<input id="input" type="checkbox" .checked="${this.checked}" @change="${this.handleChange}">`}}Y([xt({type:Boolean,reflect:!0})],lA.prototype,"checked",void 0),Y([xt({type:Boolean,reflect:!0})],lA.prototype,"quiet",void 0),Y([wt("#input")],lA.prototype,"inputElement",void 0);const cA=It`:host{display:inline-flex;align-items:flex-start;position:relative;min-height:var(--spectrum-switch-height,var(--spectrum-global-dimension-size-400));max-width:100%;margin-right:calc(var(--spectrum-switch-cursor-hit-x,
var(--spectrum-global-dimension-size-100))*2);vertical-align:top}#input{margin:0;box-sizing:border-box;padding:0;position:absolute;width:100%;height:100%;top:0;left:0;opacity:.0001;z-index:1;cursor:pointer}:host([checked]) #input+#switch:after{transform:translateX(calc(var(--spectrum-switch-track-width) - var(--spectrum-switch-handle-size,var(--spectrum-global-dimension-size-175))));border-color:var(--spectrum-switch-emphasized-handle-border-color-selected,var(--spectrum-global-color-blue-500))}#input[disabled],:host([disabled]) #input{cursor:default}#label{margin:0 var(--spectrum-switch-text-gap,var(--spectrum-global-dimension-size-125));font-size:var(--spectrum-switch-text-size,var(--spectrum-alias-font-size-default));transition:color var(--spectrum-global-animation-duration-200,.16s) ease-in-out;margin-top:var(--spectrum-global-dimension-size-75)}#switch{display:inline-block;position:relative;height:var(--spectrum-switch-track-height,var(--spectrum-global-dimension-size-175));width:var(--spectrum-switch-track-width);margin:calc((var(--spectrum-switch-height,var(--spectrum-global-dimension-size-400)) - var(--spectrum-switch-track-height,var(--spectrum-global-dimension-size-175)))/ 2) 0;flex-grow:0;flex-shrink:0;vertical-align:middle}#switch:after,#switch:before{display:block;position:absolute;content:"";box-sizing:border-box}#switch:before{transition:background var(--spectrum-global-animation-duration-100,.13s) ease-in-out,border var(--spectrum-global-animation-duration-100,.13s) ease-in-out;height:var(--spectrum-switch-track-height,var(--spectrum-global-dimension-size-175));left:0;right:0;border-radius:calc(var(--spectrum-switch-track-height,
var(--spectrum-global-dimension-size-175))/2);background-color:var(--spectrum-switch-emphasized-track-color,var(--spectrum-global-color-gray-300))}#switch:after{transition:background var(--spectrum-global-animation-duration-100,.13s) ease-in-out,border var(--spectrum-global-animation-duration-100,.13s) ease-in-out,transform var(--spectrum-global-animation-duration-100,.13s) ease-in-out,box-shadow var(--spectrum-global-animation-duration-100,.13s) ease-in-out;width:var(--spectrum-switch-handle-size,var(--spectrum-global-dimension-size-175));height:var(--spectrum-switch-handle-size,var(--spectrum-global-dimension-size-175));top:0;left:0;border-radius:var(--spectrum-switch-handle-border-radius);background-color:var(--spectrum-switch-emphasized-handle-background-color,var(--spectrum-global-color-gray-75));border:var(--spectrum-switch-handle-border-size,var(--spectrum-alias-border-size-thick)) solid var(--spectrum-switch-emphasized-handle-border-color,var(--spectrum-global-color-gray-600))}#input~#label{color:var(--spectrum-switch-emphasized-text-color,var(--spectrum-alias-text-color))}:host([checked]) #input+#switch:before{background-color:var(--spectrum-switch-emphasized-track-color-selected,var(--spectrum-global-color-blue-500))}:host(:hover) #input+#switch:after{border-color:var(--spectrum-switch-emphasized-handle-border-color-hover,var(--spectrum-global-color-gray-700));box-shadow:none}:host(:hover) #input~#label{color:var(--spectrum-switch-emphasized-text-color-hover,var(--spectrum-alias-text-color-hover))}:host(:hover[checked]) #input:enabled+#switch:before{background-color:var(--spectrum-switch-emphasized-track-color-selected-hover,var(--spectrum-global-color-blue-600))}:host(:hover[checked]) #input:enabled+#switch:after{border-color:var(--spectrum-switch-emphasized-handle-border-color-selected-hover,var(--spectrum-global-color-blue-600))}:host(:active) #input+#switch:after{border-color:var(--spectrum-switch-emphasized-handle-border-color-down,var(--spectrum-global-color-gray-800))}:host(:active) #input~#label{color:var(--spectrum-switch-emphasized-text-color-down,var(--spectrum-alias-text-color-down))}:host(:active[checked]) #input:enabled+#switch:before{background-color:var(--spectrum-switch-emphasized-track-color-selected-down,var(--spectrum-global-color-blue-700))}:host(:active[checked]) #input:enabled+#switch:after{border-color:var(--spectrum-switch-emphasized-handle-border-color-selected-down,var(--spectrum-global-color-blue-700))}:host([disabled]) #input+#switch:before{background-color:var(--spectrum-switch-emphasized-track-color-disabled,var(--spectrum-global-color-gray-300))}:host([disabled]) #input+#switch:after{border-color:var(--spectrum-switch-emphasized-handle-border-color-disabled,var(--spectrum-global-color-gray-400))}:host([disabled]) #input~#label{color:var(--spectrum-switch-emphasized-text-color-disabled,var(--spectrum-alias-text-color-disabled))}:host([disabled][checked]) #input+#switch:before{background-color:var(--spectrum-switch-emphasized-track-color-selected-disabled,var(--spectrum-global-color-gray-400))}:host([disabled][checked]) #input+#switch:after{border-color:var(--spectrum-switch-emphasized-handle-border-color-selected-disabled,var(--spectrum-global-color-gray-400))}:host([disabled][checked]) #input~#label{color:var(--spectrum-switch-emphasized-text-color-selected-disabled,var(--spectrum-alias-text-color-disabled))}:host([quiet][checked]) #input+#switch:before{background-color:var(--spectrum-switch-quiet-track-color-selected,var(--spectrum-global-color-gray-700))}:host([quiet][checked]) #input+#switch:after{border-color:var(--spectrum-switch-quiet-handle-border-color-selected,var(--spectrum-global-color-gray-700))}:host([quiet][checked]) :hover #input:enabled+#switch:before{background-color:var(--spectrum-switch-quiet-track-color-selected-hover,var(--spectrum-global-color-gray-800))}:host([quiet][checked]) :hover #input:enabled+#switch:after{border-color:var(--spectrum-switch-quiet-handle-border-color-selected-hover,var(--spectrum-global-color-gray-800))}:host(:active[quiet][checked]) #input:enabled+#switch:before{background-color:var(--spectrum-switch-quiet-track-color-selected-down,var(--spectrum-global-color-gray-900))}:host(:active[quiet][checked]) #input:enabled+#switch:after{border-color:var(--spectrum-switch-quiet-handle-border-color-selected-down,var(--spectrum-global-color-gray-900))}#input.focus-visible+#switch:after,:host(:hover) #input.focus-visible+#switch:after,:host([quiet]) #input.focus-visible+#switch:after,:host([quiet]) :hover #input.focus-visible+#switch:after{border-color:var(--spectrum-switch-emphasized-handle-border-color-key-focus,var(--spectrum-global-color-blue-400));box-shadow:0 0 0 1px var(--spectrum-switch-emphasized-handle-border-color-key-focus,var(--spectrum-global-color-blue-400))}#input.focus-visible~#label,:host(:hover) #input.focus-visible~#label,:host([quiet]) #input.focus-visible~#label,:host([quiet]) :hover #input.focus-visible~#label{color:var(--spectrum-switch-emphasized-text-color-key-focus,var(--spectrum-alias-text-color-key-focus))}:host(:hover[checked]) #input.focus-visible+#switch:before,:host([checked]) #input.focus-visible+#switch:before,:host([quiet][checked]) #input.focus-visible+#switch:before,:host([quiet][checked]) :hover #input.focus-visible+#switch:before{background-color:var(--spectrum-switch-emphasized-track-color-selected-key-focus,var(--spectrum-global-color-blue-400))}:host(:hover[checked]) #input.focus-visible+#switch:after,:host([checked]) #input.focus-visible+#switch:after,:host([quiet][checked]) #input.focus-visible+#switch:after,:host([quiet][checked]) :hover #input.focus-visible+#switch:after{border-color:var(--spectrum-switch-emphasized-handle-border-color-selected-key-focus,var(--spectrum-global-color-blue-400));box-shadow:0 0 0 1px var(--spectrum-switch-emphasized-handle-border-color-selected-key-focus,var(--spectrum-global-color-blue-400))}:host(:hover[checked]) #input.focus-visible~#label,:host([checked]) #input.focus-visible~#label,:host([quiet][checked]) #input.focus-visible~#label,:host([quiet][checked]) :hover #input.focus-visible~#label{color:var(--spectrum-switch-emphasized-text-color-selected-key-focus,var(--spectrum-alias-text-color-key-focus))}`,pA=It`#switch:after{transition:background var(--spectrum-global-animation-duration-100,.13s) ease-in-out,border var(--spectrum-global-animation-duration-100,.13s) ease-in-out,box-shadow var(--spectrum-global-animation-duration-100,.13s) ease-in-out}`;class dA extends lA{static get styles(){return window.hasOwnProperty("ShadyDOM")?[cA,pA]:[...super.styles,cA]}render(){return M`${super.render()} <span id="switch"></span> <label id="label" for="input"><slot></slot></label>`}}customElements.get("sp-switch")||customElements.define("sp-switch",dA);const hA=It`:host{display:flex;flex-direction:row}:host([column]){flex-direction:column}`;class fA extends Nt{constructor(){super(...arguments),this.name="",this._selected=""}static get styles(){return[hA]}get selected(){return this._selected}set selected(t){const e=t?this.querySelector(`sp-radio[value=${t}]`):void 0;this.deselectChecked(),e?(this._selected=t,e.checked=!0):this._selected=""}render(){return M`<slot></slot>`}firstUpdated(){const t=this.querySelector("sp-radio[checked]"),e=t?t.value:"";this.selected=this.selected||e,this.addEventListener("change",t=>{const e=t.target;this.selected=e.value})}deselectChecked(){this.querySelectorAll("sp-radio[checked]").forEach(t=>{t.checked=!1})}}Y([xt({type:String,reflect:!0})],fA.prototype,"name",void 0),Y([xt({reflect:!0})],fA.prototype,"selected",null),customElements.get("sp-radio-group")||customElements.define("sp-radio-group",fA);class mA extends fA{set selected(t){const e=t?this.querySelector(`sp-radio[value="${t}"]`):void 0;this.deselectChecked(),e?(this._selected=t,e.checked=!0):this._selected=""}}customElements.get("sp-radio-group-patched")||customElements.define("sp-radio-group-patched",mA);const gA=It`#root{display:inline-flex;align-items:flex-start;position:relative;min-height:var(--spectrum-radio-height,var(--spectrum-global-dimension-size-400));max-width:100%;margin-right:calc(var(--spectrum-radio-cursor-hit-x,
var(--spectrum-global-dimension-size-100))*2);vertical-align:top}#input{font-family:inherit;font-size:100%;line-height:1.15;margin:0;overflow:visible;box-sizing:border-box;padding:0;position:absolute;top:0;left:calc(var(--spectrum-radio-cursor-hit-x,
var(--spectrum-global-dimension-size-100))*-1);width:calc(100% + var(--spectrum-radio-cursor-hit-x,var(--spectrum-global-dimension-size-100))*2);height:100%;opacity:.0001;z-index:1;cursor:pointer}:host([disabled]) #input{cursor:default}:host([checked]) #input+#button{border-width:calc(var(--spectrum-radio-circle-diameter,var(--spectrum-global-dimension-size-175))/ 2 - var(--spectrum-radio-circle-dot-size,var(--spectrum-global-dimension-static-size-50))/ 2);border-color:var(--spectrum-radio-emphasized-circle-border-color-selected,var(--spectrum-global-color-blue-500))}#label{margin-left:var(--spectrum-radio-text-gap,var(--spectrum-global-dimension-size-125));font-size:var(--spectrum-radio-text-size,var(--spectrum-alias-font-size-default));transition:color var(--spectrum-global-animation-duration-100,.13s) ease-in-out;margin-top:var(--spectrum-global-dimension-size-75);color:var(--spectrum-radio-emphasized-text-color,var(--spectrum-alias-text-color))}#button{position:relative;box-sizing:border-box;width:var(--spectrum-radio-circle-diameter,var(--spectrum-global-dimension-size-175));height:var(--spectrum-radio-circle-diameter,var(--spectrum-global-dimension-size-175));margin:calc((var(--spectrum-radio-height,var(--spectrum-global-dimension-size-400)) - var(--spectrum-radio-circle-diameter,var(--spectrum-global-dimension-size-175)))/ 2) 0;flex-grow:0;flex-shrink:0;border-radius:calc(var(--spectrum-radio-circle-diameter,
var(--spectrum-global-dimension-size-175))/2);transition:border var(--spectrum-global-animation-duration-100,.13s) ease-in-out,box-shadow var(--spectrum-global-animation-duration-100,.13s) ease-in-out;background-color:var(--spectrum-radio-emphasized-circle-background-color,var(--spectrum-global-color-gray-75));border:var(--spectrum-radio-circle-border-size,var(--spectrum-alias-border-size-thick)) solid var(--spectrum-radio-emphasized-circle-border-color,var(--spectrum-global-color-gray-600))}:host([label-below]) #root{display:inline-flex;flex-direction:column;align-items:center;height:auto}:host([label-below]) #button{flex-shrink:0;margin:0}:host([label-below]) #label{margin:var(--spectrum-global-dimension-size-40) 0 0 0}#root:hover #button{border-color:var(--spectrum-radio-emphasized-circle-border-color-hover,var(--spectrum-global-color-gray-700));box-shadow:none}:host([checked]) #root:hover #input+#button{border-color:var(--spectrum-radio-emphasized-circle-border-color-selected-hover,var(--spectrum-global-color-blue-600))}#root:hover #label{color:var(--spectrum-radio-emphasized-text-color-hover,var(--spectrum-alias-text-color-hover))}#root:active #button{border-color:var(--spectrum-radio-emphasized-circle-border-color-down,var(--spectrum-global-color-gray-800))}:host([checked]) #root:active #input+#button{border-color:var(--spectrum-radio-emphasized-circle-border-color-selected-down,var(--spectrum-global-color-blue-700))}#root:active #label{color:var(--spectrum-radio-emphasized-text-color-down,var(--spectrum-alias-text-color-down))}:host([quiet][checked]) #input+#button{border-color:var(--spectrum-radio-quiet-circle-border-color-selected,var(--spectrum-global-color-gray-700))}:host([quiet][checked]) #root:hover #input+#button{border-color:var(--spectrum-radio-quiet-circle-border-color-selected-hover,var(--spectrum-global-color-gray-800))}:host([quiet][checked]) #root:active #input+#button{border-color:var(--spectrum-radio-quiet-circle-border-color-selected-down,var(--spectrum-global-color-gray-900))}:host([invalid]) #root:hover #input+#button,:host([quiet][invalid]) #root:hover #input+#button{border-color:var(--spectrum-radio-emphasized-circle-border-color-error-hover,var(--spectrum-global-color-red-600))}:host([invalid]) #root:hover #label,:host([quiet][invalid]) #root:hover #label{color:var(--spectrum-radio-emphasized-circle-border-color-error-hover,var(--spectrum-global-color-red-600))}:host([invalid]) #root:active #input+#button,:host([quiet][invalid]) #root:active #input+#button{border-color:var(--spectrum-radio-emphasized-circle-border-color-error-down,var(--spectrum-global-color-red-700))}:host([invalid]) #root:active #label,:host([quiet][invalid]) #root:active #label{color:var(--spectrum-radio-emphasized-circle-border-color-error-down,var(--spectrum-global-color-red-700))}:host([invalid]) #root #button,:host([invalid][checked]) #root #input+#button,:host([quiet][invalid]) #root #button,:host([quiet][invalid][checked]) #root #input+#button{border-color:var(--spectrum-radio-emphasized-circle-border-color-error,var(--spectrum-global-color-red-500))}:host([invalid]) #root #label,:host([quiet][invalid]) #root #label{color:var(--spectrum-radio-emphasized-circle-border-color-error,var(--spectrum-global-color-red-500))}:host([disabled]) #input+#button{border-color:var(--spectrum-radio-emphasized-circle-border-color-disabled,var(--spectrum-global-color-gray-400))!important}:host([disabled]) #input~#label{color:var(--spectrum-radio-emphasized-text-color-disabled,var(--spectrum-alias-text-color-disabled))!important}#input.focus-visible+#button,#root:hover #input.focus-visible+#button,:host([quiet]) #input.focus-visible+#button,:host([quiet]) #root:hover #input.focus-visible+#button{border-color:var(--spectrum-radio-emphasized-circle-border-color-key-focus,var(--spectrum-global-color-blue-400));box-shadow:0 0 0 1px var(--spectrum-radio-emphasized-circle-border-color-key-focus,var(--spectrum-global-color-blue-400))}#input.focus-visible~#label,#root:hover #input.focus-visible~#label,:host([quiet]) #input.focus-visible~#label,:host([quiet]) #root:hover #input.focus-visible~#label{color:var(--spectrum-radio-emphasized-text-color-key-focus,var(--spectrum-alias-text-color-key-focus))}:host([invalid][checked]) #root #input.focus-visible+#button,:host([quiet][invalid][checked]) #root #input.focus-visible+#button{border-color:var(--spectrum-radio-emphasized-circle-border-color-key-focus,var(--spectrum-global-color-blue-400));box-shadow:0 0 0 1px var(--spectrum-radio-emphasized-circle-border-color-key-focus,var(--spectrum-global-color-blue-400))}`;class vA extends _t{constructor(){super(...arguments),this.name="",this.value="",this.checked=!1}static get styles(){return[gA]}get focusElement(){return this.inputElement}handleChange(){this.checked=this.inputElement.checked,this.dispatchEvent(new Event("change",{bubbles:!0,composed:!0}))}render(){return M`<label id="root"><input id="input" type="radio" name="${this.name}" value="${this.value}" .checked="${this.checked}" @change="${this.handleChange}"> <span id="button"></span> <span id="label"><slot></slot></span></label>`}}Y([xt({type:String,reflect:!0})],vA.prototype,"name",void 0),Y([xt({type:String,reflect:!0})],vA.prototype,"value",void 0),Y([xt({type:Boolean,reflect:!0})],vA.prototype,"checked",void 0),Y([wt("#input")],vA.prototype,"inputElement",void 0),customElements.get("sp-radio")||customElements.define("sp-radio",vA);const bA=It`:host{z-index:1;display:block;min-width:var(--spectrum-slider-min-width,var(--spectrum-global-dimension-size-1250));-webkit-user-select:none;-moz-user-select:none;user-select:none}#controls,:host{position:relative;min-height:var(--spectrum-slider-height,var(--spectrum-alias-single-line-height))}#controls{display:inline-block;box-sizing:border-box;z-index:auto;width:calc(100% - var(--spectrum-slider-handle-width,var(--spectrum-global-dimension-size-200))/ 2*2);margin-left:calc(var(--spectrum-slider-handle-width,
var(--spectrum-global-dimension-size-200))/2);vertical-align:top}#buffer,#fill,#ramp,.track{height:var(--spectrum-slider-track-height,var(--spectrum-alias-border-size-thick));box-sizing:border-box;position:absolute;z-index:1;top:calc(var(--spectrum-slider-height,var(--spectrum-alias-single-line-height))/ 2);left:0;right:auto;margin-top:calc(var(--spectrum-slider-fill-track-height,
var(--spectrum-alias-border-size-thick))/-2);pointer-events:none}#buffer,#fill,.track{padding:0 var(--spectrum-slider-handle-gap,var(--spectrum-alias-border-size-thicker)) 0 0;margin-left:calc(var(--spectrum-slider-handle-width,
var(--spectrum-global-dimension-size-200))/2*-1)}#buffer:before,#fill:before,.track:before{content:"";display:block;height:100%;border-radius:var(--spectrum-slider-track-border-radius,var(--spectrum-global-dimension-static-size-10))}#fill{margin-left:0;padding:0 0 0 calc(var(--spectrum-slider-handle-width,var(--spectrum-global-dimension-size-200))/ 2 + var(--spectrum-slider-handle-gap,var(--spectrum-alias-border-size-thicker)))}.spectrum-Slider-fill--right{padding:0 calc(var(--spectrum-slider-handle-width,var(--spectrum-global-dimension-size-200))/ 2 + var(--spectrum-slider-handle-gap,var(--spectrum-alias-border-size-thicker))) 0 0}#buffer{padding:0 var(--spectrum-slider-handle-gap,var(--spectrum-alias-border-size-thicker)) 0 0;z-index:2}#buffer~#buffer,.track~.track{left:auto;right:0;padding:0 0 0 var(--spectrum-slider-handle-gap,var(--spectrum-alias-border-size-thicker));margin-left:0;margin-right:calc(var(--spectrum-slider-handle-width,
var(--spectrum-global-dimension-size-200))/2*-1)}#buffer~#buffer{margin-right:0;padding:0 0 0 calc(var(--spectrum-slider-handle-gap,var(--spectrum-alias-border-size-thicker)) + var(--spectrum-slider-handle-width,var(--spectrum-global-dimension-size-200))/ 2)}#buffer~#buffer:after{display:none}:host([variant=range]) #value{-webkit-user-select:text;-moz-user-select:text;user-select:text}:host([variant=range]) .track:first-of-type{padding:0 var(--spectrum-slider-handle-gap,var(--spectrum-alias-border-size-thicker)) 0 0;left:0;right:auto;margin-left:calc(var(--spectrum-slider-handle-width,
var(--spectrum-global-dimension-size-200))/2*-1)}:host([variant=range]) .track{padding:0 calc(var(--spectrum-slider-handle-gap,var(--spectrum-alias-border-size-thicker)) + var(--spectrum-slider-handle-width,var(--spectrum-global-dimension-size-200))/ 2) 0 calc(var(--spectrum-slider-handle-gap,var(--spectrum-alias-border-size-thicker)) + var(--spectrum-slider-handle-width,var(--spectrum-global-dimension-size-200))/ 2);left:auto;right:auto;margin:0}:host([variant=range]) .track:last-of-type{padding:0 0 0 var(--spectrum-slider-handle-gap,var(--spectrum-alias-border-size-thicker));left:auto;right:0;margin-right:calc(var(--spectrum-slider-handle-width,
var(--spectrum-global-dimension-size-200))/2*-1)}#ramp{margin-top:0;height:var(--spectrum-slider-ramp-track-height,var(--spectrum-global-dimension-static-size-200));position:absolute;left:calc(var(--spectrum-slider-handle-width,
var(--spectrum-global-dimension-size-200))/2*-1);right:calc(var(--spectrum-slider-handle-width,
var(--spectrum-global-dimension-size-200))/2*-1);top:calc(var(--spectrum-slider-ramp-track-height,
var(--spectrum-global-dimension-static-size-200))/2)}#ramp svg{width:100%;height:100%}#handle{position:absolute;left:0;top:calc(var(--spectrum-slider-height,var(--spectrum-alias-single-line-height))/ 2);z-index:2;display:inline-block;box-sizing:border-box;width:var(--spectrum-slider-handle-width,var(--spectrum-global-dimension-size-200));height:var(--spectrum-slider-handle-height,var(--spectrum-global-dimension-size-200));margin:calc(var(--spectrum-slider-handle-width,
var(--spectrum-global-dimension-size-200))/-2) 0 0 calc(var(--spectrum-slider-handle-width,
var(--spectrum-global-dimension-size-200))/-2);border-radius:var(--spectrum-slider-handle-border-radius,var(--spectrum-alias-border-radius-medium));transition:border-width var(--spectrum-slider-animation-duration,var(--spectrum-global-animation-duration-100)) ease-in-out;outline:0;cursor:pointer;cursor:-webkit-grab;cursor:grab;border:var(--spectrum-slider-handle-border-size,var(--spectrum-alias-border-size-thick)) solid var(--spectrum-slider-handle-border-color,var(--spectrum-global-color-gray-700));background:var(--spectrum-alias-background-color-default,var(--spectrum-global-color-gray-100))}#handle:active,:host([dragging]) #handle,:host([handle-highlight]) #handle{border-width:var(--spectrum-slider-handle-border-size-down,var(--spectrum-global-dimension-size-75));cursor:ns-resize;cursor:-webkit-grabbing;cursor:grabbing}#handle.is-tophandle,#handle:active,:host([dragging]) #handle,:host([handle-highlight]) #handle{z-index:3}#input{margin:0;width:var(--spectrum-slider-handle-width,var(--spectrum-global-dimension-size-200));height:var(--spectrum-slider-handle-height,var(--spectrum-global-dimension-size-200));padding:0;position:absolute;top:calc(var(--spectrum-slider-handle-width,
var(--spectrum-global-dimension-size-200))/-2/4);left:calc(var(--spectrum-slider-handle-width,
var(--spectrum-global-dimension-size-200))/-2/4);overflow:hidden;opacity:.000001;cursor:default;-webkit-appearance:none;border:0;pointer-events:none;background:0 0}#input:focus{outline:0}#labelContainer{display:flex;position:relative;width:auto;padding-top:var(--spectrum-fieldlabel-padding-top,var(--spectrum-global-dimension-size-50));font-size:var(--spectrum-label-text-size,var(--spectrum-global-dimension-font-size-75));line-height:var(--spectrum-label-text-line-height,var(--spectrum-global-font-line-height-small));color:var(--spectrum-label-text-color,var(--spectrum-alias-label-text-color))}#label{padding-left:0;flex-grow:1}#value{flex-grow:0;padding-right:0;cursor:default;margin-left:var(--spectrum-slider-label-gap-x,var(--spectrum-global-dimension-size-200))}.ticks{display:flex;justify-content:space-between;z-index:0;margin:0 calc(var(--spectrum-slider-handle-width,
var(--spectrum-global-dimension-size-200))/2*-1);margin-top:calc(var(--spectrum-slider-tick-mark-height,10px) + var(--spectrum-slider-track-height,var(--spectrum-alias-border-size-thick))/ 2)}.tick{position:relative}.tick,.tick:after{width:var(--spectrum-slider-tick-mark-width,var(--spectrum-alias-border-size-thick))}.tick:after{display:block;position:absolute;top:0;left:calc(50% - var(--spectrum-slider-tick-mark-width,var(--spectrum-alias-border-size-thick))/ 2);content:"";height:var(--spectrum-slider-tick-mark-height,10px);border-radius:var(--spectrum-slider-tick-mark-border-radius,var(--spectrum-alias-border-radius-xsmall));background-color:var(--spectrum-slider-tick-mark-color,var(--spectrum-alias-track-color-default))}.tick .tickLabel{display:flex;align-items:center;justify-content:center;margin:var(--spectrum-slider-label-gap-x,var(--spectrum-global-dimension-size-200)) calc(var(--spectrum-slider-label-gap-x,
var(--spectrum-global-dimension-size-200))*-1) 0 calc(var(--spectrum-slider-label-gap-x,
var(--spectrum-global-dimension-size-200))*-1);font-size:var(--spectrum-label-text-size,var(--spectrum-global-dimension-font-size-75));line-height:var(--spectrum-label-text-line-height,var(--spectrum-global-font-line-height-small))}.tick:first-of-type .tickLabel,.tick:last-of-type .tickLabel{display:block;position:absolute;margin:var(--spectrum-slider-label-gap-x,var(--spectrum-global-dimension-size-200)) 0 0 0}.tick:first-of-type .tickLabel{left:0}.tick:last-of-type .tickLabel{right:0}:host([variant=color]) #labelContainer,:host([variant=color]) .spectrum-Dial-labelContainer{padding-bottom:var(--spectrum-fieldlabel-padding-bottom,var(--spectrum-global-dimension-size-65))}:host([variant=color]) #controls,:host([variant=color]) #controls:before,:host([variant=color]) .spectrum-Dial-controls,:host([variant=color]) .spectrum-Dial-controls:before,:host([variant=color]) .track{min-height:auto;height:var(--spectrum-slider-color-track-height,var(--spectrum-global-dimension-static-size-300));margin-left:0;width:100%}:host([variant=color]) #controls:before,:host([variant=color]) .spectrum-Dial-controls:before{display:block;content:""}:host([variant=color]) #controls:before,:host([variant=color]) .spectrum-Dial-controls:before,:host([variant=color]) .track{top:0;padding:0;margin-top:0;margin-right:0;border-radius:var(--spectrum-alias-border-radius-regular,var(--spectrum-global-dimension-size-50))}:host([variant=color]) #handle,:host([variant=color]) .spectrum-Dial-handle{top:50%}:host([disabled]){cursor:default}:host([disabled]) #handle,:host([disabled]) .spectrum-Dial-handle{cursor:default;pointer-events:none}:host([disabled][variant=color]) #handle:active,:host([disabled][variant=color]) #handle:hover,:host([disabled][variant=color]) .spectrum-Dial-handle:active,:host([disabled][variant=color]) .spectrum-Dial-handle:hover{border-width:var(--spectrum-slider-color-handle-outset-border-size,var(--spectrum-alias-border-size-thin))}.track:before{background:var(--spectrum-slider-track-color,var(--spectrum-global-color-gray-300))}#fill:before,:host([variant=filled]) .track:first-child:before{background:var(--spectrum-slider-fill-track-color,var(--spectrum-global-color-gray-700))}#buffer:after,#buffer:before{background:var(--spectrum-slider-player-track-buffer-color,var(--spectrum-global-color-gray-500))}#ramp path{fill:var(--spectrum-slider-track-color,var(--spectrum-global-color-gray-300))}#handle:hover{border-color:var(--spectrum-slider-handle-border-color-hover,var(--spectrum-global-color-gray-800))}#handle:active,:host([dragging]) #handle{border-color:var(--spectrum-slider-handle-border-color-down,var(--spectrum-global-color-gray-800))}:host([variant=ramp]) #handle,:host([variant=ramp]) .spectrum-Dial-handle{box-shadow:0 0 0 4px var(--spectrum-alias-background-color-default,var(--spectrum-global-color-gray-100))}:host([handle-highlight]) #handle{border-color:var(--spectrum-slider-handle-border-color-key-focus,var(--spectrum-alias-border-color-focus));background:var(--spectrum-slider-handle-background-color-key-focus,var(--spectrum-alias-border-color-focus))}:host([dragging]) #handle{border-color:var(--spectrum-slider-handle-border-color-down,var(--spectrum-global-color-gray-800));background:var(--spectrum-slider-handle-background-color-down,var(--spectrum-alias-background-color-transparent))}:host([variant=range]) .track:not(:first-of-type):not(:last-of-type):before{background:var(--spectrum-slider-fill-track-color,var(--spectrum-global-color-gray-700))}:host([variant=color]) #controls:before,:host([variant=color]) .spectrum-Dial-controls:before{background-color:var(--spectrum-global-color-static-white,#fff);background-image:linear-gradient(-45deg,transparent 75.5%,var(--spectrum-global-color-static-gray-500,#bcbcbc) 0),linear-gradient(45deg,transparent 75.5%,var(--spectrum-global-color-static-gray-500,#bcbcbc) 0),linear-gradient(-45deg,var(--spectrum-global-color-static-gray-500,#bcbcbc) 25.5%,transparent 0),linear-gradient(45deg,var(--spectrum-global-color-static-gray-500,#bcbcbc) 25.5%,transparent 0);background-size:var(--spectrum-global-dimension-static-size-200,16px) var(--spectrum-global-dimension-static-size-200,16px);background-position:0 0,0 var(--spectrum-global-dimension-static-size-100,8px),var(--spectrum-global-dimension-static-size-100,8px) calc(-1*var(--spectrum-global-dimension-static-size-100,8px)),calc(-1*var(--spectrum-global-dimension-static-size-100,8px)) 0;z-index:0}:host([variant=color]) .track{background-color:initial;background-image:linear-gradient(90deg,var(--spectrum-slider-color-track-background-color-gradient-start,var(--spectrum-global-color-blue-400)),var(--spectrum-slider-color-track-background-color-gradient-end,var(--spectrum-global-color-blue-700)));box-shadow:inset 0 0 0 1px var(--spectrum-slider-color-track-border-color,var(--spectrum-alias-border-color-translucent-dark))}:host([variant=color]) .track:before{display:none}:host([variant=color]) #handle,:host([variant=color]) .spectrum-Dial-handle{box-shadow:inset 0 0 0 1px var(--spectrum-slider-color-handle-inset-border-color,var(--spectrum-alias-border-color-translucent-dark)),0 0 0 1px var(--spectrum-slider-color-handle-outset-border-color,var(--spectrum-alias-border-color-translucent-dark));border-color:var(--spectrum-slider-color-handle-border-color,var(--spectrum-global-color-gray-50));background:var(--spectrum-slider-color-handle-color,var(--spectrum-alias-border-color-transparent))}:host([variant=color][handle-highlight]) #handle{box-shadow:0 0 0 1px var(--spectrum-slider-color-handle-outset-border-color-key-focus,var(--spectrum-alias-border-color-translucent-dark))}:host([disabled]) #labelContainer,:host([disabled]) .spectrum-Dial-labelContainer{color:var(--spectrum-label-text-color-disabled,var(--spectrum-alias-text-color-disabled))}:host([disabled]) #handle,:host([disabled]) .spectrum-Dial-handle{border-color:var(--spectrum-slider-handle-border-color-disabled,var(--spectrum-global-color-gray-400));background:var(--spectrum-alias-background-color-default,var(--spectrum-global-color-gray-100))}:host([disabled]) #handle:active,:host([disabled]) #handle:hover,:host([disabled]) .spectrum-Dial-handle:active,:host([disabled]) .spectrum-Dial-handle:hover{border-color:var(--spectrum-slider-handle-border-color-disabled,var(--spectrum-global-color-gray-400));background:var(--spectrum-slider-handle-background-color,var(--spectrum-alias-background-color-transparent))}:host([disabled]) .track:before{background:var(--spectrum-slider-track-color-disabled,var(--spectrum-global-color-gray-300))}:host([disabled]) #fill:before,:host([disabled][variant=filled]) .track:first-child:before{background:var(--spectrum-slider-fill-track-color-disabled,var(--spectrum-global-color-gray-300))}:host([disabled]) #buffer:before{background:var(--spectrum-slider-player-track-buffer-color-disabled,var(--spectrum-alias-track-color-default))}:host([disabled]) #ramp path{fill:var(--spectrum-slider-ramp-track-color-disabled,var(--spectrum-global-color-gray-200))}:host([disabled][variant=color]) .track{background:var(--spectrum-slider-color-track-color-disabled,var(--spectrum-global-color-gray-200))!important;box-shadow:none}:host([disabled][variant=color]) #handle,:host([disabled][variant=color]) #handle:active,:host([disabled][variant=color]) #handle:hover,:host([disabled][variant=color]) .spectrum-Dial-handle,:host([disabled][variant=color]) .spectrum-Dial-handle:active,:host([disabled][variant=color]) .spectrum-Dial-handle:hover{background:var(--spectrum-slider-color-handle-color-disabled,var(--spectrum-alias-border-color-transparent));box-shadow:none;border-color:var(--spectrum-slider-color-handle-border-color-disabled,var(--spectrum-global-color-gray-400))}:host([disabled][variant=range]) .track:not(:first-of-type):not(:last-of-type):before{background:var(--spectrum-slider-fill-track-color-disabled,var(--spectrum-global-color-gray-300))}`,yA=It`:host(:focus){outline-width:0}:host([has-alpha][variant=color]) .track{background:linear-gradient(90deg,rgba(38,128,235,.5),#095aba)}`,xA=["color","filled","ramp","range","tick"];class wA extends _t{constructor(){super(...arguments),this.type="",this._value=10,this._variant="",this.label="",this.max=20,this.min=0,this.step=1,this.tickStep=0,this.tickLabels=!1,this.disabled=!1,this.dragging=!1,this.handleHighlight=!1,this.supportsPointerEvent="setPointerCapture"in this,this.onMouseUp=(t=>{this.focus(),this.currentMouseEvent=t,document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp),requestAnimationFrame(()=>{this.handleHighlight=!1,this.dragging=!1,this.dispatchChangeEvent()})}),this.onMouseMove=(t=>{this.currentMouseEvent=t})}static get styles(){return[yA,bA]}get value(){return this._value}set value(t){const e=this.value;t!==e&&(this._value=t,this.requestUpdate("value",e))}set variant(t){const e=this.variant;t!==this.variant&&(xA.includes(t)?(this.setAttribute("variant",t),this._variant=t):(this.removeAttribute("variant"),this._variant=""),this.requestUpdate("variant",e))}get variant(){return this._variant}get focusElement(){return this.input?this.input:this}render(){return M`${this.renderLabel()} ${"color"===this.variant?this.renderColorTrack():this.renderTrack()}`}updated(t){t.has("value")&&(this.value=this.clampValue(this.value),this.dragging&&this.dispatchInputEvent())}renderLabel(){return M`<div id="labelContainer"><label id="label" for="input">${this.label}</label><div id="value" role="textbox" aria-readonly="true" aria-labelledby="label">${this.value}</div></div>`}renderTrackLeft(){return"ramp"===this.variant?M``:M`<div class="track" id="track-left" style="${this.trackLeftStyle}" role="presentation"></div>`}renderTrackRight(){return"ramp"===this.variant?M``:M`<div class="track" id="track-right" style="${this.trackRightStyle}" role="presentation"></div>`}renderRamp(){return"ramp"!==this.variant?M``:M`<div id="ramp"><svg viewBox="0 0 240 16" preserveAspectRatio="none" aria-hidden="true" focusable="false"><path d="M240,4v8c0,2.3-1.9,4.1-4.2,4L1,9C0.4,9,0,8.5,0,8c0-0.5,0.4-1,1-1l234.8-7C238.1-0.1,240,1.7,240,4z"></path></svg></div>`}renderTicks(){if("tick"!==this.variant)return M``;const t=this.tickStep||this.step,e=(this.max-this.min)/t,r=new Array(e+1);return r.fill(0,0,e+1),M`<div class="ticks">${r.map((e,r)=>M`<div class="tick">${this.tickLabels?M`<div class="tickLabel">${r*t}</div>`:M``}</div>`)}</div>`}renderHandle(){return M`<div id="handle" style="${this.handleStyle}" @pointermove="${this.onPointerMove}" @pointerdown="${this.onPointerDown}" @mousedown="${this.onMouseDown}" @pointerup="${this.onPointerUp}" @pointercancel="${this.onPointerCancel}" role="presentation"><input type="range" id="input" value="${this.value}" step="${this.step}" min="${this.min}" max="${this.max}" aria-disabled="${this.disabled?"true":"false"}" aria-label="${this.ariaLabel||this.label}" aria-valuemin="${this.min}" aria-valuemax="${this.max}" aria-valuetext="${this.value}" @change="${this.onInputChange}" @focus="${this.onInputFocus}" @blur="${this.onInputBlur}"></div>`}renderTrack(){return M`<div id="controls" @pointerdown="${this.onTrackPointerDown}" @mousedown="${this.onTrackMouseDown}">${this.renderTrackLeft()} ${this.renderRamp()} ${this.renderTicks()} ${this.renderHandle()} ${this.renderTrackRight()}</div>`}renderColorTrack(){return M`<div id="controls" @pointerdown="${this.onTrackPointerDown}"><div class="track"></div>${this.renderHandle()}</div>`}onPointerDown(t){this.disabled||(this.focus(),this.dragging=!0,this.handle.setPointerCapture(t.pointerId))}onMouseDown(t){this.supportsPointerEvent||this.disabled||(document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp),this.focus(),this.dragging=!0,this.currentMouseEvent=t,this._trackMouseEvent())}_trackMouseEvent(){this.currentMouseEvent&&this.dragging&&(this.value=this.calculateHandlePosition(this.currentMouseEvent),requestAnimationFrame(()=>this._trackMouseEvent()))}onPointerUp(t){this.focus(),this.handleHighlight=!1,this.dragging=!1,this.handle.releasePointerCapture(t.pointerId),this.dispatchChangeEvent()}onPointerMove(t){this.dragging&&(this.value=this.calculateHandlePosition(t))}onPointerCancel(t){this.dragging=!1,this.handle.releasePointerCapture(t.pointerId)}onTrackPointerDown(t){t.target===this.handle||this.disabled||(this.dragging=!0,this.handle.setPointerCapture(t.pointerId),this.value=this.calculateHandlePosition(t))}onTrackMouseDown(t){this.supportsPointerEvent||t.target===this.handle||this.disabled||(document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp),this.dragging=!0,this.currentMouseEvent=t,this._trackMouseEvent())}onInputChange(){const t=parseFloat(this.input.value);this.value=this.clampValue(t),this.input.value=this.value.toString(),this.dispatchChangeEvent()}onInputFocus(){this.handleHighlight=!0}onInputBlur(){this.handleHighlight=!1}calculateHandlePosition(t){const e=this.getBoundingClientRect(),r=e.left,n=(t.clientX-r)/e.width;let o=this.min+(this.max-this.min)*n;return o=this.clampValue(o),this.step&&(o=Math.round(o/this.step)*this.step),o}clampValue(t){const e=Math.min(t,this.max);return Math.max(e,this.min)}dispatchInputEvent(){const t=new Event("input",{bubbles:!0,composed:!0});this.dispatchEvent(t)}dispatchChangeEvent(){this.input.value=this.value.toString();const t=new Event("change",{bubbles:!0,composed:!0});this.dispatchEvent(t)}get trackProgress(){const t=this.max-this.min;return(this.value-this.min)/t}get trackLeftStyle(){return`width: ${100*this.trackProgress}%`}get trackRightStyle(){return`width: ${100*(1-this.trackProgress)}%;`+`left: calc(${100*this.trackProgress}% + var(--spectrum-slider-handle-width, var(--spectrum-global-dimension-size-200)) / 2)`}get handleStyle(){return`left: ${100*this.trackProgress}%`}}Y([xt()],wA.prototype,"type",void 0),Y([xt({reflect:!0})],wA.prototype,"value",null),Y([xt({type:String})],wA.prototype,"variant",null),Y([xt()],wA.prototype,"label",void 0),Y([xt({reflect:!0,attribute:"aria-label"})],wA.prototype,"ariaLabel",void 0),Y([xt({type:Number})],wA.prototype,"max",void 0),Y([xt({type:Number})],wA.prototype,"min",void 0),Y([xt({type:Number})],wA.prototype,"step",void 0),Y([xt({type:Number,attribute:"tick-step"})],wA.prototype,"tickStep",void 0),Y([xt({type:Boolean,attribute:"tick-labels"})],wA.prototype,"tickLabels",void 0),Y([xt({type:Boolean,reflect:!0})],wA.prototype,"disabled",void 0),Y([xt({type:Boolean,reflect:!0})],wA.prototype,"dragging",void 0),Y([xt({type:Boolean,reflect:!0,attribute:"handle-highlight"})],wA.prototype,"handleHighlight",void 0),Y([wt("#handle")],wA.prototype,"handle",void 0),Y([wt("#input")],wA.prototype,"input",void 0),customElements.get("sp-slider")||customElements.define("sp-slider",wA);var kA={render(t,e){return M`${this.css()} ${this.html(t,e)}`},html:(t,e)=>M`<label>Architecture</label><sp-radio-group-patched @change="${e=>t.onChange(e.currentTarget.getAttribute("name"),e.target.value)}" selected="${oe.input.architecture}" name="architecture"><sp-radio value="MobileNetV1">MobileNet v1</sp-radio><sp-radio value="ResNet50">ResNet 50</sp-radio></sp-radio-group-patched><sp-slider label="Resolution" @change="${e=>t.onChange("inputResolution",e.target.value)}" variant="ramp" min="50" max="800" step="50" value="${oe.input.inputResolution}"></sp-slider><label>Output Stride</label><sp-radio-group-patched @change="${e=>t.onChange(e.currentTarget.getAttribute("name"),Number(e.target.value))}" selected="${oe.input.outputStride}" name="outputstride"><sp-radio value="${oe.input.outputStrideOptions[oe.input.architecture][0]}">${oe.input.outputStrideOptions[oe.input.architecture][0]}</sp-radio><sp-radio value="${oe.input.outputStrideOptions[oe.input.architecture][1]}">${oe.input.outputStrideOptions[oe.input.architecture][1]}</sp-radio></sp-radio-group-patched><label>Multiplier</label><sp-radio-group-patched @change="${e=>t.onChange(e.currentTarget.getAttribute("name"),Number(e.target.value))}" selected="${oe.input.multiplier}" class="${"ResNet50"===oe.input.architecture?"hidden":""}" name="multiplier"><sp-radio value="0.5">0.5</sp-radio><sp-radio value="0.75">0.75</sp-radio><sp-radio value="1.0">1.0</sp-radio></sp-radio-group-patched><label>Quant Bytes</label><sp-radio-group-patched @change="${e=>t.onChange(e.currentTarget.getAttribute("name"),Number(e.target.value))}" selected="${oe.input.quantBytes}" name="quantbytes"><sp-radio value="1">1</sp-radio><sp-radio value="2">2</sp-radio><sp-radio value="4">4</sp-radio></sp-radio-group-patched>`,css:()=>M`<style>:host{display:inline-block;width:100%}.hidden{display:none}label{font-size:var(--spectrum-label-text-size,var(--spectrum-global-dimension-font-size-75));line-height:var(--spectrum-label-text-line-height,var(--spectrum-global-font-line-height-small));color:var(--spectrum-label-text-color,var(--spectrum-alias-label-text-color))}sp-slider,sp-radio-group-patched{margin-bottom:15px}</style>`};V("dy-settings-input",class extends HTMLElement{static get observedAttributes(){}propertyChangedCallback(t,e,r){}connectedCallback(){this.init(kA,{})}onChange(t,e){oe.setValue("input",t,e)&&this.render()}},P);var CA={render(t,e){return M`${this.css()} ${this.html(t,e)}`},html:(t,e)=>M`<sp-slider @change="${e=>t.onChange("maxPoseDetections",e.target.value)}" variant="ramp" min="1" max="20" step="1" label="Maximum Number of Poses" value="${oe.multiPoseDetection.maxPoseDetections}"></sp-slider><sp-slider @change="${e=>t.onChange("minPoseConfidence",e.target.value)}" variant="ramp" min="0" max="1" step=".01" label="Minimum Pose Confidence" value="${oe.multiPoseDetection.minPoseConfidence}"></sp-slider><sp-slider @change="${e=>t.onChange("minPartConfidence",e.target.value)}" variant="ramp" min="0" max="1" step=".01" label="Minimum Part Confidence" value="${oe.multiPoseDetection.minPartConfidence}"></sp-slider><sp-slider label="NMS Radius" @change="${e=>t.onChange("nmsRadius",e.target.value)}" variant="ramp" min="0" max="30" step="1" value="${oe.multiPoseDetection.nmsRadius}"></sp-slider>`,css:()=>M`<style>.spectrum-Well{display:block;min-width:248px;padding:16px;margin-top:4px;border-width:1px;border-style:solid;border-radius:var(--spectrum-global-dimension-size-50)}.spectrum-Well{background-color:var(--spectrum-well-background-color);border-color:var(--spectrum-well-border-color)}:host{display:inline-block;width:100%}sp-slider{margin-bottom:15px}</style>`};V("dy-settings-multipose",class extends HTMLElement{static get observedAttributes(){}propertyChangedCallback(t,e,r){}connectedCallback(){this.init(CA,{})}onChange(t,e){oe.setValue("multiPoseDetection",t,e)}},P);var SA={render(t,e){return M`${this.css()} ${this.html(t,e)}`},html:(t,e)=>M`<sp-slider label="Minimum Pose Confidence" @change="${e=>t.onChange("minPoseConfidence",e.target.value)}" variant="ramp" min="0" max="1" step=".01" value="${oe.singlePoseDetection.minPoseConfidence}"></sp-slider><sp-slider label="Minimum Part Confidence" @change="${e=>t.onChange("minPartConfidence",e.target.value)}" variant="ramp" min="0" max="1" step=".01" value="${oe.singlePoseDetection.minPartConfidence}"></sp-slider>`,css:()=>M`<style>:host{display:inline-block;width:100%}sp-slider{margin-bottom:15px}</style>`};V("dy-settings-singlepose",class extends HTMLElement{static get observedAttributes(){}propertyChangedCallback(t,e,r){}connectedCallback(){this.init(SA,{})}onChange(t,e){oe.setValue("singlePoseDetection",t,e)}},P);const EA=It`:host{position:relative;display:inline-block;max-width:100%;width:var(--spectrum-global-dimension-size-2400);min-width:var(--spectrum-dropdown-min-width,var(--spectrum-global-dimension-size-600))}select{-webkit-appearance:none;-moz-appearance:none;appearance:none;-ms-appearance:none}select::-ms-expand{display:none}select::-ms-value{background-color:initial}select+.dropdown{position:absolute;right:var(--spectrum-dropdown-padding-x,var(--spectrum-global-dimension-size-150));top:50%;margin-top:calc(var(--spectrum-icon-chevron-down-medium-height,
var(--spectrum-global-dimension-size-75))/-2)}#button{position:relative;width:100%;display:flex;justify-content:space-between;align-items:center}#label{flex:1 1 auto;white-space:nowrap;overflow:hidden;height:calc(var(--spectrum-dropdown-height,var(--spectrum-global-dimension-size-400)) - var(--spectrum-dropdown-border-size,var(--spectrum-alias-border-size-thin))*2);line-height:calc(var(--spectrum-dropdown-height,var(--spectrum-global-dimension-size-400)) - var(--spectrum-dropdown-border-size,var(--spectrum-alias-border-size-thin))*2);font-size:var(--spectrum-dropdown-text-size,var(--spectrum-alias-font-size-default));text-overflow:ellipsis;text-align:left}#label.placeholder{font-weight:var(--spectrum-dropdown-placeholder-text-font-weight,var(--spectrum-global-font-weight-regular));font-style:var(--spectrum-dropdown-placeholder-text-font-style,var(--spectrum-global-font-style-italic));transition:color var(--spectrum-global-animation-duration-100,.13s) ease-in-out;color:var(--spectrum-dropdown-placeholder-text-color,var(--spectrum-alias-placeholder-text-color))}#label+.dropdown,#label~.dropdown{margin-left:var(--spectrum-dropdown-icon-margin-left,var(--spectrum-global-dimension-size-150))}.dropdown{display:inline-block;position:relative;vertical-align:top;transition:color var(--spectrum-global-animation-duration-100,.13s) ease-out;margin-top:calc((var(--spectrum-dropdown-height,var(--spectrum-global-dimension-size-400)) - var(--spectrum-dropdown-border-size,var(--spectrum-alias-border-size-thin))*2 - var(--spectrum-icon-chevron-down-medium-height,var(--spectrum-global-dimension-size-75)))/ 2);margin-bottom:calc((var(--spectrum-dropdown-height,var(--spectrum-global-dimension-size-400)) - var(--spectrum-dropdown-border-size,var(--spectrum-alias-border-size-thin))*2 - var(--spectrum-icon-chevron-down-medium-height,var(--spectrum-global-dimension-size-75)))/ 2);opacity:1;color:var(--spectrum-dropdown-icon-color,var(--spectrum-alias-icon-color))}#button .icon:not(.dropdown){margin-top:calc((var(--spectrum-dropdown-height,var(--spectrum-global-dimension-size-400)) - var(--spectrum-dropdown-border-size,var(--spectrum-alias-border-size-thin))*2 - var(--spectrum-dropdown-icon-size,var(--spectrum-alias-workflow-icon-size)))/ 2);margin-bottom:calc((var(--spectrum-dropdown-height,var(--spectrum-global-dimension-size-400)) - var(--spectrum-dropdown-border-size,var(--spectrum-alias-border-size-thin))*2 - var(--spectrum-dropdown-icon-size,var(--spectrum-alias-workflow-icon-size)))/ 2)}#button #label+.icon:not(.dropdown){margin-left:var(--spectrum-dropdown-icon-margin-left,var(--spectrum-global-dimension-size-150))}:host([quiet]){width:auto;min-width:var(--spectrum-dropdown-quiet-min-width,var(--spectrum-global-dimension-size-600))}#popover{max-width:var(--spectrum-global-dimension-size-3000)}.spectrum-Dropdown-popover--quiet{margin-left:calc(-1*(var(--spectrum-dropdown-quiet-popover-offset-x,var(--spectrum-global-dimension-size-150)) + var(--spectrum-popover-border-size,var(--spectrum-alias-border-size-thin))))}#button:hover .dropdown{color:var(--spectrum-dropdown-icon-color-hover,var(--spectrum-alias-icon-color-hover))}#button.is-selected .placeholder{color:var(--spectrum-dropdown-placeholder-text-color-down,var(--spectrum-global-color-gray-900))}:host([invalid]) .icon:not(.dropdown):not(.checkmark){color:var(--spectrum-dropdown-validation-icon-color-error,var(--spectrum-semantic-negative-color-icon))}:host([disabled]) #button:hover .dropdown,:host([disabled]) .dropdown,:host([invalid][disabled]) .icon,:host([invalid][disabled]) .icon:not(.dropdown):not(.checkmark){color:var(--spectrum-dropdown-icon-color-disabled,var(--spectrum-alias-icon-color-disabled))}:host([disabled]) #label.placeholder{color:var(--spectrum-dropdown-placeholder-text-color-disabled,var(--spectrum-alias-text-color-disabled))}#label.placeholder:hover{color:var(--spectrum-dropdown-placeholder-text-color-hover,var(--spectrum-alias-placeholder-text-color-hover))}#label.placeholder:active{color:var(--spectrum-dropdown-placeholder-text-color-mouse-focus,var(--spectrum-global-color-gray-900))}#button.focus-visible #label.placeholder{color:var(--spectrum-dropdown-placeholder-text-color-key-focus,var(--spectrum-alias-placeholder-text-color-hover))}#button.focus-visible .dropdown{color:var(--spectrum-dropdown-icon-color-key-focus,var(--spectrum-alias-icon-color-focus))}sp-popover{width:100%}#label~.dropdown{margin-left:var(--spectrum-dropdown-icon-gap,var(--spectrum-global-dimension-size-100))}`,zA=It`#button{display:inline-flex;box-sizing:border-box;align-items:center;justify-content:center;overflow:visible;margin:0;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-appearance:button;vertical-align:top;transition:background var(--spectrum-global-animation-duration-100,.13s) ease-out,border-color var(--spectrum-global-animation-duration-100,.13s) ease-out,color var(--spectrum-global-animation-duration-100,.13s) ease-out,box-shadow var(--spectrum-global-animation-duration-100,.13s) ease-out;text-decoration:none;font-family:adobe-clean-ux,adobe-clean,Source Sans Pro,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif;line-height:1.3;cursor:pointer;position:relative;height:var(--spectrum-actionbutton-height,var(--spectrum-alias-single-line-height));min-width:var(--spectrum-actionbutton-min-width,var(--spectrum-global-dimension-size-400));padding:0 calc(var(--spectrum-actionbutton-icon-padding-x,var(--spectrum-global-dimension-size-85)) - var(--spectrum-actionbutton-border-size,var(--spectrum-alias-border-size-thin)));border-radius:var(--spectrum-actionbutton-border-radius,var(--spectrum-alias-border-radius-regular));font-size:var(--spectrum-actionbutton-text-size,var(--spectrum-alias-font-size-default));font-weight:var(--spectrum-actionbutton-text-font-weight,var(--spectrum-alias-body-text-font-weight));background-color:var(--spectrum-actionbutton-background-color,var(--spectrum-global-color-gray-75));border:var(--spectrum-actionbutton-border-size,var(--spectrum-alias-border-size-thin)) solid var(--spectrum-actionbutton-border-color,var(--spectrum-alias-border-color));color:var(--spectrum-actionbutton-text-color,var(--spectrum-alias-text-color))}#button:focus{outline:0}#button::-moz-focus-inner{border:0;border-style:none;padding:0;margin-top:-2px;margin-bottom:-2px}:host([disabled]) #button{cursor:default;background-color:var(--spectrum-actionbutton-background-color-disabled,var(--spectrum-global-color-gray-200));border-color:var(--spectrum-actionbutton-border-color-disabled,var(--spectrum-global-color-gray-200));color:var(--spectrum-actionbutton-text-color-disabled,var(--spectrum-alias-text-color-disabled))}::slotted([slot=icon]){max-height:100%;color:var(--spectrum-actionbutton-icon-color,var(--spectrum-alias-icon-color))}slot[name=icon]+#label{padding-left:var(--spectrum-actionbutton-icon-padding-x,var(--spectrum-global-dimension-size-85));padding-right:calc(var(--spectrum-actionbutton-text-padding-x,var(--spectrum-global-dimension-size-150)) - var(--spectrum-actionbutton-icon-padding-x,var(--spectrum-global-dimension-size-85)))}.spectrum-Icon--sizeS:only-child{position:absolute;top:calc(50% - var(--spectrum-actionbutton-icon-size,var(--spectrum-alias-workflow-icon-size))/ 2);left:calc(50% - var(--spectrum-actionbutton-icon-size,var(--spectrum-alias-workflow-icon-size))/ 2)}#label:only-child{padding:0 calc(var(--spectrum-actionbutton-text-padding-x,var(--spectrum-global-dimension-size-150)) - var(--spectrum-actionbutton-icon-padding-x,var(--spectrum-global-dimension-size-85)))}#hold-affordance{position:absolute;right:var(--spectrum-actionbutton-hold-icon-padding-right,var(--spectrum-global-dimension-size-40));bottom:var(--spectrum-actionbutton-hold-icon-padding-bottom,var(--spectrum-global-dimension-size-40));color:var(--spectrum-actionbutton-hold-icon-color,var(--spectrum-alias-icon-color))}#label{align-self:center;justify-self:center;text-align:center;width:100%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}#label:empty{display:none}:host([quiet]) #button{border-width:var(--spectrum-actionbutton-quiet-border-size,var(--spectrum-alias-border-size-thin));border-radius:var(--spectrum-actionbutton-quiet-border-radius,var(--spectrum-alias-border-radius-regular));font-size:var(--spectrum-actionbutton-quiet-text-size,var(--spectrum-alias-font-size-default));font-weight:var(--spectrum-actionbutton-quiet-text-font-weight,var(--spectrum-alias-body-text-font-weight));background-color:var(--spectrum-actionbutton-quiet-background-color,var(--spectrum-alias-background-color-transparent));border-color:var(--spectrum-actionbutton-quiet-border-color,var(--spectrum-alias-border-color-transparent));color:var(--spectrum-actionbutton-quiet-text-color,var(--spectrum-alias-text-color))}#button:hover{background-color:var(--spectrum-actionbutton-background-color-hover,var(--spectrum-global-color-gray-50));border-color:var(--spectrum-actionbutton-border-color-hover,var(--spectrum-alias-border-color-hover));box-shadow:none;color:var(--spectrum-actionbutton-text-color-hover,var(--spectrum-alias-text-color-hover))}#button:hover ::slotted([slot=icon]){color:var(--spectrum-actionbutton-icon-color-hover,var(--spectrum-alias-icon-color-hover))}#button:hover #hold-affordance{color:var(--spectrum-actionbutton-hold-icon-color-hover,var(--spectrum-alias-icon-color-hover))}#button.focus-visible{background-color:var(--spectrum-actionbutton-background-color-key-focus,var(--spectrum-global-color-gray-50));border-color:var(--spectrum-actionbutton-border-color-key-focus,var(--spectrum-alias-border-color-focus));box-shadow:0 0 0 1px var(--spectrum-actionbutton-border-color-key-focus,var(--spectrum-alias-border-color-focus));color:var(--spectrum-actionbutton-text-color-key-focus,var(--spectrum-alias-text-color-hover))}#button.focus-visible ::slotted([slot=icon]){color:var(--spectrum-actionbutton-icon-color-key-focus,var(--spectrum-alias-icon-color-focus))}#button.focus-visible #hold-affordance{color:var(--spectrum-actionbutton-hold-icon-color-key-focus,var(--spectrum-alias-icon-color-hover))}#button:active{background-color:var(--spectrum-actionbutton-background-color-down,var(--spectrum-global-color-gray-200));border-color:var(--spectrum-actionbutton-border-color-down,var(--spectrum-global-color-gray-400));box-shadow:none;color:var(--spectrum-actionbutton-text-color-down,var(--spectrum-alias-text-color-down))}#button:active #hold-affordance{color:var(--spectrum-actionbutton-hold-icon-color-down,var(--spectrum-alias-icon-color-down))}:host([disabled]) #button ::slotted([slot=icon]){color:var(--spectrum-actionbutton-icon-color-disabled,var(--spectrum-alias-icon-color-disabled))}:host([disabled]) #button #hold-affordance{color:var(--spectrum-actionbutton-hold-icon-color-disabled,var(--spectrum-alias-icon-color-disabled))}:host([selected]) #button{background-color:var(--spectrum-actionbutton-background-color-selected,var(--spectrum-global-color-gray-200));border-color:var(--spectrum-actionbutton-border-color-selected,var(--spectrum-global-color-gray-300));color:var(--spectrum-actionbutton-text-color-selected,var(--spectrum-alias-text-color))}:host([selected]) #button ::slotted([slot=icon]){color:var(--spectrum-actionbutton-icon-color-selected,var(--spectrum-alias-icon-color))}:host([selected]) #button.focus-visible{background-color:var(--spectrum-actionbutton-background-color-selected-key-focus,var(--spectrum-global-color-gray-200));border-color:var(--spectrum-actionbutton-border-color-selected-key-focus,var(--spectrum-alias-border-color-focus));color:var(--spectrum-actionbutton-text-color-selected-key-focus,var(--spectrum-alias-text-color-hover))}:host([selected]) #button.focus-visible ::slotted([slot=icon]){color:var(--spectrum-actionbutton-icon-color-selected-key-focus,var(--spectrum-alias-icon-color-hover))}:host([selected]) #button:hover{background-color:var(--spectrum-actionbutton-background-color-selected-hover,var(--spectrum-global-color-gray-200));border-color:var(--spectrum-actionbutton-border-color-selected-hover,var(--spectrum-global-color-gray-400));color:var(--spectrum-actionbutton-text-color-selected-hover,var(--spectrum-alias-text-color-hover))}:host([selected]) #button:hover ::slotted([slot=icon]){color:var(--spectrum-actionbutton-icon-color-selected-hover,var(--spectrum-alias-icon-color-hover))}:host([selected]) #button:active{background-color:var(--spectrum-actionbutton-background-color-selected-down,var(--spectrum-global-color-gray-200));border-color:var(--spectrum-actionbutton-border-color-selected-down,var(--spectrum-global-color-gray-400));color:var(--spectrum-actionbutton-text-color-selected-down,var(--spectrum-alias-text-color-down))}:host([selected]) #button:active ::slotted([slot=icon]){color:var(--spectrum-actionbutton-icon-color-selected-down,var(--spectrum-alias-icon-color-down))}:host([selected][disabled]) #button{background-color:var(--spectrum-actionbutton-background-color-selected-disabled,var(--spectrum-global-color-gray-200));border-color:var(--spectrum-actionbutton-border-color-selected-disabled,var(--spectrum-global-color-gray-200));color:var(--spectrum-actionbutton-text-color-selected-disabled,var(--spectrum-alias-text-color-disabled))}:host([selected][disabled]) #button ::slotted([slot=icon]){color:var(--spectrum-actionbutton-icon-color-selected-disabled,var(--spectrum-alias-icon-color-disabled))}:host([quiet]) #button:hover{background-color:var(--spectrum-actionbutton-quiet-background-color-hover,var(--spectrum-alias-background-color-transparent));border-color:var(--spectrum-actionbutton-quiet-border-color-hover,var(--spectrum-alias-border-color-transparent));color:var(--spectrum-actionbutton-quiet-text-color-hover,var(--spectrum-alias-text-color-hover));box-shadow:none}:host([quiet]) #button.focus-visible{background-color:var(--spectrum-actionbutton-quiet-background-color-key-focus,var(--spectrum-alias-background-color-transparent));box-shadow:0 0 0 1px var(--spectrum-actionbutton-quiet-border-color-key-focus,var(--spectrum-alias-border-color-focus));border-color:var(--spectrum-actionbutton-quiet-border-color-key-focus,var(--spectrum-alias-border-color-focus));color:var(--spectrum-actionbutton-quiet-text-color-key-focus,var(--spectrum-alias-text-color-hover))}:host([quiet]) #button:active{background-color:var(--spectrum-actionbutton-quiet-background-color-down,var(--spectrum-global-color-gray-300));border-color:var(--spectrum-actionbutton-quiet-border-color-down,var(--spectrum-global-color-gray-300));color:var(--spectrum-actionbutton-quiet-text-color-down,var(--spectrum-alias-text-color-down));box-shadow:none}:host([quiet][disabled]) #button{background-color:var(--spectrum-actionbutton-quiet-background-color-disabled,var(--spectrum-alias-background-color-transparent));border-color:var(--spectrum-actionbutton-quiet-border-color-disabled,var(--spectrum-alias-border-color-transparent));color:var(--spectrum-actionbutton-quiet-text-color-disabled,var(--spectrum-alias-text-color-disabled))}:host([quiet][selected]) #button{background-color:var(--spectrum-actionbutton-quiet-background-color-selected,var(--spectrum-global-color-gray-300));border-color:var(--spectrum-actionbutton-quiet-border-color-selected,var(--spectrum-global-color-gray-300));color:var(--spectrum-actionbutton-quiet-text-color-selected,var(--spectrum-alias-text-color))}:host([quiet][selected]) #button.focus-visible{background-color:var(--spectrum-actionbutton-quiet-background-color-selected-key-focus,var(--spectrum-global-color-gray-300));border-color:var(--spectrum-actionbutton-quiet-border-color-selected-key-focus,var(--spectrum-alias-border-color-focus));color:var(--spectrum-actionbutton-quiet-text-color-selected-key-focus,var(--spectrum-alias-text-color-hover))}:host([quiet][selected]) #button:hover{background-color:var(--spectrum-actionbutton-quiet-background-color-selected-hover,var(--spectrum-global-color-gray-300));border-color:var(--spectrum-actionbutton-quiet-border-color-selected-hover,var(--spectrum-global-color-gray-300));color:var(--spectrum-actionbutton-quiet-text-color-selected-hover,var(--spectrum-alias-text-color-hover))}:host([quiet][selected]) #button:active{background-color:var(--spectrum-actionbutton-quiet-background-color-selected-down,var(--spectrum-global-color-gray-300));border-color:var(--spectrum-actionbutton-quiet-border-color-selected-down,var(--spectrum-global-color-gray-300));color:var(--spectrum-actionbutton-quiet-text-color-selected-down,var(--spectrum-alias-text-color-down))}:host([quiet][selected][disabled]) #button{background-color:var(--spectrum-actionbutton-quiet-background-color-selected-disabled,var(--spectrum-global-color-gray-200));border-color:var(--spectrum-actionbutton-quiet-border-color-selected-disabled,var(--spectrum-global-color-gray-200));color:var(--spectrum-actionbutton-quiet-text-color-selected-disabled,var(--spectrum-alias-text-color-disabled))}:host{display:inline-flex;flex-direction:row;vertical-align:top}#button{display:flex;flex:1 1 auto;-webkit-appearance:none}:host([disabled]){pointer-events:none}slot[name=icon]::slotted(svg){fill:currentColor;stroke:currentColor;width:var(--spectrum-alias-workflow-icon-size,18px);height:var(--spectrum-alias-workflow-icon-size,18px)}:host(.spectrum-Dropdown-trigger) #button{text-align:left}::slotted([slot=icon]){flex-shrink:0}`,IA=It`#button{display:inline-flex;box-sizing:border-box;align-items:center;justify-content:center;overflow:visible;border-style:solid;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-appearance:button;vertical-align:top;transition:background var(--spectrum-global-animation-duration-100,.13s) ease-out,border-color var(--spectrum-global-animation-duration-100,.13s) ease-out,color var(--spectrum-global-animation-duration-100,.13s) ease-out,box-shadow var(--spectrum-global-animation-duration-100,.13s) ease-out;text-decoration:none;font-family:adobe-clean-ux,adobe-clean,Source Sans Pro,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif;line-height:1.3;height:var(--spectrum-dropdown-height,var(--spectrum-global-dimension-size-400));font-family:inherit;font-weight:400;font-size:var(--spectrum-dropdown-text-size,var(--spectrum-alias-font-size-default));line-height:normal;-webkit-font-smoothing:initial;cursor:pointer;margin:0;padding:0 var(--spectrum-dropdown-padding-x,var(--spectrum-global-dimension-size-150));border-radius:var(--spectrum-global-dimension-size-50);transition:background-color var(--spectrum-global-animation-duration-100,.13s),box-shadow var(--spectrum-global-animation-duration-100,.13s),border-color var(--spectrum-global-animation-duration-100,.13s);color:var(--spectrum-fieldbutton-text-color,var(--spectrum-alias-text-color));background-color:var(--spectrum-fieldbutton-background-color,var(--spectrum-global-color-gray-75));border:var(--spectrum-dropdown-border-size,var(--spectrum-alias-border-size-thin)) solid var(--spectrum-fieldbutton-border-color,var(--spectrum-global-color-gray-300))}#button,#button:focus{outline:0}#button::-moz-focus-inner{border:0;border-style:none;padding:0;margin-top:-2px;margin-bottom:-2px}#button:disabled{cursor:default}.icon{max-height:100%;flex-shrink:0}#button.is-disabled,#button:disabled{border-width:0;cursor:default}#button.is-open{border-width:var(--spectrum-dropdown-border-size,var(--spectrum-alias-border-size-thin))}.spectrum-FieldButton--quiet{margin:0;padding:0;border-width:0;border-radius:var(--spectrum-fieldbutton-quiet-border-radius,0);color:var(--spectrum-fieldbutton-text-color,var(--spectrum-alias-text-color));border-color:var(--spectrum-fieldbutton-quiet-border-color,var(--spectrum-alias-border-color-transparent));background-color:var(--spectrum-fieldbutton-quiet-background-color,var(--spectrum-alias-background-color-transparent))}#button:hover{color:var(--spectrum-fieldbutton-text-color-hover,var(--spectrum-alias-text-color-hover));background-color:var(--spectrum-fieldbutton-background-color-hover,var(--spectrum-global-color-gray-50));border-color:var(--spectrum-fieldbutton-border-color-hover,var(--spectrum-global-color-gray-400))}#button.focus-visible,#button.is-focused{background-color:var(--spectrum-fieldbutton-background-color-key-focus,var(--spectrum-global-color-gray-50));border-color:var(--spectrum-fieldbutton-border-color-key-focus,var(--spectrum-alias-border-color-focus));box-shadow:0 0 0 1px var(--spectrum-fieldbutton-border-color-key-focus,var(--spectrum-alias-border-color-focus));color:var(--spectrum-fieldbutton-text-color-key-focus,var(--spectrum-alias-text-color-hover))}#button.focus-visible.is-placeholder,#button.is-focused.is-placeholder{color:var(--spectrum-fieldbutton-placeholder-text-color-key-focus,var(--spectrum-alias-placeholder-text-color-hover))}#button.is-selected,#button:active{background-color:var(--spectrum-fieldbutton-background-color-down,var(--spectrum-global-color-gray-200));border-color:var(--spectrum-fieldbutton-border-color-down,var(--spectrum-global-color-gray-400))}#button.is-selected.focus-visible,#button.is-selected.is-focused,#button:active.focus-visible,#button:active.is-focused{box-shadow:none}:host([invalid]) #button{border-color:var(--spectrum-fieldbutton-border-color-error,var(--spectrum-global-color-red-500))}:host([invalid]) #button:hover{border-color:var(--spectrum-fieldbutton-border-color-error-hover,var(--spectrum-global-color-red-600))}:host([invalid]) #button.is-selected,:host([invalid]) #button:active{border-color:var(--spectrum-fieldbutton-border-color-error-down,var(--spectrum-global-color-red-600))}:host([invalid]) #button.focus-visible,:host([invalid]) #button.is-focused{border-color:var(--spectrum-fieldbutton-border-color-error-key-focus,var(--spectrum-alias-border-color-focus));box-shadow:0 0 0 1px var(--spectrum-fieldbutton-border-color-error-key-focus,var(--spectrum-alias-border-color-focus))}#button.is-disabled,#button:disabled{background-color:var(--spectrum-fieldbutton-background-color-disabled,var(--spectrum-global-color-gray-200));color:var(--spectrum-fieldbutton-text-color-disabled,var(--spectrum-alias-text-color-disabled))}#button.is-disabled.focus-visible,#button:disabled.focus-visible{box-shadow:none}#button.is-disabled .icon,#button:disabled .icon{color:var(--spectrum-fieldbutton-icon-color-disabled,var(--spectrum-alias-icon-color-disabled))}.spectrum-FieldButton--quiet:hover{background-color:var(--spectrum-fieldbutton-quiet-background-color-hover,var(--spectrum-alias-background-color-transparent));color:var(--spectrum-fieldbutton-text-color-hover,var(--spectrum-alias-text-color-hover))}.spectrum-FieldButton--quiet.focus-visible,.spectrum-FieldButton--quiet.is-focused{background-color:var(--spectrum-fieldbutton-quiet-background-color-key-focus,var(--spectrum-alias-background-color-transparent));box-shadow:0 2px 0 0 var(--spectrum-fieldbutton-border-color-key-focus,var(--spectrum-alias-border-color-focus))}.spectrum-FieldButton--quiet.focus-visible.is-placeholder,.spectrum-FieldButton--quiet.is-focused.is-placeholder{color:var(--spectrum-fieldbutton-quiet-placeholder-text-color-key-focus,var(--spectrum-alias-placeholder-text-color-hover))}.spectrum-FieldButton--quiet.is-selected,.spectrum-FieldButton--quiet:active{background-color:var(--spectrum-fieldbutton-quiet-background-color-down,var(--spectrum-alias-background-color-transparent));border-color:var(--spectrum-fieldbutton-quiet-border-color-down,var(--spectrum-alias-border-color-transparent))}.spectrum-FieldButton--quiet.is-selected.focus-visible,.spectrum-FieldButton--quiet.is-selected.is-focused,.spectrum-FieldButton--quiet:active.focus-visible,.spectrum-FieldButton--quiet:active.is-focused{background-color:var(--spectrum-fieldbutton-quiet-background-color-key-focus,var(--spectrum-alias-background-color-transparent));box-shadow:0 2px 0 0 var(--spectrum-fieldbutton-border-color-key-focus,var(--spectrum-alias-border-color-focus))}:host([invalid]) .spectrum-FieldButton--quiet.focus-visible,:host([invalid]) .spectrum-FieldButton--quiet.is-focused{box-shadow:0 2px 0 0 var(--spectrum-fieldbutton-border-color-error-key-focus,var(--spectrum-alias-border-color-focus))}.spectrum-FieldButton--quiet.is-disabled,.spectrum-FieldButton--quiet:disabled{background-color:var(--spectrum-fieldbutton-quiet-background-color-disabled,var(--spectrum-alias-background-color-transparent));color:var(--spectrum-fieldbutton-text-color-disabled,var(--spectrum-alias-text-color-disabled))}.spectrum-FieldButton--quiet.is-disabled.focus-visible,.spectrum-FieldButton--quiet:disabled.focus-visible{box-shadow:none}`,AA=It`.chevron-down-medium{width:var(--spectrum-icon-chevron-down-medium-width);height:var(--spectrum-icon-chevron-down-medium-height,var(--spectrum-global-dimension-size-75))}`;class NA extends(Lt(_t)){constructor(){super(...arguments),this.iconRight=!1}get hasIcon(){return!!this.querySelector('[slot="icon"]')}get hasLabel(){return this.slotHasContent}get focusElement(){return this.shadowRoot?this.shadowRoot.querySelector("#button"):this}get buttonContent(){const t=M`<slot name="icon"></slot>`,e=[M`<div id="label" ?hidden="${!this.hasLabel}"><slot id="slot" @slotchange="${this.manageObservedSlot}"></slot></div>`];return this.hasIcon?(this.iconRight?e.push(t):e.unshift(t),e):e}render(){return this.href&&this.href.length>0?M`<a href="${this.href}" id="button" target="${Rt(this.target)}" aria-label="${Rt(this.label)}">${this.buttonContent}</a>`:M`<button id="button" aria-label="${Rt(this.label)}">${this.buttonContent}</button>`}}Y([xt()],NA.prototype,"href",void 0),Y([xt()],NA.prototype,"label",void 0),Y([xt()],NA.prototype,"target",void 0),Y([xt({type:Boolean,reflect:!0,attribute:"icon-right"})],NA.prototype,"iconRight",void 0);const RA=It`#button{display:inline-flex;box-sizing:border-box;align-items:center;justify-content:center;overflow:visible;margin:0;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-appearance:button;vertical-align:top;transition:background var(--spectrum-global-animation-duration-100,.13s) ease-out,border-color var(--spectrum-global-animation-duration-100,.13s) ease-out,color var(--spectrum-global-animation-duration-100,.13s) ease-out,box-shadow var(--spectrum-global-animation-duration-100,.13s) ease-out;text-decoration:none;font-family:adobe-clean-ux,adobe-clean,Source Sans Pro,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif;line-height:1.3;cursor:pointer;border-width:var(--spectrum-button-primary-border-size,var(--spectrum-alias-border-size-thick));border-style:solid;border-radius:var(--spectrum-button-primary-border-radius,var(--spectrum-alias-border-radius-large));min-height:var(--spectrum-button-primary-height,var(--spectrum-alias-single-line-height));height:auto;min-width:var(--spectrum-button-primary-min-width);padding:var(--spectrum-global-dimension-size-50) calc(var(--spectrum-button-primary-padding-x,var(--spectrum-global-dimension-size-200)) - var(--spectrum-button-primary-border-size,var(--spectrum-alias-border-size-thick)));padding-bottom:calc(var(--spectrum-global-dimension-size-50) + .5px);padding-top:calc(var(--spectrum-global-dimension-size-50) - .5px);font-size:var(--spectrum-button-primary-text-size,var(--spectrum-alias-pill-button-text-size));font-weight:var(--spectrum-button-primary-text-font-weight,var(--spectrum-global-font-weight-bold))}#button:focus{outline:0}#button::-moz-focus-inner{border:0;border-style:none;padding:0;margin-top:-2px;margin-bottom:-2px}:host([disabled]) #button{cursor:default}::slotted([slot=icon]){max-height:100%;flex-shrink:0}#button:active,#button:hover{box-shadow:none}slot[name=icon]+#label{margin-left:var(--spectrum-button-primary-text-gap,var(--spectrum-global-dimension-size-100))}#label+::slotted([slot=icon]){margin-left:calc(var(--spectrum-button-primary-text-gap,
var(--spectrum-global-dimension-size-100))/2)}#label{align-self:center;justify-self:center;text-align:center;width:100%}#label:empty{display:none}#button.focus-visible{box-shadow:0 0 0 1px var(--spectrum-button-primary-border-color-key-focus,var(--spectrum-semantic-cta-color-background-key-focus))}#button:active{box-shadow:none}:host([variant=cta]) #button{background-color:var(--spectrum-button-cta-background-color,var(--spectrum-semantic-cta-color-background-default));border-color:var(--spectrum-button-cta-border-color,var(--spectrum-semantic-cta-color-background-default));color:var(--spectrum-button-cta-text-color,var(--spectrum-global-color-static-white))}:host([variant=cta]) #button:hover{background-color:var(--spectrum-button-cta-background-color-hover,var(--spectrum-semantic-cta-color-background-hover));border-color:var(--spectrum-button-cta-border-color-hover,var(--spectrum-semantic-cta-color-background-hover));color:var(--spectrum-button-cta-text-color-hover,var(--spectrum-global-color-static-white))}:host([variant=cta]) #button.focus-visible{background-color:var(--spectrum-button-cta-background-color-key-focus,var(--spectrum-semantic-cta-color-background-key-focus));border-color:var(--spectrum-button-cta-border-color-key-focus,var(--spectrum-semantic-cta-color-background-key-focus));color:var(--spectrum-button-cta-text-color-key-focus,var(--spectrum-global-color-static-white))}:host([variant=cta]) #button:active{background-color:var(--spectrum-button-cta-background-color-down,var(--spectrum-semantic-cta-color-background-down));border-color:var(--spectrum-button-cta-border-color-down,var(--spectrum-semantic-cta-color-background-down));color:var(--spectrum-button-cta-text-color-down,var(--spectrum-global-color-static-white))}:host([variant=cta][disabled]) #button{background-color:var(--spectrum-button-cta-background-color-disabled,var(--spectrum-global-color-gray-200));border-color:var(--spectrum-button-cta-border-color-disabled,var(--spectrum-global-color-gray-200));color:var(--spectrum-button-cta-text-color-disabled,var(--spectrum-global-color-gray-500))}:host([variant=primary]) #button{background-color:var(--spectrum-button-primary-background-color,var(--spectrum-alias-background-color-transparent));border-color:var(--spectrum-button-primary-border-color,var(--spectrum-global-color-gray-800));color:var(--spectrum-button-primary-text-color,var(--spectrum-global-color-gray-800))}:host([variant=primary]) #button:hover{background-color:var(--spectrum-button-primary-background-color-hover,var(--spectrum-global-color-gray-800));border-color:var(--spectrum-button-primary-border-color-hover,var(--spectrum-global-color-gray-800));color:var(--spectrum-button-primary-text-color-hover,var(--spectrum-global-color-gray-50))}:host([variant=primary]) #button.focus-visible{background-color:var(--spectrum-button-primary-background-color-key-focus,var(--spectrum-semantic-cta-color-background-key-focus));border-color:var(--spectrum-button-primary-border-color-key-focus,var(--spectrum-semantic-cta-color-background-key-focus));color:var(--spectrum-button-primary-text-color-key-focus,var(--spectrum-global-color-static-white))}:host([variant=primary]) #button:active{background-color:var(--spectrum-button-primary-background-color-down,var(--spectrum-global-color-gray-900));border-color:var(--spectrum-button-primary-border-color-down,var(--spectrum-global-color-gray-900));color:var(--spectrum-button-primary-text-color-down,var(--spectrum-global-color-gray-50))}:host([variant=primary][disabled]) #button{background-color:var(--spectrum-button-primary-background-color-disabled,var(--spectrum-global-color-gray-200));border-color:var(--spectrum-button-primary-border-color-disabled,var(--spectrum-global-color-gray-200));color:var(--spectrum-button-primary-text-color-disabled,var(--spectrum-global-color-gray-500))}:host([variant=secondary]) #button{background-color:var(--spectrum-button-secondary-background-color,var(--spectrum-alias-background-color-transparent));border-color:var(--spectrum-button-secondary-border-color,var(--spectrum-global-color-gray-700));color:var(--spectrum-button-secondary-text-color,var(--spectrum-global-color-gray-700))}:host([variant=secondary]) #button:hover{background-color:var(--spectrum-button-secondary-background-color-hover,var(--spectrum-global-color-gray-700));border-color:var(--spectrum-button-secondary-border-color-hover,var(--spectrum-global-color-gray-700));color:var(--spectrum-button-secondary-text-color-hover,var(--spectrum-global-color-gray-50))}:host([variant=secondary]) #button.focus-visible{background-color:var(--spectrum-button-secondary-background-color-key-focus,var(--spectrum-semantic-cta-color-background-key-focus));border-color:var(--spectrum-button-secondary-border-color-key-focus,var(--spectrum-semantic-cta-color-background-key-focus));color:var(--spectrum-button-secondary-text-color-key-focus,var(--spectrum-global-color-static-white))}:host([variant=secondary]) #button:active{background-color:var(--spectrum-button-secondary-background-color-down,var(--spectrum-global-color-gray-800));border-color:var(--spectrum-button-secondary-border-color-down,var(--spectrum-global-color-gray-800));color:var(--spectrum-button-secondary-text-color-down,var(--spectrum-global-color-gray-50))}:host([variant=secondary][disabled]) #button{background-color:var(--spectrum-button-secondary-background-color-disabled,var(--spectrum-global-color-gray-200));border-color:var(--spectrum-button-secondary-border-color-disabled,var(--spectrum-global-color-gray-200));color:var(--spectrum-button-secondary-text-color-disabled,var(--spectrum-global-color-gray-500))}:host([variant=negative]) #button{background-color:var(--spectrum-button-warning-background-color,var(--spectrum-alias-background-color-transparent));border-color:var(--spectrum-button-warning-border-color,var(--spectrum-semantic-negative-color-text-small));color:var(--spectrum-button-warning-text-color,var(--spectrum-semantic-negative-color-text-small))}:host([variant=negative]) #button:hover{background-color:var(--spectrum-button-warning-background-color-hover,var(--spectrum-semantic-negative-color-text-small));border-color:var(--spectrum-button-warning-border-color-hover,var(--spectrum-semantic-negative-color-text-small));color:var(--spectrum-button-warning-text-color-hover,var(--spectrum-global-color-gray-50))}:host([variant=negative]) #button.focus-visible{background-color:var(--spectrum-button-warning-background-color-key-focus,var(--spectrum-semantic-cta-color-background-key-focus));border-color:var(--spectrum-button-warning-border-color-key-focus,var(--spectrum-semantic-cta-color-background-key-focus));color:var(--spectrum-button-warning-text-color-key-focus,var(--spectrum-global-color-static-white))}:host([variant=negative]) #button:active{background-color:var(--spectrum-button-warning-background-color-down,var(--spectrum-global-color-red-700));border-color:var(--spectrum-button-warning-border-color-down,var(--spectrum-global-color-red-700));color:var(--spectrum-button-warning-text-color-down,var(--spectrum-global-color-gray-50))}:host([variant=negative][disabled]) #button{background-color:var(--spectrum-button-warning-background-color-disabled,var(--spectrum-global-color-gray-200));border-color:var(--spectrum-button-warning-border-color-disabled,var(--spectrum-global-color-gray-200));color:var(--spectrum-button-warning-text-color-disabled,var(--spectrum-global-color-gray-500))}:host([variant=overBackground]) #button{background-color:var(--spectrum-button-over-background-background-color,var(--spectrum-alias-background-color-transparent));border-color:var(--spectrum-button-over-background-border-color,var(--spectrum-global-color-static-white));color:var(--spectrum-button-over-background-text-color,var(--spectrum-global-color-static-white))}:host([variant=overBackground]) #button:hover{background-color:var(--spectrum-button-over-background-background-color-hover,var(--spectrum-global-color-static-white));border-color:var(--spectrum-button-over-background-border-color-hover,var(--spectrum-global-color-static-white));color:inherit}:host([variant=overBackground]) #button.focus-visible{background-color:var(--spectrum-button-over-background-background-color-key-focus,var(--spectrum-global-color-static-white));border-color:var(--spectrum-button-over-background-border-color-key-focus,var(--spectrum-global-color-static-white));color:inherit;box-shadow:0 0 0 1px var(--spectrum-button-over-background-border-color-key-focus,var(--spectrum-global-color-static-white))}:host([variant=overBackground]) #button:active{background-color:var(--spectrum-button-over-background-background-color-down,var(--spectrum-global-color-static-white));border-color:var(--spectrum-button-over-background-border-color-down,var(--spectrum-global-color-static-white));color:inherit;box-shadow:none}:host([variant=overBackground][disabled]) #button{background-color:var(--spectrum-button-over-background-background-color-disabled,hsla(0,0%,100%,.1));border-color:var(--spectrum-button-over-background-border-color-disabled,var(--spectrum-alias-border-color-transparent));color:var(--spectrum-button-over-background-text-color-disabled,hsla(0,0%,100%,.35))}:host([variant=overBackground][quiet]) #button{background-color:var(--spectrum-button-quiet-over-background-background-color,var(--spectrum-alias-background-color-transparent));border-color:var(--spectrum-button-quiet-over-background-border-color,var(--spectrum-alias-border-color-transparent));color:var(--spectrum-button-quiet-over-background-text-color,var(--spectrum-global-color-static-white))}:host([variant=overBackground][quiet]) #button:hover{background-color:var(--spectrum-button-quiet-over-background-background-color-hover,hsla(0,0%,100%,.1));border-color:var(--spectrum-button-quiet-over-background-border-color-hover,var(--spectrum-alias-border-color-transparent));color:var(--spectrum-button-quiet-over-background-text-color-hover,var(--spectrum-global-color-static-white))}:host([variant=overBackground][quiet]) #button.focus-visible{background-color:var(--spectrum-button-quiet-over-background-background-color-key-focus,var(--spectrum-global-color-static-white));border-color:var(--spectrum-button-quiet-over-background-border-color-key-focus,var(--spectrum-global-color-static-white));color:inherit;box-shadow:0 0 0 1px var(--spectrum-button-quiet-over-background-border-color-key-focus,var(--spectrum-global-color-static-white))}:host([variant=overBackground][quiet]) #button:active{background-color:var(--spectrum-button-quiet-over-background-background-color-down,hsla(0,0%,100%,.15));border-color:var(--spectrum-button-quiet-over-background-border-color-down,var(--spectrum-alias-border-color-transparent));color:var(--spectrum-button-quiet-over-background-text-color-down,var(--spectrum-global-color-static-white));box-shadow:none}:host([variant=overBackground][quiet][disabled]) #button{background-color:var(--spectrum-button-quiet-over-background-background-color-disabled,var(--spectrum-alias-background-color-transparent));border-color:var(--spectrum-button-quiet-over-background-border-color-disabled,var(--spectrum-alias-border-color-transparent));color:var(--spectrum-button-quiet-over-background-text-color-disabled,hsla(0,0%,100%,.15))}:host([variant=primary][quiet]) #button{background-color:var(--spectrum-button-quiet-primary-background-color,var(--spectrum-alias-background-color-transparent));border-color:var(--spectrum-button-quiet-primary-border-color,var(--spectrum-alias-border-color-transparent));color:var(--spectrum-button-quiet-primary-text-color,var(--spectrum-global-color-gray-800))}:host([variant=primary][quiet]) #button:hover{background-color:var(--spectrum-button-quiet-primary-background-color-hover,var(--spectrum-global-color-gray-200));border-color:var(--spectrum-button-quiet-primary-border-color-hover,var(--spectrum-global-color-gray-200));color:var(--spectrum-button-quiet-primary-text-color-hover,var(--spectrum-global-color-gray-900))}:host([variant=primary][quiet]) #button.focus-visible{background-color:var(--spectrum-button-quiet-primary-background-color-key-focus,var(--spectrum-semantic-cta-color-background-key-focus));border-color:var(--spectrum-button-quiet-primary-border-color-key-focus,var(--spectrum-semantic-cta-color-background-key-focus));color:var(--spectrum-button-quiet-primary-text-color-key-focus,var(--spectrum-global-color-static-white))}:host([variant=primary][quiet]) #button:active{background-color:var(--spectrum-button-quiet-primary-background-color-down,var(--spectrum-global-color-gray-300));border-color:var(--spectrum-button-quiet-primary-border-color-down,var(--spectrum-global-color-gray-300));color:var(--spectrum-button-quiet-primary-text-color-down,var(--spectrum-global-color-gray-900))}:host([variant=primary][quiet][disabled]) #button{background-color:var(--spectrum-button-quiet-primary-background-color-disabled,var(--spectrum-alias-background-color-transparent));border-color:var(--spectrum-button-quiet-primary-border-color-disabled,var(--spectrum-alias-border-color-transparent));color:var(--spectrum-button-quiet-primary-text-color-disabled,var(--spectrum-global-color-gray-500))}:host([variant=secondary][quiet]) #button{background-color:var(--spectrum-button-quiet-secondary-background-color,var(--spectrum-alias-background-color-transparent));border-color:var(--spectrum-button-quiet-secondary-border-color,var(--spectrum-alias-border-color-transparent));color:var(--spectrum-button-quiet-secondary-text-color,var(--spectrum-global-color-gray-700))}:host([variant=secondary][quiet]) #button:hover{background-color:var(--spectrum-button-quiet-secondary-background-color-hover,var(--spectrum-global-color-gray-200));border-color:var(--spectrum-button-quiet-secondary-border-color-hover,var(--spectrum-global-color-gray-200));color:var(--spectrum-button-quiet-secondary-text-color-hover,var(--spectrum-global-color-gray-800))}:host([variant=secondary][quiet]) #button.focus-visible{background-color:var(--spectrum-button-quiet-secondary-background-color-key-focus,var(--spectrum-semantic-cta-color-background-key-focus));border-color:var(--spectrum-button-quiet-secondary-border-color-key-focus,var(--spectrum-semantic-cta-color-background-key-focus));color:var(--spectrum-button-quiet-secondary-text-color-key-focus,var(--spectrum-global-color-static-white))}:host([variant=secondary][quiet]) #button:active{background-color:var(--spectrum-button-quiet-secondary-background-color-down,var(--spectrum-global-color-gray-300));border-color:var(--spectrum-button-quiet-secondary-border-color-down,var(--spectrum-global-color-gray-300));color:var(--spectrum-button-quiet-secondary-text-color-down,var(--spectrum-global-color-gray-800))}:host([variant=secondary][quiet][disabled]) #button{background-color:var(--spectrum-button-quiet-secondary-background-color-disabled,var(--spectrum-alias-background-color-transparent));border-color:var(--spectrum-button-quiet-secondary-border-color-disabled,var(--spectrum-alias-border-color-transparent));color:var(--spectrum-button-quiet-secondary-text-color-disabled,var(--spectrum-global-color-gray-500))}:host([variant=negative][quiet]) #button{background-color:var(--spectrum-button-quiet-warning-background-color,var(--spectrum-alias-background-color-transparent));border-color:var(--spectrum-button-quiet-warning-border-color,var(--spectrum-alias-border-color-transparent));color:var(--spectrum-button-quiet-warning-text-color,var(--spectrum-semantic-negative-color-text-small))}:host([variant=negative][quiet]) #button:hover{background-color:var(--spectrum-button-quiet-warning-background-color-hover,var(--spectrum-global-color-gray-200));border-color:var(--spectrum-button-quiet-warning-border-color-hover,var(--spectrum-global-color-gray-200));color:var(--spectrum-button-quiet-warning-text-color-hover,var(--spectrum-global-color-red-700))}:host([variant=negative][quiet]) #button.focus-visible{background-color:var(--spectrum-button-quiet-warning-background-color-key-focus,var(--spectrum-semantic-cta-color-background-key-focus));border-color:var(--spectrum-button-quiet-warning-border-color-key-focus,var(--spectrum-semantic-cta-color-background-key-focus));color:var(--spectrum-button-quiet-warning-text-color-key-focus,var(--spectrum-global-color-static-white))}:host([variant=negative][quiet]) #button:active{background-color:var(--spectrum-button-quiet-warning-background-color-down,var(--spectrum-global-color-gray-300));border-color:var(--spectrum-button-quiet-warning-border-color-down,var(--spectrum-global-color-gray-300));color:var(--spectrum-button-quiet-warning-text-color-down,var(--spectrum-global-color-red-700))}:host([variant=negative][quiet][disabled]) #button{background-color:var(--spectrum-button-quiet-warning-background-color-disabled,var(--spectrum-alias-background-color-transparent));border-color:var(--spectrum-button-quiet-warning-border-color-disabled,var(--spectrum-alias-border-color-transparent));color:var(--spectrum-button-quiet-warning-text-color-disabled,var(--spectrum-global-color-gray-500))}:host{display:inline-flex;flex-direction:row;vertical-align:top}#button{display:flex;flex:1 1 auto;-webkit-appearance:none}:host([disabled]){pointer-events:none}slot[name=icon]::slotted(svg){fill:currentColor;stroke:currentColor;width:var(--spectrum-alias-workflow-icon-size,18px);height:var(--spectrum-alias-workflow-icon-size,18px)}`;class TA extends NA{constructor(){super(...arguments),this.variant="cta",this.warning=!1,this.quiet=!1}static get styles(){return[RA]}}Y([xt({reflect:!0})],TA.prototype,"variant",void 0),Y([xt({type:Boolean,reflect:!0})],TA.prototype,"warning",void 0),Y([xt({type:Boolean,reflect:!0})],TA.prototype,"quiet",void 0);const DA=It`#button{display:inline-flex;box-sizing:border-box;align-items:center;justify-content:center;overflow:visible;margin:0;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-appearance:button;vertical-align:top;transition:background var(--spectrum-global-animation-duration-100,.13s) ease-out,border-color var(--spectrum-global-animation-duration-100,.13s) ease-out,color var(--spectrum-global-animation-duration-100,.13s) ease-out,box-shadow var(--spectrum-global-animation-duration-100,.13s) ease-out;text-decoration:none;font-family:adobe-clean-ux,adobe-clean,Source Sans Pro,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif;line-height:1.3;cursor:pointer;position:relative;height:var(--spectrum-actionbutton-height,var(--spectrum-alias-single-line-height));min-width:var(--spectrum-actionbutton-min-width,var(--spectrum-global-dimension-size-400));padding:0 calc(var(--spectrum-actionbutton-icon-padding-x,var(--spectrum-global-dimension-size-85)) - var(--spectrum-actionbutton-border-size,var(--spectrum-alias-border-size-thin)));border-radius:var(--spectrum-actionbutton-border-radius,var(--spectrum-alias-border-radius-regular));font-size:var(--spectrum-actionbutton-text-size,var(--spectrum-alias-font-size-default));font-weight:var(--spectrum-actionbutton-text-font-weight,var(--spectrum-alias-body-text-font-weight));background-color:var(--spectrum-actionbutton-background-color,var(--spectrum-global-color-gray-75));border:var(--spectrum-actionbutton-border-size,var(--spectrum-alias-border-size-thin)) solid var(--spectrum-actionbutton-border-color,var(--spectrum-alias-border-color));color:var(--spectrum-actionbutton-text-color,var(--spectrum-alias-text-color))}#button:focus{outline:0}#button::-moz-focus-inner{border:0;border-style:none;padding:0;margin-top:-2px;margin-bottom:-2px}:host([disabled]) #button{cursor:default;background-color:var(--spectrum-actionbutton-background-color-disabled,var(--spectrum-global-color-gray-200));border-color:var(--spectrum-actionbutton-border-color-disabled,var(--spectrum-global-color-gray-200));color:var(--spectrum-actionbutton-text-color-disabled,var(--spectrum-alias-text-color-disabled))}::slotted([slot=icon]){max-height:100%;color:var(--spectrum-actionbutton-icon-color,var(--spectrum-alias-icon-color))}slot[name=icon]+#label{padding-left:var(--spectrum-actionbutton-icon-padding-x,var(--spectrum-global-dimension-size-85));padding-right:calc(var(--spectrum-actionbutton-text-padding-x,var(--spectrum-global-dimension-size-150)) - var(--spectrum-actionbutton-icon-padding-x,var(--spectrum-global-dimension-size-85)))}.spectrum-Icon--sizeS:only-child{position:absolute;top:calc(50% - var(--spectrum-actionbutton-icon-size,var(--spectrum-alias-workflow-icon-size))/ 2);left:calc(50% - var(--spectrum-actionbutton-icon-size,var(--spectrum-alias-workflow-icon-size))/ 2)}#label:only-child{padding:0 calc(var(--spectrum-actionbutton-text-padding-x,var(--spectrum-global-dimension-size-150)) - var(--spectrum-actionbutton-icon-padding-x,var(--spectrum-global-dimension-size-85)))}#hold-affordance{position:absolute;right:var(--spectrum-actionbutton-hold-icon-padding-right,var(--spectrum-global-dimension-size-40));bottom:var(--spectrum-actionbutton-hold-icon-padding-bottom,var(--spectrum-global-dimension-size-40));color:var(--spectrum-actionbutton-hold-icon-color,var(--spectrum-alias-icon-color))}#label{align-self:center;justify-self:center;text-align:center;width:100%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}#label:empty{display:none}:host([quiet]) #button{border-width:var(--spectrum-actionbutton-quiet-border-size,var(--spectrum-alias-border-size-thin));border-radius:var(--spectrum-actionbutton-quiet-border-radius,var(--spectrum-alias-border-radius-regular));font-size:var(--spectrum-actionbutton-quiet-text-size,var(--spectrum-alias-font-size-default));font-weight:var(--spectrum-actionbutton-quiet-text-font-weight,var(--spectrum-alias-body-text-font-weight));background-color:var(--spectrum-actionbutton-quiet-background-color,var(--spectrum-alias-background-color-transparent));border-color:var(--spectrum-actionbutton-quiet-border-color,var(--spectrum-alias-border-color-transparent));color:var(--spectrum-actionbutton-quiet-text-color,var(--spectrum-alias-text-color))}#button:hover{background-color:var(--spectrum-actionbutton-background-color-hover,var(--spectrum-global-color-gray-50));border-color:var(--spectrum-actionbutton-border-color-hover,var(--spectrum-alias-border-color-hover));box-shadow:none;color:var(--spectrum-actionbutton-text-color-hover,var(--spectrum-alias-text-color-hover))}#button:hover ::slotted([slot=icon]){color:var(--spectrum-actionbutton-icon-color-hover,var(--spectrum-alias-icon-color-hover))}#button:hover #hold-affordance{color:var(--spectrum-actionbutton-hold-icon-color-hover,var(--spectrum-alias-icon-color-hover))}#button.focus-visible{background-color:var(--spectrum-actionbutton-background-color-key-focus,var(--spectrum-global-color-gray-50));border-color:var(--spectrum-actionbutton-border-color-key-focus,var(--spectrum-alias-border-color-focus));box-shadow:0 0 0 1px var(--spectrum-actionbutton-border-color-key-focus,var(--spectrum-alias-border-color-focus));color:var(--spectrum-actionbutton-text-color-key-focus,var(--spectrum-alias-text-color-hover))}#button.focus-visible ::slotted([slot=icon]){color:var(--spectrum-actionbutton-icon-color-key-focus,var(--spectrum-alias-icon-color-focus))}#button.focus-visible #hold-affordance{color:var(--spectrum-actionbutton-hold-icon-color-key-focus,var(--spectrum-alias-icon-color-hover))}#button:active{background-color:var(--spectrum-actionbutton-background-color-down,var(--spectrum-global-color-gray-200));border-color:var(--spectrum-actionbutton-border-color-down,var(--spectrum-global-color-gray-400));box-shadow:none;color:var(--spectrum-actionbutton-text-color-down,var(--spectrum-alias-text-color-down))}#button:active #hold-affordance{color:var(--spectrum-actionbutton-hold-icon-color-down,var(--spectrum-alias-icon-color-down))}:host([disabled]) #button ::slotted([slot=icon]){color:var(--spectrum-actionbutton-icon-color-disabled,var(--spectrum-alias-icon-color-disabled))}:host([disabled]) #button #hold-affordance{color:var(--spectrum-actionbutton-hold-icon-color-disabled,var(--spectrum-alias-icon-color-disabled))}:host([selected]) #button{background-color:var(--spectrum-actionbutton-background-color-selected,var(--spectrum-global-color-gray-200));border-color:var(--spectrum-actionbutton-border-color-selected,var(--spectrum-global-color-gray-300));color:var(--spectrum-actionbutton-text-color-selected,var(--spectrum-alias-text-color))}:host([selected]) #button ::slotted([slot=icon]){color:var(--spectrum-actionbutton-icon-color-selected,var(--spectrum-alias-icon-color))}:host([selected]) #button.focus-visible{background-color:var(--spectrum-actionbutton-background-color-selected-key-focus,var(--spectrum-global-color-gray-200));border-color:var(--spectrum-actionbutton-border-color-selected-key-focus,var(--spectrum-alias-border-color-focus));color:var(--spectrum-actionbutton-text-color-selected-key-focus,var(--spectrum-alias-text-color-hover))}:host([selected]) #button.focus-visible ::slotted([slot=icon]){color:var(--spectrum-actionbutton-icon-color-selected-key-focus,var(--spectrum-alias-icon-color-hover))}:host([selected]) #button:hover{background-color:var(--spectrum-actionbutton-background-color-selected-hover,var(--spectrum-global-color-gray-200));border-color:var(--spectrum-actionbutton-border-color-selected-hover,var(--spectrum-global-color-gray-400));color:var(--spectrum-actionbutton-text-color-selected-hover,var(--spectrum-alias-text-color-hover))}:host([selected]) #button:hover ::slotted([slot=icon]){color:var(--spectrum-actionbutton-icon-color-selected-hover,var(--spectrum-alias-icon-color-hover))}:host([selected]) #button:active{background-color:var(--spectrum-actionbutton-background-color-selected-down,var(--spectrum-global-color-gray-200));border-color:var(--spectrum-actionbutton-border-color-selected-down,var(--spectrum-global-color-gray-400));color:var(--spectrum-actionbutton-text-color-selected-down,var(--spectrum-alias-text-color-down))}:host([selected]) #button:active ::slotted([slot=icon]){color:var(--spectrum-actionbutton-icon-color-selected-down,var(--spectrum-alias-icon-color-down))}:host([selected][disabled]) #button{background-color:var(--spectrum-actionbutton-background-color-selected-disabled,var(--spectrum-global-color-gray-200));border-color:var(--spectrum-actionbutton-border-color-selected-disabled,var(--spectrum-global-color-gray-200));color:var(--spectrum-actionbutton-text-color-selected-disabled,var(--spectrum-alias-text-color-disabled))}:host([selected][disabled]) #button ::slotted([slot=icon]){color:var(--spectrum-actionbutton-icon-color-selected-disabled,var(--spectrum-alias-icon-color-disabled))}:host([quiet]) #button:hover{background-color:var(--spectrum-actionbutton-quiet-background-color-hover,var(--spectrum-alias-background-color-transparent));border-color:var(--spectrum-actionbutton-quiet-border-color-hover,var(--spectrum-alias-border-color-transparent));color:var(--spectrum-actionbutton-quiet-text-color-hover,var(--spectrum-alias-text-color-hover));box-shadow:none}:host([quiet]) #button.focus-visible{background-color:var(--spectrum-actionbutton-quiet-background-color-key-focus,var(--spectrum-alias-background-color-transparent));box-shadow:0 0 0 1px var(--spectrum-actionbutton-quiet-border-color-key-focus,var(--spectrum-alias-border-color-focus));border-color:var(--spectrum-actionbutton-quiet-border-color-key-focus,var(--spectrum-alias-border-color-focus));color:var(--spectrum-actionbutton-quiet-text-color-key-focus,var(--spectrum-alias-text-color-hover))}:host([quiet]) #button:active{background-color:var(--spectrum-actionbutton-quiet-background-color-down,var(--spectrum-global-color-gray-300));border-color:var(--spectrum-actionbutton-quiet-border-color-down,var(--spectrum-global-color-gray-300));color:var(--spectrum-actionbutton-quiet-text-color-down,var(--spectrum-alias-text-color-down));box-shadow:none}:host([quiet][disabled]) #button{background-color:var(--spectrum-actionbutton-quiet-background-color-disabled,var(--spectrum-alias-background-color-transparent));border-color:var(--spectrum-actionbutton-quiet-border-color-disabled,var(--spectrum-alias-border-color-transparent));color:var(--spectrum-actionbutton-quiet-text-color-disabled,var(--spectrum-alias-text-color-disabled))}:host([quiet][selected]) #button{background-color:var(--spectrum-actionbutton-quiet-background-color-selected,var(--spectrum-global-color-gray-300));border-color:var(--spectrum-actionbutton-quiet-border-color-selected,var(--spectrum-global-color-gray-300));color:var(--spectrum-actionbutton-quiet-text-color-selected,var(--spectrum-alias-text-color))}:host([quiet][selected]) #button.focus-visible{background-color:var(--spectrum-actionbutton-quiet-background-color-selected-key-focus,var(--spectrum-global-color-gray-300));border-color:var(--spectrum-actionbutton-quiet-border-color-selected-key-focus,var(--spectrum-alias-border-color-focus));color:var(--spectrum-actionbutton-quiet-text-color-selected-key-focus,var(--spectrum-alias-text-color-hover))}:host([quiet][selected]) #button:hover{background-color:var(--spectrum-actionbutton-quiet-background-color-selected-hover,var(--spectrum-global-color-gray-300));border-color:var(--spectrum-actionbutton-quiet-border-color-selected-hover,var(--spectrum-global-color-gray-300));color:var(--spectrum-actionbutton-quiet-text-color-selected-hover,var(--spectrum-alias-text-color-hover))}:host([quiet][selected]) #button:active{background-color:var(--spectrum-actionbutton-quiet-background-color-selected-down,var(--spectrum-global-color-gray-300));border-color:var(--spectrum-actionbutton-quiet-border-color-selected-down,var(--spectrum-global-color-gray-300));color:var(--spectrum-actionbutton-quiet-text-color-selected-down,var(--spectrum-alias-text-color-down))}:host([quiet][selected][disabled]) #button{background-color:var(--spectrum-actionbutton-quiet-background-color-selected-disabled,var(--spectrum-global-color-gray-200));border-color:var(--spectrum-actionbutton-quiet-border-color-selected-disabled,var(--spectrum-global-color-gray-200));color:var(--spectrum-actionbutton-quiet-text-color-selected-disabled,var(--spectrum-alias-text-color-disabled))}:host{display:inline-flex;flex-direction:row;vertical-align:top}#button{display:flex;flex:1 1 auto;-webkit-appearance:none}:host([disabled]){pointer-events:none}slot[name=icon]::slotted(svg){fill:currentColor;stroke:currentColor;width:var(--spectrum-alias-workflow-icon-size,18px);height:var(--spectrum-alias-workflow-icon-size,18px)}:host(.spectrum-Dropdown-trigger) #button{text-align:left}::slotted([slot=icon]){flex-shrink:0}`;class _A extends NA{constructor(){super(...arguments),this.quiet=!1,this.selected=!1,this.holdAffordance=!1}static get styles(){return[DA]}}Y([xt({type:Boolean,reflect:!0})],_A.prototype,"quiet",void 0),Y([xt({type:Boolean,reflect:!0})],_A.prototype,"selected",void 0),Y([xt({type:Boolean,reflect:!0,attribute:"hold-affordance"})],_A.prototype,"holdAffordance",void 0);const OA=It`#button{display:inline-flex;box-sizing:border-box;align-items:center;justify-content:center;overflow:visible;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-appearance:button;vertical-align:top;transition:background var(--spectrum-global-animation-duration-100,.13s) ease-out,border-color var(--spectrum-global-animation-duration-100,.13s) ease-out,color var(--spectrum-global-animation-duration-100,.13s) ease-out,box-shadow var(--spectrum-global-animation-duration-100,.13s) ease-out;text-decoration:none;font-family:adobe-clean-ux,adobe-clean,Source Sans Pro,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif;line-height:1.3;cursor:pointer;width:var(--spectrum-clearbutton-medium-width,var(--spectrum-alias-single-line-height));height:var(--spectrum-clearbutton-medium-height,var(--spectrum-alias-single-line-height));border-radius:100%;padding:0;margin:0;border:none;background-color:var(--spectrum-clearbutton-medium-background-color,var(--spectrum-alias-background-color-transparent));color:var(--spectrum-clearbutton-medium-icon-color,var(--spectrum-alias-icon-color))}#button:focus{outline:0}#button::-moz-focus-inner{border:0;border-style:none;padding:0;margin-top:-2px;margin-bottom:-2px}#button:disabled{cursor:default}.spectrum-Icon{max-height:100%;flex-shrink:0}.spectrum-ClearButton--small{width:var(--spectrum-clearbutton-small-width,var(--spectrum-global-dimension-size-300));height:var(--spectrum-clearbutton-small-height,var(--spectrum-global-dimension-size-300))}#button:hover{background-color:var(--spectrum-clearbutton-medium-background-color-hover,var(--spectrum-alias-background-color-transparent));color:var(--spectrum-clearbutton-medium-icon-color-hover,var(--spectrum-alias-icon-color-hover))}#button:active{background-color:var(--spectrum-clearbutton-medium-background-color-down,var(--spectrum-alias-background-color-transparent));color:var(--spectrum-clearbutton-medium-icon-color-down,var(--spectrum-alias-icon-color-down))}#button.focus-visible{background-color:var(--spectrum-clearbutton-medium-background-color-key-focus,var(--spectrum-alias-background-color-transparent));color:var(--spectrum-clearbutton-medium-icon-color-key-focus,var(--spectrum-alias-icon-color-focus))}#button.is-disabled,#button:disabled{background-color:var(--spectrum-clearbutton-medium-background-color-disabled,var(--spectrum-alias-background-color-transparent));color:var(--spectrum-clearbutton-medium-icon-color-disabled,var(--spectrum-alias-icon-color-disabled))}:host([variant=overBackground]) #button{background-color:var(--spectrum-button-quiet-over-background-background-color,var(--spectrum-alias-background-color-transparent));border-color:var(--spectrum-button-quiet-over-background-border-color,var(--spectrum-alias-border-color-transparent));color:var(--spectrum-button-quiet-over-background-text-color,var(--spectrum-global-color-static-white))}:host([variant=overBackground]) #button:hover{background-color:var(--spectrum-button-quiet-over-background-background-color-hover,hsla(0,0%,100%,.1));border-color:var(--spectrum-button-quiet-over-background-border-color-hover,var(--spectrum-alias-border-color-transparent));color:var(--spectrum-button-quiet-over-background-text-color-hover,var(--spectrum-global-color-static-white))}:host([variant=overBackground]) #button.focus-visible{background-color:var(--spectrum-button-quiet-over-background-background-color-key-focus,var(--spectrum-global-color-static-white));border-color:var(--spectrum-button-quiet-over-background-border-color-key-focus,var(--spectrum-global-color-static-white));color:inherit;box-shadow:0 0 0 1px var(--spectrum-button-quiet-over-background-border-color-key-focus,var(--spectrum-global-color-static-white))}:host([variant=overBackground]) #button:active{background-color:var(--spectrum-button-quiet-over-background-background-color-down,hsla(0,0%,100%,.15));border-color:var(--spectrum-button-quiet-over-background-border-color-down,var(--spectrum-alias-border-color-transparent));color:var(--spectrum-button-quiet-over-background-text-color-down,var(--spectrum-global-color-static-white));box-shadow:none}:host([variant=overBackground]) #button.is-disabled,:host([variant=overBackground]) #button:disabled{background-color:var(--spectrum-button-quiet-over-background-background-color-disabled,var(--spectrum-alias-background-color-transparent));border-color:var(--spectrum-button-quiet-over-background-border-color-disabled,var(--spectrum-alias-border-color-transparent));color:var(--spectrum-button-quiet-over-background-text-color-disabled,hsla(0,0%,100%,.15))}:host{display:inline-flex;flex-direction:row;vertical-align:top}#button{display:flex;flex:1 1 auto;-webkit-appearance:none}:host([disabled]){pointer-events:none}slot[name=icon]::slotted(svg){fill:currentColor;stroke:currentColor;width:var(--spectrum-alias-workflow-icon-size,18px);height:var(--spectrum-alias-workflow-icon-size,18px)}`,FA=It`.cross-medium{width:var(--spectrum-icon-cross-medium-width,var(--spectrum-global-dimension-size-100));height:var(--spectrum-icon-cross-medium-height,var(--spectrum-global-dimension-size-100))}`;class MA extends NA{constructor(){super(...arguments),this.variant=""}static get styles(){return[OA,FA]}get buttonContent(){return[M`<sp-icons-medium></sp-icons-medium><sp-icon slot="icon" class="icon cross-medium" size="s" name="ui:CrossLarge"></sp-icon>`]}}Y([xt({reflect:!0})],MA.prototype,"variant",void 0),customElements.get("sp-action-button")||customElements.define("sp-action-button",_A),customElements.get("sp-clear-button")||customElements.define("sp-clear-button",MA),customElements.get("sp-button")||customElements.define("sp-button",TA);const LA=It`#selected{transform:scale(1);opacity:1;display:none;align-self:flex-start;flex-grow:0;margin-left:var(--spectrum-selectlist-option-icon-padding-x,var(--spectrum-global-dimension-size-150));margin-top:var(--spectrum-global-dimension-size-50)}#button{cursor:pointer;position:relative;display:flex;align-items:center;box-sizing:border-box;padding:var(--spectrum-global-dimension-size-85) var(--spectrum-selectlist-option-padding,var(--spectrum-global-dimension-static-size-150)) var(--spectrum-global-dimension-size-85) calc(var(--spectrum-selectlist-option-padding,var(--spectrum-global-dimension-static-size-150)) - var(--spectrum-selectlist-border-size-key-focus,var(--spectrum-global-dimension-static-size-25)));margin:0;border-left:var(--spectrum-selectlist-border-size-key-focus,var(--spectrum-global-dimension-static-size-25)) solid transparent;min-height:var(--spectrum-selectlist-option-height);font-size:var(--spectrum-selectlist-option-text-size,var(--spectrum-alias-font-size-default));font-weight:var(--spectrum-selectlist-option-text-font-weight,var(--spectrum-global-font-weight-regular));font-style:normal;text-decoration:none;background-color:var(--spectrum-selectlist-option-background-color,var(--spectrum-alias-background-color-transparent));color:var(--spectrum-selectlist-option-text-color,var(--spectrum-alias-text-color))}#button:focus{outline:0}:host([selected]) #button{padding-right:calc(var(--spectrum-selectlist-option-padding,var(--spectrum-global-dimension-static-size-150)) - var(--spectrum-popover-border-size,var(--spectrum-alias-border-size-thin)));color:var(--spectrum-selectlist-option-text-color-selected,var(--spectrum-alias-text-color))}:host([selected]) #button #selected{display:block;color:var(--spectrum-selectlist-option-icon-color-selected,var(--spectrum-alias-icon-color-selected))}.spectrum-Menu-itemIcon,::slotted([slot=icon]){flex-shrink:0;align-self:flex-start}.spectrum-Menu-itemIcon+#label,slot[name=icon]+#label{margin-left:var(--spectrum-selectlist-thumbnail-image-padding-x,var(--spectrum-global-dimension-size-100))}#label{flex:1 1 auto;line-height:1.3}.spectrum-Menu-itemLabel--wrapping{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}#button.focus-visible,#button.is-focused{background-color:var(--spectrum-selectlist-option-background-color-key-focus,var(--spectrum-alias-background-color-hover-overlay));color:var(--spectrum-selectlist-option-text-color-key-focus,var(--spectrum-alias-text-color));border-left-color:var(--spectrum-selectlist-option-focus-indicator-color,var(--spectrum-alias-border-color-focus))}#button.is-highlighted,#button.is-open,#button:focus,#button:hover{background-color:var(--spectrum-selectlist-option-background-color-hover,var(--spectrum-alias-background-color-hover-overlay));color:var(--spectrum-selectlist-option-text-color-hover,var(--spectrum-alias-text-color))}#button:active,.is-active{background-color:var(--spectrum-selectlist-option-background-color-down,var(--spectrum-alias-background-color-hover-overlay))}:host([disabled]) #button{background-color:var(--spectrum-selectlist-option-background-color-disabled,var(--spectrum-alias-background-color-transparent));background-image:none;color:var(--spectrum-selectlist-option-text-color-disabled,var(--spectrum-alias-text-color-disabled));cursor:default}#button{width:100%}button{border:0;background:0;padding:0;margin:0;display:inherit;font:inherit;color:inherit;text-align:inherit}#selected{flex-shrink:0}`,PA=It`.checkmark-medium{width:var(--spectrum-icon-checkmark-medium-width);height:var(--spectrum-icon-checkmark-medium-height)}`;class BA extends _A{constructor(){super(...arguments),this.tabIndex=-1,this._value=""}static get styles(){return[Tt,LA,PA]}get value(){return this._value||this.itemText}set value(t){t!==this.value&&(this._value=t||"",this.value?this.setAttribute("value",this.value):this.removeAttribute("value"))}get itemText(){return(this.textContent||"").trim()}get buttonContent(){const t=super.buttonContent;return this.selected&&t.push(M`<sp-icons-medium></sp-icons-medium><sp-icon id="selected" name="ui:CheckmarkMedium" size="s" slot="icon" class="checkmark-medium"></sp-icon>`),t}connectedCallback(){if(super.connectedCallback(),!this.hasAttribute("role")){const t=new CustomEvent("sp-menu-item-query-role",{bubbles:!0,composed:!0,detail:{role:""}});this.dispatchEvent(t),this.setAttribute("role",t.detail.role||"menuitem")}}}Y([xt({type:Number,reflect:!0})],BA.prototype,"tabIndex",void 0),Y([xt({type:String})],BA.prototype,"value",null);const qA=It`:host{box-sizing:initial;overflow:visible;height:var(--spectrum-selectlist-divider-size,var(--spectrum-alias-border-size-thick));margin:calc(var(--spectrum-selectlist-divider-padding,3px)/ 2) var(--spectrum-selectlist-option-padding,var(--spectrum-global-dimension-static-size-150));padding:0;border:none;background-color:var(--spectrum-selectlist-divider-color,var(--spectrum-alias-border-color-extralight));display:block}`;customElements.define("sp-menu-item",BA),customElements.define("sp-menu-divider",class extends Nt{static get styles(){return[qA]}firstUpdated(){this.setAttribute("role","separator")}});const VA=It`:host{visibility:hidden;opacity:0;transition:transform var(--spectrum-global-animation-duration-100,.13s) ease-in-out,opacity var(--spectrum-global-animation-duration-100,.13s) ease-in-out,visibility 0s linear var(--spectrum-global-animation-duration-100,.13s);pointer-events:none;display:inline-flex;flex-direction:column;box-sizing:border-box;min-width:var(--spectrum-global-dimension-size-400);min-height:var(--spectrum-global-dimension-size-400);position:absolute;border-radius:var(--spectrum-popover-border-radius,var(--spectrum-alias-border-radius-regular));outline:0;background-color:var(--spectrum-popover-background-color,var(--spectrum-global-color-gray-50));border:var(--spectrum-popover-border-size,var(--spectrum-alias-border-size-thin)) solid var(--spectrum-popover-border-color,var(--spectrum-alias-border-color-dark));box-shadow:0 1px 4px var(--spectrum-popover-shadow-color,var(--spectrum-alias-dropshadow-color))}:host([open]){visibility:visible;opacity:1;transition-delay:0s;pointer-events:auto}:host([direction=bottom][open]){transform:translateY(var(--spectrum-dropdown-flyout-menu-offset-y,var(--spectrum-global-dimension-size-75)))}:host([direction=top][open]){transform:translateY(calc(-1*var(--spectrum-dropdown-flyout-menu-offset-y,var(--spectrum-global-dimension-size-75))))}:host([direction=right][open]){transform:translateX(var(--spectrum-dropdown-flyout-menu-offset-y,var(--spectrum-global-dimension-size-75)))}:host([direction=left][open]){transform:translateX(calc(-1*var(--spectrum-dropdown-flyout-menu-offset-y,var(--spectrum-global-dimension-size-75))))}#tip{overflow:hidden;width:calc(var(--spectrum-popover-tip-width,var(--spectrum-global-dimension-size-250)) + 1px);height:calc(var(--spectrum-popover-tip-width,var(--spectrum-global-dimension-size-250))/ 2 + var(--spectrum-popover-border-size,var(--spectrum-alias-border-size-thin)))}#tip,#tip:after{position:absolute}#tip:after{content:"";width:var(--spectrum-popover-tip-width,var(--spectrum-global-dimension-size-250));height:var(--spectrum-popover-tip-width,var(--spectrum-global-dimension-size-250));transform:rotate(45deg);top:-18px;left:-1px;background-color:var(--spectrum-popover-background-color,var(--spectrum-global-color-gray-50));border:var(--spectrum-popover-border-size,var(--spectrum-alias-border-size-thin)) solid var(--spectrum-popover-border-color,var(--spectrum-alias-border-color-dark));box-shadow:-1px -1px 4px var(--spectrum-popover-shadow-color,var(--spectrum-alias-dropshadow-color))}:host([dialog]){min-width:270px;padding:30px 29px}:host([direction=left][tip]){margin-right:13px}:host([direction=left]) #tip{right:-16px;transform:rotate(-90deg)}:host([direction=right][tip]){margin-left:13px}:host([direction=right]) #tip{left:-16px;transform:rotate(90deg)}:host([direction=left]) #tip,:host([direction=right]) #tip{top:50%;margin-top:-6px}:host([direction=bottom][tip]){margin-top:13px}:host([direction=bottom]) #tip{top:-11px;transform:rotate(180deg)}:host([direction=top][tip]){margin-bottom:13px}:host([direction=top]) #tip{bottom:-11px}:host([direction=bottom]) #tip,:host([direction=top]) #tip{left:50%;margin-left:-12px}.spectrum-Dialog-footer,.spectrum-Dialog-header,.spectrum-Dialog-wrapper{background-color:initial}`;class WA extends Nt{constructor(){super(...arguments),this.direction="none",this.tip=!1}static get styles(){return[VA]}renderTip(){return M`<div id="tip"></div>`}render(){return M`<slot></slot>${this.tip?this.renderTip():i}`}}Y([xt({reflect:!0})],WA.prototype,"direction",void 0),Y([xt({type:Boolean,reflect:!0})],WA.prototype,"tip",void 0),customElements.get("sp-popover")||customElements.define("sp-popover",WA);class UA extends _t{constructor(){super(),this.disabled=!1,this.invalid=!1,this.open=!1,this.optionsMenu=null,this.quiet=!1,this.value="",this.selectedItemText="",this.listRole="listbox",this.itemRole="option",this.onClick=this.onClick.bind(this),this.onKeydown=this.onKeydown.bind(this),this.addEventListener("click",this.onClick),this.addEventListener("sp-menu-item-query-role",t=>{t.stopPropagation(),t.detail.role=this.itemRole}),this.addEventListener("sp-menu-query-role",t=>{t.stopPropagation(),t.detail.role=this.listRole})}static get styles(){return[zA,IA,EA,te,AA]}get focusElement(){return void 0===this.button?this:this.button}onOptionsChange(){this.optionsMenu=this.querySelector("sp-menu"),this.value&&this.requestUpdate("value")}onButtonBlur(){void 0!==this.button&&this.button.removeEventListener("keydown",this.onKeydown)}onButtonClick(){this.toggle()}onButtonFocus(){this.open?this.requestUpdate("open"):void 0!==this.button&&this.button.addEventListener("keydown",this.onKeydown)}onClick(t){const e=t.composedPath().find(t=>t instanceof Element&&null!==this.optionsMenu&&t.getAttribute("role")===this.optionsMenu.childRole);e&&this.setValueFromItem(e)}onKeydown(t){"ArrowDown"===t.code&&null!==this.optionsMenu&&(this.open=!0)}setValueFromItem(t){const e=this.selectedItemText,r=this.value;if(this.selectedItemText=t.itemText,this.value=t.value,!this.dispatchEvent(new Event("change",{cancelable:!0})))return this.selectedItemText=e,void(this.value=r);const n=this.querySelector("[selected]");n&&(n.selected=!1),t.selected=!0,this.open=!1,this.focus()}toggle(){this.open=!this.open}get buttonContent(){return[M`<div id="label" class="${Rt(this.value?void 0:"placeholder")}">${this.value?this.selectedItemText:M`<slot></slot>`}</div>${this.invalid?M`<sp-icon class="icon alert-small" name="ui:AlertSmall" size="s"></sp-icon>`:i}<sp-icon class="icon dropdown chevron-down-medium" name="ui:ChevronDownMedium" size="s"></sp-icon>`]}render(){return M`<sp-icons-medium></sp-icons-medium><button aria-haspopup="true" aria-label="${Rt(this.label||void 0)}" id="button" @blur="${this.onButtonBlur}" @click="${this.onButtonClick}" @focus="${this.onButtonFocus}" ?disabled="${this.disabled}">${this.buttonContent}</button><sp-popover direction="bottom" id="popover" ?open="${this.open}"><slot name="options" @slotchange="${this.onOptionsChange}"><sp-menu-item disabled="disabled">There are no options currently available.</sp-menu-item></slot></sp-popover>`}updated(t){if(super.updated(t),t.has("value")&&this.optionsMenu){let t;[...this.optionsMenu.querySelectorAll(`[role=${this.optionsMenu.childRole}]`)].map(e=>{this.value!==e.value||e.disabled?e.selected=!1:t=e}),t?(t.selected=!0,this.selectedItemText=t.itemText):(this.value="",this.selectedItemText=""),this.optionsMenu.updateSelectedItemIndex()}t.has("disabled")&&this.disabled&&(this.open=!1),t.has("open")&&this.open&&requestAnimationFrame(()=>{null!==this.optionsMenu&&(this.dispatchEvent(new KeyboardEvent("keydown",{code:"Tab"})),this.optionsMenu.focus())})}}Y([wt("#button")],UA.prototype,"button",void 0),Y([xt({type:Boolean,reflect:!0})],UA.prototype,"disabled",void 0),Y([xt({type:Boolean,reflect:!0})],UA.prototype,"invalid",void 0),Y([xt()],UA.prototype,"label",void 0),Y([xt({type:Boolean,reflect:!0})],UA.prototype,"open",void 0),Y([xt({type:Boolean,reflect:!0})],UA.prototype,"quiet",void 0),Y([xt({type:String})],UA.prototype,"value",void 0),Y([xt({type:String})],UA.prototype,"selectedItemText",void 0),customElements.get("sp-dropdown")||customElements.define("sp-dropdown",UA);const jA=It`:host{text-align:center;border-radius:var(--spectrum-dropzone-border-radius,var(--spectrum-alias-border-radius-regular));padding:var(--spectrum-dropzone-padding,var(--spectrum-global-dimension-size-900));border:var(--spectrum-dropzone-border-width,var(--spectrum-alias-border-size-thick)) dashed var(--spectrum-dropzone-border-color,var(--spectrum-global-color-gray-300))}:host([dragged]){border-style:solid;border-color:var(--spectrum-dropzone-border-color-selected-hover,var(--spectrum-global-color-blue-400));background-color:var(--spectrum-dropzone-background-color-selected-hover,var(--spectrum-alias-highlight-selected))}:host(:focus){outline:0;border-style:dashed;border-color:var(--spectrum-dropzone-border-color,var(--spectrum-global-color-gray-300))}:host(:focus.focus-visible){border-style:solid;border-color:var(--spectrum-dropzone-border-color-selected-hover,var(--spectrum-global-color-blue-400))}:host([dragged]) ::slotted(*){color:var(--spectrum-global-color-blue-400)}:host(:focus) ::slotted(*){color:var(--spectrum-global-color-static-gray-500,#bcbcbc)}:host(:focus.focus-visible[dragged]) ::slotted(*){color:var(--spectrum-global-color-blue-400)}:host{display:block;--spectrum-dropzone-illustration-color:var(--spectrum-global-color-static-blue-400)}:host([dragged]) ::slotted(*){--spectrum-global-color-gray-500:var(--spectrum-dropzone-illustration-color)}`;class HA extends Nt{constructor(){super(...arguments),this._dropEffect="copy",this.isDragged=!1,this.debouncedDragLeave=null}static get styles(){return[jA]}get dropEffect(){return this._dropEffect}set dropEffect(t){["copy","move","link","none"].includes(t)&&(this._dropEffect=t)}connectedCallback(){super.connectedCallback(),this.addEventListener("drop",this.onDrop),this.addEventListener("dragover",this.onDragOver),this.addEventListener("dragleave",this.onDragLeave)}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("drop",this.onDrop),this.removeEventListener("dragover",this.onDragOver),this.removeEventListener("dragleave",this.onDragLeave)}onDragOver(t){const e=new CustomEvent("sp-dropzone-should-accept",{bubbles:!0,cancelable:!0,composed:!0,detail:t}),r=this.dispatchEvent(e);if(!t.dataTransfer)return;if(!r)return void(t.dataTransfer.dropEffect="none");t.preventDefault(),this.clearDebouncedDragLeave(),this.isDragged=!0,t.dataTransfer.dropEffect=this.dropEffect;const n=new CustomEvent("sp-dropzone-dragover",{bubbles:!0,composed:!0,detail:t});this.dispatchEvent(n)}onDragLeave(t){this.clearDebouncedDragLeave(),this.debouncedDragLeave=window.setTimeout(()=>{this.isDragged=!1;const e=new CustomEvent("sp-dropzone-dragleave",{bubbles:!0,composed:!0,detail:t});this.dispatchEvent(e)},100)}onDrop(t){t.preventDefault(),this.clearDebouncedDragLeave(),this.isDragged=!1;const e=new CustomEvent("sp-dropzone-drop",{bubbles:!0,composed:!0,detail:t});this.dispatchEvent(e)}render(){return M`<slot></slot>`}clearDebouncedDragLeave(){this.debouncedDragLeave&&(clearTimeout(this.debouncedDragLeave),this.debouncedDragLeave=null)}}HA.is="sp-dropzone",Y([xt({type:Boolean,reflect:!0,attribute:"dragged"})],HA.prototype,"isDragged",void 0),customElements.get("sp-dropzone")||customElements.define("sp-dropzone",HA);const GA=It`:host{box-sizing:border-box;margin:var(--spectrum-popover-padding-y,var(--spectrum-global-dimension-size-50)) 0;padding:0;list-style-type:none;overflow:auto;display:block;background-color:var(--spectrum-selectlist-background-color,var(--spectrum-alias-background-color-transparent));display:inline-block}:host sp-menu{display:block}`;customElements.define("sp-menu",class extends Nt{constructor(){super(),this.menuItems=[],this.focusedItemIndex=0,this.focusInItemIndex=0,this.handleKeydown=this.handleKeydown.bind(this),this.startListeningToKeyboard=this.startListeningToKeyboard.bind(this),this.stopListeningToKeyboard=this.stopListeningToKeyboard.bind(this),this.onClick=this.onClick.bind(this),this.addEventListener("click",this.onClick),this.addEventListener("focusin",this.startListeningToKeyboard),this.addEventListener("focusout",this.stopListeningToKeyboard)}static get styles(){return[GA]}get childRole(){return"menu"===this.getAttribute("role")?"menuitem":"option"}focus(){if(0===this.menuItems.length)return;const t=this.menuItems[this.focusInItemIndex];this.focusedItemIndex=this.focusInItemIndex,t.focus()}onClick(t){t.composedPath().find(t=>t instanceof Element&&t.getAttribute("role")===this.childRole)&&this.prepareToCleanUp()}startListeningToKeyboard(){0!==this.menuItems.length&&this.addEventListener("keydown",this.handleKeydown)}stopListeningToKeyboard(){this.removeEventListener("keydown",this.handleKeydown)}handleKeydown(t){const{code:e}=t;if("Tab"===e)return void this.prepareToCleanUp();if("ArrowDown"!==e&&"ArrowUp"!==e)return;t.preventDefault();const r="ArrowDown"===e?1:-1;this.focusMenuItemByOffset(r)}focusMenuItemByOffset(t){const e=this.menuItems[this.focusedItemIndex];this.focusedItemIndex=(this.menuItems.length+this.focusedItemIndex+t)%this.menuItems.length;let r=this.menuItems[this.focusedItemIndex];for(;r.disabled;)this.focusedItemIndex=(this.menuItems.length+this.focusedItemIndex+t)%this.menuItems.length,r=this.menuItems[this.focusedItemIndex];r.focus(),e.tabIndex=-1}prepareToCleanUp(){document.addEventListener("focusout",()=>{requestAnimationFrame(()=>{this.querySelector("[selected]")&&(this.menuItems[this.focusInItemIndex].tabIndex=-1),this.updateSelectedItemIndex(),this.menuItems[this.focusInItemIndex].tabIndex=0})},{once:!0})}updateSelectedItemIndex(){let t=this.menuItems.length-1,e=this.menuItems[t];for(;t&&e&&!e.selected;)t-=1,e=this.menuItems[t];this.focusedItemIndex=t,this.focusInItemIndex=t}handleSlotchange(){this.menuItems=[...this.querySelectorAll(`[role="${this.childRole}"]`)],this.menuItems&&0!==this.menuItems.length&&(this.updateSelectedItemIndex(),this.menuItems[this.focusInItemIndex].tabIndex=0)}render(){return M`<slot @slotchange="${this.handleSlotchange}"></slot>`}connectedCallback(){if(super.connectedCallback(),!this.hasAttribute("role")){const t=new CustomEvent("sp-menu-query-role",{bubbles:!0,composed:!0,detail:{role:""}});this.dispatchEvent(t),this.setAttribute("role",t.detail.role||"menu")}}});const $A=It`a{background-color:initial;-webkit-text-decoration-skip:objects;text-decoration:none;transition:color var(--spectrum-global-animation-duration-100,.13s) ease-in-out;outline:0;color:var(--spectrum-link-text-color,var(--spectrum-global-color-blue-600))}a:hover{color:var(--spectrum-link-text-color-hover,var(--spectrum-global-color-blue-600))}a.focus-visible,a:hover{text-decoration:underline}a.focus-visible{-webkit-text-decoration-style:double;text-decoration-style:double;color:var(--spectrum-link-text-color-key-focus,var(--spectrum-alias-text-color-key-focus))}:host([over-background]) a,:host([quiet]) a{text-decoration:underline}a:active{color:var(--spectrum-link-text-color-down,var(--spectrum-global-color-blue-700))}:host([quiet]) a,:host([quiet]) a:active,:host([quiet]) a:focus,:host([quiet]) a:hover{color:inherit}:host([over-background]) a{color:var(--spectrum-link-over-background-text-color,var(--spectrum-global-color-static-white))}:host([over-background]) a:hover{color:var(--spectrum-link-over-background-text-color-hover,var(--spectrum-global-color-static-white))}:host([over-background]) a:active{color:var(--spectrum-link-over-background-text-color-down,var(--spectrum-global-color-static-white))}:host([over-background]) a:focus{color:var(--spectrum-link-over-background-text-color-key-focus,var(--spectrum-global-color-static-white))}`;class KA extends _t{constructor(){super(...arguments),this.href=void 0}static get styles(){return[$A]}get focusElement(){return this.shadowRoot&&this.anchorElement?this.anchorElement:this}render(){return M`<a id="anchor" href="${Rt(this.href)}" target="${Rt(this.target)}"><slot></slot></a>`}}Y([wt("#anchor")],KA.prototype,"anchorElement",void 0),Y([xt({reflect:!0})],KA.prototype,"href",void 0),Y([xt({reflect:!0})],KA.prototype,"target",void 0),customElements.get("sp-link")||customElements.define("sp-link",KA);const XA=It`:host,:root{--spectrum-global-color-celery-400:#44b556;--spectrum-global-color-celery-500:#3da74e;--spectrum-global-color-celery-600:#379947;--spectrum-global-color-celery-700:#318b40;--spectrum-global-color-chartreuse-400:#85d044;--spectrum-global-color-chartreuse-500:#7cc33f;--spectrum-global-color-chartreuse-600:#73b53a;--spectrum-global-color-chartreuse-700:#6aa834;--spectrum-global-color-yellow-400:#dfbf00;--spectrum-global-color-yellow-500:#d2b200;--spectrum-global-color-yellow-600:#c4a600;--spectrum-global-color-yellow-700:#b79900;--spectrum-global-color-magenta-400:#d83790;--spectrum-global-color-magenta-500:#ce2783;--spectrum-global-color-magenta-600:#bc1c74;--spectrum-global-color-magenta-700:#ae0e66;--spectrum-global-color-fuchsia-400:#c038cc;--spectrum-global-color-fuchsia-500:#b130bd;--spectrum-global-color-fuchsia-600:#a228ad;--spectrum-global-color-fuchsia-700:#93219e;--spectrum-global-color-purple-400:#9256d9;--spectrum-global-color-purple-500:#864ccc;--spectrum-global-color-purple-600:#7a42bf;--spectrum-global-color-purple-700:#6f38b1;--spectrum-global-color-indigo-400:#6767ec;--spectrum-global-color-indigo-500:#5c5ce0;--spectrum-global-color-indigo-600:#5151d3;--spectrum-global-color-indigo-700:#4646c6;--spectrum-global-color-seafoam-400:#1b959a;--spectrum-global-color-seafoam-500:#16878c;--spectrum-global-color-seafoam-600:#0f797d;--spectrum-global-color-seafoam-700:#096c6f;--spectrum-global-color-red-400:#e34850;--spectrum-global-color-red-500:#d7373f;--spectrum-global-color-red-600:#c9252d;--spectrum-global-color-red-700:#bb121a;--spectrum-global-color-orange-400:#e68619;--spectrum-global-color-orange-500:#da7b11;--spectrum-global-color-orange-600:#cb6f10;--spectrum-global-color-orange-700:#bd640d;--spectrum-global-color-green-400:#2d9d78;--spectrum-global-color-green-500:#268e6c;--spectrum-global-color-green-600:#12805c;--spectrum-global-color-green-700:#107154;--spectrum-global-color-blue-400:#2680eb;--spectrum-global-color-blue-500:#1473e6;--spectrum-global-color-blue-600:#0d66d0;--spectrum-global-color-blue-700:#095aba;--spectrum-global-color-gray-50:#fff;--spectrum-global-color-gray-75:#fafafa;--spectrum-global-color-gray-100:#f5f5f5;--spectrum-global-color-gray-200:#eaeaea;--spectrum-global-color-gray-300:#e1e1e1;--spectrum-global-color-gray-400:#cacaca;--spectrum-global-color-gray-500:#b3b3b3;--spectrum-global-color-gray-600:#8e8e8e;--spectrum-global-color-gray-700:#6e6e6e;--spectrum-global-color-gray-800:#4b4b4b;--spectrum-global-color-gray-900:#2c2c2c;--spectrum-alias-background-color-modal-overlay:rgba(0,0,0,0.4);--spectrum-alias-dropshadow-color:rgba(0,0,0,0.15);--spectrum-alias-background-color-hover-overlay:rgba(44,44,44,0.04);--spectrum-alias-highlight-hover:rgba(44,44,44,0.06);--spectrum-alias-highlight-active:rgba(44,44,44,0.1);--spectrum-alias-highlight-selected:rgba(20,115,230,0.1);--spectrum-alias-highlight-selected-hover:rgba(20,115,230,0.2);--spectrum-alias-text-highlight-color:rgba(20,115,230,0.2);--spectrum-alias-background-color-quickactions:hsla(0,0%,96.1%,0.9);--spectrum-alias-radial-reaction-color-default:rgba(75,75,75,0.6);--spectrum-alias-pasteboard-background-color:var(--spectrum-global-color-gray-300);--spectrum-alias-appframe-border-color:var(--spectrum-global-color-gray-300);--spectrum-alias-appframe-separator-color:var(--spectrum-global-color-gray-300);--spectrum-colorarea-border-color:rgba(44,44,44,0.1);--spectrum-colorarea-border-color-hover:rgba(44,44,44,0.1);--spectrum-colorarea-border-color-down:rgba(44,44,44,0.1);--spectrum-colorarea-border-color-key-focus:rgba(44,44,44,0.1);--spectrum-colorslider-border-color:rgba(44,44,44,0.1);--spectrum-colorslider-border-color-hover:rgba(44,44,44,0.1);--spectrum-colorslider-border-color-down:rgba(44,44,44,0.1);--spectrum-colorslider-border-color-key-focus:rgba(44,44,44,0.1);--spectrum-colorslider-vertical-border-color:rgba(44,44,44,0.1);--spectrum-colorslider-vertical-border-color-hover:rgba(44,44,44,0.1);--spectrum-colorslider-vertical-border-color-down:rgba(44,44,44,0.1);--spectrum-colorslider-vertical-border-color-key-focus:rgba(44,44,44,0.1);--spectrum-colorwheel-border-color:rgba(44,44,44,0.1);--spectrum-colorwheel-border-color-hover:rgba(44,44,44,0.1);--spectrum-colorwheel-border-color-down:rgba(44,44,44,0.1);--spectrum-colorwheel-border-color-key-focus:rgba(44,44,44,0.1);--spectrum-miller-column-item-background-color-selected:rgba(20,115,230,0.1);--spectrum-miller-column-item-background-color-selected-hover:rgba(20,115,230,0.2);--spectrum-tabs-compact-selection-indicator-color:var(--spectrum-global-color-blue-500);--spectrum-tabs-compact-vertical-rule-color:var(--spectrum-global-color-gray-200);--spectrum-tabs-compact-vertical-emphasized-selection-indicator-color:var(--spectrum-global-color-blue-500);--spectrum-tabs-compact-vertical-emphasized-rule-color:var(--spectrum-global-color-gray-200);--spectrum-tabs-emphasized-selection-indicator-color:var(--spectrum-global-color-blue-500);--spectrum-tabs-quiet-compact-emphasized-selection-indicator-color:var(--spectrum-global-color-blue-500);--spectrum-tabs-quiet-compact-vertical-emphasized-selection-indicator-color:var(--spectrum-global-color-blue-500);--spectrum-tabs-quiet-emphasized-selection-indicator-color:var(--spectrum-global-color-blue-500);--spectrum-tabs-quiet-vertical-emphasized-selection-indicator-color:var(--spectrum-global-color-blue-500);--spectrum-well-background-color:rgba(75,75,75,0.02);--spectrum-well-border-color:rgba(44,44,44,0.05)}:host{display:block}`;var YA={render(t,e){return M`${this.css()} ${this.html(t,e)}`},html:(t,e)=>M`<h3>Video Source</h3><br><sp-radio-group-patched column @change="${e=>t.onDeviceChange(e)}" selected="${ce.currentDevice.id}" name="devices">${ce.devices.map((t,e)=>M`<sp-radio ?checked="${ce.currentDevice.id===t.id}" value="${t.id}">${t.label}</sp-radio>`)}</sp-radio-group-patched><br><br><h3>Preferred Resolution</h3><br><sp-dropdown ?disabled="${!e.showCameraMenu}" @change="${e=>t.onSelectResolution(e)}">${ce.preferredResolution.label}<sp-menu slot="options" role="listbox">${ce.resolutions.map((t,e)=>M`<sp-menu-item value="${e}" ?selected="${e===ce.preferredResolutionIndex}">${t.label}</sp-menu-item>`)}</sp-menu></sp-dropdown><br><br><h3>Upload Test Video</h3><br><sp-dropzone @drop="${e=>t.onDropVideo(e)}" id="dropzone" tabindex="1" style="width: 135px; height: 75px"><sp-illustrated-message heading="Drag and Drop Your File"><img src="./images/bg-dragdrop-illustration.svg"></sp-illustrated-message><div style="color: grey"><div><label for="file-input"><sp-link>Select a Sample Video</sp-link>&nbsp;from your computer</label> <input @change="${e=>t.onChooseVideo(e)}" type="file" id="file-input" style="display: none"></div></div></sp-dropzone><br><br><h3>Multi-Pose or Single-Pose</h3><sp-switch @change="${e=>t.onChange("algorithm",e.target.checked?"multi-pose":"single-pose")}" ?checked="${"multi-pose"===oe.algorithm}">${oe.algorithm.toUpperCase()}</sp-switch><div class="spectrum-Well"><h3>Input Settings</h3><hr class="spectrum-Rule"><dy-settings-input></dy-settings-input></div><div class="spectrum-Well ${"single-pose"===oe.algorithm?"hidden":""}"><h3>Multi Pose Settings</h3><hr class="spectrum-Rule"><dy-settings-multipose></dy-settings-multipose></div><div class="spectrum-Well ${"multi-pose"===oe.algorithm?"hidden":""}"><h3>Singe Pose Settings</h3><hr class="spectrum-Rule"><dy-settings-singlepose></dy-settings-singlepose></div><sp-action-button quiet @click="${e=>t.onToggleMenu()}"><svg slot="icon" role="img">${t.classList.contains("expanded")?G:$}</svg></sp-action-button>`,css:()=>M`<style>.spectrum-Rule{border-radius:2px;height:2px;border:none;background-color:#4b4b4b}.spectrum-Well{display:block;padding:16px;margin-top:4px;border-width:1px;border-style:solid;border-radius:var(--spectrum-global-dimension-size-50)}.spectrum-Well{background-color:var(--spectrum-well-background-color);border-color:var(--spectrum-well-border-color)}:host{display:inline-block;background-color:#fff;overflow-y:scroll;position:relative;padding:15px}.hidden{display:none}h3{margin:0}sp-action-button{position:absolute;top:10px;right:0;outline:0}sp-dropdown{width:75%}</style>`};V("dy-settings",class extends HTMLElement{static get observedAttributes(){}propertyChangedCallback(t,e,r){}async connectedCallback(){this.init(YA,{showCameraMenu:!0}),(await navigator.mediaDevices.enumerateDevices()).forEach(function(t){"videoinput"===t.kind&&ce.devices.push({label:t.label,id:t.deviceId,type:"camera"})}),this.render()}onSelectResolution(t){ce.preferredResolutionIndex=parseInt(t.target.value)}onDeviceChange(t){"uploaded"===t.target.value?this.model.showCameraMenu=!1:this.model.showCameraMenu=!0,ce.currentDevice=t.target.value,this.render()}onDropVideo(t){ce.uploaded=URL.createObjectURL(t.dataTransfer.files[0]),this.render()}onChooseVideo(t){ce.uploaded=URL.createObjectURL(t.target.files[0]),this.render()}onChange(t,e){oe.setValue(null,t,e),this.render()}onToggleMenu(){this.classList.toggle("expanded"),this.render()}},P);var JA={render(t,e){return M`${this.css()} ${this.html(t,e)}`},html:(t,e)=>M`<div id="dropzone"><div id="dropzone-content"><img src="./images/bg-dragdrop-illustration.svg"><p>Drag and drop or choose your assets</p><sp-button @click="${e=>t.onFileInputClick()}" variant="cta">Load assets</sp-button><input type="file" id="file-upload" multiple="multiple" accept="image/*,application/json" @change="${e=>t.onFileInputChange(e)}"><sp-button variant="primary" @click="${t=>uA.export()}">Export</sp-button></div></div><ul>${uA.assets.map(e=>M`<li><div class="part-thumb" style="background-image: url('${e.image.src}')"></div><div class="metainfo"><h3>${e.partname}</h3><h4 class="filename">${e.filename}</h4><sp-button variant="primary" data-filename="${e.filename}" @click="${e=>t.editAsset(e)}"><svg slot="icon" role="img">${K}</svg> Edit</sp-button></div></li>`)}</ul><sp-action-button quiet @click="${e=>t.onToggleMenu()}"><svg slot="icon" role="img">${t.classList.contains("expanded")?$:G}</svg></sp-action-button>`,css:()=>M`<style>.spectrum-Rule{border-radius:2px;height:2px;border:none;background-color:#4b4b4b}.spectrum-Well{display:block;padding:16px;margin-top:4px;border-width:1px;border-style:solid;border-radius:var(--spectrum-global-dimension-size-50)}.spectrum-Well{background-color:var(--spectrum-well-background-color);border-color:var(--spectrum-well-border-color)}:host{display:inline-block;background-color:#fff;overflow-y:scroll;position:relative;padding:15px;padding-left:35px}.hidden{display:none}h3{margin:0}.metainfo{margin-left:15px}.metainfo .filename{color:var(--spectrum-global-color-gray-600);font-size:10px}sp-action-button{position:absolute;top:10px;left:0;outline:0}input{display:none}#dropzone{display:flex;width:240px;height:215px;border-color:var(--spectrum-global-color-gray-600);border-style:dashed;border-width:1px;margin-left:auto;margin-right:auto}#dropzone.drop-hover{border-color:#0080ff;background-color:#0080FF11}#dropzone-content{text-align:center;margin:auto}svg[slot]{stroke:none}.part-thumb{width:75px;height:125px;background-size:contain;background-repeat:no-repeat;background-position:center;background-color:var(--spectrum-global-color-gray-100);border-color:var(--spectrum-global-color-gray-300);border-style:solid;border-width:1px}ul{padding:0;margin-left:30px;list-style:none}li{display:flex;margin-bottom:10px}</style>`},ZA={render(t,e){return M`${this.css()} ${this.html(t,e)}`},html:(t,e)=>M`<div id="canvas-controls"><sp-dropdown value="${e.asset?e.asset.filename:""}" @change="${e=>t.onChooseAsset(e.target.value)}"><sp-menu slot="options" role="listbox">${uA.assets.map(t=>M`<sp-menu-item>${t.filename}</sp-menu-item>`)}</sp-menu></sp-dropdown><span>&nbsp;&nbsp;becomes the&nbsp;&nbsp;</span><sp-dropdown value="${e.asset?e.asset.partname:""}" @change="${e=>t.onChoosePartForCurrentAsset(e.target.value)}">Unassigned<sp-menu slot="options" role="listbox">${uA.partsList.map(t=>M`<sp-menu-item ?selected="${e.asset&&e.asset.partname===t.name}">${t.name}</sp-menu-item>`)}</sp-menu></sp-dropdown><sp-slider @input="${e=>t.onZoom(e.target.value)}" label="scale" min="10" max="500" variant="ramp" value="${Math.round(100*e.transform.scale)}"></sp-slider></div><div id="canvas-container"><canvas id="imaging"></canvas></div><div id="bottom-controls"><sp-button variant="primary" @click="${t=>uA.export()}">Export</sp-button><sp-button @click="${e=>t.onDismiss(e)}">Done</sp-button></div>`,css:()=>M`<style>:host{display:inline-block}#canvas-container{display:inline-block;height:calc(100% - 100px);width:100%;background-image:linear-gradient(45deg,#eaeaea 25%,transparent 25%),linear-gradient(-45deg,#eaeaea 25%,transparent 25%),linear-gradient(45deg,transparent 75%,#eaeaea 75%),linear-gradient(-45deg,transparent 75%,#eaeaea 75%);background-size:20px 20px;background-position:0 0,0 10px,10px -10px,-10px 0;border-radius:15px}#canvas-controls{display:flex;align-items:center;height:50px;padding-left:15px;padding-right:15px;border-bottom-style:solid;border-bottom-width:1px;border-bottom-color:var(--spectrum-global-color-gray-600)}#bottom-controls{display:flex;align-items:center;height:50px;padding-left:15px;padding-right:15px;border-top-style:solid;border-top-width:1px;border-top-color:var(--spectrum-global-color-gray-600)}#bottom-controls sp-button:first-child{margin-left:auto;margin-right:10px}sp-slider{margin-left:auto}</style>`};class QA extends HTMLElement{static get observedAttributes(){return["part"]}static get DISMISS(){return"onDismiss"}static get ASSET_UPDATE(){return"onAssetUpdate"}propertyChangedCallback(t,e,r){this.setAsset(r)}onChooseAsset(t){this.setAsset(t)}setAsset(t){this.model.asset=uA.findAssetByFilename(t),this.model.transform=this.calculateInitialTransform(this.model.asset.image),this.render(),this.redraw()}onZoom(t){const e=new CustomEvent(QA.DISMISS,{bubbles:!0,composed:!0});this.dispatchEvent(e)}onDismiss(){const t=new CustomEvent(QA.DISMISS,{bubbles:!0,composed:!0});this.dispatchEvent(t)}onChoosePartForCurrentAsset(t){this.model.asset.partname=t,this.model.asset.pins=uA.defaultPinsForPartName(t);const e=new CustomEvent(QA.ASSET_UPDATE,{detail:"assignment",bubbles:!0,composed:!0});(new H).triggerEvent(e),this.render(),this.redraw()}connectedCallback(){this.init(ZA,{transform:{offsetX:0,offsetY:0,scale:null},pinRadius:5,pinDragging:null}),this.imgCanvas=this.shadowRoot.querySelector("canvas#imaging"),this.imgCanvas.addEventListener("pointerdown",t=>this.onPointerDown(t)),this.imgCanvas.addEventListener("pointermove",t=>this.onPointerMove(t)),document.addEventListener("pointerup",t=>this.onPointerUp(t)),window.addEventListener("resize",t=>this.resize()),this.resize(),this.render()}pinHitTest(t,e){if(this.model.asset&&this.model.asset.pins){const r=this.imgCanvas.getBoundingClientRect(),n=t-r.left-this.model.transform.offsetX,o=e-r.top-this.model.transform.offsetY;for(let t=0;t<this.model.asset.pins.length;t++){const e=this.model.asset.pins[t],r=this.model.asset.width*e.x*this.model.transform.scale,a=this.model.asset.height*e.y*this.model.transform.scale;if(Math.sqrt(Math.pow(r-n,2)+Math.pow(a-o,2))<10)return t}}return-1}pointerCoordsToPercentage(t){return this.imageCoordsToPercentage(this.pointerCoordsToImageCoords(t))}pointerCoordsToImageCoords(t){const e=this.imgCanvas.getBoundingClientRect();return{x:(t.x-e.left-this.model.transform.offsetX)*(1/this.model.transform.scale),y:(t.y-e.top-this.model.transform.offsetY)*(1/this.model.transform.scale)}}imageCoordsToPercentage(t){return{x:t.x/this.model.asset.width,y:t.y/this.model.asset.height}}onPointerDown(t){this._pointerIsDown=!0;const e=this.pinHitTest(t.clientX,t.clientY);-1!==e&&(this.model.pinDragging=this.model.asset.pins[e]),this._lastPointerPosition={x:t.clientX,y:t.clientY}}onPointerUp(t){this._pointerIsDown&&(this._pointerIsDown=!1,this.model.pinDragging=null)}onPointerMove(t){if(this.model.pinDragging){const e=this.pointerCoordsToPercentage({x:t.clientX,y:t.clientY});return this.model.pinDragging.x=e.x,this.model.pinDragging.y=e.y,void this.redraw()}if(this._pointerIsDown){const e=t.clientX-this._lastPointerPosition.x,r=t.clientY-this._lastPointerPosition.y;this.model.transform.offsetX+=0|e,this.model.transform.offsetY+=0|r,this.redraw(),this._lastPointerPosition={x:t.clientX,y:t.clientY}}}onZoom(t){this.model.transform.scale=t/100,this.redraw()}redraw(){if(this.model.asset&&this.model.asset.image){this.imgctx.clearRect(0,0,this.imgCanvas.width,this.imgCanvas.height),this.imgctx.drawImage(this.model.asset.image,0,0,this.model.asset.width,this.model.asset.height,this.model.transform.offsetX,this.model.transform.offsetY,this.model.asset.width*this.model.transform.scale,this.model.asset.height*this.model.transform.scale),this.imgctx.strokeStyle="#6a6a6a",this.imgctx.lineWidth=.5,this.imgctx.beginPath(),this.imgctx.rect(this.model.transform.offsetX,this.model.transform.offsetY,this.model.asset.width*this.model.transform.scale,this.model.asset.height*this.model.transform.scale),this.imgctx.stroke(),this.imgctx.closePath();const t=["#ff2222","#22ff22","#2222ff","#ffff22","#22ffff"];this.model.asset.pins&&this.model.asset.pins.forEach((e,r)=>{this.imgctx.fillStyle=t[r],this.imgctx.beginPath(),this.imgctx.ellipse(this.model.transform.offsetX+e.x*this.model.asset.width*this.model.transform.scale,this.model.transform.offsetY+e.y*this.model.asset.height*this.model.transform.scale,this.model.pinRadius,this.model.pinRadius,0,0,2*Math.PI),this.imgctx.fill()})}}resize(){const t=this.shadowRoot.getElementById("canvas-container").getBoundingClientRect();this.imgCanvas.width=t.width,this.imgCanvas.height=t.height,this.imgctx=this.imgCanvas.getContext("2d"),this.render(),this.redraw()}calculateInitialTransform(t){if(t.width>t.height){const e=.95*this.imgCanvas.width/t.width;return{scale:e,offsetX:this.imgCanvas.width/2-t.width*e/2,offsetY:this.imgCanvas.height/2-t.height*e/2}}{const e=.95*this.imgCanvas.height/t.height;return{scale:e,offsetX:this.imgCanvas.width/2-t.width*e/2,offsetY:this.imgCanvas.height/2-t.height*e/2}}}}V("dy-part-editor",QA,P);class tN extends HTMLElement{static get EDIT_ASSET(){return"onEditAsset"}async connectedCallback(){this.init(JA,{}),this.addEventListener("dragenter",t=>this.onDragEnter(t),!1),this.addEventListener("dragover",t=>this.onDragOver(t),!1),this.addEventListener("dragleave",t=>this.onDragLeave(t),!1),this.addEventListener("drop",t=>this.onFileDrop(t),!1),(new H).addEventListener(QA.ASSET_UPDATE,t=>{this.render()})}editAsset(t){const e=new CustomEvent(tN.EDIT_ASSET,{detail:t.currentTarget.dataset.filename,bubbles:!0,composed:!0});this.dispatchEvent(e)}onToggleMenu(){this.classList.toggle("expanded"),this.render()}onFileInputClick(){this.shadowRoot.querySelector("input").click()}async onFileInputChange(t){t.target.files&&(await uA.loadAssets(t.target.files),this.render())}async onFileDrop(t){if(t.preventDefault(),this.shadowRoot.querySelector("#dropzone").classList.toggle("drop-hover",!1),t.dataTransfer.items){const e=[];for(let r=0;r<t.dataTransfer.items.length;++r)e.push(t.dataTransfer.items[r].getAsFile());await uA.loadAssets(e),this.render()}}onDragOver(t){t.preventDefault()}onDragEnter(t){t.preventDefault(),this.shadowRoot.querySelector("#dropzone").classList.toggle("drop-hover",!0)}onDragLeave(t){t.preventDefault(),this.shadowRoot.querySelector("#dropzone").classList.toggle("drop-hover",!1)}}V("dy-asset-library",tN,P);const eN=It`:host,:root{--spectrum-global-animation-duration-0:0ms;--spectrum-global-animation-duration-100:130ms;--spectrum-global-animation-duration-200:160ms;--spectrum-global-animation-duration-300:190ms;--spectrum-global-animation-duration-400:220ms;--spectrum-global-animation-duration-500:250ms;--spectrum-global-animation-duration-600:300ms;--spectrum-global-animation-duration-700:350ms;--spectrum-global-animation-duration-800:400ms;--spectrum-global-animation-duration-900:450ms;--spectrum-global-animation-duration-1000:500ms;--spectrum-global-animation-duration-2000:1000ms;--spectrum-global-animation-duration-4000:2000ms;--spectrum-global-animation-ease-in-out:cubic-bezier(0.45,0,0.4,1);--spectrum-global-animation-ease-in:cubic-bezier(0.5,0,1,1);--spectrum-global-animation-ease-out:cubic-bezier(0,0,0.4,1);--spectrum-global-animation-linear:cubic-bezier(0,0,1,1);--spectrum-global-color-static-black:#000;--spectrum-global-color-static-white:#fff;--spectrum-global-color-static-blue:#1473e6;--spectrum-global-color-static-gray-50:#fff;--spectrum-global-color-static-gray-75:#fff;--spectrum-global-color-static-gray-100:#fff;--spectrum-global-color-static-gray-200:#f4f4f4;--spectrum-global-color-static-gray-300:#eaeaea;--spectrum-global-color-static-gray-400:#d3d3d3;--spectrum-global-color-static-gray-500:#bcbcbc;--spectrum-global-color-static-gray-600:#959595;--spectrum-global-color-static-gray-700:#747474;--spectrum-global-color-static-gray-800:#505050;--spectrum-global-color-static-gray-900:#323232;--spectrum-global-color-static-blue-400:#378ef0;--spectrum-global-color-static-blue-500:#2680eb;--spectrum-global-color-static-blue-600:#1473e6;--spectrum-global-color-static-blue-700:#0d66d0;--spectrum-global-color-static-red-400:#ec5b62;--spectrum-global-color-static-red-500:#e34850;--spectrum-global-color-static-red-600:#d7373f;--spectrum-global-color-static-red-700:#c9252d;--spectrum-global-color-static-orange-400:#f29423;--spectrum-global-color-static-orange-500:#e68619;--spectrum-global-color-static-orange-600:#da7b11;--spectrum-global-color-static-orange-700:#cb6f10;--spectrum-global-color-static-green-400:#33ab84;--spectrum-global-color-static-green-500:#2d9d78;--spectrum-global-color-static-green-600:#268e6c;--spectrum-global-color-static-green-700:#12805c;--spectrum-global-color-static-celery-400:#4bc35f;--spectrum-global-color-static-celery-500:#44b556;--spectrum-global-color-static-celery-600:#3da74e;--spectrum-global-color-static-celery-700:#379947;--spectrum-global-color-static-chartreuse-400:#8ede49;--spectrum-global-color-static-chartreuse-500:#85d044;--spectrum-global-color-static-chartreuse-600:#7cc33f;--spectrum-global-color-static-chartreuse-700:#73b53a;--spectrum-global-color-static-yellow-400:#edcc00;--spectrum-global-color-static-yellow-500:#dfbf00;--spectrum-global-color-static-yellow-600:#d2b200;--spectrum-global-color-static-yellow-700:#c4a600;--spectrum-global-color-static-magenta-400:#e2499d;--spectrum-global-color-static-magenta-500:#d83790;--spectrum-global-color-static-magenta-600:#ca2982;--spectrum-global-color-static-magenta-700:#bc1c74;--spectrum-global-color-static-fuchsia-400:#cf3edc;--spectrum-global-color-static-fuchsia-500:#c038cc;--spectrum-global-color-static-fuchsia-600:#b130bd;--spectrum-global-color-static-fuchsia-700:#a228ad;--spectrum-global-color-static-purple-400:#9d64e1;--spectrum-global-color-static-purple-500:#9256d9;--spectrum-global-color-static-purple-600:#864ccc;--spectrum-global-color-static-purple-700:#7a42bf;--spectrum-global-color-static-indigo-400:#7575f1;--spectrum-global-color-static-indigo-500:#6767ec;--spectrum-global-color-static-indigo-600:#5c5ce0;--spectrum-global-color-static-indigo-700:#5151d3;--spectrum-global-color-static-seafoam-400:#20a3a8;--spectrum-global-color-static-seafoam-500:#1b959a;--spectrum-global-color-static-seafoam-600:#16878c;--spectrum-global-color-static-seafoam-700:#0f797d;--spectrum-global-color-opacity-100:1;--spectrum-global-color-opacity-90:0.9;--spectrum-global-color-opacity-80:0.8;--spectrum-global-color-opacity-60:0.6;--spectrum-global-color-opacity-50:0.5;--spectrum-global-color-opacity-40:0.4;--spectrum-global-color-opacity-30:0.3;--spectrum-global-color-opacity-25:0.25;--spectrum-global-color-opacity-20:0.2;--spectrum-global-color-opacity-15:0.15;--spectrum-global-color-opacity-10:0.1;--spectrum-global-color-opacity-8:0.08;--spectrum-global-color-opacity-7:0.07;--spectrum-global-color-opacity-6:0.06;--spectrum-global-color-opacity-5:0.05;--spectrum-global-color-opacity-4:0.04;--spectrum-semantic-negative-color-background:var(--spectrum-global-color-static-red-700);--spectrum-semantic-negative-color-default:var(--spectrum-global-color-red-500);--spectrum-semantic-negative-color-dark:var(--spectrum-global-color-red-600);--spectrum-semantic-negative-color-border:var(--spectrum-global-color-red-400);--spectrum-semantic-negative-color-icon:var(--spectrum-global-color-red-600);--spectrum-semantic-negative-color-status:var(--spectrum-global-color-red-400);--spectrum-semantic-negative-color-text-large:var(--spectrum-global-color-red-500);--spectrum-semantic-negative-color-text-small:var(--spectrum-global-color-red-600);--spectrum-semantic-negative-color-state-down:var(--spectrum-global-color-red-700);--spectrum-semantic-negative-color-state-focus:var(--spectrum-global-color-red-400);--spectrum-semantic-notice-color-background:var(--spectrum-global-color-static-orange-700);--spectrum-semantic-notice-color-default:var(--spectrum-global-color-orange-500);--spectrum-semantic-notice-color-dark:var(--spectrum-global-color-orange-600);--spectrum-semantic-notice-color-border:var(--spectrum-global-color-orange-400);--spectrum-semantic-notice-color-icon:var(--spectrum-global-color-orange-600);--spectrum-semantic-notice-color-status:var(--spectrum-global-color-orange-400);--spectrum-semantic-notice-color-text-large:var(--spectrum-global-color-orange-500);--spectrum-semantic-notice-color-text-small:var(--spectrum-global-color-orange-600);--spectrum-semantic-notice-color-state-down:var(--spectrum-global-color-orange-700);--spectrum-semantic-notice-color-state-focus:var(--spectrum-global-color-orange-400);--spectrum-semantic-positive-color-background:var(--spectrum-global-color-static-green-700);--spectrum-semantic-positive-color-default:var(--spectrum-global-color-green-500);--spectrum-semantic-positive-color-dark:var(--spectrum-global-color-green-600);--spectrum-semantic-positive-color-border:var(--spectrum-global-color-green-400);--spectrum-semantic-positive-color-icon:var(--spectrum-global-color-green-600);--spectrum-semantic-positive-color-status:var(--spectrum-global-color-green-400);--spectrum-semantic-positive-color-text-large:var(--spectrum-global-color-green-500);--spectrum-semantic-positive-color-text-small:var(--spectrum-global-color-green-600);--spectrum-semantic-positive-color-state-down:var(--spectrum-global-color-green-700);--spectrum-semantic-positive-color-state-focus:var(--spectrum-global-color-green-400);--spectrum-semantic-informative-color-background:var(--spectrum-global-color-static-blue-700);--spectrum-semantic-informative-color-default:var(--spectrum-global-color-blue-500);--spectrum-semantic-informative-color-dark:var(--spectrum-global-color-blue-600);--spectrum-semantic-informative-color-border:var(--spectrum-global-color-blue-400);--spectrum-semantic-informative-color-icon:var(--spectrum-global-color-blue-600);--spectrum-semantic-informative-color-status:var(--spectrum-global-color-blue-400);--spectrum-semantic-informative-color-text-large:var(--spectrum-global-color-blue-500);--spectrum-semantic-informative-color-text-small:var(--spectrum-global-color-blue-600);--spectrum-semantic-informative-color-state-down:var(--spectrum-global-color-blue-700);--spectrum-semantic-informative-color-state-focus:var(--spectrum-global-color-blue-400);--spectrum-semantic-cta-color-background-default:var(--spectrum-global-color-static-blue-600);--spectrum-semantic-cta-color-background-hover:var(--spectrum-global-color-static-blue-700);--spectrum-semantic-cta-color-background-down:var(--spectrum-global-color-static-blue-700);--spectrum-semantic-cta-color-background-key-focus:var(--spectrum-global-color-static-blue-600);--spectrum-semantic-background-color-key-focus:var(--spectrum-global-color-static-blue-600);--spectrum-semantic-neutral-color-background:var(--spectrum-global-color-static-gray-700);--spectrum-semantic-presence-color-1:var(--spectrum-global-color-static-red-500);--spectrum-semantic-presence-color-2:var(--spectrum-global-color-static-orange-400);--spectrum-semantic-presence-color-3:var(--spectrum-global-color-static-yellow-400);--spectrum-semantic-presence-color-4:#4bcca2;--spectrum-semantic-presence-color-5:#00c7ff;--spectrum-semantic-presence-color-6:#008cb8;--spectrum-semantic-presence-color-7:#7e4bf3;--spectrum-semantic-presence-color-8:var(--spectrum-global-color-static-fuchsia-600);--spectrum-global-dimension-static-size-0:0px;--spectrum-global-dimension-static-size-10:1px;--spectrum-global-dimension-static-size-25:2px;--spectrum-global-dimension-static-size-50:4px;--spectrum-global-dimension-static-size-40:3px;--spectrum-global-dimension-static-size-65:5px;--spectrum-global-dimension-static-size-100:8px;--spectrum-global-dimension-static-size-115:9px;--spectrum-global-dimension-static-size-125:10px;--spectrum-global-dimension-static-size-150:12px;--spectrum-global-dimension-static-size-175:14px;--spectrum-global-dimension-static-size-200:16px;--spectrum-global-dimension-static-size-225:18px;--spectrum-global-dimension-static-size-250:20px;--spectrum-global-dimension-static-size-300:24px;--spectrum-global-dimension-static-size-400:32px;--spectrum-global-dimension-static-size-450:36px;--spectrum-global-dimension-static-size-500:40px;--spectrum-global-dimension-static-size-550:44px;--spectrum-global-dimension-static-size-600:48px;--spectrum-global-dimension-static-size-700:56px;--spectrum-global-dimension-static-size-800:64px;--spectrum-global-dimension-static-size-900:72px;--spectrum-global-dimension-static-size-1000:80px;--spectrum-global-dimension-static-size-1200:96px;--spectrum-global-dimension-static-size-1700:136px;--spectrum-global-dimension-static-size-2400:192px;--spectrum-global-dimension-static-size-2600:208px;--spectrum-global-dimension-static-size-3400:272px;--spectrum-global-dimension-static-size-3600:288px;--spectrum-global-dimension-static-size-4600:368px;--spectrum-global-dimension-static-size-5000:400px;--spectrum-global-dimension-static-size-6000:480px;--spectrum-global-dimension-static-font-size-50:11px;--spectrum-global-dimension-static-font-size-75:12px;--spectrum-global-dimension-static-font-size-100:14px;--spectrum-global-dimension-static-font-size-150:15px;--spectrum-global-dimension-static-font-size-200:16px;--spectrum-global-dimension-static-font-size-300:18px;--spectrum-global-dimension-static-font-size-400:20px;--spectrum-global-dimension-static-font-size-500:22px;--spectrum-global-dimension-static-font-size-600:25px;--spectrum-global-dimension-static-font-size-700:28px;--spectrum-global-dimension-static-font-size-800:32px;--spectrum-global-dimension-static-font-size-900:36px;--spectrum-global-dimension-static-font-size-1000:40px;--spectrum-global-dimension-static-percent-50:50%;--spectrum-global-dimension-static-percent-100:100%;--spectrum-global-dimension-static-breakpoint-xsmall:304px;--spectrum-global-dimension-static-breakpoint-small:768px;--spectrum-global-dimension-static-breakpoint-medium:1280px;--spectrum-global-dimension-static-breakpoint-large:1768px;--spectrum-global-dimension-static-breakpoint-xlarge:2160px;--spectrum-global-dimension-static-grid-columns:12;--spectrum-global-dimension-static-grid-fluid-width:100%;--spectrum-global-dimension-static-grid-fixed-max-width:1280px;--spectrum-global-font-family-base:adobe-clean,"Source Sans Pro",-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Ubuntu,"Trebuchet MS","Lucida Grande",sans-serif;--spectrum-global-font-family-serif:adobe-clean-serif,"Source Serif Pro",Georgia,serif;--spectrum-global-font-family-code:"Source Code Pro",Monaco,monospace;--spectrum-global-font-weight-thin:100;--spectrum-global-font-weight-ultra-light:200;--spectrum-global-font-weight-light:300;--spectrum-global-font-weight-regular:400;--spectrum-global-font-weight-medium:500;--spectrum-global-font-weight-semi-bold:600;--spectrum-global-font-weight-bold:700;--spectrum-global-font-weight-extra-bold:800;--spectrum-global-font-weight-black:900;--spectrum-global-font-style-regular:normal;--spectrum-global-font-style-italic:italic;--spectrum-global-font-letter-spacing-none:0;--spectrum-global-font-letter-spacing-small:0.0125em;--spectrum-global-font-letter-spacing-han:0.05em;--spectrum-global-font-letter-spacing-medium:0.06em;--spectrum-global-font-line-height-large:1.7;--spectrum-global-font-line-height-medium:1.5;--spectrum-global-font-line-height-small:1.3;--spectrum-global-font-multiplier-25:0.25em;--spectrum-global-font-multiplier-75:0.75em;--spectrum-alias-border-size-thin:var(--spectrum-global-dimension-static-size-10);--spectrum-alias-border-size-thick:var(--spectrum-global-dimension-static-size-25);--spectrum-alias-border-size-thicker:var(--spectrum-global-dimension-static-size-50);--spectrum-alias-border-size-thickest:var(--spectrum-global-dimension-static-size-100);--spectrum-alias-border-offset-thin:var(--spectrum-global-dimension-static-size-25);--spectrum-alias-border-offset-thick:var(--spectrum-global-dimension-static-size-50);--spectrum-alias-border-offset-thicker:var(--spectrum-global-dimension-static-size-100);--spectrum-alias-border-offset-thickest:var(--spectrum-global-dimension-static-size-200);--spectrum-alias-grid-baseline:var(--spectrum-global-dimension-static-size-100);--spectrum-alias-grid-gutter-xsmall:var(--spectrum-global-dimension-static-size-200);--spectrum-alias-grid-gutter-small:var(--spectrum-global-dimension-static-size-300);--spectrum-alias-grid-gutter-medium:var(--spectrum-global-dimension-static-size-400);--spectrum-alias-grid-gutter-large:var(--spectrum-global-dimension-static-size-500);--spectrum-alias-grid-gutter-xlarge:var(--spectrum-global-dimension-static-size-600);--spectrum-alias-grid-margin-xsmall:var(--spectrum-global-dimension-static-size-200);--spectrum-alias-grid-margin-small:var(--spectrum-global-dimension-static-size-300);--spectrum-alias-grid-margin-medium:var(--spectrum-global-dimension-static-size-400);--spectrum-alias-grid-margin-large:var(--spectrum-global-dimension-static-size-500);--spectrum-alias-grid-margin-xlarge:var(--spectrum-global-dimension-static-size-600);--spectrum-alias-grid-layout-region-margin-bottom-xsmall:var(--spectrum-global-dimension-static-size-200);--spectrum-alias-grid-layout-region-margin-bottom-small:var(--spectrum-global-dimension-static-size-300);--spectrum-alias-grid-layout-region-margin-bottom-medium:var(--spectrum-global-dimension-static-size-400);--spectrum-alias-grid-layout-region-margin-bottom-large:var(--spectrum-global-dimension-static-size-500);--spectrum-alias-grid-layout-region-margin-bottom-xlarge:var(--spectrum-global-dimension-static-size-600);--spectrum-alias-radial-reaction-size-default:var(--spectrum-global-dimension-static-size-550);--spectrum-alias-font-family-ar:myriad-arabic,adobe-clean,"Source Sans Pro",-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Ubuntu,"Trebuchet MS","Lucida Grande",sans-serif;--spectrum-alias-font-family-he:myriad-hebrew,adobe-clean,"Source Sans Pro",-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Ubuntu,"Trebuchet MS","Lucida Grande",sans-serif;--spectrum-alias-font-family-zh:adobe-clean-han-traditional,source-han-traditional,"MingLiu","Heiti TC Light","sans-serif";--spectrum-alias-font-family-zhhans:adobe-clean-han-simplified-c,source-han-simplified-c,"SimSun","Heiti SC Light","sans-serif";--spectrum-alias-font-family-ko:adobe-clean-han-korean,source-han-korean,"Malgun Gothic","Apple Gothic","sans-serif";--spectrum-alias-font-family-ja:adobe-clean-han-japanese,source-han-japanese,"Yu Gothic","\\30E1 \\30A4 \\30EA \\30AA","\\30D2 \\30E9 \\30AE \\30CE \\89D2 \\30B4  Pro W3","Hiragino Kaku Gothic Pro W3","Osaka","\\FF2D \\FF33 \\FF30 \\30B4 \\30B7 \\30C3 \\30AF","MS PGothic","sans-serif";--spectrum-alias-font-family-condensed:adobe-clean-han-traditional,source-han-traditional,"MingLiu","Heiti TC Light",adobe-clean,"Source Sans Pro",-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Ubuntu,"Trebuchet MS","Lucida Grande",sans-serif;--spectrum-alias-line-height-body:var(--spectrum-global-font-line-height-medium);--spectrum-alias-line-height-title:var(--spectrum-global-font-line-height-small);--spectrum-alias-body-han-text-line-height:var(--spectrum-global-font-line-height-large);--spectrum-alias-body-text-font-family:var(--spectrum-global-font-family-base);--spectrum-alias-body-text-line-height:var(--spectrum-global-font-line-height-medium);--spectrum-alias-body-text-font-weight:var(--spectrum-global-font-weight-regular);--spectrum-alias-body-text-font-weight-strong:var(--spectrum-global-font-weight-bold);--spectrum-alias-button-text-line-height:var(--spectrum-global-font-line-height-small);--spectrum-alias-heading-han-text-line-height:var(--spectrum-global-font-line-height-medium);--spectrum-alias-heading-text-line-height:var(--spectrum-global-font-line-height-small);--spectrum-alias-heading-text-font-weight-regular:var(--spectrum-global-font-weight-bold);--spectrum-alias-heading-text-font-weight-regular-strong:var(--spectrum-global-font-weight-black);--spectrum-alias-heading-text-font-weight-quiet:var(--spectrum-global-font-weight-light);--spectrum-alias-heading-text-font-weight-quiet-strong:var(--spectrum-global-font-weight-bold);--spectrum-alias-heading-text-font-weight-strong:var(--spectrum-global-font-weight-black);--spectrum-alias-heading-text-font-weight-strong-strong:var(--spectrum-global-font-weight-black);--spectrum-alias-subheading-text-font-weight:var(--spectrum-global-font-weight-bold);--spectrum-alias-subheading-text-font-weight-strong:var(--spectrum-global-font-weight-black);--spectrum-alias-detail-text-font-weight:var(--spectrum-global-font-weight-regular);--spectrum-alias-detail-text-font-weight-strong:var(--spectrum-global-font-weight-bold);--spectrum-alias-serif-text-font-family:var(--spectrum-global-font-family-serif);--spectrum-alias-article-text-font-family:var(--spectrum-global-font-family-serif);--spectrum-alias-article-body-text-font-weight:var(--spectrum-global-font-weight-regular);--spectrum-alias-article-body-text-font-weight-strong:var(--spectrum-global-font-weight-black);--spectrum-alias-article-heading-text-font-weight:var(--spectrum-global-font-weight-bold);--spectrum-alias-article-heading-text-font-weight-strong:var(--spectrum-global-font-weight-black);--spectrum-alias-article-heading-text-font-weight-quiet:var(--spectrum-global-font-weight-regular);--spectrum-alias-article-heading-text-font-weight-quiet-strong:var(--spectrum-global-font-weight-bold);--spectrum-alias-article-subheading-text-font-weight:var(--spectrum-global-font-weight-bold);--spectrum-alias-article-subheading-text-font-weight-strong:var(--spectrum-global-font-weight-black);--spectrum-alias-article-detail-text-font-weight:var(--spectrum-global-font-weight-regular);--spectrum-alias-article-detail-text-font-weight-strong:var(--spectrum-global-font-weight-bold);--spectrum-alias-code-text-font-family:var(--spectrum-global-font-family-code);--spectrum-alias-han-heading-text-font-weight-regular:var(--spectrum-global-font-weight-bold);--spectrum-alias-han-heading-text-font-weight-regular-emphasis:var(--spectrum-global-font-weight-extra-bold);--spectrum-alias-han-heading-text-font-weight-regular-strong:var(--spectrum-global-font-weight-black);--spectrum-alias-han-heading-text-font-weight-quiet:var(--spectrum-global-font-weight-light);--spectrum-alias-han-heading-text-font-weight-quiet-emphasis:var(--spectrum-global-font-weight-regular);--spectrum-alias-han-heading-text-font-weight-quiet-strong:var(--spectrum-global-font-weight-bold);--spectrum-alias-han-heading-text-font-weight-light:var(--spectrum-global-font-weight-light);--spectrum-alias-han-heading-text-font-weight-light-emphasis:var(--spectrum-global-font-weight-regular);--spectrum-alias-han-heading-text-font-weight-light-strong:var(--spectrum-global-font-weight-bold);--spectrum-alias-han-heading-text-font-weight-strong:var(--spectrum-global-font-weight-black);--spectrum-alias-han-heading-text-font-weight-strong-emphasis:var(--spectrum-global-font-weight-black);--spectrum-alias-han-heading-text-font-weight-strong-strong:var(--spectrum-global-font-weight-black);--spectrum-alias-han-heading-text-font-weight-heavy:var(--spectrum-global-font-weight-black);--spectrum-alias-han-heading-text-font-weight-heavy-emphasis:var(--spectrum-global-font-weight-black);--spectrum-alias-han-heading-text-font-weight-heavy-strong:var(--spectrum-global-font-weight-black);--spectrum-alias-han-body-text-font-weight-regular:var(--spectrum-global-font-weight-regular);--spectrum-alias-han-body-text-font-weight-emphasis:var(--spectrum-global-font-weight-bold);--spectrum-alias-han-body-text-font-weight-strong:var(--spectrum-global-font-weight-black);--spectrum-alias-han-subheading-text-font-weight-regular:var(--spectrum-global-font-weight-bold);--spectrum-alias-han-subheading-text-font-weight-emphasis:var(--spectrum-global-font-weight-extra-bold);--spectrum-alias-han-subheading-text-font-weight-strong:var(--spectrum-global-font-weight-black);--spectrum-alias-han-detail-text-font-weight:var(--spectrum-global-font-weight-regular);--spectrum-alias-han-detail-text-font-weight-emphasis:var(--spectrum-global-font-weight-bold);--spectrum-alias-han-detail-text-font-weight-strong:var(--spectrum-global-font-weight-black);--spectrum-alias-code-text-font-weight-regular:var(--spectrum-global-font-weight-regular);--spectrum-alias-code-text-font-weight-strong:var(--spectrum-global-font-weight-bold);--spectrum-alias-code-text-line-height:var(--spectrum-global-font-line-height-medium);--spectrum-alias-heading-margin-bottom:var(--spectrum-global-font-multiplier-25);--spectrum-alias-body-margin-bottom:var(--spectrum-global-font-multiplier-75);--spectrum-alias-dropshadow-blur:var(--spectrum-global-dimension-size-50);--spectrum-alias-dropshadow-offset-y:var(--spectrum-global-dimension-size-10);--spectrum-alias-font-size-default:var(--spectrum-global-dimension-font-size-100);--spectrum-alias-line-height-small:var(--spectrum-global-dimension-size-200);--spectrum-alias-line-height-medium:var(--spectrum-global-dimension-size-250);--spectrum-alias-line-height-large:var(--spectrum-global-dimension-size-300);--spectrum-alias-line-height-xlarge:var(--spectrum-global-dimension-size-400);--spectrum-alias-line-height-xxlarge:var(--spectrum-global-dimension-size-600);--spectrum-alias-layout-label-gap-size:var(--spectrum-global-dimension-size-100);--spectrum-alias-pill-button-text-size:var(--spectrum-global-dimension-font-size-100);--spectrum-alias-pill-button-text-baseline:var(--spectrum-global-dimension-static-size-150);--spectrum-alias-border-radius-xsmall:var(--spectrum-global-dimension-size-10);--spectrum-alias-border-radius-small:var(--spectrum-global-dimension-size-25);--spectrum-alias-border-radius-regular:var(--spectrum-global-dimension-size-50);--spectrum-alias-border-radius-medium:var(--spectrum-global-dimension-size-100);--spectrum-alias-border-radius-large:var(--spectrum-global-dimension-size-200);--spectrum-alias-single-line-height:var(--spectrum-global-dimension-size-400);--spectrum-alias-single-line-width:var(--spectrum-global-dimension-size-2400);--spectrum-alias-workflow-icon-size:var(--spectrum-global-dimension-size-225);--spectrum-alias-heading-han-display1-text-size:var(--spectrum-global-dimension-font-size-1000);--spectrum-alias-heading-han-xxxl-text-size:var(--spectrum-global-dimension-font-size-1000);--spectrum-alias-heading-han-display1-margin-top:var(--spectrum-global-dimension-font-size-900);--spectrum-alias-heading-han-xxxl-margin-top:var(--spectrum-global-dimension-font-size-900);--spectrum-alias-heading-han-display2-text-size:var(--spectrum-global-dimension-font-size-900);--spectrum-alias-heading-han-xxl-text-size:var(--spectrum-global-dimension-font-size-900);--spectrum-alias-heading-han-display2-margin-top:var(--spectrum-global-dimension-font-size-800);--spectrum-alias-heading-han-xxl-margin-top:var(--spectrum-global-dimension-font-size-800);--spectrum-alias-heading1-han-text-size:var(--spectrum-global-dimension-font-size-800);--spectrum-alias-heading-han-xl-text-size:var(--spectrum-global-dimension-font-size-800);--spectrum-alias-heading1-han-margin-top:var(--spectrum-global-dimension-font-size-700);--spectrum-alias-heading-han-xl-margin-top:var(--spectrum-global-dimension-font-size-700);--spectrum-alias-heading2-han-text-size:var(--spectrum-global-dimension-font-size-600);--spectrum-alias-heading-han-l-text-size:var(--spectrum-global-dimension-font-size-600);--spectrum-alias-heading2-han-margin-top:var(--spectrum-global-dimension-font-size-500);--spectrum-alias-heading-han-l-margin-top:var(--spectrum-global-dimension-font-size-500);--spectrum-alias-heading3-han-text-size:var(--spectrum-global-dimension-font-size-400);--spectrum-alias-heading-han-m-text-size:var(--spectrum-global-dimension-font-size-400);--spectrum-alias-heading3-han-margin-top:var(--spectrum-global-dimension-font-size-300);--spectrum-alias-heading-han-m-margin-top:var(--spectrum-global-dimension-font-size-300);--spectrum-alias-heading4-text-size:var(--spectrum-global-dimension-font-size-300);--spectrum-alias-heading-s-text-size:var(--spectrum-global-dimension-font-size-300);--spectrum-alias-heading4-margin-top:var(--spectrum-global-dimension-font-size-200);--spectrum-alias-heading-s-margin-top:var(--spectrum-global-dimension-font-size-200);--spectrum-alias-heading5-text-size:var(--spectrum-global-dimension-font-size-200);--spectrum-alias-heading-xs-text-size:var(--spectrum-global-dimension-font-size-200);--spectrum-alias-heading5-margin-top:var(--spectrum-global-dimension-font-size-100);--spectrum-alias-heading-xs-margin-top:var(--spectrum-global-dimension-font-size-100);--spectrum-alias-heading6-text-size:var(--spectrum-global-dimension-font-size-100);--spectrum-alias-heading-xxs-text-size:var(--spectrum-global-dimension-font-size-100);--spectrum-alias-heading6-margin-top:var(--spectrum-global-dimension-font-size-75);--spectrum-alias-heading-xxs-margin-top:var(--spectrum-global-dimension-font-size-75);--spectrum-alias-background-color-default:var(--spectrum-global-color-gray-100);--spectrum-alias-background-color-transparent:transparent;--spectrum-alias-background-color-label-gray:#707070;--spectrum-alias-background-color-quickactions-overlay:rgba(0,0,0,0.2);--spectrum-alias-placeholder-text-color:var(--spectrum-global-color-gray-600);--spectrum-alias-placeholder-text-color-hover:var(--spectrum-global-color-gray-900);--spectrum-alias-placeholder-text-color-down:var(--spectrum-global-color-gray-900);--spectrum-alias-placeholder-text-color-selected:var(--spectrum-global-color-gray-800);--spectrum-alias-label-text-color:var(--spectrum-global-color-gray-700);--spectrum-alias-text-color:var(--spectrum-global-color-gray-800);--spectrum-alias-text-color-hover:var(--spectrum-global-color-gray-900);--spectrum-alias-text-color-down:var(--spectrum-global-color-gray-900);--spectrum-alias-text-color-key-focus:var(--spectrum-global-color-blue-600);--spectrum-alias-text-color-mouse-focus:var(--spectrum-global-color-blue-600);--spectrum-alias-text-color-disabled:var(--spectrum-global-color-gray-500);--spectrum-alias-text-color-invalid:var(--spectrum-global-color-red-500);--spectrum-alias-text-color-selected:var(--spectrum-global-color-blue-600);--spectrum-alias-text-color-selected-neutral:var(--spectrum-global-color-gray-900);--spectrum-alias-title-text-color:var(--spectrum-global-color-gray-900);--spectrum-alias-heading-text-color:var(--spectrum-global-color-gray-900);--spectrum-alias-border-color:var(--spectrum-global-color-gray-300);--spectrum-alias-border-color-hover:var(--spectrum-global-color-gray-400);--spectrum-alias-border-color-focus:var(--spectrum-global-color-blue-400);--spectrum-alias-border-color-down:var(--spectrum-global-color-blue-500);--spectrum-alias-border-color-extralight:var(--spectrum-global-color-gray-100);--spectrum-alias-border-color-light:var(--spectrum-global-color-gray-200);--spectrum-alias-border-color-mid:var(--spectrum-global-color-gray-300);--spectrum-alias-border-color-dark:var(--spectrum-global-color-gray-400);--spectrum-alias-border-color-transparent:transparent;--spectrum-alias-border-color-translucent-dark:rgba(0,0,0,0.05);--spectrum-alias-border-color-translucent-darker:rgba(0,0,0,0.1);--spectrum-alias-focus-color:var(--spectrum-global-color-blue-400);--spectrum-alias-track-color-default:var(--spectrum-global-color-gray-300);--spectrum-alias-track-color-disabled:var(--spectrum-global-color-gray-300);--spectrum-alias-track-color-over-background:hsla(0,0%,100%,0.2);--spectrum-alias-icon-color:var(--spectrum-global-color-gray-700);--spectrum-alias-icon-color-over-background:var(--spectrum-global-color-static-white);--spectrum-alias-icon-color-hover:var(--spectrum-global-color-gray-900);--spectrum-alias-icon-color-down:var(--spectrum-global-color-gray-900);--spectrum-alias-icon-color-focus:var(--spectrum-global-color-gray-900);--spectrum-alias-icon-color-disabled:var(--spectrum-global-color-gray-400);--spectrum-alias-icon-color-selected-neutral:var(--spectrum-global-color-gray-900);--spectrum-alias-icon-color-selected:var(--spectrum-global-color-blue-500);--spectrum-alias-icon-color-selected-hover:var(--spectrum-global-color-blue-600);--spectrum-alias-icon-color-selected-down:var(--spectrum-global-color-blue-700);--spectrum-alias-icon-color-selected-focus:var(--spectrum-global-color-blue-600);--spectrum-alias-icon-color-error:var(--spectrum-global-color-red-400);--spectrum-alias-toolbar-background-color:var(--spectrum-global-color-gray-100);--spectrum-font-fallbacks-sans:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;--spectrum-font-family-base:"adobe-clean-ux","adobe-clean","Source Sans Pro",var(--spectrum-font-fallbacks-sans);--spectrum-font-family-han:"adobe-clean-han-japanese",var(--spectrum-font-fallbacks-sans);--spectrum-font-family-ar:"adobe-arabic","myriad-arabic",var(--spectrum-font-fallbacks-sans);--spectrum-font-family-he:"adobe-hebrew",var(--spectrum-font-fallbacks-sans);--spectrum-font-family-zhhans:"adobe-clean-han-simplified-c","SimSun","Heiti SC Light",var(--spectrum-font-fallbacks-sans);--spectrum-font-family-zh:var(--spectrum-font-family-zhhans);--spectrum-font-family-zhhant:"adobe-clean-han-traditional","Microsoft JhengHei UI","Microsoft JhengHei","Heiti TC Light",var(--spectrum-font-fallbacks-sans);--spectrum-font-family-ko:"adobe-clean-han-korean","Malgun Gothic","Apple Gothic",var(--spectrum-font-fallbacks-sans);--spectrum-font-family-ja:"adobe-clean-han-japanese","Yu Gothic","\\30E1 \\30A4 \\30EA \\30AA","\\30D2 \\30E9 \\30AE \\30CE \\89D2 \\30B4  Pro W3","Hiragino Kaku Gothic Pro W3","Osaka","\\FF2D \\FF33 \\FF30 \\30B4 \\30B7 \\30C3 \\30AF","MS PGothic",var(--spectrum-font-fallbacks-sans);--spectrum-text-size:var(--spectrum-alias-font-size-default);--spectrum-text-body-line-height:var(--spectrum-alias-line-height-medium);--spectrum-text-size-text-label:var(--spectrum-label-text-size);--spectrum-line-height-text-label:var(--spectrum-label-text-line-height);font-family:var(--spectrum-font-family-base);font-size:var(--spectrum-text-size)}:host:lang(ar),:root:lang(ar){font-family:var(--spectrum-font-family-ar)}:host:lang(he),:root:lang(he){font-family:var(--spectrum-font-family-he)}:host:lang(zh-Hans),:root:lang(zh-Hans){font-family:var(--spectrum-font-family-zhhans)}:host:lang(zh-Hant),:root:lang(zh-Hant){font-family:var(--spectrum-font-family-zhhant)}:host:lang(zh),:root:lang(zh){font-family:var(--spectrum-font-family-zh)}:host:lang(ko),:root:lang(ko){font-family:var(--spectrum-font-family-ko)}:host:lang(ja),:root:lang(ja){font-family:var(--spectrum-font-family-ja)}:host{display:block}#scale,#theme{width:100%;height:100%}`,rN=It`:host,:root{--spectrum-global-color-celery-400:#44b556;--spectrum-global-color-celery-500:#4bc35f;--spectrum-global-color-celery-600:#51d267;--spectrum-global-color-celery-700:#58e06f;--spectrum-global-color-chartreuse-400:#85d044;--spectrum-global-color-chartreuse-500:#8ede49;--spectrum-global-color-chartreuse-600:#9bec54;--spectrum-global-color-chartreuse-700:#a3f858;--spectrum-global-color-yellow-400:#dfbf00;--spectrum-global-color-yellow-500:#edcc00;--spectrum-global-color-yellow-600:#fad900;--spectrum-global-color-yellow-700:#ffe22e;--spectrum-global-color-magenta-400:#d83790;--spectrum-global-color-magenta-500:#e2499d;--spectrum-global-color-magenta-600:#ec5aaa;--spectrum-global-color-magenta-700:#f56bb7;--spectrum-global-color-fuchsia-400:#c038cc;--spectrum-global-color-fuchsia-500:#cf3edc;--spectrum-global-color-fuchsia-600:#d951e5;--spectrum-global-color-fuchsia-700:#e366ef;--spectrum-global-color-purple-400:#9256d9;--spectrum-global-color-purple-500:#9d64e1;--spectrum-global-color-purple-600:#a873e9;--spectrum-global-color-purple-700:#b483f0;--spectrum-global-color-indigo-400:#6767ec;--spectrum-global-color-indigo-500:#7575f1;--spectrum-global-color-indigo-600:#8282f6;--spectrum-global-color-indigo-700:#9090fa;--spectrum-global-color-seafoam-400:#1b959a;--spectrum-global-color-seafoam-500:#20a3a8;--spectrum-global-color-seafoam-600:#23b2b8;--spectrum-global-color-seafoam-700:#26c0c7;--spectrum-global-color-red-400:#e34850;--spectrum-global-color-red-500:#ec5b62;--spectrum-global-color-red-600:#f76d74;--spectrum-global-color-red-700:#ff7b82;--spectrum-global-color-orange-400:#e68619;--spectrum-global-color-orange-500:#f29423;--spectrum-global-color-orange-600:#f9a43f;--spectrum-global-color-orange-700:#ffb55b;--spectrum-global-color-green-400:#2d9d78;--spectrum-global-color-green-500:#33ab84;--spectrum-global-color-green-600:#39b990;--spectrum-global-color-green-700:#3fc89c;--spectrum-global-color-blue-400:#2680eb;--spectrum-global-color-blue-500:#378ef0;--spectrum-global-color-blue-600:#4b9cf5;--spectrum-global-color-blue-700:#5aa9fa;--spectrum-global-color-gray-50:#252525;--spectrum-global-color-gray-75:#2f2f2f;--spectrum-global-color-gray-100:#323232;--spectrum-global-color-gray-200:#3e3e3e;--spectrum-global-color-gray-300:#4a4a4a;--spectrum-global-color-gray-400:#5a5a5a;--spectrum-global-color-gray-500:#6e6e6e;--spectrum-global-color-gray-600:#909090;--spectrum-global-color-gray-700:#b9b9b9;--spectrum-global-color-gray-800:#e3e3e3;--spectrum-global-color-gray-900:#fff;--spectrum-alias-background-color-modal-overlay:rgba(0,0,0,0.5);--spectrum-alias-dropshadow-color:rgba(0,0,0,0.5);--spectrum-alias-background-color-hover-overlay:hsla(0,0%,100%,0.06);--spectrum-alias-highlight-hover:hsla(0,0%,100%,0.07);--spectrum-alias-highlight-active:hsla(0,0%,100%,0.1);--spectrum-alias-highlight-selected:rgba(55,142,240,0.15);--spectrum-alias-highlight-selected-hover:rgba(55,142,240,0.25);--spectrum-alias-text-highlight-color:rgba(55,142,240,0.25);--spectrum-alias-background-color-quickactions:rgba(50,50,50,0.9);--spectrum-alias-radial-reaction-color-default:hsla(0,0%,89%,0.6);--spectrum-alias-pasteboard-background-color:var(--spectrum-global-color-gray-50);--spectrum-alias-appframe-border-color:var(--spectrum-global-color-gray-50);--spectrum-alias-appframe-separator-color:var(--spectrum-global-color-gray-50);--spectrum-colorarea-border-color:hsla(0,0%,100%,0.1);--spectrum-colorarea-border-color-hover:hsla(0,0%,100%,0.1);--spectrum-colorarea-border-color-down:hsla(0,0%,100%,0.1);--spectrum-colorarea-border-color-key-focus:hsla(0,0%,100%,0.1);--spectrum-colorslider-border-color:hsla(0,0%,100%,0.1);--spectrum-colorslider-border-color-hover:hsla(0,0%,100%,0.1);--spectrum-colorslider-border-color-down:hsla(0,0%,100%,0.1);--spectrum-colorslider-border-color-key-focus:hsla(0,0%,100%,0.1);--spectrum-colorslider-vertical-border-color:hsla(0,0%,100%,0.1);--spectrum-colorslider-vertical-border-color-hover:hsla(0,0%,100%,0.1);--spectrum-colorslider-vertical-border-color-down:hsla(0,0%,100%,0.1);--spectrum-colorslider-vertical-border-color-key-focus:hsla(0,0%,100%,0.1);--spectrum-colorwheel-border-color:hsla(0,0%,100%,0.1);--spectrum-colorwheel-border-color-hover:hsla(0,0%,100%,0.1);--spectrum-colorwheel-border-color-down:hsla(0,0%,100%,0.1);--spectrum-colorwheel-border-color-key-focus:hsla(0,0%,100%,0.1);--spectrum-miller-column-item-background-color-selected:rgba(55,142,240,0.1);--spectrum-miller-column-item-background-color-selected-hover:rgba(55,142,240,0.2);--spectrum-tabs-compact-selection-indicator-color:var(--spectrum-global-color-blue-500);--spectrum-tabs-compact-vertical-rule-color:var(--spectrum-global-color-gray-200);--spectrum-tabs-compact-vertical-emphasized-selection-indicator-color:var(--spectrum-global-color-blue-500);--spectrum-tabs-compact-vertical-emphasized-rule-color:var(--spectrum-global-color-gray-200);--spectrum-tabs-emphasized-selection-indicator-color:var(--spectrum-global-color-blue-500);--spectrum-tabs-quiet-compact-emphasized-selection-indicator-color:var(--spectrum-global-color-blue-500);--spectrum-tabs-quiet-compact-vertical-emphasized-selection-indicator-color:var(--spectrum-global-color-blue-500);--spectrum-tabs-quiet-emphasized-selection-indicator-color:var(--spectrum-global-color-blue-500);--spectrum-tabs-quiet-vertical-emphasized-selection-indicator-color:var(--spectrum-global-color-blue-500);--spectrum-well-background-color:hsla(0,0%,89%,0.02);--spectrum-well-border-color:hsla(0,0%,100%,0.05)}:host{display:block}`;class nN extends Nt{static get styles(){return[eN,rN]}render(){return M`<slot></slot>`}}const oN=It`:host,:root{--spectrum-global-dimension-scale-factor:1;--spectrum-global-dimension-size-0:0px;--spectrum-global-dimension-size-10:1px;--spectrum-global-dimension-size-25:2px;--spectrum-global-dimension-size-40:3px;--spectrum-global-dimension-size-50:4px;--spectrum-global-dimension-size-65:5px;--spectrum-global-dimension-size-75:6px;--spectrum-global-dimension-size-85:7px;--spectrum-global-dimension-size-100:8px;--spectrum-global-dimension-size-115:9px;--spectrum-global-dimension-size-125:10px;--spectrum-global-dimension-size-130:11px;--spectrum-global-dimension-size-150:12px;--spectrum-global-dimension-size-160:13px;--spectrum-global-dimension-size-175:14px;--spectrum-global-dimension-size-200:16px;--spectrum-global-dimension-size-225:18px;--spectrum-global-dimension-size-250:20px;--spectrum-global-dimension-size-300:24px;--spectrum-global-dimension-size-350:28px;--spectrum-global-dimension-size-400:32px;--spectrum-global-dimension-size-450:36px;--spectrum-global-dimension-size-500:40px;--spectrum-global-dimension-size-550:44px;--spectrum-global-dimension-size-600:48px;--spectrum-global-dimension-size-675:54px;--spectrum-global-dimension-size-700:56px;--spectrum-global-dimension-size-800:64px;--spectrum-global-dimension-size-900:72px;--spectrum-global-dimension-size-1000:80px;--spectrum-global-dimension-size-1200:96px;--spectrum-global-dimension-size-1250:100px;--spectrum-global-dimension-size-1600:128px;--spectrum-global-dimension-size-1700:136px;--spectrum-global-dimension-size-2000:160px;--spectrum-global-dimension-size-2400:192px;--spectrum-global-dimension-size-3000:240px;--spectrum-global-dimension-size-3400:272px;--spectrum-global-dimension-size-3600:288px;--spectrum-global-dimension-size-4600:368px;--spectrum-global-dimension-size-5000:400px;--spectrum-global-dimension-size-6000:480px;--spectrum-global-dimension-font-size-25:10px;--spectrum-global-dimension-font-size-50:11px;--spectrum-global-dimension-font-size-75:12px;--spectrum-global-dimension-font-size-100:14px;--spectrum-global-dimension-font-size-150:15px;--spectrum-global-dimension-font-size-200:16px;--spectrum-global-dimension-font-size-300:18px;--spectrum-global-dimension-font-size-400:20px;--spectrum-global-dimension-font-size-500:22px;--spectrum-global-dimension-font-size-600:25px;--spectrum-global-dimension-font-size-700:28px;--spectrum-global-dimension-font-size-800:32px;--spectrum-global-dimension-font-size-900:36px;--spectrum-global-dimension-font-size-1000:40px;--spectrum-global-dimension-font-size-1100:45px;--spectrum-alias-heading-display1-text-size:var(--spectrum-global-dimension-font-size-1100);--spectrum-alias-heading-xxxl-text-size:var(--spectrum-global-dimension-font-size-1100);--spectrum-alias-heading-display1-margin-top:var(--spectrum-global-dimension-font-size-1000);--spectrum-alias-heading-xxxl-margin-top:var(--spectrum-global-dimension-font-size-1000);--spectrum-alias-heading-display2-text-size:var(--spectrum-global-dimension-font-size-1000);--spectrum-alias-heading-xxl-text-size:var(--spectrum-global-dimension-font-size-1000);--spectrum-alias-heading-display2-margin-top:var(--spectrum-global-dimension-font-size-900);--spectrum-alias-heading-xxl-margin-top:var(--spectrum-global-dimension-font-size-900);--spectrum-alias-heading1-text-size:var(--spectrum-global-dimension-font-size-900);--spectrum-alias-heading-xl-text-size:var(--spectrum-global-dimension-font-size-900);--spectrum-alias-heading1-margin-top:var(--spectrum-global-dimension-font-size-800);--spectrum-alias-heading-xl-margin-top:var(--spectrum-global-dimension-font-size-800);--spectrum-alias-heading2-text-size:var(--spectrum-global-dimension-font-size-700);--spectrum-alias-heading-l-text-size:var(--spectrum-global-dimension-font-size-700);--spectrum-alias-heading2-margin-top:var(--spectrum-global-dimension-font-size-600);--spectrum-alias-heading-l-margin-top:var(--spectrum-global-dimension-font-size-600);--spectrum-alias-heading3-text-size:var(--spectrum-global-dimension-font-size-500);--spectrum-alias-heading-m-text-size:var(--spectrum-global-dimension-font-size-500);--spectrum-alias-heading3-margin-top:var(--spectrum-global-dimension-font-size-400);--spectrum-alias-heading-m-margin-top:var(--spectrum-global-dimension-font-size-400);--spectrum-actionbutton-touch-hit-x:var(--spectrum-global-dimension-static-size-100);--spectrum-actionbutton-touch-hit-y:var(--spectrum-global-dimension-static-size-100);--spectrum-actionbutton-emphasized-touch-hit-x:var(--spectrum-global-dimension-static-size-100);--spectrum-actionbutton-emphasized-touch-hit-y:var(--spectrum-global-dimension-static-size-100);--spectrum-actionbutton-quiet-touch-hit-x:var(--spectrum-global-dimension-static-size-100);--spectrum-actionbutton-quiet-touch-hit-y:var(--spectrum-global-dimension-static-size-100);--spectrum-actionbutton-quiet-emphasized-touch-hit-x:var(--spectrum-global-dimension-static-size-100);--spectrum-actionbutton-quiet-emphasized-touch-hit-y:var(--spectrum-global-dimension-static-size-100);--spectrum-barloader-large-border-radius:3px;--spectrum-barloader-large-indeterminate-border-radius:3px;--spectrum-barloader-large-over-background-border-radius:3px;--spectrum-barloader-small-border-radius:var(--spectrum-global-dimension-static-size-25);--spectrum-barloader-small-indeterminate-border-radius:var(--spectrum-global-dimension-static-size-25);--spectrum-barloader-small-over-background-border-radius:var(--spectrum-global-dimension-static-size-25);--spectrum-breadcrumb-compact-item-touch-hit-y:var(--spectrum-global-dimension-static-size-100);--spectrum-breadcrumb-compact-button-touch-hit-y:var(--spectrum-global-dimension-static-size-100);--spectrum-breadcrumb-item-touch-hit-y:var(--spectrum-global-dimension-static-size-100);--spectrum-breadcrumb-button-touch-hit-y:var(--spectrum-global-dimension-static-size-100);--spectrum-breadcrumb-multiline-item-touch-hit-y:var(--spectrum-global-dimension-static-size-100);--spectrum-breadcrumb-multiline-button-touch-hit-y:var(--spectrum-global-dimension-static-size-100);--spectrum-button-cta-text-padding-bottom:[object Object];--spectrum-button-cta-min-width:var(--spectrum-global-dimension-size-900);--spectrum-button-cta-touch-hit-x:var(--spectrum-global-dimension-static-size-100);--spectrum-button-cta-touch-hit-y:var(--spectrum-global-dimension-static-size-100);--spectrum-button-over-background-text-padding-bottom:[object Object];--spectrum-button-over-background-min-width:var(--spectrum-global-dimension-size-900);--spectrum-button-over-background-touch-hit-x:var(--spectrum-global-dimension-static-size-100);--spectrum-button-over-background-touch-hit-y:var(--spectrum-global-dimension-static-size-100);--spectrum-button-primary-text-padding-bottom:[object Object];--spectrum-button-primary-min-width:var(--spectrum-global-dimension-size-900);--spectrum-button-primary-touch-hit-x:var(--spectrum-global-dimension-static-size-100);--spectrum-button-primary-touch-hit-y:var(--spectrum-global-dimension-static-size-100);--spectrum-button-quiet-over-background-text-padding-bottom:[object Object];--spectrum-button-quiet-over-background-min-width:var(--spectrum-global-dimension-size-900);--spectrum-button-quiet-over-background-touch-hit-x:var(--spectrum-global-dimension-static-size-200);--spectrum-button-quiet-over-background-touch-hit-y:var(--spectrum-global-dimension-static-size-100);--spectrum-button-quiet-over-background-cursor-hit-x:var(--spectrum-global-dimension-static-size-200);--spectrum-button-quiet-primary-text-padding-bottom:[object Object];--spectrum-button-quiet-primary-min-width:var(--spectrum-global-dimension-size-900);--spectrum-button-quiet-primary-touch-hit-x:var(--spectrum-global-dimension-static-size-200);--spectrum-button-quiet-primary-touch-hit-y:var(--spectrum-global-dimension-static-size-100);--spectrum-button-quiet-primary-cursor-hit-x:var(--spectrum-global-dimension-static-size-200);--spectrum-button-quiet-secondary-text-padding-bottom:[object Object];--spectrum-button-quiet-secondary-min-width:var(--spectrum-global-dimension-size-900);--spectrum-button-quiet-secondary-touch-hit-x:var(--spectrum-global-dimension-static-size-200);--spectrum-button-quiet-secondary-touch-hit-y:var(--spectrum-global-dimension-static-size-100);--spectrum-button-quiet-secondary-cursor-hit-x:var(--spectrum-global-dimension-static-size-200);--spectrum-button-quiet-warning-text-padding-bottom:[object Object];--spectrum-button-quiet-warning-min-width:var(--spectrum-global-dimension-size-900);--spectrum-button-quiet-warning-touch-hit-x:var(--spectrum-global-dimension-static-size-200);--spectrum-button-quiet-warning-touch-hit-y:var(--spectrum-global-dimension-static-size-100);--spectrum-button-quiet-warning-cursor-hit-x:var(--spectrum-global-dimension-static-size-200);--spectrum-button-secondary-text-padding-bottom:[object Object];--spectrum-button-secondary-min-width:var(--spectrum-global-dimension-size-900);--spectrum-button-secondary-touch-hit-x:var(--spectrum-global-dimension-static-size-100);--spectrum-button-secondary-touch-hit-y:var(--spectrum-global-dimension-static-size-100);--spectrum-button-warning-text-padding-bottom:[object Object];--spectrum-button-warning-min-width:var(--spectrum-global-dimension-size-900);--spectrum-button-warning-touch-hit-x:var(--spectrum-global-dimension-static-size-100);--spectrum-button-warning-touch-hit-y:var(--spectrum-global-dimension-static-size-100);--spectrum-checkbox-text-gap-key-focus:var(--spectrum-global-dimension-static-size-115);--spectrum-checkbox-text-gap-selected-key-focus:var(--spectrum-global-dimension-static-size-115);--spectrum-checkbox-text-gap-indeterminate-key-focus:var(--spectrum-global-dimension-static-size-115);--spectrum-checkbox-text-gap-error-key-focus:var(--spectrum-global-dimension-static-size-115);--spectrum-checkbox-text-gap-error-selected-key-focus:var(--spectrum-global-dimension-static-size-115);--spectrum-checkbox-text-gap-error-indeterminate-key-focus:var(--spectrum-global-dimension-static-size-115);--spectrum-checkbox-touch-hit-y:var(--spectrum-global-dimension-static-size-100);--spectrum-checkbox-emphasized-text-gap-key-focus:var(--spectrum-global-dimension-static-size-115);--spectrum-checkbox-emphasized-text-gap-selected-key-focus:var(--spectrum-global-dimension-static-size-115);--spectrum-checkbox-emphasized-text-gap-indeterminate-key-focus:var(--spectrum-global-dimension-static-size-115);--spectrum-checkbox-emphasized-text-gap-error-key-focus:var(--spectrum-global-dimension-static-size-115);--spectrum-checkbox-emphasized-text-gap-error-selected-key-focus:var(--spectrum-global-dimension-static-size-115);--spectrum-checkbox-emphasized-text-gap-error-indeterminate-key-focus:var(--spectrum-global-dimension-static-size-115);--spectrum-checkbox-emphasized-touch-hit-y:var(--spectrum-global-dimension-static-size-100);--spectrum-checkbox-quiet-text-gap-key-focus:var(--spectrum-global-dimension-static-size-115);--spectrum-checkbox-quiet-text-gap-selected-key-focus:var(--spectrum-global-dimension-static-size-115);--spectrum-checkbox-quiet-text-gap-indeterminate-key-focus:var(--spectrum-global-dimension-static-size-115);--spectrum-checkbox-quiet-text-gap-error-key-focus:var(--spectrum-global-dimension-static-size-115);--spectrum-checkbox-quiet-text-gap-error-selected-key-focus:var(--spectrum-global-dimension-static-size-115);--spectrum-checkbox-quiet-text-gap-error-indeterminate-key-focus:var(--spectrum-global-dimension-static-size-115);--spectrum-checkbox-quiet-touch-hit-y:var(--spectrum-global-dimension-static-size-100);--spectrum-circleloader-medium-border-size:3px;--spectrum-circleloader-medium-over-background-border-size:3px;--spectrum-circleloader-small-border-size:var(--spectrum-global-dimension-static-size-25);--spectrum-circleloader-small-over-background-border-size:var(--spectrum-global-dimension-static-size-25);--spectrum-colorhandle-loupe-margin:var(--spectrum-global-dimension-static-size-125);--spectrum-colorslider-touch-hit-y:var(--spectrum-global-dimension-size-150);--spectrum-colorslider-vertical-touch-hit-x:var(--spectrum-global-dimension-size-150);--spectrum-colorwheel-min-size:var(--spectrum-global-dimension-size-2400);--spectrum-colorwheel-touch-hit-outer:var(--spectrum-global-dimension-size-150);--spectrum-colorwheel-touch-hit-inner:var(--spectrum-global-dimension-size-150);--spectrum-cyclebutton-touch-hit-x:var(--spectrum-global-dimension-static-size-100);--spectrum-cyclebutton-touch-hit-y:var(--spectrum-global-dimension-static-size-100);--spectrum-dialog-confirm-max-width:var(--spectrum-global-dimension-static-size-6000);--spectrum-dialog-confirm-title-text-size:var(--spectrum-global-dimension-font-size-300);--spectrum-dialog-confirm-description-text-size:var(--spectrum-global-dimension-font-size-100);--spectrum-dialog-confirm-padding:var(--spectrum-global-dimension-static-size-500);--spectrum-dialog-confirm-description-margin-bottom:var(--spectrum-global-dimension-static-size-600);--spectrum-dialog-max-width:var(--spectrum-global-dimension-static-size-6000);--spectrum-dialog-title-text-size:var(--spectrum-global-dimension-font-size-300);--spectrum-dialog-content-text-size:var(--spectrum-global-dimension-font-size-100);--spectrum-dialog-padding:var(--spectrum-global-dimension-static-size-500);--spectrum-dialog-content-margin-bottom:var(--spectrum-global-dimension-static-size-600);--spectrum-dialog-destructive-max-width:var(--spectrum-global-dimension-static-size-6000);--spectrum-dialog-destructive-title-text-size:var(--spectrum-global-dimension-font-size-300);--spectrum-dialog-destructive-description-text-size:var(--spectrum-global-dimension-font-size-100);--spectrum-dialog-destructive-padding:var(--spectrum-global-dimension-static-size-500);--spectrum-dialog-destructive-description-margin-bottom:var(--spectrum-global-dimension-static-size-600);--spectrum-dialog-error-max-width:var(--spectrum-global-dimension-static-size-6000);--spectrum-dialog-error-title-text-size:var(--spectrum-global-dimension-font-size-300);--spectrum-dialog-error-description-text-size:var(--spectrum-global-dimension-font-size-100);--spectrum-dialog-error-padding:var(--spectrum-global-dimension-static-size-500);--spectrum-dialog-error-description-margin-bottom:var(--spectrum-global-dimension-static-size-600);--spectrum-dialog-info-max-width:var(--spectrum-global-dimension-static-size-6000);--spectrum-dialog-info-title-text-size:var(--spectrum-global-dimension-font-size-300);--spectrum-dialog-info-description-text-size:var(--spectrum-global-dimension-font-size-100);--spectrum-dialog-info-padding:var(--spectrum-global-dimension-static-size-500);--spectrum-dialog-info-description-margin-bottom:var(--spectrum-global-dimension-static-size-600);--spectrum-dropdown-touch-hit-x:var(--spectrum-global-dimension-static-size-100);--spectrum-dropdown-touch-hit-y:var(--spectrum-global-dimension-static-size-100);--spectrum-dropdown-quiet-touch-hit-y:var(--spectrum-global-dimension-static-size-400);--spectrum-dropdown-thumbnail-small-touch-hit-x:var(--spectrum-global-dimension-static-size-100);--spectrum-dropdown-thumbnail-small-touch-hit-y:var(--spectrum-global-dimension-static-size-100);--spectrum-fieldbutton-quiet-min-width:var(--spectrum-global-dimension-size-225);--spectrum-icon-arrow-down-small-height:var(--spectrum-global-dimension-size-125);--spectrum-icon-arrow-left-medium-height:var(--spectrum-global-dimension-size-125);--spectrum-icon-checkmark-medium-width:var(--spectrum-global-dimension-size-150);--spectrum-icon-checkmark-medium-height:var(--spectrum-global-dimension-size-150);--spectrum-icon-checkmark-small-width:var(--spectrum-global-dimension-size-125);--spectrum-icon-checkmark-small-height:var(--spectrum-global-dimension-size-125);--spectrum-icon-chevron-down-medium-width:var(--spectrum-global-dimension-size-125);--spectrum-icon-chevron-left-large-width:var(--spectrum-global-dimension-size-150);--spectrum-icon-chevron-left-medium-height:var(--spectrum-global-dimension-size-125);--spectrum-icon-chevron-right-large-width:var(--spectrum-global-dimension-size-150);--spectrum-icon-chevron-right-medium-height:var(--spectrum-global-dimension-size-125);--spectrum-icon-cross-large-width:var(--spectrum-global-dimension-size-150);--spectrum-icon-cross-large-height:var(--spectrum-global-dimension-size-150);--spectrum-icon-dash-small-width:var(--spectrum-global-dimension-size-125);--spectrum-icon-dash-small-height:var(--spectrum-global-dimension-size-125);--spectrum-icon-skip-left-width:9px;--spectrum-icon-skip-left-height:var(--spectrum-global-dimension-size-125);--spectrum-icon-skip-right-width:9px;--spectrum-icon-skip-right-height:var(--spectrum-global-dimension-size-125);--spectrum-icon-triplegripper-width:var(--spectrum-global-dimension-size-125);--spectrum-loader-bar-large-border-radius:3px;--spectrum-loader-bar-large-over-background-border-radius:3px;--spectrum-loader-bar-small-border-radius:var(--spectrum-global-dimension-static-size-25);--spectrum-loader-bar-small-over-background-border-radius:var(--spectrum-global-dimension-static-size-25);--spectrum-loader-circle-medium-border-size:3px;--spectrum-loader-circle-medium-over-background-border-size:3px;--spectrum-loader-circle-small-border-size:var(--spectrum-global-dimension-static-size-25);--spectrum-loader-circle-small-over-background-border-size:var(--spectrum-global-dimension-static-size-25);--spectrum-meter-large-border-radius:3px;--spectrum-meter-small-border-radius:var(--spectrum-global-dimension-static-size-25);--spectrum-pagination-page-button-line-height:26px;--spectrum-radio-text-gap-key-focus:var(--spectrum-global-dimension-static-size-115);--spectrum-radio-text-gap-selected-key-focus:var(--spectrum-global-dimension-static-size-115);--spectrum-radio-text-gap-error-key-focus:var(--spectrum-global-dimension-static-size-115);--spectrum-radio-text-gap-error-selected-key-focus:var(--spectrum-global-dimension-static-size-115);--spectrum-radio-margin-bottom:0px;--spectrum-radio-touch-hit-y:var(--spectrum-global-dimension-static-size-100);--spectrum-radio-emphasized-text-gap-key-focus:var(--spectrum-global-dimension-static-size-115);--spectrum-radio-emphasized-text-gap-selected-key-focus:var(--spectrum-global-dimension-static-size-115);--spectrum-radio-emphasized-text-gap-error-key-focus:var(--spectrum-global-dimension-static-size-115);--spectrum-radio-emphasized-text-gap-error-selected-key-focus:var(--spectrum-global-dimension-static-size-115);--spectrum-radio-emphasized-margin-bottom:0px;--spectrum-radio-emphasized-touch-hit-y:var(--spectrum-global-dimension-static-size-100);--spectrum-radio-quiet-text-gap-key-focus:var(--spectrum-global-dimension-static-size-115);--spectrum-radio-quiet-text-gap-selected-key-focus:var(--spectrum-global-dimension-static-size-115);--spectrum-radio-quiet-text-gap-error-key-focus:var(--spectrum-global-dimension-static-size-115);--spectrum-radio-quiet-text-gap-error-selected-key-focus:var(--spectrum-global-dimension-static-size-115);--spectrum-radio-quiet-margin-bottom:0px;--spectrum-radio-quiet-touch-hit-y:var(--spectrum-global-dimension-static-size-100);--spectrum-rating-icon-width:24px;--spectrum-rating-indicator-width:16px;--spectrum-rating-touch-hit-y:var(--spectrum-global-dimension-static-size-100);--spectrum-rating-emphasized-icon-width:24px;--spectrum-rating-emphasized-indicator-width:16px;--spectrum-rating-emphasized-touch-hit-y:var(--spectrum-global-dimension-static-size-100);--spectrum-rating-quiet-icon-width:24px;--spectrum-rating-quiet-indicator-width:16px;--spectrum-rating-quiet-touch-hit-y:var(--spectrum-global-dimension-static-size-100);--spectrum-search-touch-hit-x:var(--spectrum-global-dimension-static-size-100);--spectrum-search-touch-hit-y:var(--spectrum-global-dimension-static-size-100);--spectrum-search-icon-frame:var(--spectrum-global-dimension-static-size-400);--spectrum-search-quiet-touch-hit-x:var(--spectrum-global-dimension-static-size-100);--spectrum-search-quiet-touch-hit-y:var(--spectrum-global-dimension-static-size-100);--spectrum-search-quiet-icon-frame:var(--spectrum-global-dimension-static-size-400);--spectrum-selectlist-option-icon-size:var(--spectrum-global-dimension-static-size-150);--spectrum-selectlist-option-icon-padding-y:var(--spectrum-global-dimension-static-size-125);--spectrum-selectlist-option-icon-margin-top:var(--spectrum-global-dimension-static-size-65);--spectrum-selectlist-option-height:var(--spectrum-global-dimension-static-size-400);--spectrum-selectlist-thumbnail-option-icon-padding-y:var(--spectrum-global-dimension-static-size-125);--spectrum-selectlist-thumbnail-small-option-icon-padding-y:var(--spectrum-global-dimension-static-size-125);--spectrum-sidenav-item-touch-hit-bottom:var(--spectrum-global-dimension-static-size-25);--spectrum-sidenav-multilevel-item-touch-hit-bottom:var(--spectrum-global-dimension-static-size-25);--spectrum-slider-track-touch-hit-y:var(--spectrum-global-dimension-static-size-100);--spectrum-slider-handle-touch-hit-x:var(--spectrum-global-dimension-static-size-200);--spectrum-slider-handle-touch-hit-y:var(--spectrum-global-dimension-static-size-200);--spectrum-slider-editable-track-touch-hit-y:var(--spectrum-global-dimension-static-size-100);--spectrum-slider-editable-handle-touch-hit-x:var(--spectrum-global-dimension-static-size-200);--spectrum-slider-editable-handle-touch-hit-y:var(--spectrum-global-dimension-static-size-200);--spectrum-slider-fill-track-touch-hit-y:var(--spectrum-global-dimension-static-size-100);--spectrum-slider-fill-handle-touch-hit-x:var(--spectrum-global-dimension-static-size-200);--spectrum-slider-fill-handle-touch-hit-y:var(--spectrum-global-dimension-static-size-200);--spectrum-switch-text-gap-key-focus:var(--spectrum-global-dimension-static-size-115);--spectrum-switch-text-gap-selected-key-focus:var(--spectrum-global-dimension-static-size-115);--spectrum-switch-text-gap-error-key-focus:var(--spectrum-global-dimension-static-size-115);--spectrum-switch-text-gap-error-selected-key-focus:var(--spectrum-global-dimension-static-size-115);--spectrum-switch-track-width:26px;--spectrum-switch-handle-border-radius:7px;--spectrum-switch-touch-hit-y:var(--spectrum-global-dimension-static-size-100);--spectrum-switch-emphasized-text-gap-key-focus:var(--spectrum-global-dimension-static-size-115);--spectrum-switch-emphasized-text-gap-selected-key-focus:var(--spectrum-global-dimension-static-size-115);--spectrum-switch-emphasized-text-gap-error-key-focus:var(--spectrum-global-dimension-static-size-115);--spectrum-switch-emphasized-text-gap-error-selected-key-focus:var(--spectrum-global-dimension-static-size-115);--spectrum-switch-emphasized-track-width:26px;--spectrum-switch-emphasized-handle-border-radius:7px;--spectrum-switch-emphasized-touch-hit-y:var(--spectrum-global-dimension-static-size-100);--spectrum-switch-quiet-text-gap-key-focus:var(--spectrum-global-dimension-static-size-115);--spectrum-switch-quiet-text-gap-selected-key-focus:var(--spectrum-global-dimension-static-size-115);--spectrum-switch-quiet-text-gap-error-key-focus:var(--spectrum-global-dimension-static-size-115);--spectrum-switch-quiet-text-gap-error-selected-key-focus:var(--spectrum-global-dimension-static-size-115);--spectrum-switch-quiet-track-width:26px;--spectrum-switch-quiet-handle-border-radius:7px;--spectrum-switch-quiet-touch-hit-y:var(--spectrum-global-dimension-static-size-100);--spectrum-tabs-compact-focus-ring-border-radius:5px;--spectrum-tabs-compact-margin-left:-8px;--spectrum-tabs-compact-margin-right:-8px;--spectrum-tabs-compact-vertical-focus-ring-border-radius:5px;--spectrum-tabs-compact-vertical-emphasized-focus-ring-border-radius:5px;--spectrum-tabs-baseline:var(--spectrum-global-dimension-size-225);--spectrum-tabs-focus-ring-border-radius:5px;--spectrum-tabs-margin-left:-8px;--spectrum-tabs-margin-right:-8px;--spectrum-tabs-emphasized-baseline:var(--spectrum-global-dimension-size-225);--spectrum-tabs-emphasized-focus-ring-border-radius:5px;--spectrum-tabs-emphasized-margin-left:-8px;--spectrum-tabs-emphasized-margin-right:-8px;--spectrum-tabs-quiet-baseline:var(--spectrum-global-dimension-size-225);--spectrum-tabs-quiet-focus-ring-border-radius:5px;--spectrum-tabs-quiet-margin-left:-8px;--spectrum-tabs-quiet-margin-right:-8px;--spectrum-tabs-quiet-compact-focus-ring-border-radius:5px;--spectrum-tabs-quiet-compact-margin-left:-8px;--spectrum-tabs-quiet-compact-margin-right:-8px;--spectrum-tabs-quiet-compact-emphasized-focus-ring-border-radius:5px;--spectrum-tabs-quiet-compact-emphasized-margin-left:-8px;--spectrum-tabs-quiet-compact-emphasized-margin-right:-8px;--spectrum-tabs-quiet-compact-vertical-focus-ring-border-radius:5px;--spectrum-tabs-quiet-compact-vertical-emphasized-focus-ring-border-radius:5px;--spectrum-tabs-quiet-emphasized-baseline:var(--spectrum-global-dimension-size-225);--spectrum-tabs-quiet-emphasized-focus-ring-border-radius:5px;--spectrum-tabs-quiet-emphasized-margin-left:-8px;--spectrum-tabs-quiet-emphasized-margin-right:-8px;--spectrum-tabs-quiet-vertical-baseline:var(--spectrum-global-dimension-size-225);--spectrum-tabs-quiet-vertical-focus-ring-border-radius:5px;--spectrum-tabs-quiet-vertical-emphasized-baseline:var(--spectrum-global-dimension-size-225);--spectrum-tabs-quiet-vertical-emphasized-focus-ring-border-radius:5px;--spectrum-tabs-vertical-baseline:var(--spectrum-global-dimension-size-225);--spectrum-tabs-vertical-focus-ring-border-radius:5px;--spectrum-textarea-touch-hit-x:var(--spectrum-global-dimension-static-size-100);--spectrum-textarea-touch-hit-y:var(--spectrum-global-dimension-static-size-100);--spectrum-textarea-icon-frame:var(--spectrum-global-dimension-static-size-400);--spectrum-textarea-quiet-touch-hit-x:var(--spectrum-global-dimension-static-size-100);--spectrum-textarea-quiet-touch-hit-y:var(--spectrum-global-dimension-static-size-100);--spectrum-textarea-quiet-icon-frame:var(--spectrum-global-dimension-static-size-400);--spectrum-textfield-touch-hit-x:var(--spectrum-global-dimension-static-size-100);--spectrum-textfield-touch-hit-y:var(--spectrum-global-dimension-static-size-100);--spectrum-textfield-icon-frame:var(--spectrum-global-dimension-static-size-400);--spectrum-textfield-quiet-touch-hit-x:var(--spectrum-global-dimension-static-size-100);--spectrum-textfield-quiet-touch-hit-y:var(--spectrum-global-dimension-static-size-100);--spectrum-textfield-quiet-icon-frame:var(--spectrum-global-dimension-static-size-400);--spectrum-tool-touch-hit-x:var(--spectrum-global-dimension-static-size-100);--spectrum-tool-touch-hit-y:var(--spectrum-global-dimension-static-size-100);--spectrum-tool-high-emphasis-touch-hit-x:var(--spectrum-global-dimension-static-size-100);--spectrum-tool-high-emphasis-touch-hit-y:var(--spectrum-global-dimension-static-size-100);--spectrum-tooltip-padding-bottom:5px;--spectrum-tooltip-content-max-width:101px;--spectrum-tooltip-info-padding-bottom:5px;--spectrum-tooltip-info-content-max-width:101px;--spectrum-tooltip-negative-padding-bottom:5px;--spectrum-tooltip-negative-content-max-width:101px;--spectrum-tooltip-positive-padding-bottom:5px;--spectrum-tooltip-positive-content-max-width:101px}:host{display:block}`;class aN extends Nt{static get styles(){return[eN,oN]}render(){return M`<slot></slot>`}}class iN extends Nt{constructor(){super(...arguments),this.color="light",this.scale="medium"}renderTheme(t){let e;if("light"===this.color)e=M`<sp-theme-light id="theme">${t}</sp-theme-light>`;else{if("dark"!==this.color)return console.warn(`Unknown color ${this.color} for sp-theme`),t;e=M`<sp-theme-dark id="theme">${t}</sp-theme-dark>`}return customElements.get(`sp-theme-${this.color}`)||console.warn(`Theme component sp-theme-${this.color} has not been registered`),e}renderScale(t){let e;return"medium"!==this.scale?(console.warn(`Unknown scale ${this.scale} for sp-theme`),t):(e=M`<sp-scale-medium id="scale">${t}</sp-scale-medium>`,customElements.get(`sp-theme-${this.color}`)||console.warn(`Theme component sp-scale-${this.scale} has not been registered`),e)}render(){return this.renderTheme(this.renderScale(M`<slot></slot>`))}}Y([xt({reflect:!0})],iN.prototype,"color",void 0),Y([xt({reflect:!0})],iN.prototype,"scale",void 0);class sN extends Nt{static get styles(){return[eN,XA]}render(){return M`<slot></slot>`}}const uN=It`:host,:root{--spectrum-global-color-celery-400:#4bc35f;--spectrum-global-color-celery-500:#44b556;--spectrum-global-color-celery-600:#3da74e;--spectrum-global-color-celery-700:#379947;--spectrum-global-color-chartreuse-400:#8ede49;--spectrum-global-color-chartreuse-500:#85d044;--spectrum-global-color-chartreuse-600:#7cc33f;--spectrum-global-color-chartreuse-700:#73b53a;--spectrum-global-color-yellow-400:#edcc00;--spectrum-global-color-yellow-500:#dfbf00;--spectrum-global-color-yellow-600:#d2b200;--spectrum-global-color-yellow-700:#c4a600;--spectrum-global-color-magenta-400:#e2499d;--spectrum-global-color-magenta-500:#d83790;--spectrum-global-color-magenta-600:#ca2982;--spectrum-global-color-magenta-700:#bc1c74;--spectrum-global-color-fuchsia-400:#cf3edc;--spectrum-global-color-fuchsia-500:#c038cc;--spectrum-global-color-fuchsia-600:#b130bd;--spectrum-global-color-fuchsia-700:#a228ad;--spectrum-global-color-purple-400:#9d64e1;--spectrum-global-color-purple-500:#9256d9;--spectrum-global-color-purple-600:#864ccc;--spectrum-global-color-purple-700:#7a42bf;--spectrum-global-color-indigo-400:#7575f1;--spectrum-global-color-indigo-500:#6767ec;--spectrum-global-color-indigo-600:#5c5ce0;--spectrum-global-color-indigo-700:#5151d3;--spectrum-global-color-seafoam-400:#20a3a8;--spectrum-global-color-seafoam-500:#1b959a;--spectrum-global-color-seafoam-600:#16878c;--spectrum-global-color-seafoam-700:#0f797d;--spectrum-global-color-red-400:#ec5b62;--spectrum-global-color-red-500:#e34850;--spectrum-global-color-red-600:#d7373f;--spectrum-global-color-red-700:#c9252d;--spectrum-global-color-orange-400:#f29423;--spectrum-global-color-orange-500:#e68619;--spectrum-global-color-orange-600:#da7b11;--spectrum-global-color-orange-700:#cb6f10;--spectrum-global-color-green-400:#33ab84;--spectrum-global-color-green-500:#2d9d78;--spectrum-global-color-green-600:#268e6c;--spectrum-global-color-green-700:#12805c;--spectrum-global-color-blue-400:#378ef0;--spectrum-global-color-blue-500:#2680eb;--spectrum-global-color-blue-600:#1473e6;--spectrum-global-color-blue-700:#0d66d0;--spectrum-global-color-gray-50:#fff;--spectrum-global-color-gray-75:#fff;--spectrum-global-color-gray-100:#fff;--spectrum-global-color-gray-200:#f4f4f4;--spectrum-global-color-gray-300:#eaeaea;--spectrum-global-color-gray-400:#d3d3d3;--spectrum-global-color-gray-500:#bcbcbc;--spectrum-global-color-gray-600:#959595;--spectrum-global-color-gray-700:#747474;--spectrum-global-color-gray-800:#505050;--spectrum-global-color-gray-900:#323232;--spectrum-alias-background-color-modal-overlay:rgba(0,0,0,0.4);--spectrum-alias-dropshadow-color:rgba(0,0,0,0.15);--spectrum-alias-background-color-hover-overlay:rgba(50,50,50,0.04);--spectrum-alias-highlight-hover:rgba(50,50,50,0.06);--spectrum-alias-highlight-active:rgba(50,50,50,0.1);--spectrum-alias-highlight-selected:rgba(38,128,235,0.1);--spectrum-alias-highlight-selected-hover:rgba(38,128,235,0.2);--spectrum-alias-text-highlight-color:rgba(38,128,235,0.2);--spectrum-alias-background-color-quickactions:hsla(0,0%,100%,0.9);--spectrum-alias-radial-reaction-color-default:rgba(80,80,80,0.6);--spectrum-alias-pasteboard-background-color:var(--spectrum-global-color-gray-300);--spectrum-alias-appframe-border-color:var(--spectrum-global-color-gray-300);--spectrum-alias-appframe-separator-color:var(--spectrum-global-color-gray-300);--spectrum-tabs-compact-selection-indicator-color:var(--spectrum-global-color-blue-500);--spectrum-tabs-compact-vertical-rule-color:var(--spectrum-global-color-gray-200);--spectrum-tabs-compact-vertical-emphasized-rule-color:var(--spectrum-global-color-gray-200);--spectrum-tabs-compact-vertical-emphasized-selection-indicator-color:var(--spectrum-global-color-blue-500);--spectrum-tabs-emphasized-selection-indicator-color:var(--spectrum-global-color-blue-500);--spectrum-tabs-quiet-compact-emphasized-selection-indicator-color:var(--spectrum-global-color-blue-500);--spectrum-tabs-quiet-compact-vertical-emphasized-selection-indicator-color:var(--spectrum-global-color-blue-500);--spectrum-tabs-quiet-emphasized-selection-indicator-color:var(--spectrum-global-color-blue-500);--spectrum-tabs-quiet-vertical-emphasized-selection-indicator-color:var(--spectrum-global-color-blue-500);--spectrum-colorarea-border-color:rgba(50,50,50,0.1);--spectrum-colorarea-border-color-hover:rgba(50,50,50,0.1);--spectrum-colorarea-border-color-down:rgba(50,50,50,0.1);--spectrum-colorarea-border-color-key-focus:rgba(50,50,50,0.1);--spectrum-colorslider-border-color:rgba(50,50,50,0.1);--spectrum-colorslider-border-color-hover:rgba(50,50,50,0.1);--spectrum-colorslider-border-color-down:rgba(50,50,50,0.1);--spectrum-colorslider-border-color-key-focus:rgba(50,50,50,0.1);--spectrum-colorslider-vertical-border-color:rgba(50,50,50,0.1);--spectrum-colorslider-vertical-border-color-hover:rgba(50,50,50,0.1);--spectrum-colorslider-vertical-border-color-down:rgba(50,50,50,0.1);--spectrum-colorslider-vertical-border-color-key-focus:rgba(50,50,50,0.1);--spectrum-colorwheel-border-color:rgba(50,50,50,0.1);--spectrum-colorwheel-border-color-hover:rgba(50,50,50,0.1);--spectrum-colorwheel-border-color-down:rgba(50,50,50,0.1);--spectrum-colorwheel-border-color-key-focus:rgba(50,50,50,0.1);--spectrum-miller-column-item-background-color-selected:rgba(38,128,235,0.1);--spectrum-miller-column-item-background-color-selected-hover:rgba(38,128,235,0.2);--spectrum-well-background-color:rgba(80,80,80,0.02);--spectrum-well-border-color:rgba(50,50,50,0.05)}:host{display:block}`;class lN extends Nt{static get styles(){return[eN,uN]}render(){return M`<slot></slot>`}}customElements.get("sp-theme-dark")||customElements.define("sp-theme-dark",nN),customElements.get("sp-theme-light")||customElements.define("sp-theme-light",sN),customElements.get("sp-theme-lightest")||customElements.define("sp-theme-lightest",lN),customElements.get("sp-scale-medium")||customElements.define("sp-scale-medium",aN),customElements.get("sp-theme")||customElements.define("sp-theme",iN);var cN={render(t,e){return M`${this.css()} ${this.html(t,e)}`},html:(t,e)=>M`<sp-theme color="light" scale="medium"><dy-settings></dy-settings><dy-asset-library></dy-asset-library><dy-video></dy-video><div ?active="${e.showModal}" id="modal-container"><div id="modal-contents"><dy-part-editor></dy-part-editor></div></div><dy-capture></dy-capture></sp-theme>`,css:()=>M`<style>#modal-container{left:0;right:0;top:0;bottom:0;margin:auto;background-color:#4a4a4a4a;position:absolute;display:none}#modal-container[active]{display:inline-block}#modal-contents{left:10%;right:10%;top:10%;bottom:10%;margin:auto;border-radius:15px;border-width:1px;border-style:solid;border-color:#e1e1e1;background-color:#fff;position:absolute;display:inline-block}dy-capture{position:absolute;top:0;left:33%;background-color:#fff;border-bottom-left-radius:15px;border-bottom-right-radius:15px;border-style:solid;border-width:1px;border-color:var(--spectrum-global-color-gray-600)}dy-part-editor{width:100%;height:100%}dy-video{width:100%;height:100%}dy-settings{width:300px;margin-left:-300px;background-color:#000;height:calc(100% - 30px);position:absolute;left:0;border-right-style:solid;border-right-width:2px;border-right-color:#3a3a3a}dy-settings.expanded{background-color:#fff;margin-left:0;border-right-color:#e1e1e1}dy-asset-library{width:300px;margin-right:-320px;background-color:#000;height:calc(100% - 30px);position:absolute;right:0;border-left-style:solid;border-left-width:2px;border-left-color:#3a3a3a}dy-asset-library.expanded{background-color:#fff;margin-right:0;border-left-color:#e1e1e1}</style>`};function pN(t){for(var e=window.location.search.substring(1).split("&"),r=0;r<e.length;r++){var n=e[r].split("=");if(decodeURIComponent(n[0])==t)return decodeURIComponent(n[1])}console.log("Query variable %s not found",t)}class dN extends HTMLElement{static get observedAttributes(){}propertyChangedCallback(t,e,r){}connectedCallback(){this.init(cN,{showModal:!1}),this.addEventListener(QA.DISMISS,t=>{this.model.showModal=!1,this.render()}),this.addEventListener(tN.EDIT_ASSET,t=>{this.model.showModal=!0;const e=this.shadowRoot.querySelector("dy-part-editor");this.render(),requestAnimationFrame(()=>{e.resize(),e.part=t.detail})});const t=this.shadowRoot.querySelector("dy-video");pN("video")?t.source=pN("video"):t.camera=!0}}V("dy-app",dN,P);export default dN;
//# sourceMappingURL=app-78cc1907.js.map
